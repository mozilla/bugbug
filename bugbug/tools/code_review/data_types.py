from pydantic import BaseModel, Field

from bugbug.tools.core.data_types import InlineComment


class GeneratedReviewComment(BaseModel):
    """A review comment generated by the code review agent."""

    file: str = Field(description="The path to the file the comment applies to.")
    code_line: int = Field(description="The line number that the comment refers to.")
    comment: str = Field(description="The review comment.")
    explanation: str = Field(
        description="A brief rationale for the comment, including how confident you are and why."
    )
    order: int = Field(
        description="An integer representing the priority of the comment, with 1 being the highest confidence/importance."
    )


class AgentResponse(BaseModel):
    """The response from the code review agent."""

    comments: list[GeneratedReviewComment] = Field(
        description="A list of generated review comments."
    )


class CodeReviewToolResponse(BaseModel):
    """The response from the CodeReviewTool."""

    review_comments: list[InlineComment] = Field(
        description="A list of inline comments to be added to the code review, converted from the agent's generated comments."
    )
    patch_summary: str = Field(
        description="A brief summary of the patch, generated by the agent."
    )
    details: dict = Field(
        description="Additional details about the tool's execution, such as which models were used and any relevant metadata."
    )
