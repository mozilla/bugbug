{"cf_tracking_thunderbird_esr52": "---", "status": "RESOLVED", "cf_tracking_firefox60": "---", "attachments": [], "classification": "Components", "creator": "kinetik@flim.org", "mentors_detail": [], "depends_on": [], "cf_has_str": "---", "cf_user_story": "", "cf_backlog": "---", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "cf_status_firefox58": "---", "cf_status_firefox59": "---", "keywords": [], "cc_detail": [{"email": "ajones@mozilla.com", "id": 443088, "name": "ajones@mozilla.com", "real_name": "Anthony Jones (:kentuckyfriedtakahe, :k17e)"}, {"email": "bvandyk@mozilla.com", "id": 560379, "name": "bvandyk@mozilla.com", "real_name": "Bryce Van Dyk (:bryce)"}], "cf_last_resolved": "2016-07-06T04:35:30Z", "votes": 0, "severity": "normal", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 6, "comments": [{"text": "Right now, WebMDemuxer calculates the duration of a frame by subtracting the frame's start time from the next frame's start time.\n\nWhenever the next frame is not available (at the end of the file or buffer for MSE), we fall back to using the duration we calculated for the previous frame.  Being a guess, this can be incorrect.\n\nExisting code here:  https://dxr.mozilla.org/mozilla-central/source/dom/media/webm/WebMDemuxer.cpp#504\n\nWebM has two additional ways to signal the duration of frames which we should use in preference to estimating.  These are BlockDuration (nestegg_packet_duration) and DefaultDuration (nestegg_track_default_duration), both of which are optional.\n\nThe frame duration logic should be (according to the WebM spec):\n1. Use BlockDuration if present.\n2. Use DefaultDuration if present.\n3. Use (next_frame - current_frame) to calculate duration.\n\nIt's not clear from the spec how to handle cases that aren't addressed by the above, so I propose:\n\n4. Use previous frame's duration as an estimate.\n  1. If the media has a duration present, clamp the final frame's duration to the media's duration.", "author": "kinetik@flim.org", "id": 11131904, "time": "2016-02-03T03:17:23Z"}, {"text": "Note that using nestegg_packet_duration relies on the following upstream fix: https://github.com/kinetiknz/nestegg/commit/6439d944761e5526e1dd637cf2cc56c110c13db8", "author": "kinetik@flim.org", "id": 11131905, "time": "2016-02-03T03:18:04Z"}, {"text": "This may impact external media tests also: http://pf-jenkins.qa.mtv2.mozilla.com:8080/job/mn-mse-youtube-basic-y-aurora-win7_32_64/904/artifact/logs/media_tests.html\n\nIn the above case it looks like the duration of the video has changed from the expected value due to re-evaluation of the duration. I don't think this caused the fail in the test, but wanted to make sure the issue is referenced for the future.", "author": "bvandyk@mozilla.com", "id": 11416509, "time": "2016-05-17T21:36:04Z"}, {"text": "Bug 1261900 is going to introduce these changes as part of a larger patchset, so we can probably dupe this to that.", "author": "kinetik@flim.org", "id": 11416563, "time": "2016-05-17T21:55:03Z"}, {"text": "Mass change P2 -> P3", "author": "ajones@mozilla.com", "id": 11526171, "time": "2016-07-06T04:28:09Z"}, {"text": "Done in bug 1261900", "author": "kinetik@flim.org", "id": 11526369, "time": "2016-07-06T04:35:30Z"}], "id": 1245375, "priority": "P3", "cc": ["ajones@mozilla.com", "bvandyk@mozilla.com"], "cf_crash_signature": "", "version": "Trunk", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "see_also": [], "cf_tracking_firefox59": "---", "last_change_time": "2016-07-06T04:35:30Z", "cf_platform_rel": "---", "product": "Core", "cf_fx_iteration": "---", "blocks": [], "qa_contact": "", "creation_time": "2016-02-03T03:17:23Z", "cf_status_firefox_esr52": "---", "component": "Audio/Video: Playback", "assigned_to_detail": {"email": "kinetik@flim.org", "id": 274575, "name": "kinetik@flim.org", "real_name": "Matthew Gregan [:kinetik]"}, "groups": [], "cf_status_firefox60": "---", "target_milestone": "---", "is_cc_accessible": true, "cf_status_firefox46": "---", "cf_rank": null, "cf_status_thunderbird_esr52": "---", "url": "", "creator_detail": {"email": "kinetik@flim.org", "id": 274575, "name": "kinetik@flim.org", "real_name": "Matthew Gregan [:kinetik]"}, "whiteboard": "", "mentors": [], "summary": "Use BlockDuration (when available) rather than estimating frame duration", "alias": null, "dupe_of": null, "flags": [], "cf_tracking_firefox58": "---", "assigned_to": "kinetik@flim.org", "is_open": false, "history": [{"changes": [{"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "bvandyk@mozilla.com"}], "who": "bvandyk@mozilla.com", "when": "2016-02-03T03:41:44Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "ajones@mozilla.com"}, {"removed": "--", "field_name": "priority", "added": "P2"}], "who": "ajones@mozilla.com", "when": "2016-02-08T20:27:40Z"}, {"changes": [{"removed": "P2", "field_name": "priority", "added": "P3"}], "who": "ajones@mozilla.com", "when": "2016-07-06T04:28:09Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "bvandyk@mozilla.com", "field_name": "assigned_to", "added": "kinetik@flim.org"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2016-07-06 04:35:30"}], "who": "kinetik@flim.org", "when": "2016-07-06T04:35:30Z"}], "resolution": "FIXED", "op_sys": "Unspecified", "cf_fx_points": "---", "cf_blocking_fennec": "---"}