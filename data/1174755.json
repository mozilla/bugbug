{"cf_tracking_thunderbird_esr52": "---", "status": "RESOLVED", "cf_tracking_firefox60": "---", "attachments": [{"creator": "andrew@comminos.com", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2015-06-19T19:15:19Z", "type_id": 4, "creation_date": "2015-06-15T17:00:54Z", "id": 1191828, "setter": "mats@mozilla.com"}], "content_type": "text/plain", "id": 8622554}], "classification": "Components", "creator": "andrew@comminos.com", "cc": ["andrew@comminos.com", "jmuizelaar@mozilla.com", "karlt@mozbugz.karlt.net", "mats@mozilla.com", "mstange@themasta.com", "stransky@redhat.com"], "depends_on": [], "creation_time": "2015-06-15T15:47:53Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "cf_status_firefox58": "---", "cf_status_firefox59": "---", "keywords": [], "summary": "Reftest failures on GTK3 due to native theme background", "id": 1174755, "assigned_to_detail": {"email": "andrew@comminos.com", "id": 502464, "name": "andrew@comminos.com", "real_name": "Andrew Comminos [:acomminos]"}, "severity": "normal", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "assigned_to": "andrew@comminos.com", "comment_count": 17, "comments": [{"text": "Some reftests fail with the GTK3 theme used on the try server due to native theming of some XUL/HTML elements. The tests should be modified to pass regardless of the native theme's background.\n\nExample: layout/reftests/bugs/664127-1.xul", "author": "andrew@comminos.com", "id": 10389462, "time": "2015-06-15T15:47:53Z"}, {"text": "Created attachment 8622554\nImprove reftest consistency on GTK3.\n\nThis patch makes several layout reftests independent of the platform's widget styling.\n\nIt also bumps up the fuzziness for a bidi test already fuzzed on GTK3.", "author": "andrew@comminos.com", "id": 10389855, "time": "2015-06-15T17:00:54Z"}, {"text": "Try push (GTK3): https://treeherder.mozilla.org/#/jobs?repo=try&revision=cb894dee7933", "author": "andrew@comminos.com", "id": 10390825, "time": "2015-06-15T19:52:22Z"}, {"text": "Comment on attachment 8622554\nImprove reftest consistency on GTK3.\n\nBetter to ask the author of the tests to review these changes.\nMats authored at least some of them.\nCurrent rendering can be seen on\nhttps://treeherder.mozilla.org/#/jobs?repo=elm", "author": "karlt@mozbugz.karlt.net", "id": 10407704, "time": "2015-06-19T03:07:06Z"}, {"text": "Comment on attachment 8622554\nImprove reftest consistency on GTK3.\n\n(In reply to Andrew Comminos [:acomminos] from comment #0)\n> Some reftests fail with the GTK3 theme used on the try server due to native\n> theming of some XUL/HTML elements. The tests should be modified to pass\n> regardless of the native theme's background.\n\nWhen an element is styled with \"-moz-appearance:none\" then the native theme's\nbackground, or anything else from native theme, shouldn't applied in the first\nplace.  These test failures seems to indicate a bug in that regard.\n\nThe change to 966992-1.html / 966992-1-ref.html seems to indicate a second bug,\nseparate from the one above.  The changes in the patch for these two files\nmakes no sense to me.  Can you explain what the error in the reference\nrendering comes from please?", "author": "mats@mozilla.com", "id": 10409080, "time": "2015-06-19T15:08:30Z"}, {"text": "(In reply to Mats Palmgren (:mats) from comment #4)\n> Comment on attachment 8622554\n> Improve reftest consistency on GTK3.\n> \n> (In reply to Andrew Comminos [:acomminos] from comment #0)\n> > Some reftests fail with the GTK3 theme used on the try server due to native\n> > theming of some XUL/HTML elements. The tests should be modified to pass\n> > regardless of the native theme's background.\n> \n> When an element is styled with \"-moz-appearance:none\" then the native theme's\n> background, or anything else from native theme, shouldn't applied in the\n> first\n> place.  These test failures seems to indicate a bug in that regard.\n> \n> The change to 966992-1.html / 966992-1-ref.html seems to indicate a second\n> bug,\n> separate from the one above.  The changes in the patch for these two files\n> makes no sense to me.  Can you explain what the error in the reference\n> rendering comes from please?\n\nReftest analyzer results showing differences: http://hg.mozilla.org/mozilla-central/raw-file/tip/layout/tools/reftest/reftest-analyzer.xhtml#logurl=http://ftp.mozilla.org/pub/mozilla.org/firefox/tinderbox-builds/elm-linux-debug/1434698441/elm_ubuntu32_vm-debug_test-reftest-2-bm02-tests1-linux32-build1.txt.gz&only_show_unexpected=1\n\nThe tests for bugs 664127 and 668319 attempt to verify that setting the opacity of the tree parent properly sets the opacity of the children- this fails on themes that set a nonwhite background colour for the tree.\n\nFor bug 966992, the test assumes that the text box's background colour is solid white, as evidenced by the application of a white mask.\n\nI agree, however, that making moz-appearance ensure that no native styling is introduced would be the best solution. I'd imagine it could break quite a few tests, perhaps we should handle it in a separate bug?", "author": "andrew@comminos.com", "id": 10409149, "time": "2015-06-19T15:28:52Z"}, {"text": "(In reply to Andrew Comminos [:acomminos] from comment #5)\n> For bug 966992, the test assumes that the text box's background colour is\n> solid white, as evidenced by the application of a white mask.\n\nAh, now I see where that block comes from.  Yes, this test assumes that\n-moz-appearance:none results in a solid white background, which is a valid\nassumption.\n\n> I agree, however, that making moz-appearance ensure that no native styling\n> is introduced would be the best solution. I'd imagine it could break quite a\n> few tests, perhaps we should handle it in a separate bug?\n\nYes, that's a bug that should be fixed.  I bet it will fix the test\nfailures in this bug.", "author": "mats@mozilla.com", "id": 10409232, "time": "2015-06-19T15:48:13Z"}, {"text": "(In reply to Mats Palmgren (:mats) from comment #6)\n> (In reply to Andrew Comminos [:acomminos] from comment #5)\n> > For bug 966992, the test assumes that the text box's background colour is\n> > solid white, as evidenced by the application of a white mask.\n> \n> Ah, now I see where that block comes from.  Yes, this test assumes that\n> -moz-appearance:none results in a solid white background, which is a valid\n> assumption.\n\nWhy do you think this is a valid assumption?\n\n> > I agree, however, that making moz-appearance ensure that no native styling\n> > is introduced would be the best solution. I'd imagine it could break quite a\n> > few tests, perhaps we should handle it in a separate bug?\n> \n> Yes, that's a bug that should be fixed.  I bet it will fix the test\n> failures in this bug.\n\nAre you saying -moz-appearance: none should influence the used value of the background-color property? That doesn't sound right to me. What's the solution you're thinking of?", "author": "mstange@themasta.com", "id": 10409313, "time": "2015-06-19T16:06:24Z"}, {"text": "(In reply to Markus Stange [:mstange] from comment #7)\n> Why do you think this is a valid assumption?\n\n-moz-appearance:none disables native theming, that's mostly what it's for.\nThus we will render the elements according to the CSS styles instead.\nThe default UA style sheet for <input> has a solid white background.\nAs far as I know that has been the default for all platforms since\nforever.  If this is no longer true in GTK3 builds then I consider\nthat difference a bug.\n\nTo be clear, I'm not objecting to changing the default built-in\nstyles for -moz-appearance:none form controls (bug 997190).\nI'm objecting that it is *different* in GTK3 builds.  I strongly\nbelieve -moz-appearance:none should have the same rendering on all\nplatforms.\n\n> Are you saying -moz-appearance: none should influence the used value of the\n> background-color property?\n\nNo.  -moz-appearance doesn't change the value of any (other)\nCSS properties.\n\n> What's the solution you're thinking of?\n\nI don't know where they grey-ish background color comes from in\nthe GTK3 builds.  I'm guessing it comes from the native theme,\nwhich is a bug since it shouldn't be used for -moz-appearance:none\nelements.  If it comes from some other source, say some special\nUA styles just for GTK3 builds, then I consider that a bug too\nsince default UA styles for form controls (that are used for\n-moz-appearance:none) should be the same on all platforms.", "author": "mats@mozilla.com", "id": 10409654, "time": "2015-06-19T17:29:12Z"}, {"text": "(In reply to Mats Palmgren (:mats) from comment #8)\n> I don't know where they grey-ish background color comes from in\n> the GTK3 builds.  I'm guessing it comes from the native theme,\n> which is a bug since it shouldn't be used for -moz-appearance:none\n> elements.\n\nIMHO that's incarnation of Bug 1158076 for the Light themes, see:\n\nhttps://bugzilla.mozilla.org/show_bug.cgi?id=1158076#c15", "author": "stransky@redhat.com", "id": 10409680, "time": "2015-06-19T17:35:40Z"}, {"text": "(In reply to Mats Palmgren (:mats) from comment #8)\n> The default UA style sheet for <input> has a solid white background.\n\nOh, so this is where our misunderstanding came from. I thought we were talking about the XUL <tree>'s background, which has background-color: -moz-Field in its UA stylesheet. I didn't catch that the patch contained style changes for <input> elements as well.\n\nAndrew, do you know where the bad background color for input elements is coming from?", "author": "mstange@themasta.com", "id": 10409736, "time": "2015-06-19T17:46:09Z"}, {"text": "(In reply to Markus Stange [:mstange] from comment #10)\n> Andrew, do you know where the bad background color for input elements is\n> coming from?\n\nThe background colour for input elements is also set to -moz-Field according to forms.css- I'd suspect that's where it would be coming from.", "author": "andrew@comminos.com", "id": 10409751, "time": "2015-06-19T17:49:28Z"}, {"text": "(In reply to Andrew Comminos [:acomminos] from comment #11)\n> The background colour for input elements is also set to -moz-Field according\n> to forms.css- I'd suspect that's where it would be coming from.\n\nbtw. forms.css is used for HTML elements and only when it's not styled by OS. General XUL elements are defined in toolkit dir for each OS.", "author": "stransky@redhat.com", "id": 10409788, "time": "2015-06-19T17:55:26Z"}, {"text": "Comment on attachment 8622554\nImprove reftest consistency on GTK3.\n\nOh, so we side load values from the theme via these -moz-Field values?\nI thought -moz-appearance:none neutralized those somehow, but I guess\nit doesn't.\n\nIn light of that, this seems like a reasonable workaround.", "author": "mats@mozilla.com", "id": 10410065, "time": "2015-06-19T19:15:19Z"}, {"text": "https://hg.mozilla.org/integration/mozilla-inbound/rev/1959e594ac43", "author": "pulsebot@bots.tld", "id": 10418705, "time": "2015-06-24T16:26:35Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/1959e594ac43", "author": "cbook@mozilla.com", "id": 10421629, "time": "2015-06-25T09:33:18Z"}, {"text": "(In reply to Mats Palmgren (:mats) from comment #4)\n> When an element is styled with \"-moz-appearance:none\" then the native theme's\n> background, or anything else from native theme, shouldn't applied in the\n> first\n> place.  These test failures seems to indicate a bug in that regard.\n\n(In reply to Mats Palmgren (:mats) from comment #8)\n> -moz-appearance:none disables native theming, that's mostly what it's for.\n> Thus we will render the elements according to the CSS styles instead.\n\n> I strongly\n> believe -moz-appearance:none should have the same rendering on all\n> platforms.\n\nI agree.\n\n(In reply to Martin Str\u00e1nsk\u00fd from comment #9)\n> IMHO that's incarnation of Bug 1158076 for the Light themes\n\nYes.\n\n(In reply to Mats Palmgren (:mats) from comment #13)\n> Oh, so we side load values from the theme via these -moz-Field values?\n> I thought -moz-appearance:none neutralized those somehow, but I guess\n> it doesn't.\n\nSetting CSS foreground and background colors from the theme causes problems\nwhen mixed with document styling.\n\nAvoiding setting CSS colors when -moz-appearance is none, or avoiding\naltogether with -moz-appearance not-none causing foreground and background to\nbe obtained from the theme instead of CSS could resolve this.", "author": "karlt@mozbugz.karlt.net", "id": 10422739, "time": "2015-06-25T19:56:24Z"}], "cf_last_resolved": "2015-06-25T09:33:18Z", "priority": "--", "mentors_detail": [], "cf_crash_signature": "", "version": "unspecified", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox59": "---", "last_change_time": "2015-06-25T19:56:24Z", "cf_platform_rel": "---", "product": "Core", "cf_status_firefox_esr52": "---", "blocks": [627699], "qa_contact": "", "see_also": [], "cf_fx_iteration": "---", "component": "Widget: Gtk", "votes": 0, "groups": [], "cf_status_firefox60": "---", "cf_status_firefox41": "fixed", "target_milestone": "mozilla41", "is_cc_accessible": true, "cf_status_thunderbird_esr52": "---", "url": "", "creator_detail": {"email": "andrew@comminos.com", "id": 502464, "name": "andrew@comminos.com", "real_name": "Andrew Comminos [:acomminos]"}, "whiteboard": "", "mentors": [], "cc_detail": [{"email": "andrew@comminos.com", "id": 502464, "name": "andrew@comminos.com", "real_name": "Andrew Comminos [:acomminos]"}, {"email": "jmuizelaar@mozilla.com", "id": 309398, "name": "jmuizelaar@mozilla.com", "real_name": "Jeff Muizelaar [:jrmuizel]"}, {"email": "karlt@mozbugz.karlt.net", "id": 274246, "name": "karlt@mozbugz.karlt.net", "real_name": "Karl Tomlinson (:karlt)"}, {"email": "mats@mozilla.com", "id": 5168, "name": "mats@mozilla.com", "real_name": "Mats Palmgren (:mats)"}, {"email": "mstange@themasta.com", "id": 293943, "name": "mstange@themasta.com", "real_name": "Markus Stange [:mstange]"}, {"email": "stransky@redhat.com", "id": 263117, "name": "stransky@redhat.com", "real_name": "Martin Str\u00e1nsk\u00fd [:stransky]"}], "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "cf_tracking_firefox58": "---", "cf_rank": null, "is_open": false, "history": [{"changes": [{"removed": "", "field_name": "cc", "added": "karlt@mozbugz.karlt.net"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8622554, "added": "review?(karlt@mozbugz.karlt.net)"}], "who": "andrew@comminos.com", "when": "2015-06-15T17:00:54Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "mats@mozilla.com"}, {"field_name": "flagtypes.name", "removed": "review?(karlt@mozbugz.karlt.net)", "attachment_id": 8622554, "added": "review?(mats@mozilla.com)"}], "who": "karlt@mozbugz.karlt.net", "when": "2015-06-19T03:07:06Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(acomminos@mozilla.com), needinfo?(karlt@mozbugz.karlt.net)"}, {"field_name": "flagtypes.name", "removed": "review?(mats@mozilla.com)", "attachment_id": 8622554, "added": "review-"}], "who": "mats@mozilla.com", "when": "2015-06-19T15:08:30Z"}, {"changes": [{"removed": "needinfo?(acomminos@mozilla.com)", "field_name": "flagtypes.name", "added": "needinfo?(mats@mozilla.com)"}], "who": "andrew@comminos.com", "when": "2015-06-19T15:28:52Z"}, {"changes": [{"removed": "needinfo?(mats@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "mats@mozilla.com", "when": "2015-06-19T15:48:13Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "mstange@themasta.com"}], "who": "andrew@comminos.com", "when": "2015-06-19T16:03:08Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(mats@mozilla.com)"}], "who": "mstange@themasta.com", "when": "2015-06-19T16:06:24Z"}, {"changes": [{"removed": "needinfo?(mats@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "mats@mozilla.com", "when": "2015-06-19T17:29:12Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "stransky@redhat.com"}], "who": "stransky@redhat.com", "when": "2015-06-19T17:35:40Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review-", "attachment_id": 8622554, "added": "review+"}], "who": "mats@mozilla.com", "when": "2015-06-19T19:15:19Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "checkin-needed"}], "who": "andrew@comminos.com", "when": "2015-06-19T19:29:02Z"}, {"changes": [{"removed": "checkin-needed", "field_name": "keywords", "added": ""}], "who": "pulsebot@bots.tld", "when": "2015-06-24T16:26:35Z"}, {"changes": [{"removed": "ASSIGNED", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla41"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2015-06-25 02:33:18"}, {"removed": "---", "field_name": "cf_status_firefox41", "added": "fixed"}], "who": "cbook@mozilla.com", "when": "2015-06-25T09:33:18Z"}, {"changes": [{"removed": "needinfo?(karlt@mozbugz.karlt.net)", "field_name": "flagtypes.name", "added": ""}], "who": "karlt@mozbugz.karlt.net", "when": "2015-06-25T19:56:24Z"}], "resolution": "FIXED", "op_sys": "Linux", "cf_fx_points": "---", "cf_blocking_fennec": "---"}