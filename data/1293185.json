{"status": "RESOLVED", "cf_tracking_firefox60": "---", "attachments": [], "classification": "Client Software", "creator": "ashiue@mozilla.com", "cc": ["aklotz@mozilla.com", "ashiue@mozilla.com", "avihpit@yahoo.com", "bgrinstead@mozilla.com", "gchang@mozilla.com", "jmaher@mozilla.com", "jryans@gmail.com", "ovidiu.boca@softvision.ro", "rwood@mozilla.com", "wlachance@mozilla.com"], "depends_on": [], "creation_time": "2016-08-08T07:56:21Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "cf_status_firefox58": "---", "cf_status_firefox59": "---", "keywords": ["perf", "regression", "talos-regression"], "summary": "2.87 - 5.19% damp  (windows7-32, windows8-64) regression on push 0372c7296be3197d796edadfa6a13197d1019024 (Sat Aug 6 2016)", "id": 1293185, "cf_status_firefox50": "unaffected", "cf_status_firefox51": "fixed", "assigned_to_detail": {"email": "nobody@mozilla.org", "id": 1, "name": "nobody@mozilla.org", "real_name": "Nobody; OK to take it and work on it"}, "severity": "normal", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "assigned_to": "nobody@mozilla.org", "comment_count": 14, "comments": [{"text": "Talos has detected a Firefox performance regression from push 0372c7296be3197d796edadfa6a13197d1019024. As author of one of the patches included in that push, we need your help to address this regression.\n\nSummary of tests that regressed:\n\n  damp summary windows7-32 opt e10s: 255.66 -> 264.02 (3.27% worse)\n  damp summary windows7-32 pgo e10s: 192.88 -> 198.42 (2.87% worse)\n  damp summary windows8-64 opt e10s: 245.14 -> 257.85 (5.19% worse)\n\n\nYou can find links to graphs and comparison views for each of the above tests at: https://treeherder.mozilla.org/perf.html#/alerts?id=2310\n\nOn the page above you can see an alert for each affected platform as well as a link to a graph showing the history of scores for this test. There is also a link to a treeherder page showing the Talos jobs in a pushlog format.\n\nTo learn more about the regressing test(s), please see: https://wiki.mozilla.org/Buildbot/Talos/Tests\n\nFor information on reproducing and debugging the regression, either on try or locally, see: https://wiki.mozilla.org/Buildbot/Talos/Running\n\n*** Please let us know your plans within 3 business days, or the offending patch(es) will be backed out! ***\n\nOur wiki page outlines the common responses and expectations: https://wiki.mozilla.org/Buildbot/Talos/RegressionBugsHandling", "author": "ashiue@mozilla.com", "id": 11606215, "time": "2016-08-08T07:56:21Z"}, {"text": "I did some retriggers, here is the zooming better view:\nhttps://treeherder.mozilla.org/perf.html#/graphs?series=%5Bautoland,0c0bb95cce8f2fc538367aeb786aba2a6381e9ad,1,1%5D&series=%5Bautoland,1c9b4b6e159a90b8868b22cb962acd1e4d9d69b1,1,1%5D&zoom=1470402394173.1343,1470444236168.6567,242.17391304347825,280.57971014492756\n\nThis issue might be caused by push 0372c7296be3197d796edadfa6a13197d1019024.\n\nHi Aaron, as you are the patch author, can you take a look at this and determine what is the root cause? Thanks!", "author": "ashiue@mozilla.com", "id": 11606221, "time": "2016-08-08T08:00:21Z"}, {"text": "We can't back this out without completely breaking a11y for e10s on Windows -- its entire implementation requires this patch, which does the absolute minimum required to make a11y+e10s work.\n\nIf we look at the PGO graph, I'd suggest that the change is minimal and not particularly out of line.\n\nI do have a follow-up patch to fix a bug that would cause some busy waiting in the content process - that might improve this, but overall I think we're going to need to take the hit.\n\nIn the worst case I could write a follow-up patch that does not activate this code unless a11y is turned on, but I think we should deal with that as a last resort.", "author": "aklotz@mozilla.com", "id": 11626041, "time": "2016-08-15T18:04:39Z"}, {"text": "I agree that we shouldn't be disabling this feature just for testing- taking a hit on damp might be good.  This appears to be damp only, do we have an idea why this is the case?", "author": "jmaher@mozilla.com", "id": 11626063, "time": "2016-08-15T18:10:39Z"}, {"text": "I have no idea! The patch in question affects the main event loops and the e10s message channel. Why it is only affecting damp and not the other talos tests escapes me!", "author": "aklotz@mozilla.com", "id": 11626095, "time": "2016-08-15T18:19:04Z"}, {"text": "For cases like these, the subtest details can be revealing:\n\nhttps://treeherder.mozilla.org/perf.html#/comparesubtest?originalProject=autoland&originalRevision=c008ecf88273d3965b84e34e6c33d085c69c319c&newProject=autoland&newRevision=0372c7296be3197d796edadfa6a13197d1019024&originalSignature=0c0bb95cce8f2fc538367aeb786aba2a6381e9ad&newSignature=0c0bb95cce8f2fc538367aeb786aba2a6381e9ad&framework=1\n\nIt looks like 'damp complicated.inspector.close.DAMP opt e10s' and 'simple.styleeditor.close.DAMP opt e10s' are the most affected (showing 40 and 45% regression). Does that suggest anything? Maybe we could get some mileage out of profiling results for those tests specifically?", "author": "wlachance@mozilla.com", "id": 11626107, "time": "2016-08-15T18:23:12Z"}, {"text": "adding :bgrins as he is the *damp wizard*, odd that we have both those close methods causing issues.", "author": "jmaher@mozilla.com", "id": 11626236, "time": "2016-08-15T19:02:44Z"}, {"text": "It looks unrelated, but just noting that there were some damp changes that landed a couple days earlier in Bug 1291809 (https://hg.mozilla.org/mozilla-central/rev/d97d3eb03261)", "author": "bgrinstead@mozilla.com", "id": 11626252, "time": "2016-08-15T19:11:58Z"}, {"text": "The 'close' measurements are tracking the time to call gDevTools.closeToolbox (basically the code that runs when the devtools toolbox is destroyed [0]).  This includes time to destroy the particular panel like the Inspector or Style Editor, for instance.\n\n[0]: https://dxr.mozilla.org/mozilla-central/source/devtools/client/framework/toolbox.js#2037", "author": "bgrinstead@mozilla.com", "id": 11626267, "time": "2016-08-15T19:15:12Z"}, {"text": "(In reply to Aaron Klotz [:aklotz] from comment #2)\n> I do have a follow-up patch to fix a bug that would cause some busy waiting\n> in the content process - that might improve this, but overall I think we're\n> going to need to take the hit.\n\nWould you be able to do a try push with this patch so we can measure if that helps?", "author": "bgrinstead@mozilla.com", "id": 11626275, "time": "2016-08-15T19:17:01Z"}, {"text": "https://treeherder.mozilla.org/#/jobs?repo=try&revision=bd336bf69eda", "author": "aklotz@mozilla.com", "id": 11626358, "time": "2016-08-15T19:46:00Z"}, {"text": "damp has slightly improved again on inbound once the follow-up patch landed (https://bugzilla.mozilla.org/show_bug.cgi?id=1273635#c23). I think that's going to be about the best we can do with this situation.\n\nJoel, do you mind if I resolve this bug?", "author": "aklotz@mozilla.com", "id": 11633427, "time": "2016-08-17T18:47:29Z"}, {"text": "lets resolve it!", "author": "jmaher@mozilla.com", "id": 11633430, "time": "2016-08-17T18:49:13Z"}, {"text": "Per comment #11 & #12, mark 51 as fixed.", "author": "gchang@mozilla.com", "id": 11702314, "time": "2016-09-12T08:24:09Z"}], "cf_last_resolved": "2016-08-17T18:50:49Z", "priority": "--", "mentors_detail": [], "cf_crash_signature": "", "version": "51 Branch", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox59": "---", "last_change_time": "2016-09-12T08:24:09Z", "cf_platform_rel": "---", "product": "Firefox", "cf_status_firefox_esr52": "---", "blocks": [1273635, 1291351], "qa_contact": "", "see_also": [], "cf_fx_iteration": "---", "component": "Untriaged", "votes": 0, "cf_status_firefox49": "unaffected", "cf_status_firefox48": "unaffected", "groups": [], "cf_status_firefox60": "---", "target_milestone": "---", "is_cc_accessible": true, "url": "", "creator_detail": {"email": "ashiue@mozilla.com", "id": 500502, "name": "ashiue@mozilla.com", "real_name": "Alison Shiue"}, "whiteboard": "", "mentors": [], "cc_detail": [{"email": "aklotz@mozilla.com", "id": 454100, "name": "aklotz@mozilla.com", "real_name": "Aaron Klotz [:aklotz]"}, {"email": "ashiue@mozilla.com", "id": 500502, "name": "ashiue@mozilla.com", "real_name": "Alison Shiue"}, {"email": "avihpit@yahoo.com", "id": 55598, "name": "avihpit@yahoo.com", "real_name": "Avi Halachmi (:avih)"}, {"email": "bgrinstead@mozilla.com", "id": 476442, "name": "bgrinstead@mozilla.com", "real_name": "Brian Grinstead [:bgrins]"}, {"email": "gchang@mozilla.com", "id": 506302, "name": "gchang@mozilla.com", "real_name": "Gerry Chang [:gchang]"}, {"email": "jmaher@mozilla.com", "id": 324370, "name": "jmaher@mozilla.com", "real_name": "Joel Maher ( :jmaher) (UTC-5)"}, {"email": "jryans@gmail.com", "id": 282978, "name": "jryans@gmail.com", "real_name": "J. Ryan Stinnett [:jryans] (use ni?)"}, {"email": "ovidiu.boca@softvision.ro", "id": 551038, "name": "ovidiu.boca@softvision.ro", "real_name": "ovidiu boca[:Ovidiu]"}, {"email": "rwood@mozilla.com", "id": 447387, "name": "rwood@mozilla.com", "real_name": "Robert Wood [:rwood]"}, {"email": "wlachance@mozilla.com", "id": 420096, "name": "wlachance@mozilla.com", "real_name": "William Lachance (:wlach) (use needinfo!)"}], "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "cf_tracking_firefox58": "---", "cf_rank": null, "is_open": false, "resolution": "FIXED", "op_sys": "Unspecified", "cf_fx_points": "---", "history": [{"changes": [{"removed": "", "field_name": "cc", "added": "aklotz@mozilla.com"}, {"removed": "", "field_name": "blocks", "added": "1273635, 1291351"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(aklotz@mozilla.com)"}], "who": "ashiue@mozilla.com", "when": "2016-08-08T08:00:21Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "ovidiu.boca@softvision.ro"}, {"removed": "---", "field_name": "cf_status_firefox48", "added": "unaffected"}, {"removed": "---", "field_name": "cf_status_firefox49", "added": "unaffected"}, {"removed": "---", "field_name": "cf_status_firefox50", "added": "unaffected"}], "who": "ovidiu.boca@softvision.ro", "when": "2016-08-09T08:03:07Z"}, {"changes": [{"removed": "needinfo?(aklotz@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "aklotz@mozilla.com", "when": "2016-08-15T18:04:39Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "bgrinstead@mozilla.com"}], "who": "jmaher@mozilla.com", "when": "2016-08-15T19:02:44Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "jryans@gmail.com"}], "who": "bgrinstead@mozilla.com", "when": "2016-08-15T19:11:58Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(aklotz@mozilla.com)"}], "who": "bgrinstead@mozilla.com", "when": "2016-08-15T19:17:01Z"}, {"changes": [{"removed": "needinfo?(aklotz@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "aklotz@mozilla.com", "when": "2016-08-15T19:46:00Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(jmaher@mozilla.com)"}], "who": "aklotz@mozilla.com", "when": "2016-08-17T18:47:29Z"}, {"changes": [{"removed": "needinfo?(jmaher@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "jmaher@mozilla.com", "when": "2016-08-17T18:49:13Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2016-08-17 18:50:49"}], "who": "aklotz@mozilla.com", "when": "2016-08-17T18:50:49Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "gchang@mozilla.com"}, {"removed": "affected", "field_name": "cf_status_firefox51", "added": "fixed"}], "who": "gchang@mozilla.com", "when": "2016-09-12T08:24:09Z"}]}