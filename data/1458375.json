{"cf_tracking_thunderbird_esr52": "---", "status": "RESOLVED", "cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "cf_tracking_firefox62": "---", "creator": "timdream@gmail.com", "mentors_detail": [], "depends_on": [], "cf_status_firefox_esr60": "---", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "keywords": [], "cc_detail": [{"email": "bgrinstead@mozilla.com", "id": 476442, "name": "bgrinstead@mozilla.com", "real_name": "Brian Grinstead [:bgrins]"}, {"email": "brennan.brisad@gmail.com", "id": 469463, "name": "brennan.brisad@gmail.com", "real_name": "Michael Hoffmann"}, {"email": "bzbarsky@mit.edu", "id": 20209, "name": "bzbarsky@mit.edu", "real_name": "Boris Zbarsky [:bz] (Vacation Jun 16-24) (no decent commit message means r-)"}, {"email": "continuation@gmail.com", "id": 406194, "name": "continuation@gmail.com", "real_name": "Andrew McCreight [:mccr8]"}, {"email": "felipc@gmail.com", "id": 208747, "name": "felipc@gmail.com", "real_name": ":Felipe Gomes (needinfo me!)"}, {"email": "gandalf@aviary.pl", "id": 41270, "name": "gandalf@aviary.pl", "real_name": "Zibi Braniecki [:gandalf][:zibi]"}, {"email": "grayshade@gmail.com", "id": 296264, "name": "grayshade@gmail.com", "real_name": "Laurentiu Nicola"}, {"email": "hpradhan@gmail.com", "id": 34707, "name": "hpradhan@gmail.com", "real_name": "Harshal Pradhan"}, {"email": "igoldan@mozilla.com", "id": 590618, "name": "igoldan@mozilla.com", "real_name": "Ionu\u021b Goldan [:igoldan], Performance Sheriffing"}, {"email": "kmaglione+bmo@mozilla.com", "id": 106098, "name": "kmaglione+bmo@mozilla.com", "real_name": "Kris Maglione [:kmag]"}, {"email": "mayankleoboy1@gmail.com", "id": 440227, "name": "mayankleoboy1@gmail.com", "real_name": "Mayank Bansal"}, {"email": "mcastelluccio@mozilla.com", "id": 420453, "name": "mcastelluccio@mozilla.com", "real_name": "Marco Castelluccio [:marco]"}, {"email": "mconley@mozilla.com", "id": 403756, "name": "mconley@mozilla.com", "real_name": "Mike Conley (:mconley) (:\u2699\ufe0f) (Catching up on needinfos / reviews)"}, {"email": "mstange@themasta.com", "id": 293943, "name": "mstange@themasta.com", "real_name": "Markus Stange [:mstange]"}, {"email": "nissan4321@gmail.com", "id": 414417, "name": "nissan4321@gmail.com", "real_name": "Mikel"}, {"email": "rwood@mozilla.com", "id": 447387, "name": "rwood@mozilla.com", "real_name": "Robert Wood [:rwood]"}, {"email": "scineram@freemail.hu", "id": 590726, "name": "scineram@freemail.hu", "real_name": ""}, {"email": "snorp@snorp.net", "id": 227322, "name": "snorp@snorp.net", "real_name": "James Willcox (:snorp) (jwillcox@mozilla.com)"}, {"email": "tcampbell@mozilla.com", "id": 586681, "name": "tcampbell@mozilla.com", "real_name": "Ted Campbell [:tcampbell]"}, {"email": "timbugzilla@gmail.com", "id": 437905, "name": "timbugzilla@gmail.com", "real_name": ""}], "cf_last_resolved": "2018-06-13T09:27:17Z", "attachments": [{"creator": "mconley@mozilla.com", "is_obsolete": 1, "is_patch": 0, "flags": [], "content_type": "text/x-review-board-request", "id": 8973786}, {"creator": "mconley@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-05-31T14:16:15Z", "type_id": 4, "creation_date": "2018-05-30T18:58:48Z", "id": 1763760, "setter": "rwood@mozilla.com"}], "content_type": "text/x-review-board-request", "id": 8981986}, {"creator": "mconley@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-05-31T13:57:42Z", "type_id": 4, "creation_date": "2018-05-30T18:58:48Z", "id": 1763761, "setter": "rwood@mozilla.com"}], "content_type": "text/x-review-board-request", "id": 8981987}, {"creator": "mconley@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-05-30T22:04:54Z", "type_id": 4, "creation_date": "2018-05-30T18:58:48Z", "id": 1763762, "setter": "felipc@gmail.com"}], "content_type": "text/x-review-board-request", "id": 8981988}, {"creator": "mconley@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-05-31T14:52:00Z", "type_id": 4, "creation_date": "2018-05-30T18:58:48Z", "id": 1763763, "setter": "rwood@mozilla.com"}], "content_type": "text/x-review-board-request", "id": 8981989}, {"creator": "mconley@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-05-31T14:57:38Z", "type_id": 4, "creation_date": "2018-05-30T18:58:48Z", "id": 1763764, "setter": "rwood@mozilla.com"}], "content_type": "text/x-review-board-request", "id": 8981990}, {"creator": "mconley@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-05-30T19:49:51Z", "type_id": 4, "creation_date": "2018-05-30T18:58:48Z", "id": 1763765, "setter": "kmaglione+bmo@mozilla.com"}], "content_type": "text/x-review-board-request", "id": 8981991}, {"creator": "mconley@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-05-31T01:56:34Z", "type_id": 4, "creation_date": "2018-05-30T18:58:48Z", "id": 1763766, "setter": "timdream@gmail.com"}], "content_type": "text/x-review-board-request", "id": 8981992}, {"creator": "mconley@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-05-31T15:54:53Z", "type_id": 4, "creation_date": "2018-05-30T21:17:57Z", "id": 1763842, "setter": "snorp@snorp.net"}], "content_type": "text/x-review-board-request", "id": 8982039}, {"creator": "mconley@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-06-06T21:07:08Z", "type_id": 4, "creation_date": "2018-06-05T21:33:33Z", "id": 1766240, "setter": "kmaglione+bmo@mozilla.com"}], "content_type": "text/x-review-board-request", "id": 8983571}], "votes": 1, "classification": "Components", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 99, "comments": [{"text": "See bug 1456728. There is a cpstartup performance regression caused by the removal of the scrollbar binding. Adding an empty binding \"fixes\" it.\n\nWe will need to investigate why and remove it.", "author": "timdream@gmail.com", "id": 13247279, "time": "2018-05-01T21:59:30Z"}, {"text": "Continue from my investigation from bug 1456728 comment 43:\n\nSo I've got to a point where on OSX debug locally, I can see the build gets slower if nsSyncLoadService::PushSyncStreamToListener() calls into nsParser::OnStopRequest(). However, when I copy my URI check code into the function and make OnStopRequest() no-op when it hits general.xml, the build continue to run fast. The two results are conflicting. I guess my methodology might be flawed.\n\nWhat I am going to do next is to repeat the process in the loner machine, hopefully to avoid the noises on my machine locally.", "author": "timdream@gmail.com", "id": 13250359, "time": "2018-05-02T20:10:09Z"}, {"text": "Just to confirm what I see from Try:\n\nThe performance gain happened in nsSyncLoadService::PushSyncStreamToListener() but before XMLDocument::EndLoad()\n\nPerformance regressed by skipping nsSyncLoadService::PushSyncStreamToListener() in content process:\nhttps://treeherder.mozilla.org/perf.html#/compare?originalProject=try&originalRevision=2e7bac585cfa&newProject=try&newRevision=bbe9bfd1dc21&framework=1\n\nBut not by an early return from XMLDocument::EndLoad()\n\nhttps://treeherder.mozilla.org/perf.html#/compare?originalProject=try&originalRevision=2e7bac585cfa&newProject=try&newRevision=303f5970e696&framework=1", "author": "timdream@gmail.com", "id": 13250969, "time": "2018-05-03T00:56:07Z"}, {"text": "I have now narrowed down the code that makes it fast to be inside nsParser::ResumeParse()\n\nhttps://treeherder.mozilla.org/perf.html#/compare?originalProject=try&originalRevision=2e7bac585cfa&newProject=try&newRevision=065b6219e7db&framework=1&filter=cpstartup\n\nBut not any calls into nsXMLDocumentSink from there:\n\nhttps://treeherder.mozilla.org/perf.html#/compare?originalProject=try&originalRevision=2e7bac585cfa&newProject=try&newRevision=9b2c66578bed&framework=1&filter=cpstartup", "author": "timdream@gmail.com", "id": 13256792, "time": "2018-05-06T03:12:18Z"}, {"text": "Worth investigating: we load xul.css in content process in cpstartup test.\n\nhttps://treeherder.mozilla.org/#/jobs?repo=try&revision=ed50dfc9fce1f397f703dd403a723e2429e35375\n\n( Ctrl+F \"nsSyncLoadService::PushSyncStreamToListener()\" in this log https://taskcluster-artifacts.net/ADWlcrjWSbWG0m-EM1SzmQ/0/public/logs/live_backing.log )", "author": "timdream@gmail.com", "id": 13257025, "time": "2018-05-06T15:13:51Z"}, {"text": "Yeah, I don't think components.css belongs to content process either :'(", "author": "timdream@gmail.com", "id": 13257028, "time": "2018-05-06T15:15:22Z"}, {"text": "... and the nsExpatDriver::ParseBuffer() call is identified in nsExpatDriver::ConsumeToken()\n\nhttps://searchfox.org/mozilla-central/rev/b28b94dc81d60c6d9164315adbd4a5073526d372/parser/htmlparser/nsExpatDriver.cpp#985\n\nhttps://treeherder.mozilla.org/perf.html#/compare?originalProject=try&originalRevision=2e7bac585cfa&newProject=try&newRevision=1ccef9e0f1fe&framework=1&filter=cpstartup\n\nhttps://treeherder.mozilla.org/perf.html#/compare?originalProject=try&originalRevision=2e7bac585cfa&newProject=try&newRevision=29c53f093a74&framework=1&filter=cpstartup", "author": "timdream@gmail.com", "id": 13258554, "time": "2018-05-07T03:09:29Z"}, {"text": "(In reply to Tim Guan-tin Chien [:timdream] (please needinfo) from comment #4)\n> Worth investigating: we load xul.css in content process in cpstartup test.\n\n(In reply to Tim Guan-tin Chien [:timdream] (please needinfo) from comment #5)\n> Yeah, I don't think components.css belongs to content process either :'(\n\nThat must be due to the page loading over a chrome:// URI, or some other test-specific thing. The only place where these sheets get loaded are if LoadsFullXULStyleSheetUpFront is true: https://searchfox.org/mozilla-central/rev/b28b94dc81d60c6d9164315adbd4a5073526d372/layout/base/nsDocumentViewer.cpp#2372-2385.", "author": "bgrinstead@mozilla.com", "id": 13258560, "time": "2018-05-07T03:18:30Z"}, {"text": "(In reply to Brian Grinstead [:bgrins] from comment #7)\n> That must be due to the page loading over a chrome:// URI, or some other\n> test-specific thing. The only place where these sheets get loaded are if\n> LoadsFullXULStyleSheetUpFront is true:\n> https://searchfox.org/mozilla-central/rev/\n> b28b94dc81d60c6d9164315adbd4a5073526d372/layout/base/nsDocumentViewer.\n> cpp#2372-2385.\n\nYou are right. This eventually reaches nsIDocument::InternalAllowXULXBL() and checks the principal.\n\nhttps://searchfox.org/mozilla-central/rev/b28b94dc81d60c6d9164315adbd4a5073526d372/dom/base/nsDocument.cpp#5023\n\nI actually don't understand why target.html has to be loaded with system principal, but I haven't tried to remove this.\n\nhttps://searchfox.org/mozilla-central/rev/b28b94dc81d60c6d9164315adbd4a5073526d372/testing/talos/talos/tests/cpstartup/bootstrap.js#95", "author": "timdream@gmail.com", "id": 13258606, "time": "2018-05-07T04:48:57Z"}, {"text": "(In reply to Tim Guan-tin Chien [:timdream] (please needinfo) from comment #6)\n\nThe fact that libexpat could cause any side effect is pretty unimaginable. The side effect might be caused by a state change eventually found. So this will still take time to investigate.", "author": "timdream@gmail.com", "id": 13258610, "time": "2018-05-07T04:52:47Z"}, {"text": "(In reply to Tim Guan-tin Chien [:timdream] (please needinfo) from comment #8)\n> (In reply to Brian Grinstead [:bgrins] from comment #7)\n> > That must be due to the page loading over a chrome:// URI, or some other\n> > test-specific thing. The only place where these sheets get loaded are if\n> > LoadsFullXULStyleSheetUpFront is true:\n> > https://searchfox.org/mozilla-central/rev/\n> > b28b94dc81d60c6d9164315adbd4a5073526d372/layout/base/nsDocumentViewer.\n> > cpp#2372-2385.\n> \n> You are right. This eventually reaches nsIDocument::InternalAllowXULXBL()\n> and checks the principal.\n> \n> https://searchfox.org/mozilla-central/rev/\n> b28b94dc81d60c6d9164315adbd4a5073526d372/dom/base/nsDocument.cpp#5023\n> \n> I actually don't understand why target.html has to be loaded with system\n> principal, but I haven't tried to remove this.\n\nI think the 'fix' for this is to update the test to not use system principle for the content process document.\n\nI don't know if there are any cases where we load chrome:// URIs in a content process for normal browsing (and if there are it certainly isn't the 'normal' entry point for starting a content process. So whatever side effects we are hitting here are probably affecting the test but not normal users. Mike, does that make sense? And if so, would it be be relatively easy to load the document over localhost instead of chrome://?", "author": "bgrinstead@mozilla.com", "id": 13259853, "time": "2018-05-07T16:08:16Z"}, {"text": "(In reply to Brian Grinstead [:bgrins] from comment #10)\n> I don't know if there are any cases where we load chrome:// URIs in a\n> content process for normal browsing (and if there are it certainly isn't the\n> 'normal' entry point for starting a content process. So whatever side\n> effects we are hitting here are probably affecting the test but not normal\n> users. Mike, does that make sense? And if so, would it be be relatively easy\n> to load the document over localhost instead of chrome://?\n\nYeah, I agree that loading up a chrome:// URI in a new tab is not a very likely scenario. If that's having an impact on the measurement, then we should adjust the test to match the common scenario. There's no great reason to load a chrome:// URI except that (I think) it was just easier to write.\n\nI think I can provide a patch to update the test (rwood should review it). Coming up.", "author": "mconley@mozilla.com", "id": 13260240, "time": "2018-05-07T18:20:22Z"}, {"text": "Created attachment 8973786\nBug 1458375 - Make cpstartup Talos test load the target over http:// rather than chrome://.\n\nReview commit: https://reviewboard.mozilla.org/r/242152/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/242152/", "author": "mconley@mozilla.com", "id": 13260383, "time": "2018-05-07T19:13:25Z"}, {"text": "Okay, this patch moves the page load to http://. I suggest importing that, putting a patch on top of it to remove the empty binding, and seeing what Talos on Try thinks. If it's all green, rwood would be a good reviewer for the Talos bits.", "author": "mconley@mozilla.com", "id": 13260386, "time": "2018-05-07T19:14:15Z"}, {"text": "Thanks for the patch; it didn't remove system principal when loading target.html so I would need to test its validity.\n\nhttps://searchfox.org/mozilla-central/rev/b28b94dc81d60c6d9164315adbd4a5073526d372/testing/talos/talos/tests/cpstartup/bootstrap.js#95\n\nI will try to land this in another bug as it doesn't really relate to the empty binding.", "author": "timdream@gmail.com", "id": 13260503, "time": "2018-05-07T19:51:59Z"}, {"text": "I was wrong as comment 14 and comment 8. The page gets system principal because of the chrome URL and not because of that line.", "author": "timdream@gmail.com", "id": 13261174, "time": "2018-05-08T00:12:58Z"}, {"text": "(In reply to Tim Guan-tin Chien [:timdream] (please needinfo) from comment #9)\n> (In reply to Tim Guan-tin Chien [:timdream] (please needinfo) from comment #6)\n> \n> The fact that libexpat could cause any side effect is pretty unimaginable.\n\n... and I can confirm that calling into XML_Parse() in xmlparse.c triggers speed-up...\n\nhttps://treeherder.mozilla.org/#/jobs?repo=try&author=timdream@gmail.com&fromchange=0f0889a9b70f331e6bbf044439677f358ec4d910&selectedJob=177544633", "author": "timdream@gmail.com", "id": 13263638, "time": "2018-05-08T20:42:51Z"}, {"text": "Here is a brief intro on what happened and what I've found: over at bug 1456728, I was flagged by talos for slowing down content process start-up by moving the <xul:scrolbar> mark-ups from the XBL binding to nsScrollbarFrame. Investigation shows that simply by adding an empty binding back to <xul:scrollbar>, the performance regression goes away. Given the merge schedule, I checked-in the empty binding to central, and continue the investigation over here.\n\nMy methodology of locating the cause involving identifying the code path that loads the empty binding, and insert early returns in various places. By comparing the talos results on the try pushes, I was able to narrow down the exact function calls that lead to the effect. Eventually, I reached comment 16, which skipping XML_Parse() in nsExpatDriver::ParseBuffer() re-creates the performance regression*.\n\nThis is very mindblowing because expat should be self-contained and perhaps stateless. We were hoping to find something that gets initialized earlier/later because of the binding and perhaps keeping the performance by moving it somewhere else. That *something* certainly shouldn't be attempt parse an XML file :-/.\n\n:mconley had a brief discussion with me on this over IRC; he recommends that I use the Linux perf tool [1] to figure out that slows us down when we don't call into expat. It would also help us understand if the cause here is memory allocation-related.\n\n[1] https://en.wikipedia.org/wiki/Perf_(Linux)\n\nThis is way out of my field of expertise so it would take some time to set it up. If you have free cycles to dive into this mystery, feel free to take over.\n\n* I've ruled out nsXMLDocumentSink calls from nsParser::ResumeParse() (comment 3) but I didn't rule out calls by nsExpatDriver.", "author": "timdream@gmail.com", "id": 13264138, "time": "2018-05-09T00:30:47Z"}, {"text": "(In reply to Tim Guan-tin Chien [:timdream] (please needinfo) from comment #17)\n> \n> :mconley had a brief discussion with me on this over IRC; he recommends that\n> I use the Linux perf tool [1] to figure out that slows us down when we don't\n> call into expat. It would also help us understand if the cause here is\n> memory allocation-related.\n> \n\nI can try to work on this tomorrow if you can forward me the details to sign into the Talos machine you've got loaned out.", "author": "mconley@mozilla.com", "id": 13264221, "time": "2018-05-09T01:26:41Z"}, {"text": "Forwarded.", "author": "timdream@gmail.com", "id": 13264232, "time": "2018-05-09T01:39:47Z"}, {"text": "Thanks, received! ni?ing myself for analysis.", "author": "mconley@mozilla.com", "id": 13264233, "time": "2018-05-09T01:40:55Z"}, {"text": "So, just an update here - I'm able to reproduce the issue on the Talos loaner, but I can't get perf installed on this particular distro.\n\nI think I'm going to fall back to Gecko Profiler profile analysis.", "author": "mconley@mozilla.com", "id": 13277125, "time": "2018-05-14T21:18:07Z"}, {"text": "Got some profiles from the Talos loaner. Talos by default does 2 runs when profiling, so I've included both profiles for each state.\n\n\n# Good (empty binding):\nScores: 1674.0, 1627.0\n\nhttps://perfht.ml/2wHX1WD\nhttps://perfht.ml/2Kp7BUl\n\n\n# Bad (XML_Parse bypassed):\nScores: 1691.0, 1702.0 \n\nhttps://perfht.ml/2Kp9oZz\nhttps://perfht.ml/2wNZcYW\n\nContinuing analysis...", "author": "mconley@mozilla.com", "id": 13279341, "time": "2018-05-15T17:54:55Z"}, {"text": "Alright, I'm about ready to give up on this one.\n\nI was able to get perf running on the Talos loaner, and the only thing that jumped out at me is that in the \"bad\" case, for the content process, the CPU misses the L1 cache more. I did a few runs, and here's the difference:\n\nGood: ~227 L1-dcache-loadmisses\nBad:  ~251 L2-dcache-loadmisses\n\nThat's not a huge increase, but it's the only thing that stuck out to me.\n\nLooking at the default events that perf records, here's what I got...\n\nGood case:\n\n 72.46%  Web Content  [unknown]                   [.] 0x7fadfc0de1e0\n  1.83%  Web Content  [kernel.kallsyms]           [k] page_fault\n  1.45%  Web Content  libc-2.15.so                [.] __strlen_sse2_pminub\n  1.36%  Web Content  [kernel.kallsyms]           [k] clear_page_c\n  1.20%  Web Content  libc-2.15.so                [.] __strcmp_sse2\n  0.99%  Web Content  libxul.so                   [.] nsBufferedOutputStream::QueryInterface(nsID const&, void**)\n  0.95%  Web Content  [kernel.kallsyms]           [k] error_entry\n  0.93%  Web Content  [kernel.kallsyms]           [k] hpet_msi_next_event\n  0.93%  Web Content  perf-24669.map              [.] 0x331c4938c2e0\n  0.91%  Web Content  [kernel.kallsyms]           [k] native_write_msr_safe\n  0.85%  Web Content  libglib-2.0.so.0.3200.1     [.] slab_allocator_alloc_chunk\n  0.82%  Web Content  libc-2.15.so                [.] __memcpy_ssse3_back\n  0.75%  Web Content  libc-2.15.so                [.] __strchr_sse42\n  0.61%  Web Content  libpthread-2.15.so          [.] pthread_mutex_lock\n  0.48%  Web Content  firefox                     [.] arena_t::Malloc(unsigned long, bool)\n  0.48%  Web Content  [kernel.kallsyms]           [k] _cond_resched\n  0.47%  Web Content  [kernel.kallsyms]           [k] __mem_cgroup_commit_charge\n  0.47%  Web Content  [kernel.kallsyms]           [k] __ticket_spin_lock\n  0.47%  Web Content  [kernel.kallsyms]           [k] radix_tree_lookup_element\n  0.47%  Web Content  [kernel.kallsyms]           [k] pagevec_lru_move_fn\n  0.47%  Web Content  [kernel.kallsyms]           [k] _copy_to_user\n  0.46%  Web Content  [kernel.kallsyms]           [k] ____pagevec_lru_add\n  0.46%  Web Content  [kernel.kallsyms]           [k] anon_vma_clone\n  0.46%  Web Content  [kernel.kallsyms]           [k] get_page_from_freelist\n  0.45%  Web Content  [kernel.kallsyms]           [k] sys_mmap\n  0.45%  Web Content  [kernel.kallsyms]           [k] ____pagevec_lru_add_fn\n  0.44%  Web Content  [kernel.kallsyms]           [k] __phys_addr\n  0.44%  Web Content  libX11.so.6.3.0             [.] 0x514e0\n  0.43%  Web Content  libxul.so                   [.] silk_encode_frame_FLP\n  0.43%  Web Content  [nvidia]                    [k] 0x521783\n  0.43%  Web Content  [kernel.kallsyms]           [k] mem_cgroup_charge_common\n  0.43%  Web Content  libgobject-2.0.so.0.3200.1  [.] g_type_class_ref\n  0.41%  Web Content  libglib-2.0.so.0.3200.1     [.] g_slice_alloc\n  0.41%  Web Content  libglib-2.0.so.0.3200.1     [.] g_string_insert_len\n  0.37%  Web Content  firefox                     [.] free\n  0.37%  Web Content  firefox                     [.] Allocator<MozJemallocBase>::realloc(void*, unsigned long)\n  0.34%  Web Content  [kernel.kallsyms]           [k] zap_pte_range\n  0.34%  Web Content  [kernel.kallsyms]           [k] bit_spin_unlock\n  0.33%  Web Content  [kernel.kallsyms]           [k] find_vma\n  0.31%  Web Content  [kernel.kallsyms]           [k] free_pcppages_bulk\n  0.31%  Web Content  libgobject-2.0.so.0.3200.1  [.] g_type_check_instance_is_a\n  0.29%  Web Content  [kernel.kallsyms]           [k] mem_cgroup_del_lru_list.part.36\n  0.28%  Web Content  libglib-2.0.so.0.3200.1     [.] g_datalist_get_flags\n  0.26%  Web Content  firefox                     [.] arena_salloc(void const*)\n  0.24%  Web Content  [kernel.kallsyms]           [k] page_add_new_anon_rmap\n  0.23%  Web Content  libz.so.1.2.3.4             [.] inflate\n  0.23%  Web Content  libz.so.1.2.3.4             [.] 0xd846\n  0.23%  Web Content  [kernel.kallsyms]           [k] restore_sigcontext\n  0.21%  Web Content  [kernel.kallsyms]           [k] __wake_up_bit\n  0.21%  Web Content  [kernel.kallsyms]           [k] skb_release_data\n  0.19%  Web Content  [kernel.kallsyms]           [k] lookup_page_cgroup\n  0.19%  Web Content  [kernel.kallsyms]           [k] sk_run_filter\n\n\nBad case:\n\n 74.93%  Web Content  [unknown]                   [.] 0x7f92f28160d6\n  1.57%  Web Content  [kernel.kallsyms]           [k] __cpa_flush_all\n  1.26%  Web Content  perf-17400.map              [.] 0x32d0738a2ba2\n  1.18%  Web Content  ld-2.15.so                  [.] do_lookup_x\n  1.09%  Web Content  [nvidia]                    [k] nv_flush_cache\n  0.91%  Web Content  libglib-2.0.so.0.3200.1     [.] g_slice_alloc\n  0.88%  Web Content  [kernel.kallsyms]           [k] page_fault\n  0.84%  Web Content  libxul.so                   [.] nsBufferedOutputStream::QueryInterface(nsID const&, void**)\n  0.69%  Web Content  [kernel.kallsyms]           [k] clear_page_c\n  0.64%  Web Content  libgobject-2.0.so.0.3200.1  [.] g_signal_newv\n  0.57%  Web Content  libglib-2.0.so.0.3200.1     [.] g_hash_table_lookup\n  0.51%  Web Content  libpthread-2.15.so          [.] pthread_mutex_lock\n  0.47%  Web Content  libgobject-2.0.so.0.3200.1  [.] g_type_value_table_peek\n  0.45%  Web Content  [kernel.kallsyms]           [k] prep_new_page\n  0.45%  Web Content  [kernel.kallsyms]           [k] mem_cgroup_add_lru_list.part.37\n  0.44%  Web Content  [kernel.kallsyms]           [k] _cond_resched\n  0.44%  Web Content  [kernel.kallsyms]           [k] retint_swapgs\n  0.43%  Web Content  [kernel.kallsyms]           [k] perf_pmu_rotate_start.isra.42\n  0.43%  Web Content  [kernel.kallsyms]           [k] system_call\n  0.43%  Web Content  [kernel.kallsyms]           [k] prio_tree_insert\n  0.43%  Web Content  [kernel.kallsyms]           [k] path_init\n  0.42%  Web Content  [kernel.kallsyms]           [k] syscall_trace_enter\n  0.41%  Web Content  [kernel.kallsyms]           [k] radix_tree_lookup_element\n  0.41%  Web Content  [kernel.kallsyms]           [k] ahci_port_intr\n  0.41%  Web Content  [kernel.kallsyms]           [k] mem_cgroup_uncharge_start\n  0.40%  Web Content  [kernel.kallsyms]           [k] __find_get_block_slow\n  0.40%  Web Content  libX11.so.6.3.0             [.] 0x4db56\n  0.39%  Web Content  libgdk-3.so.0.400.1         [.] 0x5b8bb\n  0.39%  Web Content  [kernel.kallsyms]           [k] handle_mm_fault\n  0.39%  Web Content  libc-2.15.so                [.] __GI_____strtod_l_internal\n  0.39%  Web Content  [nvidia]                    [k] 0xa34b\n  0.39%  Web Content  [kernel.kallsyms]           [k] fd_install\n  0.39%  Web Content  [kernel.kallsyms]           [k] get_page_from_freelist\n  0.38%  Web Content  ld-2.15.so                  [.] _dl_lookup_symbol_x\n  0.38%  Web Content  libglib-2.0.so.0.3200.1     [.] get_C_locale\n  0.37%  Web Content  [kernel.kallsyms]           [k] do_wp_page\n  0.36%  Web Content  libglib-2.0.so.0.3200.1     [.] slab_allocator_alloc_chunk\n  0.36%  Web Content  [kernel.kallsyms]           [k] find_get_page\n  0.35%  Web Content  libpthread-2.15.so          [.] pthread_mutex_unlock\n  0.33%  Web Content  libz.so.1.2.3.4             [.] crc32\n  0.31%  Web Content  libglib-2.0.so.0.3200.1     [.] g_slice_free_chain_with_offset\n  0.30%  Web Content  [kernel.kallsyms]           [k] copy_creds\n  0.27%  Web Content  libgtk-3.so.0.400.1         [.] 0x104a68\n  0.26%  Web Content  libgio-2.0.so.0.3200.1      [.] g_local_file_init\n  0.24%  Web Content  firefox                     [.] SizeClass::SizeClass(unsigned long)\n  0.24%  Web Content  ld-2.15.so                  [.] strcmp\n  0.21%  Web Content  libglib-2.0.so.0.3200.1     [.] g_array_append_vals\n  0.21%  Web Content  firefox                     [.] Allocator<MozJemallocBase>::free(void*)\n  0.20%  Web Content  libc-2.15.so                [.] __strchr_sse42\n  0.19%  Web Content  libglib-2.0.so.0.3200.1     [.] g_str_hash\n  0.18%  Web Content  libpthread-2.15.so          [.] pthread_getspecific\n  0.18%  Web Content  libc-2.15.so                [.] __dcigettext\n  0.18%  Web Content  libgobject-2.0.so.0.3200.1  [.] g_type_interface_peek\n  0.18%  Web Content  libc-2.15.so                [.] __strcmp_sse42\n  0.18%  Web Content  libgobject-2.0.so.0.3200.1  [.] param_spec_pool_hash\n  0.18%  Web Content  [kernel.kallsyms]           [k] __do_softirq\n  0.13%  Web Content  [kernel.kallsyms]           [k] find_vma\n  0.00%  Web Content  [kernel.kallsyms]           [k] native_write_msr_safe\n\n\n\nMy conclusion here, based on this, as well as the Gecko Profiles that we've looked at, is that there's not one thing that we're doing wrong that seems to be hurting us here. Something at a lower level - maybe within some of the GTK libraries, or maybe within the kernel, or maybe down to the CPU caches - is burning us here, and causing us to be a little more expensive.\n\nThe other thing to note is that these Talos machines are running a super out-of-date version of Ubuntu (12.04 Precise LTS). That version of Ubuntu hasn't had official support from Canonical in about a year. We should probably upgrade the OS and remeasure here - especially because I haven't been able to reproduce this issue on modern versions of Ubuntu (even when I match CPU cores and RAM to the Talos machines).\n\nI'm going to see if I can get some help getting the Talos loaner updated to a modern version of Ubuntu, and see if the regression is still reproducible.", "author": "mconley@mozilla.com", "id": 13300922, "time": "2018-05-23T22:16:55Z"}, {"text": "Thank you so much for looking into it! I am not sure a recent version of Ubuntu, but I was reproducing this bug locally on macOS 10.12. There was just too much notice locally on my machine to work on this bug reliably.\n\nPerhaps I can try to produce two profiles on macOS like comment 22? Last time I did I couldn't get the symbols; I can try to figure out that to do there.", "author": "timdream@gmail.com", "id": 13308403, "time": "2018-05-24T00:49:28Z"}, {"text": "(In reply to Tim Guan-tin Chien [:timdream] (please needinfo) from comment #24)\n> Thank you so much for looking into it! I am not sure a recent version of\n> Ubuntu, but I was reproducing this bug locally on macOS 10.12.\n\nI never considered trying to reproduce this on my local macOS machine. How embarrassing - if I can reproduce this with XCode Instruments connected, that might be super helpful in illuminating the issue. I'll try that today.", "author": "mconley@mozilla.com", "id": 13351962, "time": "2018-05-24T15:32:29Z"}, {"text": "With XCode Instruments, I may have fallen upon a lead, but it's a pretty weird one.\n\nUsing the System Trace instrument, I was able to look at thread locking, context switching, etc. One of the things I noticed was in the \"good\" case, content processes tend to have js::HelperThread threads doing (what appears to be) JS parsing off of the main thread. I couldn't find these threads in the \"bad\" case (when I remove the empty binding).\n\nI am able to control parallel parsing with the javascript.options.parallel_parsing pref. Locally, when I disabled parallel parsing, the difference between baseline and removing the empty binding went away (if anything, it appeared as if removing the empty binding was slightly better than baseline).\n\nI've got some try pushes cooking to see if this is the case on Linux64 on our Talos hardware as well. If this truly is the root cause - that we're somehow not parsing our JS in parallel properly in the bad case - I guess the next question is, \"why\"?\n\nOr this might be all a red herring. We'll see, I guess.", "author": "mconley@mozilla.com", "id": 13364150, "time": "2018-05-25T15:36:47Z"}, {"text": "Disabling parallel JS in the binary (which I was tinkering with before I found the pref) gets rid of the difference between the baseline and removing the binding:\n\nhttps://treeherder.mozilla.org/perf.html#/compare?originalProject=try&originalRevision=7ea891e89077&newProject=try&newRevision=47d0489f190c&framework=1\n\nFlipping the javascript.options.parallel_parsing pref to false is similar:\n\nhttps://treeherder.mozilla.org/perf.html#/compare?originalProject=try&originalRevision=9407d4cefbf4&newProject=try&newRevision=d684823ce8e7&framework=1\n\nThe plot thickens. I'm now trying to figure out if and when we schedule parallel JS parsing in the content process normally, and if and how that's being affected somehow by XML parsing the empty binding.", "author": "mconley@mozilla.com", "id": 13364195, "time": "2018-05-25T15:53:50Z"}, {"text": "Okay, miraculously, I think I'm 80% of the way towards understanding what's happening here.\n\nGood news! I'm almost sure that we've caught a real performance regression here! \\o/ Thanks, Talos!\n\nWe have this thing called the ScriptPreloader that notices scripts loaded in the parent and content processes before the browser-delayed-startup-finished observer notification for the first window fires. After that, the scripts it has seen are parsed off of the main thread, sorted by the order they were loaded in, and stashed in a binary format on the file system.\n\nThen, on start-up, the cache is opened and made available for when both the parent and content processes want to load these scripts - we're able to skip the parsing step and start running the scripts more quickly.\n\nThe ScriptPreloader was added in bug 1359653. I'm pretty sure most people don't know it exists. It _does_ have a nice impact on our Talos numbers though (see bug 1359653 comment 93).\n\nAnyhow, for some reason, when we don't have the XBL binding on the scrollbar, the scripts from the content process are only heard about _after_ the browser-delayed-startup-finished notification fires, so they miss the window of time to get into the cache.\n\nThe solution might end up being that browser-delayed-startup-finished is not the right point at which to \"close the door\" on scripts to put into the cache. We might want another notification to fire after all of the idle callback scripts fire in browser.js as well. We might also want to ensure that the content process has sent up its initial scripts too.\n\nSo, ultimately, the reason we're regressing cpstartup is because the scripts we're running aren't in the ScriptPreloader cache.\n\nI'm still trying to figure out why, but I'm quite confident I'll have an answer shortly. Stay tuned.", "author": "mconley@mozilla.com", "id": 13369407, "time": "2018-05-28T16:46:08Z"}, {"text": "So it seems that the reason we're not caching the scripts from the child when we don't parse the XML seems to be some kind of scheduling foul-up.\n\nIn both cases (with or without the empty XBL binding), the browser-delayed-startup-finished notification can fire before the list of scripts are received from the child to cache. At that point, the parent asks a different thread to \"prepare\" the cache that will be written to disk. Meanwhile, the first tab's content process is sending the list of scripts to cache to the parent, and that message is sitting on the messaging thread waiting for the main thread to service it.\n\nIn the \"good\" case, where we have an empty XBL binding, the thread to prepare the cache is serviced _after_ the IPC message from the child is serviced. This means that we see browser-delayed-startup-finished, queue up the preparation, get some more scripts from the content process, and then prepare and write the cache to disk off of the main thread.\n\nIn the \"bad\" case, with no empty XBL binding, the thread to prepare the cache is serviced _before_ the IPC message from the child is serviced. This means that we see browser-delayed-startup-finished, queue up the preparation, and then start that preparation before we start servicing that list of scripts from the content process. By the time we _do_ service that message, we've already written the cache.", "author": "mconley@mozilla.com", "id": 13369627, "time": "2018-05-28T19:25:28Z"}, {"text": "Hey kmag,\n\nDo you have any objections if I change ScriptPreloader to wait for something other than browser-delayed-startup-finished for \"closing the caching window\" during start-up? I'm thinking, specifically, of adding a new observer notification here:\n\nhttps://searchfox.org/mozilla-central/rev/5a744713370ec47969595e369fd5125f123e6d24/browser/base/content/browser.js#1781\n\ncalled browser-idle-startup-tasks-finished, which ScriptPreloader will wait for.\n\nThis will increase the size of the caching window significantly, and greatly increases the probability that the content process(es) will have sent up its list of scripts for caching.\n\nDo you see any issues with that?", "author": "mconley@mozilla.com", "id": 13369838, "time": "2018-05-28T22:23:39Z"}, {"text": "Sounds fine to me. I've always suspected it might be a good idea to push the window back a bit further, but there was no other obvious place to put it.", "author": "kmaglione+bmo@mozilla.com", "id": 13369881, "time": "2018-05-28T22:55:57Z"}, {"text": "Talked to timdream - I'll take this bug.", "author": "mconley@mozilla.com", "id": 13371686, "time": "2018-05-29T16:29:46Z"}, {"text": "Created attachment 8981986\nBug 1458375 - Remove non-e10s support for TalosPowersContent goQuitApplication.\n\nReview commit: https://reviewboard.mozilla.org/r/248024/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/248024/", "author": "mconley@mozilla.com", "id": 13375408, "time": "2018-05-30T18:58:48Z"}, {"text": "Created attachment 8981987\nBug 1458375 - Talos tests that use TalosPowersContent.goQuitApplication(); shouldn't close their windows.\n\ngoQuitApplication does the work of closing all windows anyways, so closing the\nwindow is superfluous. goQuitApplication is also going to be checking for certain\noperations to be finished before doing that, which could be influenced by closing\na window early.\n\nReview commit: https://reviewboard.mozilla.org/r/248026/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/248026/", "author": "mconley@mozilla.com", "id": 13375409, "time": "2018-05-30T18:58:48Z"}, {"text": "Created attachment 8981988\nBug 1458375 - Add a new browser-idle-startup-tasks-finished notification.\n\nThis notification fires when a browser window finishes running its idle tasks. Note\nthat it might never run if every window goes away before the idle tasks can run.\n\nReview commit: https://reviewboard.mozilla.org/r/248028/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/248028/", "author": "mconley@mozilla.com", "id": 13375410, "time": "2018-05-30T18:58:48Z"}, {"text": "Created attachment 8981989\nBug 1458375 - Make TalosPowersContent.goQuitApplication wait for browser-idle-startup-tasks-finished to fire before quitting.\n\nbrowser-idle-startup-tasks-finished will kick off some caching that can influence\nfuture runs in the same profile. We want to make sure that we properly create\nthat cache when running Talos.\n\nReview commit: https://reviewboard.mozilla.org/r/248030/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/248030/", "author": "mconley@mozilla.com", "id": 13375411, "time": "2018-05-30T18:58:48Z"}, {"text": "Created attachment 8981990\nBug 1458375 - Make sessionrestore tests wait for the browser-idle-startup-tasks-finished event.\n\nReview commit: https://reviewboard.mozilla.org/r/248032/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/248032/", "author": "mconley@mozilla.com", "id": 13375412, "time": "2018-05-30T18:58:48Z"}, {"text": "Created attachment 8981991\nBug 1458375 - Make ScriptPreloader wait until browser-idle-startup-tasks-finished before writing cache.\n\nThe ScriptPreloader stopped recording before browser-delayed-startup-finished before, but there\nare other scripts (both in the parent and content processes) that might run soon after that we\nalso want to cache. This increases the probability that those scripts are noted by the\nScriptPreloader cache.\n\nReview commit: https://reviewboard.mozilla.org/r/248036/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/248036/", "author": "mconley@mozilla.com", "id": 13375413, "time": "2018-05-30T18:58:48Z"}, {"text": "Created attachment 8981992\nBug 1458375 - Remove empty binding attached to scrollbars.\n\nReview commit: https://reviewboard.mozilla.org/r/248040/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/248040/", "author": "mconley@mozilla.com", "id": 13375414, "time": "2018-05-30T18:58:48Z"}, {"text": "Comment on attachment 8981991\nBug 1458375 - Make ScriptPreloader wait until browser-idle-startup-tasks-finished before writing cache.\n\nhttps://reviewboard.mozilla.org/r/248036/#review254152\n\n::: js/xpconnect/loader/ScriptPreloader.cpp:34\n(Diff revision 1)\n>  #include \"nsJSUtils.h\"\n>  #include \"nsProxyRelease.h\"\n>  #include \"nsThreadUtils.h\"\n>  #include \"nsXULAppAPI.h\"\n>  #include \"xpcpublic.h\"\n>  \n\nPlease just rename this to something more generic that states its purpose. Like STARTUP_COMPLETE_TOPIC.\n\nAlso, please make sure this is dispatched in Fennec.", "author": "kmaglione+bmo@mozilla.com", "id": 13375561, "time": "2018-05-30T19:49:51Z"}, {"text": "Created attachment 8982039\nBug 1458375 - Add browser-idle-startup-tasks-finished notification to Fennec.\n\nReview commit: https://reviewboard.mozilla.org/r/248082/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/248082/", "author": "mconley@mozilla.com", "id": 13375775, "time": "2018-05-30T21:17:57Z"}, {"text": "Comment on attachment 8981986\nBug 1458375 - Remove non-e10s support for TalosPowersContent goQuitApplication.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/248024/diff/1-2/", "author": "mconley@mozilla.com", "id": 13375776, "time": "2018-05-30T21:17:57Z"}, {"text": "Comment on attachment 8981987\nBug 1458375 - Talos tests that use TalosPowersContent.goQuitApplication(); shouldn't close their windows.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/248026/diff/1-2/", "author": "mconley@mozilla.com", "id": 13375777, "time": "2018-05-30T21:17:57Z"}, {"text": "Comment on attachment 8981988\nBug 1458375 - Add a new browser-idle-startup-tasks-finished notification.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/248028/diff/1-2/", "author": "mconley@mozilla.com", "id": 13375778, "time": "2018-05-30T21:17:57Z"}, {"text": "Comment on attachment 8981989\nBug 1458375 - Make TalosPowersContent.goQuitApplication wait for browser-idle-startup-tasks-finished to fire before quitting.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/248030/diff/1-2/", "author": "mconley@mozilla.com", "id": 13375779, "time": "2018-05-30T21:17:57Z"}, {"text": "Comment on attachment 8981990\nBug 1458375 - Make sessionrestore tests wait for the browser-idle-startup-tasks-finished event.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/248032/diff/1-2/", "author": "mconley@mozilla.com", "id": 13375780, "time": "2018-05-30T21:17:57Z"}, {"text": "Comment on attachment 8981991\nBug 1458375 - Make ScriptPreloader wait until browser-idle-startup-tasks-finished before writing cache.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/248036/diff/1-2/", "author": "mconley@mozilla.com", "id": 13375781, "time": "2018-05-30T21:17:57Z"}, {"text": "Comment on attachment 8981992\nBug 1458375 - Remove empty binding attached to scrollbars.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/248040/diff/1-2/", "author": "mconley@mozilla.com", "id": 13375782, "time": "2018-05-30T21:17:57Z"}, {"text": "Comment on attachment 8981988\nBug 1458375 - Add a new browser-idle-startup-tasks-finished notification.\n\nhttps://reviewboard.mozilla.org/r/248028/#review254220", "author": "felipc@gmail.com", "id": 13375892, "time": "2018-05-30T22:04:54Z"}, {"text": "Comment on attachment 8981992\nBug 1458375 - Remove empty binding attached to scrollbars.\n\nhttps://reviewboard.mozilla.org/r/248040/#review254290", "author": "timdream@gmail.com", "id": 13376329, "time": "2018-05-31T01:56:34Z"}, {"text": "Comment on attachment 8981987\nBug 1458375 - Talos tests that use TalosPowersContent.goQuitApplication(); shouldn't close their windows.\n\nhttps://reviewboard.mozilla.org/r/248026/#review254404\n\nYep LGTM and applied patch locally and ran tresize which uses goQuitApplication()", "author": "rwood@mozilla.com", "id": 13377457, "time": "2018-05-31T13:57:42Z"}, {"text": "Just so nobody thinks I'm cooking the books, here's a comparison with and without the empty binding (both having the rest of the patches):\n\nhttps://treeherder.mozilla.org/perf.html#/compare?originalProject=try&originalRevision=97d5b4811a11&newProject=try&newRevision=3e5e06d9fc97&framework=1&showOnlyImportant=1", "author": "mconley@mozilla.com", "id": 13377471, "time": "2018-05-31T14:00:48Z"}, {"text": "(In reply to Robert Wood [:rwood] from comment #51)\n> Comment on attachment 8981987\n> Bug 1458375 - Talos tests that use TalosPowersContent.goQuitApplication();\n> shouldn't close their windows.\n> \n> https://reviewboard.mozilla.org/r/248026/#review254404\n> \n> Yep LGTM and applied patch locally and ran tresize which uses\n> goQuitApplication()\n\nWhoops r+d the wrong patch", "author": "rwood@mozilla.com", "id": 13377566, "time": "2018-05-31T14:15:03Z"}, {"text": "Comment on attachment 8981986\nBug 1458375 - Remove non-e10s support for TalosPowersContent goQuitApplication.\n\nhttps://reviewboard.mozilla.org/r/248024/#review254412\n\nLGTM, applied locally and ran a talos test that uses goQuitApplication (tresize).", "author": "rwood@mozilla.com", "id": 13377567, "time": "2018-05-31T14:16:15Z"}, {"text": "(In reply to Robert Wood [:rwood] from comment #53)\n> (In reply to Robert Wood [:rwood] from comment #51)\n> > Comment on attachment 8981987\n> > Bug 1458375 - Talos tests that use TalosPowersContent.goQuitApplication();\n> > shouldn't close their windows.\n> > \n> > https://reviewboard.mozilla.org/r/248026/#review254404\n> > \n> > Yep LGTM and applied patch locally and ran tresize which uses\n> > goQuitApplication()\n> \n> Whoops r+d the wrong patch\n\nOk now looked at this one, it's also fine. Ran talos tests that use goQuitApplication (tresize, sessionrestore) and no issues.", "author": "rwood@mozilla.com", "id": 13377630, "time": "2018-05-31T14:36:36Z"}, {"text": "Comment on attachment 8981989\nBug 1458375 - Make TalosPowersContent.goQuitApplication wait for browser-idle-startup-tasks-finished to fire before quitting.\n\nhttps://reviewboard.mozilla.org/r/248030/#review254406\n\nLGTM! Also applied previous patches first as well as this one, and ran the talos tests that use goQuitApplication (tresize, sessionrestore). No issues.", "author": "rwood@mozilla.com", "id": 13377680, "time": "2018-05-31T14:52:00Z"}, {"text": "Comment on attachment 8981990\nBug 1458375 - Make sessionrestore tests wait for the browser-idle-startup-tasks-finished event.\n\nhttps://reviewboard.mozilla.org/r/248032/#review254442\n\nLGTM, also applied locally with the others and talos sessionrestore runs fine.", "author": "rwood@mozilla.com", "id": 13377697, "time": "2018-05-31T14:57:38Z"}, {"text": "Comment on attachment 8982039\nBug 1458375 - Add browser-idle-startup-tasks-finished notification to Fennec.\n\nhttps://reviewboard.mozilla.org/r/248082/#review254458", "author": "snorp@snorp.net", "id": 13377895, "time": "2018-05-31T15:54:53Z"}, {"text": "Pushed by mconley@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/2968c0a21410\nRemove non-e10s support for TalosPowersContent goQuitApplication. r=rwood\nhttps://hg.mozilla.org/integration/autoland/rev/cfe8da250de7\nTalos tests that use TalosPowersContent.goQuitApplication(); shouldn't close their windows. r=rwood\nhttps://hg.mozilla.org/integration/autoland/rev/715850ae92a1\nAdd a new browser-idle-startup-tasks-finished notification. r=Felipe\nhttps://hg.mozilla.org/integration/autoland/rev/bd2cba9dfb3d\nAdd browser-idle-startup-tasks-finished notification to Fennec. r=snorp\nhttps://hg.mozilla.org/integration/autoland/rev/868da3a1b94a\nMake TalosPowersContent.goQuitApplication wait for browser-idle-startup-tasks-finished to fire before quitting. r=rwood\nhttps://hg.mozilla.org/integration/autoland/rev/1fb76b9b6f82\nMake sessionrestore tests wait for the browser-idle-startup-tasks-finished event. r=rwood\nhttps://hg.mozilla.org/integration/autoland/rev/ae969e1cebfb\nMake ScriptPreloader stop recording after browser-idle-startup-tasks-finished. r=kmag\nhttps://hg.mozilla.org/integration/autoland/rev/30a743401670\nRemove empty binding attached to scrollbars. r=timdream", "author": "pulsebot@bots.tld", "id": 13377984, "time": "2018-05-31T16:27:39Z"}, {"text": "Backed out 8 changesets (bug 1458375) for Mochitest leaks on a CLOSED TREE\n\nPush with failures: https://treeherder.mozilla.org/#/jobs?repo=autoland&revision=30a7434016700d5d11031eb329526932c8bcb93d&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception&filter-classifiedState=unclassified&selectedJob=181159673\n\nFailure log: https://treeherder.mozilla.org/logviewer.html#?job_id=181159673&repo=autoland&lineNumber=5344\n\nBackout: https://hg.mozilla.org/integration/autoland/rev/da1661774f7f4546497f46e89aceba860693613f", "author": "nerli@mozilla.com", "id": 13378545, "time": "2018-05-31T19:41:18Z"}, {"text": "Created attachment 8983571\nBug 1458375 - Make browser mochitests wait for browser-idle-startup-tasks-finished before running tests.\n\nReview commit: https://reviewboard.mozilla.org/r/249428/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/249428/", "author": "mconley@mozilla.com", "id": 13389304, "time": "2018-06-05T21:33:33Z"}, {"text": "Comment on attachment 8981986\nBug 1458375 - Remove non-e10s support for TalosPowersContent goQuitApplication.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/248024/diff/2-3/", "author": "mconley@mozilla.com", "id": 13389305, "time": "2018-06-05T21:33:33Z"}, {"text": "Comment on attachment 8981987\nBug 1458375 - Talos tests that use TalosPowersContent.goQuitApplication(); shouldn't close their windows.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/248026/diff/2-3/", "author": "mconley@mozilla.com", "id": 13389306, "time": "2018-06-05T21:33:33Z"}, {"text": "Comment on attachment 8981988\nBug 1458375 - Add a new browser-idle-startup-tasks-finished notification.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/248028/diff/2-3/", "author": "mconley@mozilla.com", "id": 13389307, "time": "2018-06-05T21:33:33Z"}, {"text": "Comment on attachment 8982039\nBug 1458375 - Add browser-idle-startup-tasks-finished notification to Fennec.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/248082/diff/1-2/", "author": "mconley@mozilla.com", "id": 13389308, "time": "2018-06-05T21:33:33Z"}, {"text": "Comment on attachment 8981989\nBug 1458375 - Make TalosPowersContent.goQuitApplication wait for browser-idle-startup-tasks-finished to fire before quitting.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/248030/diff/2-3/", "author": "mconley@mozilla.com", "id": 13389309, "time": "2018-06-05T21:33:33Z"}, {"text": "Comment on attachment 8981990\nBug 1458375 - Make sessionrestore tests wait for the browser-idle-startup-tasks-finished event.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/248032/diff/2-3/", "author": "mconley@mozilla.com", "id": 13389310, "time": "2018-06-05T21:33:33Z"}, {"text": "Comment on attachment 8981991\nBug 1458375 - Make ScriptPreloader wait until browser-idle-startup-tasks-finished before writing cache.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/248036/diff/2-3/", "author": "mconley@mozilla.com", "id": 13389311, "time": "2018-06-05T21:33:33Z"}, {"text": "Comment on attachment 8981992\nBug 1458375 - Remove empty binding attached to scrollbars.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/248040/diff/2-3/", "author": "mconley@mozilla.com", "id": 13389312, "time": "2018-06-05T21:33:33Z"}, {"text": "Comment on attachment 8983571\nBug 1458375 - Make browser mochitests wait for browser-idle-startup-tasks-finished before running tests.\n\nhttps://reviewboard.mozilla.org/r/249428/#review255612\n\n\nCode analysis found 1 defect in this patch:\n - 1 defect found by mozlint\n\nYou can run this analysis locally with:\n - `./mach lint path/to/file` (JS/Python)\n\n\nIf you see a problem in this automated review, please report it here: http://bit.ly/2y9N9Vx\n\n\n::: testing/mochitest/browser-test.js:518\n(Diff revision 1)\n>  \n> -    if (this.tests.length)\n> -      this.waitForGraphicsTestWindowToBeGone(this.nextTest.bind(this));\n> -    else\n> +    if (this.tests.length) {\n> +      this.waitForWindowsReady().then(() => {\n> +        this.nextTest();\n> +      });\n> +    }\n\nError: Closing curly brace does not appear on the same line as the subsequent block. [eslint: brace-style]", "author": "jkeromnes+clangbot@mozilla.com", "id": 13389378, "time": "2018-06-05T21:48:27Z"}, {"text": "Comment on attachment 8983571\nBug 1458375 - Make browser mochitests wait for browser-idle-startup-tasks-finished before running tests.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/249428/diff/1-2/", "author": "mconley@mozilla.com", "id": 13389482, "time": "2018-06-05T22:05:39Z"}, {"text": "Comment on attachment 8983571\nBug 1458375 - Make browser mochitests wait for browser-idle-startup-tasks-finished before running tests.\n\nhttps://reviewboard.mozilla.org/r/249428/#review255986\n\n::: testing/mochitest/browser-test.js:530\n(Diff revision 2)\n> +      await new Promise(resolve => {\n> +        const IDLE_TOPIC = \"browser-idle-startup-tasks-finished\";\n> +        let observer = (subject, topic, data) => {\n> +          if (topic == IDLE_TOPIC && subject == window) {\n> +            Services.obs.removeObserver(observer, IDLE_TOPIC);\n> +            resolve();\n> +          }\n> +        };\n> +        Services.obs.addObserver(observer, IDLE_TOPIC);\n> +      });\n\nNit:\n\n    await TestUtils.topicObserved(IDLE_TOPIC,\n                                  subject => subject === window);", "author": "kmaglione+bmo@mozilla.com", "id": 13392164, "time": "2018-06-06T21:07:08Z"}, {"text": "Comment on attachment 8981986\nBug 1458375 - Remove non-e10s support for TalosPowersContent goQuitApplication.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/248024/diff/3-4/", "author": "mconley@mozilla.com", "id": 13401979, "time": "2018-06-12T05:22:09Z"}, {"text": "Comment on attachment 8981987\nBug 1458375 - Talos tests that use TalosPowersContent.goQuitApplication(); shouldn't close their windows.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/248026/diff/3-4/", "author": "mconley@mozilla.com", "id": 13401980, "time": "2018-06-12T05:22:09Z"}, {"text": "Comment on attachment 8981988\nBug 1458375 - Add a new browser-idle-startup-tasks-finished notification.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/248028/diff/3-4/", "author": "mconley@mozilla.com", "id": 13401981, "time": "2018-06-12T05:22:09Z"}, {"text": "Comment on attachment 8982039\nBug 1458375 - Add browser-idle-startup-tasks-finished notification to Fennec.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/248082/diff/2-3/", "author": "mconley@mozilla.com", "id": 13401982, "time": "2018-06-12T05:22:09Z"}, {"text": "Comment on attachment 8981989\nBug 1458375 - Make TalosPowersContent.goQuitApplication wait for browser-idle-startup-tasks-finished to fire before quitting.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/248030/diff/3-4/", "author": "mconley@mozilla.com", "id": 13401983, "time": "2018-06-12T05:22:09Z"}, {"text": "Comment on attachment 8981990\nBug 1458375 - Make sessionrestore tests wait for the browser-idle-startup-tasks-finished event.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/248032/diff/3-4/", "author": "mconley@mozilla.com", "id": 13401984, "time": "2018-06-12T05:22:09Z"}, {"text": "Comment on attachment 8981991\nBug 1458375 - Make ScriptPreloader wait until browser-idle-startup-tasks-finished before writing cache.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/248036/diff/3-4/", "author": "mconley@mozilla.com", "id": 13401985, "time": "2018-06-12T05:22:09Z"}, {"text": "Comment on attachment 8981992\nBug 1458375 - Remove empty binding attached to scrollbars.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/248040/diff/3-4/", "author": "mconley@mozilla.com", "id": 13401986, "time": "2018-06-12T05:22:09Z"}, {"text": "Comment on attachment 8983571\nBug 1458375 - Make browser mochitests wait for browser-idle-startup-tasks-finished before running tests.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/249428/diff/2-3/", "author": "mconley@mozilla.com", "id": 13401987, "time": "2018-06-12T05:22:09Z"}, {"text": "For the folks who are wondering why I haven't just gone ahead and landed this, it's because it caused a ts_paint regression on Linux.\n\nIt seems that there's some kind of relationship between the size of the ScriptPreload cache for the parent process, and ts_paint performance on Linux. My theory is that if the cache gets large enough, then we end up taxing background threads on decoding which draws CPU cycles from the main thread, pulling from first paint performance. I suspect this only because an issue because I greatly increased the number of scripts going into the cache in the parent process.\n\nSo I've modified my scheme somewhat; I'm going back to using browser-delayed-startup-finished to stop the recording for the ScriptPreloader in the parent process - however, I wait until browser-idle-startup-tasks-finished to prepare and write the caches to disk.\n\nThis seems to address all of the remaining high-confidence regressions for me.\n\nTry push: https://treeherder.mozilla.org/#/jobs?repo=try&revision=c87fd0965dcc7528a29cfffbd4a8b516c220bf55\n\nComparison to a baseline: https://treeherder.mozilla.org/perf.html#/compare?originalProject=try&originalRevision=395a7f880d36&newProject=try&newRevision=c87fd0965dcc&framework=1&showOnlyImportant=1\n\nI ended up modifying the ScriptPreloader changes in this way:\n\nhttps://reviewboard.mozilla.org/r/248036/diff/3-4#index_header\n\nDoes that still look okay to you, kmag?", "author": "mconley@mozilla.com", "id": 13401994, "time": "2018-06-12T05:26:57Z"}, {"text": "Yeah, that sounds reasonable enough. But I really think that ideally we should try to get scripts loaded by the idle tasks into the preloader cache. I'd expect it to noticeably improve startup responsiveness in a lot of cases.", "author": "kmaglione+bmo@mozilla.com", "id": 13402589, "time": "2018-06-12T19:02:35Z"}, {"text": "Comment on attachment 8981991\nBug 1458375 - Make ScriptPreloader wait until browser-idle-startup-tasks-finished before writing cache.\n\nhttps://reviewboard.mozilla.org/r/248036/#review256998\n\n::: js/xpconnect/loader/ScriptPreloader.cpp:771\n(Diff revisions 3 - 4)\n>      NS_NAMED_LITERAL_CSTRING(mochikitPrefix, \"chrome://mochikit/\");\n>      if (StringHead(url, mochikitPrefix.Length()) == mochikitPrefix) {\n>          return;\n>      }\n>  \n> +    if (mStartupFinished) {\n\nNot necessary. Active() already checks this.", "author": "kmaglione+bmo@mozilla.com", "id": 13402595, "time": "2018-06-12T19:04:32Z"}, {"text": "(In reply to Kris Maglione [:kmag] from comment #83)\n> Yeah, that sounds reasonable enough. But I really think that ideally we\n> should try to get scripts loaded by the idle tasks into the preloader cache.\n> I'd expect it to noticeably improve startup responsiveness in a lot of cases.\n\nAgreed. I found the ts_paint regression quite surprising - I'll file a follow-up bug to revisit.\n\n(In reply to Kris Maglione [:kmag] from comment #84)\n> Not necessary. Active() already checks this.\n\nThanks!", "author": "mconley@mozilla.com", "id": 13402625, "time": "2018-06-12T19:27:11Z"}, {"text": "Comment on attachment 8981986\nBug 1458375 - Remove non-e10s support for TalosPowersContent goQuitApplication.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/248024/diff/4-5/", "author": "mconley@mozilla.com", "id": 13402628, "time": "2018-06-12T19:31:10Z"}, {"text": "Comment on attachment 8981987\nBug 1458375 - Talos tests that use TalosPowersContent.goQuitApplication(); shouldn't close their windows.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/248026/diff/4-5/", "author": "mconley@mozilla.com", "id": 13402629, "time": "2018-06-12T19:31:10Z"}, {"text": "Comment on attachment 8981988\nBug 1458375 - Add a new browser-idle-startup-tasks-finished notification.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/248028/diff/4-5/", "author": "mconley@mozilla.com", "id": 13402630, "time": "2018-06-12T19:31:10Z"}, {"text": "Comment on attachment 8982039\nBug 1458375 - Add browser-idle-startup-tasks-finished notification to Fennec.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/248082/diff/3-4/", "author": "mconley@mozilla.com", "id": 13402631, "time": "2018-06-12T19:31:10Z"}, {"text": "Comment on attachment 8981989\nBug 1458375 - Make TalosPowersContent.goQuitApplication wait for browser-idle-startup-tasks-finished to fire before quitting.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/248030/diff/4-5/", "author": "mconley@mozilla.com", "id": 13402632, "time": "2018-06-12T19:31:10Z"}, {"text": "Comment on attachment 8981990\nBug 1458375 - Make sessionrestore tests wait for the browser-idle-startup-tasks-finished event.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/248032/diff/4-5/", "author": "mconley@mozilla.com", "id": 13402633, "time": "2018-06-12T19:31:10Z"}, {"text": "Comment on attachment 8981991\nBug 1458375 - Make ScriptPreloader wait until browser-idle-startup-tasks-finished before writing cache.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/248036/diff/4-5/", "author": "mconley@mozilla.com", "id": 13402634, "time": "2018-06-12T19:31:10Z"}, {"text": "Comment on attachment 8981992\nBug 1458375 - Remove empty binding attached to scrollbars.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/248040/diff/4-5/", "author": "mconley@mozilla.com", "id": 13402635, "time": "2018-06-12T19:31:10Z"}, {"text": "Comment on attachment 8983571\nBug 1458375 - Make browser mochitests wait for browser-idle-startup-tasks-finished before running tests.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/249428/diff/3-4/", "author": "mconley@mozilla.com", "id": 13402636, "time": "2018-06-12T19:31:10Z"}, {"text": "Pushed by mconley@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/8b65605994f9\nRemove non-e10s support for TalosPowersContent goQuitApplication. r=rwood\nhttps://hg.mozilla.org/integration/autoland/rev/764acaea4d9e\nTalos tests that use TalosPowersContent.goQuitApplication(); shouldn't close their windows. r=rwood\nhttps://hg.mozilla.org/integration/autoland/rev/6c43f8368b07\nAdd a new browser-idle-startup-tasks-finished notification. r=Felipe\nhttps://hg.mozilla.org/integration/autoland/rev/06ebd23a33bf\nAdd browser-idle-startup-tasks-finished notification to Fennec. r=snorp\nhttps://hg.mozilla.org/integration/autoland/rev/7b152fdfbb4a\nMake TalosPowersContent.goQuitApplication wait for browser-idle-startup-tasks-finished to fire before quitting. r=rwood\nhttps://hg.mozilla.org/integration/autoland/rev/5a342be8a03e\nMake sessionrestore tests wait for the browser-idle-startup-tasks-finished event. r=rwood\nhttps://hg.mozilla.org/integration/autoland/rev/8603f0a7c7d1\nMake ScriptPreloader wait until browser-idle-startup-tasks-finished before writing cache. r=kmag\nhttps://hg.mozilla.org/integration/autoland/rev/616dd117184d\nRemove empty binding attached to scrollbars. r=timdream\nhttps://hg.mozilla.org/integration/autoland/rev/b01c4543a097\nMake browser mochitests wait for browser-idle-startup-tasks-finished before running tests. r=kmag", "author": "pulsebot@bots.tld", "id": 13402637, "time": "2018-06-12T19:34:11Z"}, {"text": "Push from comment 95 brought at least a perf win:\n\n== Change summary for alert #13775 (as of Tue, 12 Jun 2018 16:33:36 GMT) ==\n\nImprovements:\n\n  6%  sessionrestore_no_auto_restore windows10-64 pgo e10s stylo     279.08 -> 262.25\n\nFor up to date results, see: https://treeherder.mozilla.org/perf.html#/alerts?id=13775", "author": "igoldan@mozilla.com", "id": 13403198, "time": "2018-06-13T07:39:46Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/8b65605994f9\nhttps://hg.mozilla.org/mozilla-central/rev/764acaea4d9e\nhttps://hg.mozilla.org/mozilla-central/rev/6c43f8368b07\nhttps://hg.mozilla.org/mozilla-central/rev/06ebd23a33bf\nhttps://hg.mozilla.org/mozilla-central/rev/7b152fdfbb4a\nhttps://hg.mozilla.org/mozilla-central/rev/5a342be8a03e\nhttps://hg.mozilla.org/mozilla-central/rev/8603f0a7c7d1\nhttps://hg.mozilla.org/mozilla-central/rev/616dd117184d\nhttps://hg.mozilla.org/mozilla-central/rev/b01c4543a097", "author": "csabou@mozilla.com", "id": 13403255, "time": "2018-06-13T09:27:17Z"}, {"text": "A more complete list of perf improvements:\n\n== Change summary for alert #13786 (as of Tue, 12 Jun 2018 16:33:36 GMT) ==\n\nImprovements:\n\n  7%  sessionrestore_no_auto_restore windows10-64 opt e10s stylo     306.08 -> 283.75\n  7%  sessionrestore_no_auto_restore linux64 pgo e10s stylo          297.50 -> 276.58\n  7%  sessionrestore_no_auto_restore windows7-32 pgo e10s stylo      302.00 -> 281.17\n  6%  sessionrestore_no_auto_restore linux64 opt e10s stylo          311.38 -> 291.33\n  6%  sessionrestore_no_auto_restore windows7-32 opt e10s stylo      336.42 -> 315.25\n  6%  sessionrestore_no_auto_restore windows10-64 pgo e10s stylo     279.08 -> 262.25\n\nFor up to date results, see: https://treeherder.mozilla.org/perf.html#/alerts?id=13786", "author": "igoldan@mozilla.com", "id": 13405147, "time": "2018-06-14T14:35:23Z"}], "id": 1458375, "priority": "P2", "cc": ["bgrinstead@mozilla.com", "brennan.brisad@gmail.com", "bzbarsky@mit.edu", "continuation@gmail.com", "felipc@gmail.com", "gandalf@aviary.pl", "grayshade@gmail.com", "hpradhan@gmail.com", "igoldan@mozilla.com", "kmaglione+bmo@mozilla.com", "mayankleoboy1@gmail.com", "mcastelluccio@mozilla.com", "mconley@mozilla.com", "mstange@themasta.com", "nissan4321@gmail.com", "rwood@mozilla.com", "scineram@freemail.hu", "snorp@snorp.net", "tcampbell@mozilla.com", "timbugzilla@gmail.com"], "cf_crash_signature": "", "version": "unspecified", "is_cc_accessible": true, "cf_tracking_firefox_esr52": "---", "see_also": ["https://bugzilla.mozilla.org/show_bug.cgi?id=1456728", "https://bugzilla.mozilla.org/show_bug.cgi?id=1459774", "https://bugzilla.mozilla.org/show_bug.cgi?id=1468673"], "cf_tracking_thunderbird_esr60": "---", "cf_platform_rel": "---", "product": "Core", "cf_fx_iteration": "---", "blocks": [1397874, 1465832], "qa_contact": "", "creation_time": "2018-05-01T21:59:30Z", "cf_status_firefox_esr52": "---", "component": "XBL", "assigned_to_detail": {"email": "mconley@mozilla.com", "id": 403756, "name": "mconley@mozilla.com", "real_name": "Mike Conley (:mconley) (:\u2699\ufe0f) (Catching up on needinfos / reviews)"}, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "fixed", "cf_status_firefox61": "---", "cf_status_firefox60": "---", "target_milestone": "mozilla62", "cf_rank": null, "cf_qa_whiteboard": "", "severity": "normal", "groups": [], "cf_status_thunderbird_esr52": "---", "url": "", "cf_status_thunderbird_esr60": "---", "creator_detail": {"email": "timdream@gmail.com", "id": 185001, "name": "timdream@gmail.com", "real_name": "Tim Guan-tin Chien [:timdream] (please needinfo)"}, "whiteboard": "", "mentors": [], "summary": "Remove empty binding & investigate the performance gain caused by it", "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "last_change_time": "2018-06-14T14:35:23Z", "assigned_to": "mconley@mozilla.com", "is_open": false, "history": [{"changes": [{"removed": "", "field_name": "see_also", "added": "https://bugzilla.mozilla.org/show_bug.cgi?id=1456728"}], "who": "timdream@gmail.com", "when": "2018-05-01T22:01:03Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "bgrinstead@mozilla.com"}], "who": "bgrinstead@mozilla.com", "when": "2018-05-01T22:01:57Z"}, {"changes": [{"removed": "", "field_name": "blocks", "added": "1397874"}], "who": "bgrinstead@mozilla.com", "when": "2018-05-01T22:02:14Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "mcastelluccio@mozilla.com"}], "who": "mcastelluccio@mozilla.com", "when": "2018-05-01T22:20:11Z"}, {"changes": [{"removed": "--", "field_name": "priority", "added": "P2"}, {"removed": "", "field_name": "cc", "added": "continuation@gmail.com"}], "who": "continuation@gmail.com", "when": "2018-05-01T23:29:52Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "hpradhan@gmail.com"}], "who": "hpradhan@gmail.com", "when": "2018-05-02T13:18:45Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "bzbarsky@mit.edu"}], "who": "bzbarsky@mit.edu", "when": "2018-05-02T13:44:42Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "mconley@mozilla.com"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(mconley@mozilla.com)"}], "who": "bgrinstead@mozilla.com", "when": "2018-05-07T16:08:16Z"}, {"changes": [{"removed": "needinfo?(mconley@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "mconley@mozilla.com", "when": "2018-05-07T19:14:15Z"}, {"changes": [{"removed": "", "field_name": "see_also", "added": "https://bugzilla.mozilla.org/show_bug.cgi?id=1459774"}], "who": "timdream@gmail.com", "when": "2018-05-07T23:39:41Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(timdream@gmail.com)"}], "who": "mconley@mozilla.com", "when": "2018-05-09T01:26:41Z"}, {"changes": [{"removed": "needinfo?(timdream@gmail.com)", "field_name": "flagtypes.name", "added": ""}], "who": "timdream@gmail.com", "when": "2018-05-09T01:39:47Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(mconley@mozilla.com)"}], "who": "mconley@mozilla.com", "when": "2018-05-09T01:40:55Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "jan@ikenmeyer.eu"}], "who": "jan@ikenmeyer.eu", "when": "2018-05-09T17:54:31Z"}, {"changes": [{"removed": "jan@ikenmeyer.eu", "field_name": "cc", "added": ""}], "who": "jan@ikenmeyer.eu", "when": "2018-05-15T17:56:27Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "brennan.brisad@gmail.com"}], "who": "brennan.brisad@gmail.com", "when": "2018-05-20T14:09:54Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "gandalf@aviary.pl"}], "who": "gandalf@aviary.pl", "when": "2018-05-22T15:22:27Z"}, {"changes": [{"removed": "needinfo?(mconley@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "mconley@mozilla.com", "when": "2018-05-23T22:16:55Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "mayankleoboy1@gmail.com"}], "who": "mayankleoboy1@gmail.com", "when": "2018-05-24T13:35:59Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "grayshade@gmail.com"}], "who": "grayshade@gmail.com", "when": "2018-05-24T20:45:59Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "mstange@themasta.com"}], "who": "mstange@themasta.com", "when": "2018-05-25T15:39:49Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "tcampbell@mozilla.com"}], "who": "tcampbell@mozilla.com", "when": "2018-05-28T18:04:27Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "kmaglione+bmo@mozilla.com"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(kmaglione+bmo@mozilla.com)"}], "who": "mconley@mozilla.com", "when": "2018-05-28T22:23:39Z"}, {"changes": [{"removed": "needinfo?(kmaglione+bmo@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "kmaglione+bmo@mozilla.com", "when": "2018-05-28T22:55:57Z"}, {"changes": [{"removed": "timdream@gmail.com", "field_name": "assigned_to", "added": "mconley@mozilla.com"}], "who": "mconley@mozilla.com", "when": "2018-05-29T16:29:46Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8981986, "added": "review?(rwood@mozilla.com)"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8981987, "added": "review?(rwood@mozilla.com)"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8981988, "added": "review?(felipc@gmail.com)"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8981989, "added": "review?(rwood@mozilla.com)"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8981990, "added": "review?(rwood@mozilla.com)"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8981991, "added": "review?(kmaglione+bmo@mozilla.com)"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8981992, "added": "review?(timdream@gmail.com)"}, {"removed": "", "field_name": "cc", "added": "felipc@gmail.com, rwood@mozilla.com"}], "who": "mconley@mozilla.com", "when": "2018-05-30T18:58:48Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8973786, "added": "1"}], "who": "mconley@mozilla.com", "when": "2018-05-30T18:58:54Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(kmaglione+bmo@mozilla.com)", "attachment_id": 8981991, "added": "review+"}], "who": "kmaglione+bmo@mozilla.com", "when": "2018-05-30T19:49:51Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8982039, "added": "review?(snorp@snorp.net)"}, {"removed": "", "field_name": "cc", "added": "snorp@snorp.net"}], "who": "mconley@mozilla.com", "when": "2018-05-30T21:17:57Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(felipc@gmail.com)", "attachment_id": 8981988, "added": "review+"}], "who": "felipc@gmail.com", "when": "2018-05-30T22:04:54Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(timdream@gmail.com)", "attachment_id": 8981992, "added": "review+"}], "who": "timdream@gmail.com", "when": "2018-05-31T01:56:34Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(rwood@mozilla.com)", "attachment_id": 8981987, "added": "review+"}], "who": "rwood@mozilla.com", "when": "2018-05-31T13:57:42Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(rwood@mozilla.com)", "attachment_id": 8981986, "added": "review+"}], "who": "rwood@mozilla.com", "when": "2018-05-31T14:16:15Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(rwood@mozilla.com)", "attachment_id": 8981989, "added": "review+"}], "who": "rwood@mozilla.com", "when": "2018-05-31T14:52:00Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(rwood@mozilla.com)", "attachment_id": 8981990, "added": "review+"}], "who": "rwood@mozilla.com", "when": "2018-05-31T14:57:38Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(snorp@snorp.net)", "attachment_id": 8982039, "added": "review+"}], "who": "snorp@snorp.net", "when": "2018-05-31T15:54:53Z"}, {"changes": [{"removed": "", "field_name": "blocks", "added": "1465832"}], "who": "mconley@mozilla.com", "when": "2018-05-31T16:12:23Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(mconley@mozilla.com)"}], "who": "nerli@mozilla.com", "when": "2018-05-31T19:41:18Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "scineram@freemail.hu"}], "who": "scineram@freemail.hu", "when": "2018-06-01T08:17:37Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "timbugzilla@gmail.com"}], "who": "timbugzilla@gmail.com", "when": "2018-06-01T09:44:59Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "nissan4321@gmail.com"}], "who": "nissan4321@gmail.com", "when": "2018-06-02T22:01:51Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8983571, "added": "review?(kmaglione+bmo@mozilla.com)"}], "who": "mconley@mozilla.com", "when": "2018-06-05T21:33:33Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(kmaglione+bmo@mozilla.com)", "attachment_id": 8983571, "added": "review+"}], "who": "kmaglione+bmo@mozilla.com", "when": "2018-06-06T21:07:08Z"}, {"changes": [{"field_name": "attachments.description", "removed": "Bug 1458375 - Make ScriptPreloader stop recording after browser-idle-startup-tasks-finished.", "attachment_id": 8981991, "added": "Bug 1458375 - Make ScriptPreloader wait until browser-idle-startup-tasks-finished before writing cache."}], "who": "mconley@mozilla.com", "when": "2018-06-12T05:22:09Z"}, {"changes": [{"removed": "needinfo?(mconley@mozilla.com)", "field_name": "flagtypes.name", "added": "needinfo?(kmaglione+bmo@mozilla.com)"}], "who": "mconley@mozilla.com", "when": "2018-06-12T05:26:57Z"}, {"changes": [{"removed": "needinfo?(kmaglione+bmo@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "kmaglione+bmo@mozilla.com", "when": "2018-06-12T19:02:35Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "igoldan@mozilla.com"}], "who": "igoldan@mozilla.com", "when": "2018-06-13T07:39:46Z"}, {"changes": [{"removed": "ASSIGNED", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla62"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2018-06-13 09:27:17"}, {"removed": "---", "field_name": "cf_status_firefox62", "added": "fixed"}], "who": "csabou@mozilla.com", "when": "2018-06-13T09:27:17Z"}, {"changes": [{"removed": "", "field_name": "see_also", "added": "https://bugzilla.mozilla.org/show_bug.cgi?id=1468673"}], "who": "mconley@mozilla.com", "when": "2018-06-14T03:10:21Z"}], "resolution": "FIXED", "op_sys": "Unspecified", "cf_fx_points": "---", "cf_blocking_fennec": "---"}