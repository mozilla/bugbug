{"cf_tracking_thunderbird_esr52": "---", "status": "RESOLVED", "cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "cf_tracking_firefox62": "---", "creator": "dkeeler@mozilla.com", "mentors_detail": [], "depends_on": [], "cf_status_firefox33": "---", "cf_status_firefox_esr60": "---", "cf_status_firefox35": "---", "cf_status_firefox36": "wontfix", "cf_status_firefox37": "wontfix", "cf_user_story": "", "history": [{"changes": [{"removed": "", "field_name": "keywords", "added": "sec-moderate"}, {"removed": "---", "field_name": "cf_status_firefox36", "added": "affected"}, {"removed": "---", "field_name": "cf_status_firefox37", "added": "affected"}, {"removed": "---", "field_name": "cf_status_firefox38", "added": "affected"}, {"removed": "---", "field_name": "cf_status_firefox39", "added": "affected"}, {"removed": "---", "field_name": "cf_status_firefox_esr38", "added": "affected"}], "who": "dkeeler@mozilla.com", "when": "2015-03-25T17:34:45Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "brian@briansmith.org"}], "who": "brian@briansmith.org", "when": "2015-03-25T18:02:39Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "mmc@mozilla.com"}], "who": "dkeeler@mozilla.com", "when": "2015-03-25T18:30:24Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "ASSIGNED"}, {"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "dkeeler@mozilla.com"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8583297, "added": "review?(mmc@mozilla.com)"}], "who": "dkeeler@mozilla.com", "when": "2015-03-25T20:07:00Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(brian@briansmith.org)"}], "who": "mmc.bugzilla@gmail.com", "when": "2015-03-25T20:35:43Z"}, {"changes": [{"removed": "needinfo?(brian@briansmith.org)", "field_name": "flagtypes.name", "added": ""}], "who": "brian@briansmith.org", "when": "2015-03-25T20:50:58Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(mmc@mozilla.com)", "attachment_id": 8583297, "added": ""}], "who": "mmc.bugzilla@gmail.com", "when": "2015-03-25T20:54:05Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8583297, "added": "1"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8584790, "added": "review?(mmc@mozilla.com), feedback?(brian@briansmith.org)"}], "who": "dkeeler@mozilla.com", "when": "2015-03-27T20:46:03Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(mmc@mozilla.com)", "attachment_id": 8584790, "added": "feedback+"}], "who": "mmc.bugzilla@gmail.com", "when": "2015-03-30T20:45:38Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "feedback?(brian@briansmith.org)", "attachment_id": 8584790, "added": "feedback+"}], "who": "brian@briansmith.org", "when": "2015-03-31T00:23:02Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "rlb@ipv.sx"}], "who": "dkeeler@mozilla.com", "when": "2015-04-02T21:13:14Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "cykesiopka.bmo@gmail.com"}], "who": "dkeeler@mozilla.com", "when": "2015-04-03T17:40:44Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8584790, "added": "1"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8588051, "added": "review?(cykesiopka.bmo@gmail.com), feedback?"}], "who": "dkeeler@mozilla.com", "when": "2015-04-03T17:40:50Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "jjones@mozilla.com"}], "who": "dkeeler@mozilla.com", "when": "2015-04-03T17:41:37Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "feedback?", "attachment_id": 8588051, "added": "feedback?(jjones@mozilla.com)"}], "who": "dkeeler@mozilla.com", "when": "2015-04-03T17:41:53Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(cykesiopka.bmo@gmail.com)", "attachment_id": 8588051, "added": "review+"}], "who": "cykesiopka.bmo@gmail.com", "when": "2015-04-04T00:19:39Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review+, feedback?(jjones@mozilla.com)", "attachment_id": 8588051, "added": "review?(cykesiopka.bmo@gmail.com), feedback+"}], "who": "jjones@mozilla.com", "when": "2015-04-06T16:57:30Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(cykesiopka.bmo@gmail.com)", "attachment_id": 8588051, "added": "review+"}], "who": "cykesiopka.bmo@gmail.com", "when": "2015-04-06T17:04:54Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8588051, "added": "1"}, {"removed": "", "field_name": "cc", "added": "jst@mozilla.org"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8588677, "added": "review?(jst@mozilla.org)"}], "who": "dkeeler@mozilla.com", "when": "2015-04-06T18:39:09Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8588677, "added": "review+"}], "who": "mmc.bugzilla@gmail.com", "when": "2015-04-07T20:32:01Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "bugs@pettay.fi"}, {"field_name": "flagtypes.name", "removed": "review?(jst@mozilla.org)", "attachment_id": 8588677, "added": "review?(bugs@pettay.fi)"}], "who": "dkeeler@mozilla.com", "when": "2015-04-10T19:49:01Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(bugs@pettay.fi)", "attachment_id": 8588677, "added": "review+"}], "who": "bugs@pettay.fi", "when": "2015-04-14T17:43:27Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "past@mozilla.com"}], "who": "dkeeler@mozilla.com", "when": "2015-04-15T20:22:22Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8588677, "added": "1"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8593007, "added": "review?(past@mozilla.com)"}], "who": "dkeeler@mozilla.com", "when": "2015-04-15T20:22:36Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(past@mozilla.com)", "attachment_id": 8593007, "added": "review+"}], "who": "past@mozilla.com", "when": "2015-04-16T11:56:05Z"}, {"changes": [{"removed": "ASSIGNED", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "cc", "added": "dkeeler@mozilla.com"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla40"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(dkeeler@mozilla.com)"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2015-04-17 13:09:26"}, {"removed": "affected", "field_name": "cf_status_firefox36", "added": "wontfix"}, {"removed": "affected", "field_name": "cf_status_firefox37", "added": "wontfix"}, {"removed": "---", "field_name": "cf_status_firefox40", "added": "fixed"}, {"removed": "---", "field_name": "cf_status_firefox_esr31", "added": "unaffected"}, {"removed": "---", "field_name": "cf_status_b2g_1_4", "added": "unaffected"}, {"removed": "---", "field_name": "cf_status_b2g_2_0", "added": "unaffected"}, {"removed": "---", "field_name": "cf_status_b2g_2_0m", "added": "unaffected"}, {"removed": "---", "field_name": "cf_status_b2g_2_1", "added": "unaffected"}, {"removed": "---", "field_name": "cf_status_b2g_2_1_s", "added": "unaffected"}, {"removed": "---", "field_name": "cf_status_b2g_2_2", "added": "affected"}, {"removed": "---", "field_name": "cf_status_b2g_master", "added": "fixed"}], "who": "ryanvm@gmail.com", "when": "2015-04-17T20:09:26Z"}, {"changes": [{"removed": "needinfo?(dkeeler@mozilla.com)", "field_name": "flagtypes.name", "added": ""}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8594188, "added": "review+, approval-mozilla-beta?"}], "who": "dkeeler@mozilla.com", "when": "2015-04-17T21:18:44Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8593007, "added": "approval-mozilla-aurora?"}], "who": "dkeeler@mozilla.com", "when": "2015-04-17T21:19:38Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "approval-mozilla-aurora?", "attachment_id": 8593007, "added": "approval-mozilla-aurora+"}], "who": "sledru@mozilla.com", "when": "2015-04-19T08:26:04Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "in-testsuite+"}, {"removed": "affected", "field_name": "cf_status_firefox39", "added": "fixed"}], "who": "ryanvm@gmail.com", "when": "2015-04-20T14:30:26Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "king.jan1999.jr@googlemail.com"}], "who": "dkeeler@mozilla.com", "when": "2015-04-21T16:29:17Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8595474, "added": "review+, approval-mozilla-b2g37?"}], "who": "dkeeler@mozilla.com", "when": "2015-04-21T18:24:47Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "sledru@mozilla.com"}], "who": "sledru@mozilla.com", "when": "2015-04-22T07:40:01Z"}, {"changes": [{"removed": "affected", "field_name": "cf_status_firefox38", "added": "wontfix"}], "who": "sledru@mozilla.com", "when": "2015-04-23T14:05:12Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "approval-mozilla-beta?", "attachment_id": 8594188, "added": "approval-mozilla-beta-"}], "who": "sledru@mozilla.com", "when": "2015-04-23T14:06:13Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(sledru@mozilla.com)"}], "who": "rlb@ipv.sx", "when": "2015-04-23T21:42:32Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "dougt@mozilla.com"}], "who": "rlb@ipv.sx", "when": "2015-04-23T21:44:16Z"}, {"changes": [{"removed": "needinfo?(sledru@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "sledru@mozilla.com", "when": "2015-04-24T07:39:21Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "approval-mozilla-b2g37?", "attachment_id": 8595474, "added": "approval-mozilla-b2g37+"}], "who": "bajaj.bhavana@gmail.com", "when": "2015-05-01T00:06:32Z"}, {"changes": [{"removed": "---", "field_name": "cf_status_firefox38_0_5", "added": "wontfix"}, {"removed": "affected", "field_name": "cf_status_b2g_2_2", "added": "fixed"}], "who": "ryanvm@gmail.com", "when": "2015-05-01T01:40:24Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(dkeeler@mozilla.com)"}, {"removed": "---", "field_name": "cf_tracking_firefox_esr38", "added": "?"}], "who": "ryanvm@gmail.com", "when": "2015-05-05T01:34:01Z"}, {"changes": [{"removed": "needinfo?(dkeeler@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "dkeeler@mozilla.com", "when": "2015-05-05T17:14:27Z"}, {"changes": [{"field_name": "attachments.description", "removed": "patch for beta", "attachment_id": 8594188, "added": "patch for esr-38"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8594188, "added": "approval-mozilla-esr38?"}], "who": "dkeeler@mozilla.com", "when": "2015-05-19T22:01:08Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "approval-mozilla-esr38?", "attachment_id": 8594188, "added": "approval-mozilla-esr38+"}], "who": "sledru@mozilla.com", "when": "2015-05-25T14:12:08Z"}, {"changes": [{"removed": "affected", "field_name": "cf_status_firefox_esr38", "added": "fixed"}], "who": "ryanvm@gmail.com", "when": "2015-05-26T13:12:37Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "abillings@mozilla.com"}, {"removed": "", "field_name": "whiteboard", "added": "[adv-main39+][adv-esr38.1+]"}, {"removed": "?", "field_name": "cf_tracking_firefox_esr38", "added": "39+"}], "who": "abillings@mozilla.com", "when": "2015-06-20T00:22:23Z"}, {"changes": [{"removed": "", "field_name": "alias", "added": "CVE-2015-2741"}], "who": "abillings@mozilla.com", "when": "2015-06-24T21:09:26Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "florin.mezei@softvisioninc.eu, otilia.anica@softvisioninc.eu"}], "who": "kairo@kairo.at", "when": "2015-06-30T11:39:22Z"}, {"changes": [{"removed": "core-security", "field_name": "groups", "added": ""}, {"removed": "", "field_name": "cc", "added": "mark@wolfbeast.com"}], "who": "dveditz@mozilla.com", "when": "2015-07-06T22:14:29Z"}, {"changes": [{"removed": "", "field_name": "blocks", "added": "1181975"}], "who": "cykesiopka.bmo@gmail.com", "when": "2015-07-09T07:40:49Z"}], "cf_tracking_firefox_relnote": "---", "comments": [{"text": "In bug 1066190, we discovered that encountering an overridable certificate error could cause pinning checks to be skipped. So, if building a trusted chain failed in CertVerifier::VerifyCert, we made sure that we called CertListContainsExpectedKeys to do pinning checks. CertListContainsExpectedKeys expects a chain of certificates ending in a trusted root. The default pinning setting is to skip the checks if the root isn't a built-in root. In VerifyCert, if building a chain failed, we don't have a chain - we just pass the certificate itself to CertListContainsExpectedKeys. This does the built-in root check on that certificate, which almost certainly won't be a built-in. So, we skip the pinning checks and use the original error, which would allow overrides.", "author": "dkeeler@mozilla.com", "id": 10076878, "time": "2015-03-25T17:33:18Z"}, {"text": "This problem would have been avoided if my suggestion would have been taken: If a site has a valid pinset, then don't allow cert error overrides at all, full stop. There's no good reason to allow cert error overrides for pinned sites.", "author": "brian@briansmith.org", "id": 10077047, "time": "2015-03-25T18:02:39Z"}, {"text": "Created attachment 8583297\npatch\n\nThis is a minimal patch with the intention that it's the safest, smallest change to uplift. The real fix is the API I mention in the comment, but that will require some refactoring, etc.", "author": "dkeeler@mozilla.com", "id": 10077724, "time": "2015-03-25T20:07:00Z"}, {"text": "Brian, do you think that the pinning mode (strict or mitm) should have an affect on whether an orthogonal error should be overridable? We are thinking it shouldn't matter.", "author": "mmc.bugzilla@gmail.com", "id": 10077922, "time": "2015-03-25T20:35:43Z"}, {"text": "(In reply to [:mmc] Monica Chew (please use needinfo) from comment #3)\n> Brian, do you think that the pinning mode (strict or mitm) should have an\n> affect on whether an orthogonal error should be overridable? We are thinking\n> it shouldn't matter.\n\nIt seems less error-prone to just disallow cert error overrides, and reducing the chances of a bug in this logic seems much more important than whatever benefit allowing cert error overrides for pinned sites (which seems close to zero, if not negative) provides.", "author": "brian@briansmith.org", "id": 10078024, "time": "2015-03-25T20:50:58Z"}, {"text": "Comment on attachment 8583297\npatch\n\nReview of attachment 8583297:\n-----------------------------------------------------------------\n\nOK, thanks. After talking it over with keeler it is too late for 37, since this has already gone to RC, and we should go with the original solution that requires an API \"do we have pinning information for this host\".", "author": "mmc.bugzilla@gmail.com", "id": 10078044, "time": "2015-03-25T20:54:05Z"}, {"text": "Created attachment 8584790\npatch v2\n\nHere's the patch with the new API.\nBrian, if you're interested, I'd appreciate any feedback you have (not a big deal, though - I understand reviewing PSM code is not high on your priority or interest list).", "author": "dkeeler@mozilla.com", "id": 10089763, "time": "2015-03-27T20:46:03Z"}, {"text": "Comment on attachment 8584790\npatch v2\n\nReview of attachment 8584790:\n-----------------------------------------------------------------\n\nLooks much better, thanks. I made some slightly disruptive comments around legacy function names, feel free to ignore them if you don't think it's worthwhile.\n\n::: docshell/base/nsDocShell.cpp\n@@ +5052,4 @@\n>            cssClass.AssignLiteral(\"badStsCert\");\n>            // measuring STS separately allows us to measure click through\n>            // rates easily\n>            bucketId = nsISecurityUITelemetry::WARNING_BAD_CERT_TOP_STS;\n\nThis conflates telemetry for STS and HPKP. Maybe make another clause for isPinnedHost with just \"badStsCert\"?\n\n::: security/manager/boot/src/PublicKeyPinningService.cpp\n@@ +181,2 @@\n>  /**\n>   * Check PKPins on the given certlist against the specified hostname\n\nBad comment and name. Returns true if any pins on the certlist pass for the given hostname, or pins don't exist.\n\nAlso \"Check\" is a bad name because it doesn't say what to do if \"Check\" fails. PinsPassForHostname or something would be better.\n\n@@ +193,5 @@\n>    }\n>  \n> +  nsresult rv = FindPinningInformation(hostname, time,\n> +    [&](TransportSecurityPreload* staticFingerprints,\n> +        const nsTArray<nsCString>* dynamicFingerprints) {\n\nThis signature shows up twice. Time to typedef? I also think it would be easier if the callback were named instead of anonymous.\n\n@@ +203,5 @@\n> +      }\n> +      return NS_OK;\n> +    }\n> +    if (staticFingerprints) {\n> +      bool result = EvalChainWithPinset(certList, staticFingerprints->pinset);\n\nSince you are touching this code, how about renaming these to CertChainMatchesPinset and friends? Eval is so generic. Same for EvalChainWithHashtype above.\n\n::: security/manager/ssl/src/SSLServerCertVerification.cpp\n@@ +490,2 @@\n>    bool strictTransportSecurityEnabled = false;\n> +  bool havePinningInformation = false;\n\ns/have/has\n\n@@ +567,5 @@\n>               (\"[%p][%p] All errors covered by override rules\\n\",\n>               mFdForLogging, this));\n>        return new SSLServerCertVerificationResult(mInfoObject, 0);\n>      }\n>    } else {\n\nSlightly cleaner to move this up top since it's shorter, but no big deal.", "author": "mmc.bugzilla@gmail.com", "id": 10097415, "time": "2015-03-30T20:45:38Z"}, {"text": "Comment on attachment 8584790\npatch v2\n\nReview of attachment 8584790:\n-----------------------------------------------------------------\n\nThis seems to implement what I suggested. But, to be honest, I quickly found that I'm so unfamiliar with the PublicKeyPinningService code that any specific feedback I can offer on it is probably not very useful. :(\n\n::: docshell/base/nsDocShell.cpp\n@@ +5052,4 @@\n>            cssClass.AssignLiteral(\"badStsCert\");\n>            // measuring STS separately allows us to measure click through\n>            // rates easily\n>            bucketId = nsISecurityUITelemetry::WARNING_BAD_CERT_TOP_STS;\n\nI agree. It would be better to have a separate telemetry probe.\n\n::: security/certverifier/CertVerifier.cpp\n@@ -467,5 @@\n> -                                                          time, mPinningMode);\n> -      if (pinningResult != Success) {\n> -        rv = pinningResult;\n> -      }\n> -    }\n\nGreat!\n\n::: security/manager/boot/src/PublicKeyPinningService.cpp\n@@ +175,5 @@\n>  \n> +template<typename Callback>\n> +static nsresult\n> +FindPinningInformation(const char* hostname, mozilla::pkix::Time time,\n> +                       Callback callback);\n\nI suggest that you avoid making this a template, by having the Callback function take enough parameter. that it doesn't need to capture any variables. C++ lambdas have a special case for non-capturing lambdas ([] instead of [&]) that allow them to be converted into a regular function pointer. (I'm hoping to do similar in mozilla::pkix soon, if possible.)\n\n@@ +182,5 @@\n>   * Check PKPins on the given certlist against the specified hostname\n>   */\n>  static bool\n>  CheckPinsForHostname(const CERTCertList *certList, const char *hostname,\n>                       bool enforceTestMode, mozilla::pkix::Time time)\n\nI agree with mmc. \"CheckXXX\" functions should return an error/status code, not a boolean. If a boolean result is needed then the function should be named something that makes it obvious what a true result means and what a false result means.", "author": "brian@briansmith.org", "id": 10098281, "time": "2015-03-31T00:23:02Z"}, {"text": "Created attachment 8588051\npatch v3\n\nThank you both for the reviews/feedback. I discussed this with Monica yesterday, and (as I understand it) we came to the conclusion that while the pinning implementation could benefit from improved documentation and some function renaming, it would be best to first prepare a more uplift-friendly patch that has fewer overall changes (i.e. basically just code changes), so that's what I did here. It does change all uses of boolean return values to an nsresult / output variable paradigm. I also re-worked the template/lambda approach since it wasn't necessary. I'm intending for the remaining documentation/naming fixups to be done as part of bug 1102436 or maybe in its own follow-up bug.", "author": "dkeeler@mozilla.com", "id": 10116657, "time": "2015-04-03T17:40:50Z"}, {"text": "Comment on attachment 8588051\npatch v3\n\nReview of attachment 8588051:\n-----------------------------------------------------------------\n\nLGTM. Unfortunately I'm not really familiar with this code either.\nI did however go over the existing code, so I believe I understand the existing code and the changes.\n\n::: security/manager/boot/src/PublicKeyPinningService.cpp\n@@ +81,5 @@\n>        if (base64Out.Equals(fingerprints->data[i])) {\n>          PR_LOG(gPublicKeyPinningLog, PR_LOG_DEBUG,\n>                 (\"pkpin: found pin base_64 ='%s'\\n\", base64Out.get()));\n> +       certMatchesPinset = true;\n> +       return NS_OK;\n\nNit: indentation here looks off.\n\n@@ +91,5 @@\n>        if (base64Out.Equals((*dynamicFingerprints)[i])) {\n>          PR_LOG(gPublicKeyPinningLog, PR_LOG_DEBUG,\n>                 (\"pkpin: found pin base_64 ='%s'\\n\", base64Out.get()));\n> +       certMatchesPinset = true;\n> +       return NS_OK;\n\nHere as well.\n\n@@ +174,5 @@\n>  /**\n>    Comparator for the is public key pinned host.\n>  */\n>  static int\n> +TransportSecurityPreloadCompare(const void *key, const void *entry)\n\nNit: |const void*| while you're here.\n\n::: security/manager/ssl/tests/unit/head_psm.js\n@@ +575,5 @@\n>      throw Components.results.NS_ERROR_NO_INTERFACE;\n>    },\n>  }\n> +\n> +// Utility functions for adding tests relating to certificate error orverrides\n\nNit: s/orverrides/overrides/", "author": "cykesiopka.bmo@gmail.com", "id": 10118099, "time": "2015-04-04T00:19:39Z"}, {"text": "keeler: I'm afraid I barely got started on this patch, and I have to leave for a bit of PTO. I'm not going to be able to finish this review until Monday, I'm sorry. :(\n\nThe couple files I looked at looked fine, but like Cykesiopka, I would need to read around the other files to properly review.", "author": "jjones@mozilla.com", "id": 10118165, "time": "2015-04-04T01:07:40Z"}, {"text": "Comment on attachment 8588051\npatch v3\n\nReview of attachment 8588051:\n-----------------------------------------------------------------\n\nKeeler,\n\nI've dug through the changes and the associated parts of PSM and it looks alright. I made some nit comments to go along with Cykesiopka's, but given the intent to refactor I don't see anything that should hold up a merge. You can mark r=jcj.\n\nSorry for the delay!\n\n::: security/manager/boot/src/PublicKeyPinningService.cpp\n@@ +52,4 @@\n>  }\n>  \n>  /*\n>   * Returns true if a given cert matches any hashType fingerprints from the\n\nNit: Now it returns NS_OK unless there are no static or dynamic pinned fingerprints.\n\n@@ +100,4 @@\n>  }\n>  \n>  /*\n>   * Returns true if a given chain matches any hashType fingerprints from the\n\nNit: Sets the outvar if there's an intersection; returns NS_OK unless fingerprints/dynamicFingerprints changes between lines 125 and 137.\n\n@@ +149,4 @@\n>  }\n>  \n>  /**\n>   * Given a pinset and certlist, return true if one of the certificates on\n\nNit: Note out variable\n\n::: security/manager/boot/src/PublicKeyPinningService.h\n@@ +22,1 @@\n>     * the given certificate chain matches the pin set specified by the\n\nNit: Note out variable\n\n@@ +35,2 @@\n>    /**\n>     * Returns true if there is any intersection between the certificate list\n\nNit: Note out variable", "author": "jjones@mozilla.com", "id": 10121560, "time": "2015-04-06T16:57:30Z"}, {"text": "Comment on attachment 8588051\npatch v3\n\nSetting (I guess accidental) r? back to r+.", "author": "cykesiopka.bmo@gmail.com", "id": 10121602, "time": "2015-04-06T17:04:54Z"}, {"text": "Created attachment 8588677\npatch v3.1\n\nThank you for the reviews. I'm deferring preexisting style and comment nits to the follow-up bug (or potentially bug 1102436).\n\nThis also needs a docshell peer review. jst: the idea is to check for and prevent certificate error overrides for hosts we have pinning information for (much in the way we already do for HSTS hosts).", "author": "dkeeler@mozilla.com", "id": 10122112, "time": "2015-04-06T18:39:09Z"}, {"text": "Comment on attachment 8588677\npatch v3.1\n\nReview of attachment 8588677:\n-----------------------------------------------------------------\n\nLGTM. Thanks for working on this.", "author": "mmc.bugzilla@gmail.com", "id": 10127801, "time": "2015-04-07T20:32:01Z"}, {"text": "Comment on attachment 8588677\npatch v3.1\n\nOlli said he would be able to review the docshell changes early next week.", "author": "dkeeler@mozilla.com", "id": 10143017, "time": "2015-04-10T19:49:01Z"}, {"text": "Comment on attachment 8588677\npatch v3.1\n\nNot super happy to see 2 sync SendIsSecureURI calls in a row, but this code\nshould be called rather rarely.", "author": "bugs@pettay.fi", "id": 10154167, "time": "2015-04-14T17:43:27Z"}, {"text": "Created attachment 8593007\npatch v3.2\n\nTurns out there was a devtools test that needed to explicitly enable pinning after these changes. Panos, would you please review the changes to toolkit/devtools/webconsole/test/unit/test_security-info-static-hpkp.js? Thanks.", "author": "dkeeler@mozilla.com", "id": 10160636, "time": "2015-04-15T20:22:36Z"}, {"text": "https://treeherder.mozilla.org/#/jobs?repo=try&revision=1e78516e315d\nhttps://treeherder.mozilla.org/#/jobs?repo=try&revision=877caf6501bf", "author": "dkeeler@mozilla.com", "id": 10160638, "time": "2015-04-15T20:23:08Z"}, {"text": "Comment on attachment 8593007\npatch v3.2\n\nReview of attachment 8593007:\n-----------------------------------------------------------------\n\nLGTM.", "author": "past@mozilla.com", "id": 10163010, "time": "2015-04-16T11:56:05Z"}, {"text": "Thanks!\nhttps://hg.mozilla.org/integration/mozilla-inbound/rev/98059179549d", "author": "dkeeler@mozilla.com", "id": 10164211, "time": "2015-04-16T17:02:38Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/98059179549d\n\nI assume we want to nominate this for Aurora/Beta/b2g37 approval?", "author": "ryanvm@gmail.com", "id": 10170047, "time": "2015-04-17T20:09:26Z"}, {"text": "Created attachment 8594188\npatch for esr-38\n\nApproval Request Comment\n[Feature/regressing bug #]: key pinning\n[User impact if declined]: key pinning won't be as effective at preventing MITM attacks (the user would still have to click through an override page)\n[Describe test coverage new/current, TreeHerder]: has tests\n[Risks and why]: this does touch a fair bit of code, but since it basically copies similar modifications that were made for HSTS, I think the risk is mitigated somewhat (i.e. we've done something like this before, so it probably won't break anything else)\n[String/UUID change made/needed]: none", "author": "dkeeler@mozilla.com", "id": 10170392, "time": "2015-04-17T21:18:44Z"}, {"text": "Comment on attachment 8593007\npatch v3.2\n\nApproval Request Comment\nsee comment 23", "author": "dkeeler@mozilla.com", "id": 10170396, "time": "2015-04-17T21:19:38Z"}, {"text": "Looks like b2g37 will need rebasing too.", "author": "ryanvm@gmail.com", "id": 10170649, "time": "2015-04-17T22:07:41Z"}, {"text": "Comment on attachment 8593007\npatch v3.2\n\nIt is a sec moderate, we are past the middle cycle for beta and the patch is quite big.\nI am not sure we want to take the risk here for beta.\nAnyway, taking it for aurora.", "author": "sledru@mozilla.com", "id": 10172338, "time": "2015-04-19T08:26:04Z"}, {"text": "https://hg.mozilla.org/releases/mozilla-aurora/rev/5ab6348ad96e", "author": "ryanvm@gmail.com", "id": 10175361, "time": "2015-04-20T14:30:26Z"}, {"text": "(In reply to Sylvestre Ledru [:sylvestre] from comment #26)\n> Comment on attachment 8593007\n> patch v3.2\n> \n> It is a sec moderate, we are past the middle cycle for beta and the patch is\n> quite big.\n> I am not sure we want to take the risk here for beta.\n> Anyway, taking it for aurora.\n\nIt would be good to at least get this on ESR 38.", "author": "dkeeler@mozilla.com", "id": 10176691, "time": "2015-04-20T18:42:36Z"}, {"text": "FWIW, it looks like the public Bug 1156073 (filed yesterday) is a dupe of this bug (assuming I'm not misinterpreting anything). Not sure what the proper procedure here is...", "author": "cykesiopka.bmo@gmail.com", "id": 10178116, "time": "2015-04-20T23:58:06Z"}, {"text": "*** Bug 1156073 has been marked as a duplicate of this bug. ***", "author": "dkeeler@mozilla.com", "id": 10181121, "time": "2015-04-21T16:29:17Z"}, {"text": "Created attachment 8595474\npatch for b2g37\n\nNOTE: Please see https://wiki.mozilla.org/Release_Management/B2G_Landing to better understand the B2G approval process and landings.\n\n[Approval Request Comment]\nsee comment 23", "author": "dkeeler@mozilla.com", "id": 10181798, "time": "2015-04-21T18:24:47Z"}, {"text": "(In reply to David Keeler [:keeler] (use needinfo?) from comment #28)\n> It would be good to at least get this on ESR 38.\nESR 38 is based on the release and doesn't receive much testing coverage (as the code is pretty much the same in esr and release). If we take it for ESR, we have to take it for 38.", "author": "sledru@mozilla.com", "id": 10184352, "time": "2015-04-22T07:40:01Z"}, {"text": "Comment on attachment 8594188\npatch for esr-38\n\nAs mentioned in comment #26, I am not ready to take the risk as this release is going to get marketing exposure.", "author": "sledru@mozilla.com", "id": 10190636, "time": "2015-04-23T14:06:13Z"}, {"text": "(In reply to Sylvestre Ledru [:sylvestre] from comment #33)\n> Comment on attachment 8594188\n> patch for beta\n> \n> As mentioned in comment #26, I am not ready to take the risk as this release\n> is going to get marketing exposure.\n\nI'm confused.  ISTM that the marketing risk here is that we'll be noted as non-compliant with the pinning spec and provided degraded security to pinned sites.", "author": "rlb@ipv.sx", "id": 10193039, "time": "2015-04-23T21:42:32Z"}, {"text": "(In reply to Richard Barnes [:rbarnes] from comment #34)\n> I'm confused.  ISTM that the marketing risk here is that we'll be noted as\n> non-compliant with the pinning spec and provided degraded security to pinned\n> sites.\nI understand your point (and I asked Lawrence's opinion before rejecting this uplift) but understand that we are working on stabilizing the release, it is late in the cycle and it is not uncommon that security changes affect the release.\nWe can just let it ride the train from 39.", "author": "sledru@mozilla.com", "id": 10194512, "time": "2015-04-24T07:39:21Z"}, {"text": "Might be worth considering this for ESR 38.1 nomination if 39 is looking stable once on the beta channel?", "author": "ryanvm@gmail.com", "id": 10203954, "time": "2015-04-27T21:00:39Z"}, {"text": "https://hg.mozilla.org/releases/mozilla-b2g37_v2_2/rev/8fbdb08d1cef", "author": "ryanvm@gmail.com", "id": 10220368, "time": "2015-05-01T01:40:24Z"}, {"text": "[Tracking Requested - why for this release]: Requesting 39+ status for potential landing in 38.1. It's a security and spec compliance issue.\n\nDavid, you'll still need to request esr38 approval on the beta patch some time next week after 38.0 ships.", "author": "ryanvm@gmail.com", "id": 10230298, "time": "2015-05-05T01:34:01Z"}, {"text": "(In reply to Ryan VanderMeulen [:RyanVM UTC-4] from comment #38)\n\nThanks - will do.", "author": "dkeeler@mozilla.com", "id": 10232867, "time": "2015-05-05T17:14:27Z"}, {"text": "Comment on attachment 8594188\npatch for esr-38\n\n[Approval Request Comment]\nIf this is not a sec:{high,crit} bug, please state case for ESR consideration:\nUser impact if declined: potential bypass of key pinning protections (i.e. site impersonation)\nFix Landed on Version: 40, uplifted to 39\nRisk to taking this patch (and alternatives if risky): some risk, but we haven't seen any issues yet, and it's been a few weeks\nString or UUID changes made by this patch: none\n\nSee https://wiki.mozilla.org/Release_Management/ESR_Landing_Process for more info.", "author": "dkeeler@mozilla.com", "id": 10287113, "time": "2015-05-19T22:01:08Z"}, {"text": "https://hg.mozilla.org/releases/mozilla-esr38/rev/ed87585a9fbc", "author": "ryanvm@gmail.com", "id": 10309437, "time": "2015-05-26T13:12:37Z"}], "keywords": ["sec-moderate"], "cf_tracking_firefox36": "---", "cf_fx_iteration": "---", "summary": "key pinning checks for overridable errors do not work as intended by default", "cf_last_resolved": "2015-04-17T20:09:26Z", "attachments": [{"creator": "dkeeler@mozilla.com", "is_obsolete": 1, "is_patch": 1, "flags": [], "content_type": "text/plain", "id": 8583297}, {"creator": "dkeeler@mozilla.com", "is_obsolete": 1, "is_patch": 1, "flags": [{"status": "+", "name": "feedback", "modification_date": "2015-03-31T00:23:02Z", "type_id": 607, "creation_date": "2015-03-27T20:46:03Z", "id": 1133715, "setter": "brian@briansmith.org"}, {"status": "+", "name": "feedback", "modification_date": "2015-03-30T20:45:38Z", "type_id": 607, "creation_date": "2015-03-30T20:45:38Z", "id": 1135083, "setter": "mmc.bugzilla@gmail.com"}], "content_type": "text/plain", "id": 8584790}, {"creator": "dkeeler@mozilla.com", "is_obsolete": 1, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2015-04-06T17:04:54Z", "type_id": 4, "creation_date": "2015-04-03T17:40:50Z", "id": 1138909, "setter": "cykesiopka.bmo@gmail.com"}, {"status": "+", "name": "feedback", "modification_date": "2015-04-06T16:57:30Z", "type_id": 607, "creation_date": "2015-04-03T17:40:50Z", "id": 1138910, "setter": "jjones@mozilla.com"}], "content_type": "text/plain", "id": 8588051}, {"creator": "dkeeler@mozilla.com", "is_obsolete": 1, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2015-04-14T17:43:27Z", "type_id": 4, "creation_date": "2015-04-06T18:39:09Z", "id": 1140001, "setter": "bugs@pettay.fi"}, {"status": "+", "name": "review", "modification_date": "2015-04-07T20:32:01Z", "type_id": 4, "creation_date": "2015-04-07T20:32:01Z", "id": 1141139, "setter": "mmc.bugzilla@gmail.com"}], "content_type": "text/plain", "id": 8588677}, {"creator": "dkeeler@mozilla.com", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2015-04-16T11:56:05Z", "type_id": 4, "creation_date": "2015-04-15T20:22:36Z", "id": 1147478, "setter": "past@mozilla.com"}, {"status": "+", "name": "approval-mozilla-aurora", "modification_date": "2015-04-19T08:26:04Z", "type_id": 720, "creation_date": "2015-04-17T21:19:38Z", "id": 1149494, "setter": "sledru@mozilla.com"}], "content_type": "text/plain", "id": 8593007}, {"creator": "dkeeler@mozilla.com", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2015-04-17T21:18:44Z", "type_id": 4, "creation_date": "2015-04-17T21:18:44Z", "id": 1149490, "setter": "dkeeler@mozilla.com"}, {"status": "-", "name": "approval-mozilla-beta", "modification_date": "2015-04-23T14:06:13Z", "type_id": 721, "creation_date": "2015-04-17T21:18:44Z", "id": 1149491, "setter": "sledru@mozilla.com"}, {"status": "+", "name": "approval-mozilla-esr38", "modification_date": "2015-05-25T14:12:08Z", "type_id": 889, "creation_date": "2015-05-19T22:01:08Z", "id": 1170792, "setter": "sledru@mozilla.com"}], "content_type": "text/plain", "id": 8594188}, {"creator": "dkeeler@mozilla.com", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2015-04-21T18:24:47Z", "type_id": 4, "creation_date": "2015-04-21T18:24:47Z", "id": 1151573, "setter": "dkeeler@mozilla.com"}, {"status": "+", "name": "approval-mozilla-b2g37", "modification_date": "2015-05-01T00:06:32Z", "type_id": 875, "creation_date": "2015-04-21T18:24:47Z", "id": 1151574, "setter": "bajaj.bhavana@gmail.com"}], "content_type": "text/plain", "id": 8595474}], "votes": 0, "classification": "Components", "is_confirmed": true, "is_creator_accessible": true, "cc_detail": [{"email": "abillings@mozilla.com", "id": 280903, "name": "abillings@mozilla.com", "real_name": "Al Billings [:abillings]"}, {"email": "brian@briansmith.org", "id": 14661, "name": "brian@briansmith.org", "real_name": "Brian Smith (:briansmith, :bsmith, use NEEDINFO?)"}, {"email": "bugs@pettay.fi", "id": 39966, "name": "bugs@pettay.fi", "real_name": "Olli Pettay [:smaug]"}, {"email": "cykesiopka.bmo@gmail.com", "id": 462935, "name": "cykesiopka.bmo@gmail.com", "real_name": ":Cykesiopka"}, {"email": "dkeeler@mozilla.com", "id": 349244, "name": "dkeeler@mozilla.com", "real_name": "[:keeler] (use needinfo)"}, {"email": "doug.turner@gmail.com", "id": 302291, "name": "doug.turner@gmail.com", "real_name": "Doug Turner (:dougt)"}, {"email": "florin.mezei@softvisioninc.eu", "id": 500713, "name": "florin.mezei@softvisioninc.eu", "real_name": "Florin Mezei, QA (:FlorinMezei)"}, {"email": "jjones@mozilla.com", "id": 520206, "name": "jjones@mozilla.com", "real_name": "J.C. Jones [:jcj] (Leave between 24 Jun - 17 Aug)"}, {"email": "jstenback+bmo@gmail.com", "id": 12352, "name": "jstenback+bmo@gmail.com", "real_name": "Johnny Stenback  (:jst)"}, {"email": "king.jan1999.jr@googlemail.com", "id": 537080, "name": "king.jan1999.jr@googlemail.com", "real_name": ""}, {"email": "mark@wolfbeast.com", "id": 364942, "name": "mark@wolfbeast.com", "real_name": "Mark Straver"}, {"email": "mmc.bugzilla@gmail.com", "id": 237291, "name": "mmc.bugzilla@gmail.com", "real_name": "[:mmc] Monica Chew (no longer reading bugmail)"}, {"email": "otilia.anica@gmail.com", "id": 421380, "name": "otilia.anica@gmail.com", "real_name": "Otilia Anica"}, {"email": "past@mozilla.com", "id": 363318, "name": "past@mozilla.com", "real_name": "Panos Astithas [:past] (please ni?)"}, {"email": "rlb@ipv.sx", "id": 373085, "name": "rlb@ipv.sx", "real_name": "Richard Barnes [:rbarnes]"}, {"email": "sledru@mozilla.com", "id": 495955, "name": "sledru@mozilla.com", "real_name": "Sylvestre Ledru [:sylvestre]"}], "cf_has_regression_range": "---", "comment_count": 42, "cf_has_str": "---", "id": 1147497, "priority": "--", "cc": ["abillings@mozilla.com", "brian@briansmith.org", "bugs@pettay.fi", "cykesiopka.bmo@gmail.com", "dkeeler@mozilla.com", "doug.turner@gmail.com", "florin.mezei@softvisioninc.eu", "jjones@mozilla.com", "jstenback+bmo@gmail.com", "king.jan1999.jr@googlemail.com", "mark@wolfbeast.com", "mmc.bugzilla@gmail.com", "otilia.anica@gmail.com", "past@mozilla.com", "rlb@ipv.sx", "sledru@mozilla.com"], "cf_crash_signature": "", "version": "unspecified", "is_cc_accessible": true, "cf_tracking_firefox_esr52": "---", "see_also": [], "cf_tracking_thunderbird_esr60": "---", "cf_platform_rel": "---", "product": "Core", "cf_status_b2g_2_0m": "unaffected", "blocks": [1181975, 1066190], "qa_contact": "", "cf_tracking_firefox37": "---", "creation_time": "2015-03-25T17:33:18Z", "cf_tracking_firefox35": "---", "cf_status_firefox_esr52": "---", "component": "Security: PSM", "assigned_to_detail": {"email": "dkeeler@mozilla.com", "id": 349244, "name": "dkeeler@mozilla.com", "real_name": "[:keeler] (use needinfo)"}, "cf_tracking_firefox_esr60": "---", "cf_status_firefox_esr31": "unaffected", "cf_status_firefox34": "---", "cf_status_firefox62": "---", "cf_status_firefox61": "---", "cf_status_firefox60": "---", "target_milestone": "mozilla40", "cf_rank": null, "platform": "All", "severity": "normal", "groups": [], "cf_status_thunderbird_esr52": "---", "cf_status_b2g_1_4": "unaffected", "url": "", "cf_status_thunderbird_esr60": "---", "creator_detail": {"email": "dkeeler@mozilla.com", "id": 349244, "name": "dkeeler@mozilla.com", "real_name": "[:keeler] (use needinfo)"}, "whiteboard": "[adv-main39+][adv-esr38.1+]", "cf_status_b2g_2_1": "unaffected", "cf_status_b2g_2_0": "unaffected", "cf_status_b2g_2_2": "fixed", "alias": "CVE-2015-2741", "dupe_of": null, "flags": [{"status": "+", "name": "in-testsuite", "modification_date": "2015-04-20T14:30:26Z", "type_id": 37, "creation_date": "2015-04-20T14:30:26Z", "id": 1150367, "setter": "ryanvm@gmail.com"}], "last_change_time": "2015-07-09T07:40:49Z", "assigned_to": "dkeeler@mozilla.com", "is_open": false, "cf_qa_whiteboard": "", "mentors": [], "resolution": "FIXED", "op_sys": "All", "cf_fx_points": "---", "cf_blocking_fennec": "---"}