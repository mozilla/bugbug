{"status": "RESOLVED", "cf_tracking_firefox60": "---", "attachments": [{"creator": "gijskruitbosch+bugs@gmail.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2016-05-19T10:51:59Z", "type_id": 748, "creation_date": "2016-05-12T16:30:58Z", "id": 1393060, "setter": "florian@queze.net"}, {"status": "+", "name": "review", "modification_date": "2016-05-19T11:02:04Z", "type_id": 748, "creation_date": "2016-05-19T11:02:04Z", "id": 1396825, "setter": "gijskruitbosch+bugs@gmail.com"}], "content_type": "text/x-review-board-request", "id": 8751807}], "classification": "Client Software", "creator": "florian@queze.net", "cc": ["florian@queze.net", "gfritzsche@mozilla.com", "gijskruitbosch+bugs@gmail.com", "glind@mozilla.com", "isegall@mozilla.com", "mgrimes@mozilla.com", "rweiss@mozilla.com"], "depends_on": [], "creation_time": "2016-05-12T11:41:04Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "cf_status_firefox58": "---", "cf_status_firefox59": "---", "keywords": [], "summary": "_getSearchEngineId's fallback to the engine name can leak user data", "cf_last_resolved": "2016-05-20T21:10:31Z", "assigned_to_detail": {"email": "gijskruitbosch+bugs@gmail.com", "id": 159069, "name": "gijskruitbosch+bugs@gmail.com", "real_name": ":Gijs (under the weather; responses will be slow)"}, "severity": "normal", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "assigned_to": "gijskruitbosch+bugs@gmail.com", "comment_count": 21, "comments": [{"text": "BrowserSearch.recordSearchInTelemetry calls _getSearchEngineId (https://hg.mozilla.org/mozilla-central/annotate/3461f3cae784/browser/base/content/browser.js#l3642) which returns the engine's identifier (null for user-installed engines) and then fallbacks to the engine's name if the identifier is null.\n\nThis would likely be fine if this data was only collected for users who opted-in to Telemetry, but bug 1160220 made the SEARCH_COUNTS histogram opt-out, meaning that we are now (I assume) unintentionally collecting the non-default engine names of release users.", "author": "florian@queze.net", "id": 11403446, "time": "2016-05-12T11:41:04Z"}, {"text": "Created attachment 8751807\nMozReview Request: Bug 1272294 - only collect non-default search engine names if the user opted into telemetry, r=florian\n\nReview commit: https://reviewboard.mozilla.org/r/52221/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/52221/", "author": "gijskruitbosch+bugs@gmail.com", "id": 11404386, "time": "2016-05-12T16:30:58Z"}, {"text": "Comment on attachment 8751807\nMozReview Request: Bug 1272294 - only collect non-default search engine names if the user opted into telemetry, r=florian\n\nhttps://reviewboard.mozilla.org/r/52221/#review49175\n\nLooks reasonable, but:\n- this may be covered by tests, so I would suggest doing a try push with at least bc tests\n- I hope nobody was using this data\n\n::: browser/base/content/browser.js:3647\n(Diff revision 1)\n>    _getSearchEngineId: function (engine) {\n>      if (!engine) {\n>        return \"other\";\n>      }\n>  \n>      if (engine.identifier) {\n\nWe can further simplify by doing:\n  if (engine && engine.identifier) \\{\n    return engine.identifier;\n  \\}\n \n  return \"other\";\n(then the first early return can disappear too)", "author": "florian@queze.net", "id": 11404912, "time": "2016-05-12T19:14:32Z"}, {"text": "Ilana, can you confirm we don't need search engine names from non-default providers?", "author": "gijskruitbosch+bugs@gmail.com", "id": 11407219, "time": "2016-05-13T14:22:37Z"}, {"text": "remote:   https://treeherder.mozilla.org/#/jobs?repo=try&revision=03155034a46a", "author": "gijskruitbosch+bugs@gmail.com", "id": 11407220, "time": "2016-05-13T14:22:46Z"}, {"text": "It's pretty valuable information. Consider the case of hijacked browsers - we'd like to target those who have had their engine changed to (avg-toolbar-search-wetakeyourinfo, whatever) to see if it's a valid selection.\n\nI propose 2 solutions, since the data-privacy one is completely valid.\n\n1. Have a separate variable, nondefaultengine, that only records for those with extended telemetry and a non built-in.\n2. (less preferable) Record that the engine is one of a set of known top hijackers/alternatives (we could determine the list every few months) and record it if it falls into one of these, ensuring we don't get any data-leaking search domains.\n\nThoughts?", "author": "isegall@mozilla.com", "id": 11408165, "time": "2016-05-13T19:43:56Z"}, {"text": "(In reply to Ilana from comment #5)\n> It's pretty valuable information. Consider the case of hijacked browsers -\n> we'd like to target those who have had their engine changed to\n> (avg-toolbar-search-wetakeyourinfo, whatever) to see if it's a valid\n> selection.\n\nJust to be sure there's no misunderstanding here: this records the search volume for each engine.\n\nWe have a different probe to record the current default engine, that we added in bug 1164159, mostly to help us investigate hijacking situations.", "author": "florian@queze.net", "id": 11408407, "time": "2016-05-13T21:01:52Z"}, {"text": "Ah, sorry about that.\nI'd say that there's still some value here, although it is lower for hijacking than the default setting. There's still an application for potential search partner expansion and for knowing the # of engines used (to correlate with satisfaction, etc). I've cc'd gregglind and rweiss, who may have other applications in mind. Otherwise, this is far less useful than knowing the default engine, although it seems to be at the same level of privacy invasion.", "author": "isegall@mozilla.com", "id": 11408725, "time": "2016-05-13T23:42:39Z"}, {"text": "Comment on attachment 8751807\nMozReview Request: Bug 1272294 - only collect non-default search engine names if the user opted into telemetry, r=florian\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/52221/diff/1-2/", "author": "gijskruitbosch+bugs@gmail.com", "id": 11419563, "time": "2016-05-18T18:08:15Z"}, {"text": "Comment on attachment 8751807\nMozReview Request: Bug 1272294 - only collect non-default search engine names if the user opted into telemetry, r=florian\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/52221/diff/2-3/", "author": "gijskruitbosch+bugs@gmail.com", "id": 11419574, "time": "2016-05-18T18:09:55Z"}, {"text": "Comment on attachment 8751807\nMozReview Request: Bug 1272294 - only collect non-default search engine names if the user opted into telemetry, r=florian\n\nThis is a little hacky because it reuses the same histogram. For non-opt-in-users this will produce \"other\".\n\nI don't think the faff of creating an extra histogram and dealing with all the test fallout is worth it if all we're interested in is/are absolute/relative frequency of other engines. We presumably know how many people opt in to extended telemetry and can use that to judge volumes accordingly.", "author": "gijskruitbosch+bugs@gmail.com", "id": 11419585, "time": "2016-05-18T18:12:05Z"}, {"text": "https://treeherder.mozilla.org/#/jobs?repo=try&revision=20211baffa40", "author": "gijskruitbosch+bugs@gmail.com", "id": 11419647, "time": "2016-05-18T18:30:52Z"}, {"text": "(In reply to :Gijs Kruitbosch from comment #11)\n> https://treeherder.mozilla.org/#/jobs?repo=try&revision=20211baffa40\n\nGah, this was pushed by autoland using an inbound head, and so now it doesn't have the changes from bug 1197310 and so the tests time out. :-\\", "author": "gijskruitbosch+bugs@gmail.com", "id": 11421550, "time": "2016-05-19T09:11:30Z"}, {"text": "(In reply to :Gijs Kruitbosch from comment #12)\n> (In reply to :Gijs Kruitbosch from comment #11)\n> > https://treeherder.mozilla.org/#/jobs?repo=try&revision=20211baffa40\n> \n> Gah, this was pushed by autoland using an inbound head, and so now it\n> doesn't have the changes from bug 1197310 and so the tests time out. :-\\\n\nHm, no, this should have had those csets. There must be something wrong with my patch (it does work on OSX, which is where I tested it...).", "author": "gijskruitbosch+bugs@gmail.com", "id": 11421741, "time": "2016-05-19T10:12:16Z"}, {"text": "Comment on attachment 8751807\nMozReview Request: Bug 1272294 - only collect non-default search engine names if the user opted into telemetry, r=florian\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/52221/diff/3-4/", "author": "gijskruitbosch+bugs@gmail.com", "id": 11421792, "time": "2016-05-19T10:32:45Z"}, {"text": "https://treeherder.mozilla.org/#/jobs?repo=try&revision=c7722ee23a86\n\nThis time tested locally on my Linux VM. Seems like \"true\" as the pref value breaks on Linux but not on OS X? Well, anyway, not using a string makes more sense, so let's see if try is happy now.", "author": "gijskruitbosch+bugs@gmail.com", "id": 11421820, "time": "2016-05-19T10:49:20Z"}, {"text": "Comment on attachment 8751807\nMozReview Request: Bug 1272294 - only collect non-default search engine names if the user opted into telemetry, r=florian\n\nhttps://reviewboard.mozilla.org/r/52221/#review50620\n\n::: browser/components/search/test/browser_healthreport.js:73\n(Diff revision 4)\n>          break;\n>      }\n>    }\n>  \n> +  SpecialPowers.pushPrefEnv({set: [[\"toolkit.telemetry.enabled\", true]]}).then(function() {\n> -  Services.obs.addObserver(observer, \"browser-search-engine-modified\", false);\n> +    Services.obs.addObserver(observer, \"browser-search-engine-modified\", false);\n\nWhy is the addObserver call made after the pref change? It looks to me like only the addEngine call needs telemetry enabled.", "author": "florian@queze.net", "id": 11421827, "time": "2016-05-19T10:51:59Z"}, {"text": "Comment on attachment 8751807\nMozReview Request: Bug 1272294 - only collect non-default search engine names if the user opted into telemetry, r=florian\n\nhttps://reviewboard.mozilla.org/r/52221/#review50626\n\n::: browser/components/search/test/browser_healthreport.js:73\n(Diff revision 4)\n>          break;\n>      }\n>    }\n>  \n> +  SpecialPowers.pushPrefEnv({set: [[\"toolkit.telemetry.enabled\", true]]}).then(function() {\n> -  Services.obs.addObserver(observer, \"browser-search-engine-modified\", false);\n> +    Services.obs.addObserver(observer, \"browser-search-engine-modified\", false);\n\nTrue, I was just being lazy in how I dealt with this. Fixed now.", "author": "gijskruitbosch+bugs@gmail.com", "id": 11421842, "time": "2016-05-19T11:02:04Z"}, {"text": "Comment on attachment 8751807\nMozReview Request: Bug 1272294 - only collect non-default search engine names if the user opted into telemetry, r=florian\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/52221/diff/4-5/", "author": "gijskruitbosch+bugs@gmail.com", "id": 11421843, "time": "2016-05-19T11:02:22Z"}, {"text": "https://hg.mozilla.org/integration/mozilla-inbound/rev/e68856caffda", "author": "pulsebot@bots.tld", "id": 11422064, "time": "2016-05-19T12:53:22Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/e68856caffda", "author": "kwierso@gmail.com", "id": 11426750, "time": "2016-05-20T21:10:31Z"}], "id": 1272294, "priority": "--", "mentors_detail": [], "cf_crash_signature": "", "version": "unspecified", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox59": "---", "last_change_time": "2017-04-04T21:38:43Z", "cf_platform_rel": "---", "product": "Firefox", "cf_status_firefox_esr52": "---", "blocks": [1089670, 1160220], "qa_contact": "", "see_also": [], "cf_fx_iteration": "---", "component": "Search", "votes": 0, "cf_status_firefox49": "fixed", "groups": [], "cf_status_firefox60": "---", "target_milestone": "Firefox 49", "is_cc_accessible": true, "url": "", "creator_detail": {"email": "florian@queze.net", "id": 149052, "name": "florian@queze.net", "real_name": "Florian Qu\u00e8ze [:florian]"}, "whiteboard": "", "mentors": [], "cc_detail": [{"email": "florian@queze.net", "id": 149052, "name": "florian@queze.net", "real_name": "Florian Qu\u00e8ze [:florian]"}, {"email": "gfritzsche@mozilla.com", "id": 439671, "name": "gfritzsche@mozilla.com", "real_name": "Georg Fritzsche (slow to respond) [:gfritzsche]"}, {"email": "gijskruitbosch+bugs@gmail.com", "id": 159069, "name": "gijskruitbosch+bugs@gmail.com", "real_name": ":Gijs (under the weather; responses will be slow)"}, {"email": "glind@mozilla.com", "id": 428302, "name": "glind@mozilla.com", "real_name": "Gregg Lind (Fx Strategy and Insights - Shield - Heartbeat )"}, {"email": "isegall@mozilla.com", "id": 438952, "name": "isegall@mozilla.com", "real_name": "Ilana"}, {"email": "mgrimes@mozilla.com", "id": 440997, "name": "mgrimes@mozilla.com", "real_name": "Matt Grimes [:Matt_G]"}, {"email": "rweiss@mozilla.com", "id": 418169, "name": "rweiss@mozilla.com", "real_name": "Rebecca Weiss"}], "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "cf_tracking_firefox58": "---", "cf_rank": null, "is_open": false, "resolution": "FIXED", "op_sys": "Unspecified", "cf_fx_points": "---", "history": [{"changes": [{"removed": "", "field_name": "cc", "added": "gfritzsche@mozilla.com"}], "who": "gfritzsche@mozilla.com", "when": "2016-05-12T12:51:58Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "ASSIGNED"}, {"removed": "", "field_name": "blocks", "added": "1089670"}, {"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "gijskruitbosch+bugs@gmail.com"}], "who": "gijskruitbosch+bugs@gmail.com", "when": "2016-05-12T16:30:04Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8751807, "added": "review?(florian@queze.net)"}, {"removed": "", "field_name": "cc", "added": "florian@queze.net"}], "who": "gijskruitbosch+bugs@gmail.com", "when": "2016-05-12T16:30:58Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(florian@queze.net)", "attachment_id": 8751807, "added": "review+"}], "who": "florian@queze.net", "when": "2016-05-12T19:14:32Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "isegall@mozilla.com"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(isegall@mozilla.com)"}], "who": "gijskruitbosch+bugs@gmail.com", "when": "2016-05-13T14:22:37Z"}, {"changes": [{"removed": "needinfo?(isegall@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "isegall@mozilla.com", "when": "2016-05-13T19:43:56Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "mgrimes@mozilla.com"}], "who": "isegall@mozilla.com", "when": "2016-05-13T19:44:15Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "glind@mozilla.com, rweiss@mozilla.com"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(rweiss@mozilla.com), needinfo?(glind@mozilla.com)"}], "who": "isegall@mozilla.com", "when": "2016-05-13T23:42:39Z"}, {"changes": [{"field_name": "attachments.description", "removed": "MozReview Request: Bug 1272294 - don't collect non-default search engine names, r?florian", "attachment_id": 8751807, "added": "MozReview Request: Bug 1272294 - only collect non-default search engine names if the user opted into telemetry, r?florian"}], "who": "gijskruitbosch+bugs@gmail.com", "when": "2016-05-18T18:09:55Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review+", "attachment_id": 8751807, "added": "review?(florian@queze.net)"}], "who": "gijskruitbosch+bugs@gmail.com", "when": "2016-05-18T18:12:05Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(florian@queze.net)", "attachment_id": 8751807, "added": "review+"}], "who": "florian@queze.net", "when": "2016-05-19T10:51:59Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8751807, "added": "review+"}], "who": "gijskruitbosch+bugs@gmail.com", "when": "2016-05-19T11:02:04Z"}, {"changes": [{"field_name": "attachments.description", "removed": "MozReview Request: Bug 1272294 - only collect non-default search engine names if the user opted into telemetry, r?florian", "attachment_id": 8751807, "added": "MozReview Request: Bug 1272294 - only collect non-default search engine names if the user opted into telemetry, r=florian"}], "who": "gijskruitbosch+bugs@gmail.com", "when": "2016-05-19T11:02:22Z"}, {"changes": [{"removed": "ASSIGNED", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "Firefox 49"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2016-05-20 21:10:31"}, {"removed": "---", "field_name": "cf_status_firefox49", "added": "fixed"}], "who": "kwierso@gmail.com", "when": "2016-05-20T21:10:31Z"}, {"changes": [{"removed": "needinfo?(rweiss@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "rweiss@mozilla.com", "when": "2016-07-13T19:59:34Z"}, {"changes": [{"removed": "needinfo?(glind@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "standard8@mozilla.com", "when": "2017-04-04T21:38:43Z"}]}