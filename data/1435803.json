{"cf_tracking_thunderbird_esr52": "---", "status": "RESOLVED", "cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "cf_tracking_firefox62": "---", "creator": "intermittent-bug-filer@mozilla.bugs", "mentors_detail": [], "depends_on": [], "cf_status_firefox_esr60": "---", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "keywords": ["intermittent-failure"], "cc_detail": [{"email": "emilio@crisal.io", "id": 546716, "name": "emilio@crisal.io", "real_name": "Emilio Cobos \u00c1lvarez [:emilio]"}, {"email": "jmaher@mozilla.com", "id": 324370, "name": "jmaher@mozilla.com", "real_name": "Joel Maher ( :jmaher ) (UTC-4)"}], "cf_last_resolved": "2018-02-08T19:05:29Z", "attachments": [{"creator": "emilio@crisal.io", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-02-08T02:09:51Z", "type_id": 4, "creation_date": "2018-02-08T01:31:59Z", "id": 1713835, "setter": "dbaron@dbaron.org"}], "content_type": "text/x-review-board-request", "id": 8949254}], "votes": 0, "classification": "Components", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 19, "comments": [{"text": "Filed by: archaeopteryx [at] coole-files.de\n\nhttps://treeherder.mozilla.org/logviewer.html#?job_id=160422406&repo=mozilla-central\n\nhttps://queue.taskcluster.net/v1/task/QeKpQ2dzR5mnIXpkzS8AhA/runs/0/artifacts/public/logs/live_backing.log\n\n[task 2018-02-05T17:41:06.325Z] 17:41:06     INFO - GECKO(1031) | Assertion failure: !PresContext()->HasPendingMediaQueryUpdates() (Someone forgot to update media queries?), at /builds/worker/workspace/build/src/layout/base/GeckoRestyleManager.cpp:566\n[task 2018-02-05T17:41:06.326Z] 17:41:06     INFO - GECKO(1031) | #01: mozilla::GeckoRestyleManager::ProcessPendingRestyles [layout/base/GeckoRestyleManager.cpp:573]\n[task 2018-02-05T17:41:06.328Z] 17:41:06     INFO - \n[task 2018-02-05T17:41:06.328Z] 17:41:06     INFO - GECKO(1031) | #02: mozilla::GeckoRestyleManager::RebuildAllStyleData [layout/base/GeckoRestyleManager.cpp:479]\n[task 2018-02-05T17:41:06.328Z] 17:41:06     INFO - \n[task 2018-02-05T17:41:06.328Z] 17:41:06     INFO - GECKO(1031) | #03: nsPresContext::RebuildAllStyleData [layout/base/RestyleManagerInlines.h:33]\n[task 2018-02-05T17:41:06.328Z] 17:41:06     INFO - \n[task 2018-02-05T17:41:06.330Z] 17:41:06     INFO - GECKO(1031) | #04: nsPresContext::DoChangeCharSet [layout/base/nsPresContext.cpp:1134]\n[task 2018-02-05T17:41:06.330Z] 17:41:06     INFO - \n[task 2018-02-05T17:41:06.331Z] 17:41:06     INFO - GECKO(1031) | #05: CharSetChangingRunnable::Run [layout/base/nsPresContext.cpp:146]\n[task 2018-02-05T17:41:06.331Z] 17:41:06     INFO - \n[task 2018-02-05T17:41:06.332Z] 17:41:06     INFO - GECKO(1031) | #06: mozilla::SchedulerGroup::Runnable::Run [xpcom/threads/SchedulerGroup.cpp:395]\n[task 2018-02-05T17:41:06.332Z] 17:41:06     INFO - \n[task 2018-02-05T17:41:06.333Z] 17:41:06     INFO - GECKO(1031) | #07: nsThread::ProcessNextEvent [mfbt/Maybe.h:100]\n[task 2018-02-05T17:41:06.334Z] 17:41:06     INFO - \n[task 2018-02-05T17:41:06.341Z] 17:41:06     INFO - GECKO(1031) | #08: NS_ProcessNextEvent [xpcom/threads/nsThreadUtils.cpp:517]\n[task 2018-02-05T17:41:06.341Z] 17:41:06     INFO - \n[task 2018-02-05T17:41:06.343Z] 17:41:06     INFO - GECKO(1031) | #09: mozilla::ipc::MessagePump::Run [ipc/glue/MessagePump.cpp:98]\n[task 2018-02-05T17:41:06.344Z] 17:41:06     INFO - \n[task 2018-02-05T17:41:06.346Z] 17:41:06     INFO - GECKO(1031) | #10: MessageLoop::RunInternal [ipc/chromium/src/base/message_loop.cc:327]\n[task 2018-02-05T17:41:06.347Z] 17:41:06     INFO - \n[task 2018-02-05T17:41:06.348Z] 17:41:06     INFO - GECKO(1031) | #11: MessageLoop::Run [ipc/chromium/src/base/message_loop.cc:298]\n[task 2018-02-05T17:41:06.349Z] 17:41:06     INFO - \n[task 2018-02-05T17:41:06.351Z] 17:41:06     INFO - GECKO(1031) | #12: nsBaseAppShell::Run [widget/nsBaseAppShell.cpp:159]\n[task 2018-02-05T17:41:06.352Z] 17:41:06     INFO - \n[task 2018-02-05T17:41:06.353Z] 17:41:06     INFO - GECKO(1031) | #13: XRE_RunAppShell [toolkit/xre/nsEmbedFunctions.cpp:873]\n[task 2018-02-05T17:41:06.354Z] 17:41:06     INFO - \n[task 2018-02-05T17:41:06.356Z] 17:41:06     INFO - GECKO(1031) | #14: mozilla::ipc::MessagePumpForChildProcess::Run [ipc/glue/MessagePump.cpp:269]\n[task 2018-02-05T17:41:06.357Z] 17:41:06     INFO - \n[task 2018-02-05T17:41:06.358Z] 17:41:06     INFO - GECKO(1031) | #15: MessageLoop::RunInternal [ipc/chromium/src/base/message_loop.cc:327]\n[task 2018-02-05T17:41:06.360Z] 17:41:06     INFO - \n[task 2018-02-05T17:41:06.361Z] 17:41:06     INFO - GECKO(1031) | #16: MessageLoop::Run [ipc/chromium/src/base/message_loop.cc:298]\n[task 2018-02-05T17:41:06.362Z] 17:41:06     INFO - \n[task 2018-02-05T17:41:06.363Z] 17:41:06     INFO - GECKO(1031) | #17: XRE_InitChildProcess [toolkit/xre/nsEmbedFunctions.cpp:703]\n[task 2018-02-05T17:41:06.363Z] 17:41:06     INFO - \n[task 2018-02-05T17:41:06.364Z] 17:41:06     INFO - GECKO(1031) | #18: content_process_main [ipc/contentproc/plugin-container.cpp:63]\n[task 2018-02-05T17:41:06.365Z] 17:41:06     INFO - \n[task 2018-02-05T17:41:06.366Z] 17:41:06     INFO - GECKO(1031) | #19: main [browser/app/nsBrowserApp.cpp:280]\n[task 2018-02-05T17:41:06.367Z] 17:41:06     INFO -", "author": "intermittent-bug-filer@mozilla.bugs", "id": 13019639, "time": "2018-02-05T18:56:51Z"}, {"text": "16 failures in 154 pushes (0.104 failures/push) were associated with this bug yesterday.    \n\nRepository breakdown:\n* autoland: 10\n* mozilla-central: 4\n* mozilla-inbound: 2\n\nPlatform breakdown:\n* linux64-stylo-disabled: 8\n* linux32-stylo-disabled: 7\n* linux32: 1\n\nFor more details, see:\nhttps://brasstacks.mozilla.com/orangefactor/?display=Bug&bugid=1435803&startday=2018-02-07&endday=2018-02-07&tree=all", "author": "orangefactor@bots.tld", "id": 13026486, "time": "2018-02-08T01:00:56Z"}, {"text": "(In reply to OrangeFactor Robot from comment #1)\n> Platform breakdown:\n> * linux64-stylo-disabled: 8\n> * linux32-stylo-disabled: 7\n\nThese are all debug-mochitest-browser-chrome-e10s-14\n\n> * linux32: 1\n\nThis is debug-mochitest-media-e10s-2.  (I wonder if that has stylo disabled?)", "author": "dbaron@dbaron.org", "id": 13026518, "time": "2018-02-08T01:15:27Z"}, {"text": "I'm going to assume this is a regression from bug 1435939.", "author": "dbaron@dbaron.org", "id": 13026521, "time": "2018-02-08T01:17:36Z"}, {"text": "Except for the single isolated occurrence 2 days earlier (!!), this failure becoming high frequency does appear to match the landing of bug 1435939, based on:\nhttps://brasstacks.mozilla.com/orangefactor/?display=Bug&bugid=1435803&entireHistory=true&tree=all", "author": "dbaron@dbaron.org", "id": 13026526, "time": "2018-02-08T01:22:49Z"}, {"text": "That bug landed 11 hours ago, but this bug was filed 2 days ago, so sounds unlikely... But chances are that bug made it more frequent, yeah.\n\nLooking at the stack it makes sense, Gecko reconstructs all style data synchronously, instead of async like Stylo does, so there's nothing preventing that assertion to get hit from one of the direct callers of RebuildAllStyleData.\n\nThere wasn't anything preventing that assertion to fail either before bug 1430844, which added it.\n\nI'll take a look to see if there's an easy fix, otherwise disabling that assertion on the old style system is probably an ok solution for now.", "author": "emilio@crisal.io", "id": 13026527, "time": "2018-02-08T01:23:58Z"}, {"text": "Created attachment 8949254\nBug 1435803: Loosen an assertion that may not hold on the old style system.\n\nReview commit: https://reviewboard.mozilla.org/r/218622/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/218622/", "author": "emilio@crisal.io", "id": 13026534, "time": "2018-02-08T01:31:59Z"}, {"text": "Feel free to land it if it's urgent, since it's late for me and I'm heading out to bed :)", "author": "emilio@crisal.io", "id": 13026540, "time": "2018-02-08T01:34:59Z"}, {"text": "Comment on attachment 8949254\nBug 1435803: Loosen an assertion that may not hold on the old style system.\n\nhttps://reviewboard.mozilla.org/r/218622/#review224426\n\nr=dbaron, although I didn't really page all of this in.  (In particular, it's not entirely clear to me why mDoRebuildAllStyleData is a useful condition other than \"it happens to be when the assertion fires\".)\n\nI'd also note that I had an unlanded patch in my tree that might have fixed some related issues: https://hg.mozilla.org/users/dbaron_mozilla.com/patches/raw-file/0c03eded4deb/flush-media-feature-values .\n\n::: layout/base/GeckoRestyleManager.cpp:570\n(Diff revision 1)\n> +  // point is probably not worth the effort. Also, the restyles the media query\n> +  // changes require will be processed afterwards anyway, so it's probably not a\n> +  // correctness issue, just not as efficient as it could be.\n\nI'm not entirely convinced that this is true, given things like bug 1089417 comment 21, etc., but it's been too long for me to remember the details, or whether that setup is still true.", "author": "dbaron@dbaron.org", "id": 13026578, "time": "2018-02-08T02:09:51Z"}, {"text": "(In reply to David Baron :dbaron: \u231a\ufe0fUTC-8 from comment #8)\n> Comment on attachment 8949254\n> Bug 1435803: Loosen an assertion that may not hold on the old style system.\n> \n> https://reviewboard.mozilla.org/r/218622/#review224426\n> \n> r=dbaron, although I didn't really page all of this in.  (In particular,\n> it's not entirely clear to me why mDoRebuildAllStyleData is a useful\n> condition other than \"it happens to be when the assertion fires\".)\n> \n> I'd also note that I had an unlanded patch in my tree that might have fixed\n> some related issues:\n> https://hg.mozilla.org/users/dbaron_mozilla.com/patches/raw-file/\n> 0c03eded4deb/flush-media-feature-values .\n\nMaybe... The only thing that cares about that on stylo, afaict, is ProcessPendingRestyles, of which there are two callers now (three in Gecko). One is sound (FlushPendingNotifications), the other one (FlushThrottledStyles) is bug 1436625.\n\nOther than that we should update media queries correctly.\n\n> ::: layout/base/GeckoRestyleManager.cpp:570\n> (Diff revision 1)\n> > +  // point is probably not worth the effort. Also, the restyles the media query\n> > +  // changes require will be processed afterwards anyway, so it's probably not a\n> > +  // correctness issue, just not as efficient as it could be.\n> \n> I'm not entirely convinced that this is true, given things like bug 1089417\n> comment 21, etc., but it's been too long for me to remember the details, or\n> whether that setup is still true.\n\nAt least in the Stylo case it would be, but maybe on the old style system it's not... Still given this is not an exactly new problem and this is nearly permafailing according to Aryx I'm going to land this for now, I think.", "author": "emilio@crisal.io", "id": 13027545, "time": "2018-02-08T14:13:32Z"}, {"text": "Comment on attachment 8949254\nBug 1435803: Loosen an assertion that may not hold on the old style system.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/218622/diff/1-2/", "author": "emilio@crisal.io", "id": 13027554, "time": "2018-02-08T14:17:28Z"}, {"text": "(In reply to David Baron :dbaron: \u231a\ufe0fUTC-8 from comment #8)\n> Comment on attachment 8949254\n> Bug 1435803: Loosen an assertion that may not hold on the old style system.\n> \n> https://reviewboard.mozilla.org/r/218622/#review224426\n> \n> r=dbaron, although I didn't really page all of this in.  (In particular,\n> it's not entirely clear to me why mDoRebuildAllStyleData is a useful\n> condition other than \"it happens to be when the assertion fires\".)\n> \n> I'd also note that I had an unlanded patch in my tree that might have fixed\n> some related issues:\n> https://hg.mozilla.org/users/dbaron_mozilla.com/patches/raw-file/\n> 0c03eded4deb/flush-media-feature-values .\n\nfwiw, I think the ContentStateChanged / AttributeChanged callers on this patch would need some thought, since FlushPendingMediaQueryUpdates can call script. Also, the FlushUserFontSet one should not be needed now that we call that right after flushing pending media query updates.", "author": "emilio@crisal.io", "id": 13027562, "time": "2018-02-08T14:18:38Z"}, {"text": "Comment on attachment 8949254\nBug 1435803: Loosen an assertion that may not hold on the old style system.\n\nhttps://reviewboard.mozilla.org/r/218622/#review224426\n\n> I'm not entirely convinced that this is true, given things like bug 1089417 comment 21, etc., but it's been too long for me to remember the details, or whether that setup is still true.\n\nI've mentioned that bug comment in the patch.", "author": "emilio@crisal.io", "id": 13027564, "time": "2018-02-08T14:19:17Z"}, {"text": "Pushed by ecoal95@gmail.com:\nhttps://hg.mozilla.org/integration/autoland/rev/d186a51615a6\nLoosen an assertion that may not hold on the old style system. r=dbaron", "author": "pulsebot@bots.tld", "id": 13027571, "time": "2018-02-08T14:20:54Z"}, {"text": "We're sorry - something has gone wrong while rewriting or rebasing your commits. The commits being pushed no longer match what was requested. Please file a bug.", "author": "autoland@mozilla.bugs", "id": 13027576, "time": "2018-02-08T14:22:47Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/d186a51615a6", "author": "cbrindusan@mozilla.com", "id": 13028461, "time": "2018-02-08T19:05:29Z"}, {"text": "50 failures in 125 pushes (0.4 failures/push) were associated with this bug yesterday.    \n\nRepository breakdown:\n* mozilla-inbound: 23\n* autoland: 16\n* mozilla-central: 10\n* try: 1\n\nPlatform breakdown:\n* linux64-stylo-disabled: 28\n* linux32-stylo-disabled: 20\n* windows7-32: 1\n* linux32: 1\n\nFor more details, see:\nhttps://brasstacks.mozilla.com/orangefactor/?display=Bug&bugid=1435803&startday=2018-02-08&endday=2018-02-08&tree=all", "author": "orangefactor@bots.tld", "id": 13029394, "time": "2018-02-09T01:00:42Z"}, {"text": "76 failures in 702 pushes (0.108 failures/push) were associated with this bug in the last 7 days. \n\nThis is the #12 most frequent failure this week. \n\n** This failure happened more than 75 times this week! Resolving this bug is a very high priority. **\n\n** Try to resolve this bug as soon as possible. If unresolved for 1 week, the affected test(s) may be disabled. **   \n\nRepository breakdown:\n* autoland: 28\n* mozilla-inbound: 27\n* mozilla-central: 15\n* try: 6\n\nPlatform breakdown:\n* linux64-stylo-disabled: 39\n* linux32-stylo-disabled: 33\n* linux32: 3\n* windows7-32: 1\n\nFor more details, see:\nhttps://brasstacks.mozilla.com/orangefactor/?display=Bug&bugid=1435803&startday=2018-02-05&endday=2018-02-11&tree=all", "author": "orangefactor@bots.tld", "id": 13034782, "time": "2018-02-12T01:33:33Z"}, {"text": "2 failures in 660 pushes (0.003 failures/push) were associated with this bug in the last 7 days.    \n\nRepository breakdown:\n* autoland: 2\n\nPlatform breakdown:\n* linux64: 2\n\nFor more details, see:\nhttps://treeherder.mozilla.org/intermittent-failures.html#/bugdetails?bug=1435803&startday=2018-05-07&endday=2018-05-13&tree=trunk", "author": "orangefactor@bots.tld", "id": 13274068, "time": "2018-05-14T01:24:14Z"}], "id": 1435803, "priority": "P5", "cc": ["emilio@crisal.io", "jmaher@mozilla.com"], "cf_crash_signature": "", "version": "unspecified", "is_cc_accessible": true, "cf_tracking_firefox_esr52": "---", "see_also": ["https://bugzilla.mozilla.org/show_bug.cgi?id=1436625"], "cf_tracking_thunderbird_esr60": "---", "cf_platform_rel": "---", "product": "Core", "cf_fx_iteration": "---", "blocks": [1435939], "qa_contact": "", "creation_time": "2018-02-05T18:56:51Z", "cf_status_firefox_esr52": "---", "component": "Layout", "assigned_to_detail": {"email": "emilio@crisal.io", "id": 546716, "name": "emilio@crisal.io", "real_name": "Emilio Cobos \u00c1lvarez [:emilio]"}, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "---", "cf_status_firefox61": "---", "cf_status_firefox60": "fixed", "target_milestone": "mozilla60", "cf_rank": null, "cf_qa_whiteboard": "", "severity": "normal", "groups": [], "cf_status_thunderbird_esr52": "---", "url": "", "cf_status_thunderbird_esr60": "---", "creator_detail": {"email": "intermittent-bug-filer@mozilla.bugs", "id": 573381, "name": "intermittent-bug-filer@mozilla.bugs", "real_name": "Treeherder Bug Filer"}, "whiteboard": "[stockwell fixed:product]", "mentors": [], "summary": "Intermittent GECKO(1031) | Assertion failure: !PresContext()->HasPendingMediaQueryUpdates() (Someone forgot to update media queries?), at /builds/worker/workspace/build/src/layout/base/GeckoRestyleManager.cpp:566", "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "last_change_time": "2018-05-14T01:24:14Z", "assigned_to": "emilio@crisal.io", "is_open": false, "history": [{"changes": [{"removed": "", "field_name": "cc", "added": "emilio@crisal.io"}, {"removed": "", "field_name": "blocks", "added": "1435939"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(emilio@crisal.io)"}], "who": "dbaron@dbaron.org", "when": "2018-02-08T01:17:36Z"}, {"changes": [{"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "emilio@crisal.io"}, {"removed": "needinfo?(emilio@crisal.io)", "field_name": "flagtypes.name", "added": ""}], "who": "emilio@crisal.io", "when": "2018-02-08T01:30:31Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8949254, "added": "review?(dbaron@dbaron.org)"}], "who": "emilio@crisal.io", "when": "2018-02-08T01:31:59Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(dbaron@dbaron.org)", "attachment_id": 8949254, "added": "review+"}], "who": "dbaron@dbaron.org", "when": "2018-02-08T02:09:51Z"}, {"changes": [{"removed": "", "field_name": "see_also", "added": "https://bugzilla.mozilla.org/show_bug.cgi?id=1436625"}], "who": "hikezoe@mozilla.com", "when": "2018-02-08T02:30:33Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla60"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2018-02-08 19:05:29"}, {"removed": "---", "field_name": "cf_status_firefox60", "added": "fixed"}], "who": "cbrindusan@mozilla.com", "when": "2018-02-08T19:05:29Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "jmaher@mozilla.com"}, {"removed": "", "field_name": "whiteboard", "added": "[stockwell fixed:product]"}], "who": "jmaher@mozilla.com", "when": "2018-03-05T21:10:40Z"}], "resolution": "FIXED", "op_sys": "Unspecified", "cf_fx_points": "---", "cf_blocking_fennec": "---"}