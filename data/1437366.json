{"cf_tracking_thunderbird_esr52": "---", "status": "RESOLVED", "cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "cf_tracking_firefox62": "---", "creator": "lpy750@outlook.com", "mentors_detail": [], "depends_on": [], "cf_status_firefox_esr60": "---", "cf_user_story": "", "cf_backlog": "---", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "keywords": ["regression"], "cc_detail": [{"email": "adihan@cafex.com", "id": 616421, "name": "adihan@cafex.com", "real_name": "Abdu"}, {"email": "apehrson@mozilla.com", "id": 489889, "name": "apehrson@mozilla.com", "real_name": "Andreas Pehrson [:pehrsons]"}, {"email": "astonalex5@gmail.com", "id": 609379, "name": "astonalex5@gmail.com", "real_name": "Alexander"}, {"email": "jyavenard@mozilla.com", "id": 512198, "name": "jyavenard@mozilla.com", "real_name": "Jean-Yves Avenard [:jya]"}, {"email": "lpy750@outlook.com", "id": 605010, "name": "lpy750@outlook.com", "real_name": ""}, {"email": "mcastelluccio@mozilla.com", "id": 420453, "name": "mcastelluccio@mozilla.com", "real_name": "Marco Castelluccio [:marco]"}, {"email": "padenot@mozilla.com", "id": 404637, "name": "padenot@mozilla.com", "real_name": "Paul Adenot (:padenot)"}, {"email": "rjesup@jesup.org", "id": 11539, "name": "rjesup@jesup.org", "real_name": "Randell Jesup [:jesup]"}, {"email": "sescalante@mozilla.com", "id": 501107, "name": "sescalante@mozilla.com", "real_name": ":shell escalante"}], "cf_last_resolved": "2018-03-21T12:13:26Z", "attachments": [{"creator": "padenot@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-03-05T15:55:17Z", "type_id": 4, "creation_date": "2018-03-05T15:33:13Z", "id": 1725034, "setter": "apehrson@mozilla.com"}, {"status": "+", "name": "approval-mozilla-beta", "modification_date": "2018-04-17T15:20:44Z", "type_id": 721, "creation_date": "2018-04-17T09:33:25Z", "id": 1744874, "setter": "jcristau@mozilla.com"}], "content_type": "text/x-review-board-request", "id": 8955228}, {"creator": "padenot@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-03-05T16:33:18Z", "type_id": 4, "creation_date": "2018-03-05T15:33:13Z", "id": 1725035, "setter": "apehrson@mozilla.com"}], "content_type": "text/x-review-board-request", "id": 8956085}, {"creator": "padenot@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-03-05T16:49:13Z", "type_id": 4, "creation_date": "2018-03-05T15:26:58Z", "id": 1725025, "setter": "apehrson@mozilla.com"}], "content_type": "text/x-review-board-request", "id": 8956086}, {"creator": "padenot@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-03-07T16:54:47Z", "type_id": 4, "creation_date": "2018-03-05T15:26:58Z", "id": 1725026, "setter": "apehrson@mozilla.com"}], "content_type": "text/x-review-board-request", "id": 8956087}, {"creator": "padenot@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-03-19T19:44:35Z", "type_id": 4, "creation_date": "2018-03-19T17:48:09Z", "id": 1731570, "setter": "apehrson@mozilla.com"}], "content_type": "text/x-review-board-request", "id": 8960259}, {"creator": "padenot@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-03-19T19:45:31Z", "type_id": 4, "creation_date": "2018-03-19T17:48:09Z", "id": 1731571, "setter": "apehrson@mozilla.com"}], "content_type": "text/x-review-board-request", "id": 8960260}], "votes": 0, "classification": "Components", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 68, "comments": [{"text": "User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:59.0) Gecko/20100101 Firefox/59.0\nBuild ID: 20180208193705\n\nSteps to reproduce:\n\nWindows 10 64-bit\n\nNot affected: Firefox 58.0.2\nAffected: any Firefox 59 beta, Firefox 60 Nightly\n\nIn Windows, open soundcard output playback device and set sample rate to either 96000Hz or 192000Hz.\n\nOpen mixer.com, find a live stream with Low Latency enabled.\n\n\n\nActual results:\n\nAlthough running at normal speed, as expected, audio will sound high pitched.\n\n\n\nExpected results:\n\nUpon a little experimenting, it appears Firefox 58 relies on \"OpenH264 Video Codec provided by Cisco Systems, Inc.\" for both audio and video, whereas Firefox 59+ only uses it for video.", "author": "lpy750@outlook.com", "id": 13033364, "time": "2018-02-11T12:21:48Z"}, {"text": "Hi. Thanks for the report! Sounds like another AAC container-vs-stream samplerate issue. Does it happen when the playback device set to a lower sample rate, like 48 or 44.1 kHz?\n\nJean-Yves, does this match up with any existing bugs? Looks like we have a 59 regression.", "author": "giles@thaumas.net", "id": 13048737, "time": "2018-02-16T20:59:44Z"}, {"text": "Hi there, at 44.1kHz or 48kHz playback is fine. At 88.2kHz or above it is high pitched/sounds just like \"the chipmunks\".\n\nTested on two devices with different hardware... a PC and tablet running Windows 10, and both did it with FF 59 but not FF 58.\n\nAs mentioned, I can easily reproduce it every time on www.mixer.com with a live stream that has \"Low Latency\" enabled, but websites such as YouTube aren't affected.", "author": "lpy750@outlook.com", "id": 13049370, "time": "2018-02-17T04:19:10Z"}, {"text": "It could be bug 1431169, it's the only thing changing the AAC decoder, if that's what it is.\n\nCould you try using the mozregression tool to determine what caused the problem for You?\n\nThanknyou", "author": "jyavenard@mozilla.com", "id": 13050098, "time": "2018-02-18T03:37:47Z"}, {"text": "Oh my bad, this is on Windows... Another cubeb error then.", "author": "jyavenard@mozilla.com", "id": 13050099, "time": "2018-02-18T03:38:23Z"}, {"text": "(In reply to lpy750 from comment #0)\n> User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:59.0)\n> Gecko/20100101 Firefox/59.0\n> Build ID: 20180208193705\n> \n> Steps to reproduce:\n> \n> Windows 10 64-bit\n> \n> Not affected: Firefox 58.0.2\n> Affected: any Firefox 59 beta, Firefox 60 Nightly\n> \n> In Windows, open soundcard output playback device and set sample rate to\n> either 96000Hz or 192000Hz.\n> \n> Open mixer.com, find a live stream with Low Latency enabled.\n> \n> \n> \n> Actual results:\n> \n> Although running at normal speed, as expected, audio will sound high pitched.\n> \n> \n> \n> Expected results:\n> \n> Upon a little experimenting, it appears Firefox 58 relies on \"OpenH264 Video\n> Codec provided by Cisco Systems, Inc.\" for both audio and video, whereas\n> Firefox 59+ only uses it for video.", "author": "jyavenard@mozilla.com", "id": 13050100, "time": "2018-02-18T03:38:57Z"}, {"text": "Damn, it validated too quickly \n \n> Expected results:\n> \n> Upon a little experimenting, it appears Firefox 58 relies on \"OpenH264 Video\n> Codec provided by Cisco Systems, Inc.\" for both audio and video, whereas\n> Firefox 59+ only uses it for video.\n\nNot at all. Openh264 is only used for webrtc session with peer requiring h264, e.g no Web browsers", "author": "jyavenard@mozilla.com", "id": 13050101, "time": "2018-02-18T03:40:14Z"}, {"text": "I see. My observation is, if I try a Mixer.com low latency stream with the H264 plugin disabled, it will fail to load in Firefox 58. But in Firefox 59, only the video fails to load but the audio will still work.", "author": "lpy750@outlook.com", "id": 13050137, "time": "2018-02-18T05:48:04Z"}, {"text": "(In reply to lpy750 from comment #7)\n> I see. My observation is, if I try a Mixer.com low latency stream with the\n> H264 plugin disabled, it will fail to load in Firefox 58. But in Firefox 59,\n> only the video fails to load but the audio will still work.\n\nIt must be an entire coincidence. The OpenH264 plugin can not be used to decode normal playback video", "author": "jyavenard@mozilla.com", "id": 13050226, "time": "2018-02-18T09:50:23Z"}, {"text": "mixer.com, when using low-latency mode, uses WebRTC for transport, and that uses OpenH264.\n\nThis is easy to check: open a \"low-latency\" stream, open \"about:webrtc\", see all the PeerConnection in use, with video flowing.", "author": "padenot@mozilla.com", "id": 13075459, "time": "2018-02-28T14:42:52Z"}, {"text": "And why would it plays incorrectly when changing the system sampling rate, nevertheless, it's a regression", "author": "jyavenard@mozilla.com", "id": 13077388, "time": "2018-02-28T19:50:34Z"}, {"text": "Yes. jya, do you have time to have a look, or do you want me to take it? I think the issue is in the area of the AudioConduit.", "author": "padenot@mozilla.com", "id": 13079105, "time": "2018-03-01T12:05:12Z"}, {"text": "Created attachment 8955228\nBug 1437366 - Set the correct (possibly clamped) rate on the MediaStreamTrack when the MSG runs at a rate not compatible with the webrtc.org code, and fix interval calculation.\n\nReview commit: https://reviewboard.mozilla.org/r/224388/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/224388/", "author": "padenot@mozilla.com", "id": 13080420, "time": "2018-03-01T18:10:25Z"}, {"text": "Taking as per discussion with jya.\n\nAlso, I haven't been able to test this: my windows builder is currently busted. However, this corresponds to the symptoms: wrong rate (i.e. high pitched audio) + twice less data than needed, so the audio sounds really weird.\n\nHaving the wrong rate on the track here means that the MSG will not resample its input, and consider that we're under-runing like crazy instead.", "author": "padenot@mozilla.com", "id": 13080441, "time": "2018-03-01T18:14:22Z"}, {"text": "Comment on attachment 8955228\nBug 1437366 - Set the correct (possibly clamped) rate on the MediaStreamTrack when the MSG runs at a rate not compatible with the webrtc.org code, and fix interval calculation.\n\nhttps://reviewboard.mozilla.org/r/224388/#review230706", "author": "padenot@mozilla.com", "id": 13083513, "time": "2018-03-02T17:09:26Z"}, {"text": "This helps, but is not good enough.", "author": "padenot@mozilla.com", "id": 13083516, "time": "2018-03-02T17:09:57Z"}, {"text": "Comment on attachment 8955228\nBug 1437366 - Set the correct (possibly clamped) rate on the MediaStreamTrack when the MSG runs at a rate not compatible with the webrtc.org code, and fix interval calculation.\n\nhttps://reviewboard.mozilla.org/r/224388/#review230712\n\n::: media/webrtc/signaling/src/mediapipeline/MediaPipeline.cpp:1970\n(Diff revision 1)\n>      , mMaybeTrackNeedsUnmute(true)\n>    {\n>      MOZ_RELEASE_ASSERT(mSource, \"Must be used with a SourceMediaStream\");\n> +  }\n> +\n> +  virtual ~GenericReceiveListener()\n\nthat move seems out of scope to me", "author": "jyavenard@mozilla.com", "id": 13083617, "time": "2018-03-02T17:42:32Z"}, {"text": "I don't quite understand what is going on here. The patch above is valid, but then I only hear audio sporadically. It sounds like it's under-running somewhere else.", "author": "padenot@mozilla.com", "id": 13083849, "time": "2018-03-02T18:42:16Z"}, {"text": "Created attachment 8956085\nBug 1437366 - Teach the AudioConduit to send audio that has a non-supported sample-rate.\n\nReview commit: https://reviewboard.mozilla.org/r/225018/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/225018/", "author": "padenot@mozilla.com", "id": 13104907, "time": "2018-03-05T15:26:58Z"}, {"text": "Created attachment 8956086\nBug 1437366 - Add a way to force the sample-rate used for a MediaStreamGraph.\n\nReview commit: https://reviewboard.mozilla.org/r/225020/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/225020/", "author": "padenot@mozilla.com", "id": 13104908, "time": "2018-03-05T15:26:58Z"}, {"text": "Created attachment 8956087\nBug 1437366 - Test that sending and receiving audio when using a graph with a sample-rate that is not supported by the MediaPipeline code works.\n\nReview commit: https://reviewboard.mozilla.org/r/225022/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/225022/", "author": "padenot@mozilla.com", "id": 13104909, "time": "2018-03-05T15:26:58Z"}, {"text": "Comment on attachment 8955228\nBug 1437366 - Set the correct (possibly clamped) rate on the MediaStreamTrack when the MSG runs at a rate not compatible with the webrtc.org code, and fix interval calculation.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/224388/diff/1-2/", "author": "padenot@mozilla.com", "id": 13104910, "time": "2018-03-05T15:26:58Z"}, {"text": "Comment on attachment 8955228\nBug 1437366 - Set the correct (possibly clamped) rate on the MediaStreamTrack when the MSG runs at a rate not compatible with the webrtc.org code, and fix interval calculation.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/224388/diff/2-3/", "author": "padenot@mozilla.com", "id": 13104932, "time": "2018-03-05T15:33:13Z"}, {"text": "Comment on attachment 8956085\nBug 1437366 - Teach the AudioConduit to send audio that has a non-supported sample-rate.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/225018/diff/1-2/", "author": "padenot@mozilla.com", "id": 13104933, "time": "2018-03-05T15:33:13Z"}, {"text": "Comment on attachment 8956086\nBug 1437366 - Add a way to force the sample-rate used for a MediaStreamGraph.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/225020/diff/1-2/", "author": "padenot@mozilla.com", "id": 13104934, "time": "2018-03-05T15:33:13Z"}, {"text": "Comment on attachment 8956087\nBug 1437366 - Test that sending and receiving audio when using a graph with a sample-rate that is not supported by the MediaPipeline code works.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/225022/diff/1-2/", "author": "padenot@mozilla.com", "id": 13104935, "time": "2018-03-05T15:33:13Z"}, {"text": "(In reply to Paul Adenot (:padenot) from comment #17)\n> I don't quite understand what is going on here. The patch above is valid,\n> but then I only hear audio sporadically. It sounds like it's under-running\n> somewhere else.\n\nFor the record it was that the `aDesiredTime` number in mozilla::MediaPipelineReceiveAudio::PipelineListener::NotifyPullImpl was assumed to be in the right sample-rate domain, since we assumed that the graph rate was OK to use in the MediaPipeline (which isn't the case), so it was completely off.", "author": "padenot@mozilla.com", "id": 13104969, "time": "2018-03-05T15:39:30Z"}, {"text": "Comment on attachment 8955228\nBug 1437366 - Set the correct (possibly clamped) rate on the MediaStreamTrack when the MSG runs at a rate not compatible with the webrtc.org code, and fix interval calculation.\n\nhttps://reviewboard.mozilla.org/r/224388/#review230988\n\n::: media/webrtc/signaling/src/mediapipeline/MediaPipeline.cpp:1978\n(Diff revision 3)\n> +    MOZ_ASSERT((aRate != 0 && mTrack->AsAudioStreamTrack()) ||\n> +               mTrack->AsVideoStreamTrack());\n\nMove the assert to the top of the `->AsAudioStreamTrack()` block", "author": "apehrson@mozilla.com", "id": 13105027, "time": "2018-03-05T15:55:17Z"}, {"text": "Comment on attachment 8956085\nBug 1437366 - Teach the AudioConduit to send audio that has a non-supported sample-rate.\n\nhttps://reviewboard.mozilla.org/r/225018/#review230992\n\nr+ with these minor issues and nits fixed.\n\n::: media/webrtc/signaling/src/mediapipeline/MediaPipeline.cpp:497\n(Diff revision 2)\n>    {\n>      MOZ_ASSERT(mConduit);\n>      MOZ_COUNT_CTOR(AudioProxyThread);\n>    }\n>  \n> +  uint32_t AppropriateSendingRateForInputRate(uint32_t aInputRate)\n\nCould we move this to AudioSessionConduit so the definition of what is supported lives in one place?\n\n::: media/webrtc/signaling/src/mediapipeline/MediaPipeline.cpp:497\n(Diff revision 2)\n>    {\n>      MOZ_ASSERT(mConduit);\n>      MOZ_COUNT_CTOR(AudioProxyThread);\n>    }\n>  \n> +  uint32_t AppropriateSendingRateForInputRate(uint32_t aInputRate)\n\nPlease document this so we know what it's intended to do.\n\n::: media/webrtc/signaling/src/mediapipeline/MediaPipeline.cpp:504\n(Diff revision 2)\n> +    if (aInputRate < 16000) {\n> +      return 16000;\n> +    } else if (aInputRate < 32000) {\n> +      return 32000;\n> +    } else if (aInputRate < 44100) {\n\nYou want these to be `<=` no?\n\nOr an `aInputRate` of `16000` will result in 32000.\n\nFine that those rates are covered by `IsSamplingFreqSupported()` above, but that is not obvious here.\n\n::: media/webrtc/signaling/src/mediapipeline/MediaPipeline.cpp:515\n(Diff revision 2)\n> +    } else {\n> +      return 48000;\n> +    }\n> +  }\n> +\n>    void InternalProcessAudioChunk(TrackRate rate,\n\nPlease document this method so we know what it's intended to do.\n\n::: media/webrtc/signaling/src/mediapipeline/MediaPipeline.cpp:517\n(Diff revision 2)\n> +    }\n> +  }\n> +\n>    void InternalProcessAudioChunk(TrackRate rate,\n>                                   const AudioChunk& chunk,\n> -                                 bool enabled)\n> +                                 bool aEnabled)\n\nIf you're fixing `aEnabled`, could you do `rate` and `chunk` too?\n\n::: media/webrtc/signaling/src/mediapipeline/MediaPipeline.cpp:545\n(Diff revision 2)\n> +    if (mInterleavedAudio.Length() < sampleCount) {\n> +      mInterleavedAudio.SetLength(sampleCount);\n> +    }\n\nSee also SetCapacity\n\n::: media/webrtc/signaling/src/mediapipeline/MediaPipeline.cpp:584\n(Diff revision 2)\n> +    if (framesProcessed != 0) {\n> +      processedAudio = inputAudio;\n> +    } else {\n> +      // In place conversion not possible, use a buffer.\n\nIMO this gets easier to read if you put the block that the conditional is for (checking framesProcessed against 0) first.\n\nThe bonus of avoiding negations helps too.\n\n::: media/webrtc/signaling/src/mediapipeline/MediaPipeline.cpp:601\n(Diff revision 2)\n> +                     transmissionRate,\n> +                     outputChannels,\n> +                     framesProcessed);\n> +  }\n>  \n> -    // Check if the rate or the number of channels has changed since the last\n> +  void PacketizeAndSend(const int16_t* aAudioData,\n\nCan you document this method so we know what it's intended to do?\n\n::: media/webrtc/signaling/src/mediapipeline/MediaPipeline.cpp:604\n(Diff revision 2)\n> +  }\n>  \n> -    // Check if the rate or the number of channels has changed since the last\n> -    // time we came through. I realize it may be overkill to check if the rate\n> -    // has changed, but I believe it is possible (e.g. if we change sources) and\n> -    // it costs us very little to handle this case.\n> +  void PacketizeAndSend(const int16_t* aAudioData,\n> +                        uint32_t aRate,\n> +                        uint32_t aChannels,\n> +                        uint32_t aFrameCount) {\n\nOpening bracket on new line\n\n::: media/webrtc/signaling/src/mediapipeline/MediaPipeline.cpp:613\n(Diff revision 2)\n>  \n> -    uint32_t audio_10ms = rate / 100;\n> +    uint32_t audio_10ms = aRate / 100;\n>  \n>      if (!mPacketizer || mPacketizer->PacketSize() != audio_10ms ||\n> -        mPacketizer->Channels() != outputChannels) {\n> +        mPacketizer->Channels() != aChannels) {\n>        // It's ok to drop the audio still in the packetizer here.\n\nNormally I'd ask you to clarify *why* this is ok, but since this line is not touched I'll consider it optional.", "author": "apehrson@mozilla.com", "id": 13105176, "time": "2018-03-05T16:33:18Z"}, {"text": "Comment on attachment 8956086\nBug 1437366 - Add a way to force the sample-rate used for a MediaStreamGraph.\n\nhttps://reviewboard.mozilla.org/r/225020/#review231004\n\nLooks good, but please make sure to get the behavior around resetting the pref, and `PreferredSampleRate()` right.\n\n::: dom/media/CubebUtils.cpp:37\n(Diff revision 2)\n>  #define PREF_VOLUME_SCALE \"media.volume_scale\"\n>  #define PREF_CUBEB_BACKEND \"media.cubeb.backend\"\n>  #define PREF_CUBEB_LATENCY_PLAYBACK \"media.cubeb_latency_playback_ms\"\n>  #define PREF_CUBEB_LATENCY_MSG \"media.cubeb_latency_msg_frames\"\n> +// Allows to get something non-default for the preferred sample-rate, to allow\n> +// troubleshotting in the field and testing.\n\ns/shotting/shooting/\n\n::: dom/media/CubebUtils.cpp:128\n(Diff revision 2)\n> +// If sCubebForcedSampleRate is non-zero, PreferredSampleRate will return the\n> +// preferred sample-rate for the audio backend in use. Otherwise, it will be\n> +// used as the preferred sample-rate.\n\nI think you need to flip the cases around here, no?\n\n> If it's non-zero it will be used as the preferred rate. Otherwise, PreferredSampleRate() will return the rate for the backend in use.\n\n::: dom/media/CubebUtils.cpp:247\n(Diff revision 2)\n> +  } else if (strcmp(aPref, PREF_CUBEB_FORCE_SAMPLE_RATE) == 0) {\n> +    if (Preferences::HasUserValue(aPref)) {\n> +      StaticMutexAutoLock lock(sMutex);\n> +      sCubebForcedSampleRate = Preferences::GetUint(aPref, 48000);\n> +    }\n\nWhat does it mean if it doesn't have user value -- shouldn't we reset the forced rate to 0?\n\nIt seems sound to me to rely on Preferences::GetUint() to fall back to 0 in case of an error (like there not being a user value).\n\nAny reason for defaulting to 48k instead of 0 here?\n\n::: dom/media/CubebUtils.cpp:336\n(Diff revision 2)\n>  uint32_t PreferredSampleRate()\n>  {\n>    if (!InitPreferredSampleRate()) {\n>      return 44100;\n>    }\n>    MOZ_ASSERT(sPreferredSampleRate);\n> +  if (sCubebForcedSampleRate) {\n> +    return sCubebForcedSampleRate;\n> +  }\n\nIt seems logical to me that the forced rate should be returned even if InitPreferredSampleRate() fails.\n\n::: dom/media/tests/mochitest/test_forceSampleRate.html:10\n(Diff revision 2)\n> +<p id=\"display\"></p>\n> +<div id=\"content\" style=\"display: none\">\n> +</div>\n\nNeeded?\n\n::: dom/media/tests/mochitest/test_forceSampleRate.html:23\n(Diff revision 2)\n> +SimpleTest.waitForExplicitFinish();\n> +SpecialPowers.pushPrefEnv({\"set\": [\n> +  [\"media.cubeb.force_sample_rate\", WEIRD_SAMPLE_RATE]\n> +]}).then(function() {\n> +  var ac = new AudioContext();\n> +  is(ac.sampleRate, WEIRD_SAMPLE_RATE, \"Forced sample-rate set successfuly.\");\n\ns/successfuly/successfully/", "author": "apehrson@mozilla.com", "id": 13105230, "time": "2018-03-05T16:49:13Z"}, {"text": "Comment on attachment 8956087\nBug 1437366 - Test that sending and receiving audio when using a graph with a sample-rate that is not supported by the MediaPipeline code works.\n\nhttps://reviewboard.mozilla.org/r/225022/#review231010\n\nr- for finishing the test early.\n\n::: dom/media/tests/mochitest/mochitest.ini:30\n(Diff revision 2)\n>    !/dom/media/test/gizmo.mp4\n>  \n>  [test_a_noOp.html]\n>  [test_dataChannel_basicAudio.html]\n> +[test_peerConnection_basicAudio_forcedSampleRate.html]\n>  skip-if = (android_version == '18') # Bug 962984 for debug, bug 963244 for opt\n\nThe `skip-if` applies to the line above does it not?\n\nPlease double check this with the try results.\n\n::: dom/media/tests/mochitest/test_peerConnection_basicAudio_forcedSampleRate.html:16\n(Diff revision 2)\n> +    title: \"Basic audio-only peer connection, with the MSG running at a rate not supported by the MediaPipeline\"\n> +  });\n> +\n> +// The MediaPipeline supports 16, 32, 44.1 and 48kHz, test something below and\n> +// above those numbers;\n> +[96000, 24000].forEach(function(forcedSampleRate) {\n\nWhen we've run this function for the first element (96k), the test framework will consider the test done and move on to the next, no?\n\nI always had to override the finish() call when doing something like this before. One example is [1] where we do `test.chain.execute()` instead of `test.run()` to avoid finishing early.\n\n\n[1] https://searchfox.org/mozilla-central/source/dom/media/tests/mochitest/test_peerConnection_capturedVideo.html\n\n::: dom/media/tests/mochitest/test_peerConnection_basicAudio_forcedSampleRate.html:25\n(Diff revision 2)\n> +    ]\n> +  }).then(function () {\n> +    var test;\n> +    runNetworkTest(function (options) {\n> +      test = new PeerConnectionTest(options);\n> +      test.audioContext = new AudioContext();\n\ndo you need to have the audio context as an attribute on `test`?\n\nIt should be kept alive through the MediaStream and the stream destination node, no?\n\n::: dom/media/tests/mochitest/test_peerConnection_basicAudio_forcedSampleRate.html:26\n(Diff revision 2)\n> +  }).then(function () {\n> +    var test;\n> +    runNetworkTest(function (options) {\n> +      test = new PeerConnectionTest(options);\n> +      test.audioContext = new AudioContext();\n> +      test.setMediaConstraints([{ audio: true }], [{ audio: true }]);\n\nThis will cause the test framework to set up one gUM on pcLocal (which you replace) and one gUM on pcRemote.\n\nMake the second array empty to make the test case a bit smaller.", "author": "apehrson@mozilla.com", "id": 13105256, "time": "2018-03-05T17:00:46Z"}, {"text": "Comment on attachment 8955228\nBug 1437366 - Set the correct (possibly clamped) rate on the MediaStreamTrack when the MSG runs at a rate not compatible with the webrtc.org code, and fix interval calculation.\n\nhttps://reviewboard.mozilla.org/r/224388/#review231314\n\n::: media/webrtc/signaling/src/mediapipeline/MediaPipeline.cpp:1978\n(Diff revision 3)\n> +    MOZ_ASSERT((aRate != 0 && mTrack->AsAudioStreamTrack()) ||\n> +               mTrack->AsVideoStreamTrack());\n\n!? this is clearly an invariant for the whole method.\n\n::: media/webrtc/signaling/src/mediapipeline/MediaPipeline.cpp:1978\n(Diff revision 3)\n> +    MOZ_ASSERT((aRate != 0 && mTrack->AsAudioStreamTrack()) ||\n> +               mTrack->AsVideoStreamTrack());\n\n!? this is clearly an invariant for the whole method.", "author": "padenot@mozilla.com", "id": 13108376, "time": "2018-03-06T16:09:04Z"}, {"text": "Comment on attachment 8955228\nBug 1437366 - Set the correct (possibly clamped) rate on the MediaStreamTrack when the MSG runs at a rate not compatible with the webrtc.org code, and fix interval calculation.\n\nhttps://reviewboard.mozilla.org/r/224388/#review231314\n\n> !? this is clearly an invariant for the whole method.\n\nSure, but you only assert the rate if it's audio, and we assert the track type further down in the method.", "author": "apehrson@mozilla.com", "id": 13108415, "time": "2018-03-06T16:23:54Z"}, {"text": "Comment on attachment 8956085\nBug 1437366 - Teach the AudioConduit to send audio that has a non-supported sample-rate.\n\nhttps://reviewboard.mozilla.org/r/225018/#review230992\n\n> Could we move this to AudioSessionConduit so the definition of what is supported lives in one place?\n\nAudioSessionConduit does not want to know about this.\n\nThis is an implementation concern of the MediaPipeline. AudioSessionConduit still only supports a few rates.\n\n> You want these to be `<=` no?\n> \n> Or an `aInputRate` of `16000` will result in 32000.\n> \n> Fine that those rates are covered by `IsSamplingFreqSupported()` above, but that is not obvious here.\n\nIt's now clear with the documentations.\n\n> See also SetCapacity\n\n?\n\n> Normally I'd ask you to clarify *why* this is ok, but since this line is not touched I'll consider it optional.\n\nFixed regardless.", "author": "padenot@mozilla.com", "id": 13108473, "time": "2018-03-06T16:50:42Z"}, {"text": "Comment on attachment 8956085\nBug 1437366 - Teach the AudioConduit to send audio that has a non-supported sample-rate.\n\nhttps://reviewboard.mozilla.org/r/225018/#review231336", "author": "padenot@mozilla.com", "id": 13108474, "time": "2018-03-06T16:51:07Z"}, {"text": "Comment on attachment 8955228\nBug 1437366 - Set the correct (possibly clamped) rate on the MediaStreamTrack when the MSG runs at a rate not compatible with the webrtc.org code, and fix interval calculation.\n\nhttps://reviewboard.mozilla.org/r/224388/#review231314\n\n> !? this is clearly an invariant for the whole method.\n\nYou're right, removed the other one. I prefer the invariants stated in one go at the top.", "author": "padenot@mozilla.com", "id": 13108565, "time": "2018-03-06T17:19:08Z"}, {"text": "Comment on attachment 8955228\nBug 1437366 - Set the correct (possibly clamped) rate on the MediaStreamTrack when the MSG runs at a rate not compatible with the webrtc.org code, and fix interval calculation.\n\nhttps://reviewboard.mozilla.org/r/224388/#review231314\n\n> You're right, removed the other one. I prefer the invariants stated in one go at the top.\n\nPersonally I prefer to make the asserts as individual as possible. Makes it easier to debug when they fail. Could you make one checking the track type, and then one `MOZ_ASSERT_IF(isAudio, aRate != 0)`?", "author": "apehrson@mozilla.com", "id": 13108596, "time": "2018-03-06T17:27:53Z"}, {"text": "Comment on attachment 8956087\nBug 1437366 - Test that sending and receiving audio when using a graph with a sample-rate that is not supported by the MediaPipeline code works.\n\nhttps://reviewboard.mozilla.org/r/225022/#review231346\n\n::: dom/media/tests/mochitest/test_peerConnection_basicAudio_forcedSampleRate.html:16\n(Diff revision 2)\n> +    title: \"Basic audio-only peer connection, with the MSG running at a rate not supported by the MediaPipeline\"\n> +  });\n> +\n> +// The MediaPipeline supports 16, 32, 44.1 and 48kHz, test something below and\n> +// above those numbers;\n> +[96000, 24000].forEach(function(forcedSampleRate) {\n\nIt occured to me last night that this is a bit more complicated. It's best to do both tests in two documents, because we have an MSG per documents (for now), and I don't want to innadvertently run into a sitution where an AudioContext with a certain rate runs on an MSG with a different rate. That would be very bad.", "author": "padenot@mozilla.com", "id": 13110941, "time": "2018-03-07T14:18:03Z"}, {"text": "Comment on attachment 8955228\nBug 1437366 - Set the correct (possibly clamped) rate on the MediaStreamTrack when the MSG runs at a rate not compatible with the webrtc.org code, and fix interval calculation.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/224388/diff/3-4/", "author": "padenot@mozilla.com", "id": 13110952, "time": "2018-03-07T14:21:00Z"}, {"text": "Comment on attachment 8956085\nBug 1437366 - Teach the AudioConduit to send audio that has a non-supported sample-rate.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/225018/diff/2-3/", "author": "padenot@mozilla.com", "id": 13110953, "time": "2018-03-07T14:21:00Z"}, {"text": "Comment on attachment 8956086\nBug 1437366 - Add a way to force the sample-rate used for a MediaStreamGraph.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/225020/diff/2-3/", "author": "padenot@mozilla.com", "id": 13110954, "time": "2018-03-07T14:21:00Z"}, {"text": "Comment on attachment 8956087\nBug 1437366 - Test that sending and receiving audio when using a graph with a sample-rate that is not supported by the MediaPipeline code works.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/225022/diff/2-3/", "author": "padenot@mozilla.com", "id": 13110955, "time": "2018-03-07T14:21:00Z"}, {"text": "Comment on attachment 8956087\nBug 1437366 - Test that sending and receiving audio when using a graph with a sample-rate that is not supported by the MediaPipeline code works.\n\nhttps://reviewboard.mozilla.org/r/225022/#review231700\n\n::: dom/media/tests/mochitest/peerconnection_audio_forced_sample_rate.js:8\n(Diff revision 3)\n> +// the MediaPipeline can work with.\n> +// It is in a separate file because we have an MSG per document, and we want to\n> +// test multiple sample-rates, so we include it in multiple HTML mochitest\n> +// files.\n> +function test_peerconnection_audio_forced_sample_rate(forcedSampleRate) {\n> +  SpecialPowers.pushPrefEnv({\n\nSimpleTest might not yet be available.\n\nhttps://searchfox.org/mozilla-central/rev/efce4ceddfbe5fe4e2d74f1aed93894bada9b273/dom/media/tests/mochitest/pc.js#2099\n\nAnd I'd suggest using pushPrefs instead, https://searchfox.org/mozilla-central/rev/efce4ceddfbe5fe4e2d74f1aed93894bada9b273/dom/media/tests/mochitest/head.js#378\n\n::: dom/media/tests/mochitest/peerconnection_audio_forced_sample_rate.js:13\n(Diff revision 3)\n> +  SpecialPowers.pushPrefEnv({\n> +    \"set\": [\n> +      [\"media.cubeb.force_sample_rate\", forcedSampleRate]\n> +    ]\n> +  }).then(function () {\n> +    var test;\n\nUnnecessary\n\n::: dom/media/tests/mochitest/peerconnection_audio_forced_sample_rate.js:16\n(Diff revision 3)\n> +    ]\n> +  }).then(function () {\n> +    var test;\n> +    runNetworkTest(function (options) {\n> +      test = new PeerConnectionTest(options);\n> +      var ac = new AudioContext();\n\nUse `let` instead of `var`? Applies throughout\n\n::: dom/media/tests/mochitest/peerconnection_audio_forced_sample_rate.js:31\n(Diff revision 3)\n> +          test.pcLocal.attachLocalStream(dest.stream);\n> +        }\n> +      ]);\n> +      test.chain.append([\n> +        function CHECK_REMOTE_AUDIO_FLOW(test) {\n> +          return test.pcRemote.checkReceivingToneFrom(new AudioContext(), test.pcLocal);\n\nYou could pass in `ac` here.\n\n::: dom/media/tests/mochitest/test_peerConnection_basicAudio_forced_lower_rate.html:15\n(Diff revision 3)\n> +  createHTML({\n> +    bug: \"1437366\",\n> +    title: \"Basic audio-only peer connection, with the MSG running at a rate not supported by the MediaPipeline (24000Hz)\"\n> +  });\n> +\n> +test_peerconnection_audio_forced_sample_rate(24000);\n\nIndentation", "author": "apehrson@mozilla.com", "id": 13111488, "time": "2018-03-07T16:54:47Z"}, {"text": "Comment on attachment 8956087\nBug 1437366 - Test that sending and receiving audio when using a graph with a sample-rate that is not supported by the MediaPipeline code works.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/225022/diff/3-4/", "author": "padenot@mozilla.com", "id": 13114204, "time": "2018-03-08T15:51:32Z"}, {"text": "Pushed by paul@paul.cx:\nhttps://hg.mozilla.org/integration/autoland/rev/41bb4a676575\nSet the correct (possibly clamped) rate on the MediaStreamTrack when the MSG runs at a rate not compatible with the webrtc.org code, and fix interval calculation. r=jya,pehrsons\nhttps://hg.mozilla.org/integration/autoland/rev/abca0eb36d33\nTeach the AudioConduit to send audio that has a non-supported sample-rate. r=pehrsons\nhttps://hg.mozilla.org/integration/autoland/rev/a26852df062b\nAdd a way to force the sample-rate used for a MediaStreamGraph. r=pehrsons\nhttps://hg.mozilla.org/integration/autoland/rev/57826a5b03e8\nTest that sending and receiving audio when using a graph with a sample-rate that is not supported by the MediaPipeline code works. r=pehrsons", "author": "pulsebot@bots.tld", "id": 13114219, "time": "2018-03-08T15:58:22Z"}, {"text": "Backed out for mochitest failures on /test_peerConnection_basicAudio_forced_higher_rate.html\n\nBack out push: https://hg.mozilla.org/integration/autoland/rev/e85551acd081e9b3d24cf65f08cc770caa55cfef\nPush: https://treeherder.mozilla.org/#/jobs?repo=autoland&revision=57826a5b03e8484b89b565e335d709a6b03bab05\n\nLog: https://treeherder.mozilla.org/#/jobs?repo=autoland&revision=57826a5b03e8484b89b565e335d709a6b03bab05", "author": "nbeleuzu@mozilla.com", "id": 13114548, "time": "2018-03-08T17:33:08Z"}, {"text": "Created attachment 8960259\nBug 1437366 - Lower the sample rate so that the test don't underrun on Windows on try.\n\nReview commit: https://reviewboard.mozilla.org/r/229018/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/229018/", "author": "padenot@mozilla.com", "id": 13140252, "time": "2018-03-19T17:48:09Z"}, {"text": "Created attachment 8960260\nBug 1437366 - Disable the test on Android, all the others are, there are now ways this one can pass.\n\nReview commit: https://reviewboard.mozilla.org/r/229020/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/229020/", "author": "padenot@mozilla.com", "id": 13140253, "time": "2018-03-19T17:48:09Z"}, {"text": "Comment on attachment 8955228\nBug 1437366 - Set the correct (possibly clamped) rate on the MediaStreamTrack when the MSG runs at a rate not compatible with the webrtc.org code, and fix interval calculation.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/224388/diff/4-5/", "author": "padenot@mozilla.com", "id": 13140254, "time": "2018-03-19T17:48:09Z"}, {"text": "Comment on attachment 8956085\nBug 1437366 - Teach the AudioConduit to send audio that has a non-supported sample-rate.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/225018/diff/3-4/", "author": "padenot@mozilla.com", "id": 13140255, "time": "2018-03-19T17:48:09Z"}, {"text": "Comment on attachment 8956086\nBug 1437366 - Add a way to force the sample-rate used for a MediaStreamGraph.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/225020/diff/3-4/", "author": "padenot@mozilla.com", "id": 13140256, "time": "2018-03-19T17:48:09Z"}, {"text": "Comment on attachment 8956087\nBug 1437366 - Test that sending and receiving audio when using a graph with a sample-rate that is not supported by the MediaPipeline code works.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/225022/diff/4-5/", "author": "padenot@mozilla.com", "id": 13140257, "time": "2018-03-19T17:48:09Z"}, {"text": "Comment on attachment 8960259\nBug 1437366 - Lower the sample rate so that the test don't underrun on Windows on try.\n\nhttps://reviewboard.mozilla.org/r/229018/#review234828\n\nSadness. I wonder how long/well this will hold. But for the short term it should be all right.\n\n::: dom/media/tests/mochitest/test_peerConnection_basicAudio_forced_higher_rate.html:12\n(Diff revision 1)\n>  <body>\n>  <pre id=\"test\">\n>  <script type=\"application/javascript\">\n>    createHTML({\n>      bug: \"1437366\",\n>      title: \"Basic audio-only peer connection, with the MSG running at a rate not supported by the MediaPipeline (96000Hz)\"\n\nAlso here, s/96/49/", "author": "apehrson@mozilla.com", "id": 13140640, "time": "2018-03-19T19:44:35Z"}, {"text": "Comment on attachment 8960260\nBug 1437366 - Disable the test on Android, all the others are, there are now ways this one can pass.\n\nhttps://reviewboard.mozilla.org/r/229020/#review234836", "author": "apehrson@mozilla.com", "id": 13140644, "time": "2018-03-19T19:45:31Z"}, {"text": "Comment on attachment 8955228\nBug 1437366 - Set the correct (possibly clamped) rate on the MediaStreamTrack when the MSG runs at a rate not compatible with the webrtc.org code, and fix interval calculation.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/224388/diff/5-6/", "author": "padenot@mozilla.com", "id": 13142583, "time": "2018-03-20T14:35:53Z"}, {"text": "Comment on attachment 8956085\nBug 1437366 - Teach the AudioConduit to send audio that has a non-supported sample-rate.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/225018/diff/4-5/", "author": "padenot@mozilla.com", "id": 13142584, "time": "2018-03-20T14:35:53Z"}, {"text": "Comment on attachment 8956086\nBug 1437366 - Add a way to force the sample-rate used for a MediaStreamGraph.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/225020/diff/4-5/", "author": "padenot@mozilla.com", "id": 13142585, "time": "2018-03-20T14:35:53Z"}, {"text": "Comment on attachment 8956087\nBug 1437366 - Test that sending and receiving audio when using a graph with a sample-rate that is not supported by the MediaPipeline code works.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/225022/diff/5-6/", "author": "padenot@mozilla.com", "id": 13142586, "time": "2018-03-20T14:35:53Z"}, {"text": "Comment on attachment 8960259\nBug 1437366 - Lower the sample rate so that the test don't underrun on Windows on try.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/229018/diff/1-2/", "author": "padenot@mozilla.com", "id": 13142587, "time": "2018-03-20T14:35:53Z"}, {"text": "Comment on attachment 8960260\nBug 1437366 - Disable the test on Android, all the others are, there are now ways this one can pass.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/229020/diff/1-2/", "author": "padenot@mozilla.com", "id": 13142588, "time": "2018-03-20T14:35:53Z"}, {"text": "Pushed by paul@paul.cx:\nhttps://hg.mozilla.org/integration/autoland/rev/408c4c89868d\nSet the correct (possibly clamped) rate on the MediaStreamTrack when the MSG runs at a rate not compatible with the webrtc.org code, and fix interval calculation. r=jya,pehrsons\nhttps://hg.mozilla.org/integration/autoland/rev/66aa57290ce6\nTeach the AudioConduit to send audio that has a non-supported sample-rate. r=pehrsons\nhttps://hg.mozilla.org/integration/autoland/rev/dfabe184b367\nAdd a way to force the sample-rate used for a MediaStreamGraph. r=pehrsons\nhttps://hg.mozilla.org/integration/autoland/rev/b36537851ae1\nTest that sending and receiving audio when using a graph with a sample-rate that is not supported by the MediaPipeline code works. r=pehrsons\nhttps://hg.mozilla.org/integration/autoland/rev/1bc2b82918bd\nLower the sample rate so that the test don't underrun on Windows on try. r=pehrsons\nhttps://hg.mozilla.org/integration/autoland/rev/f1ec577cb636\nDisable the test on Android, all the others are, there are now ways this one can pass. r=pehrsons", "author": "pulsebot@bots.tld", "id": 13143112, "time": "2018-03-20T17:28:49Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/408c4c89868d\nhttps://hg.mozilla.org/mozilla-central/rev/66aa57290ce6\nhttps://hg.mozilla.org/mozilla-central/rev/dfabe184b367\nhttps://hg.mozilla.org/mozilla-central/rev/b36537851ae1\nhttps://hg.mozilla.org/mozilla-central/rev/1bc2b82918bd\nhttps://hg.mozilla.org/mozilla-central/rev/f1ec577cb636", "author": "aryx.bugmail@gmx-topmail.de", "id": 13145186, "time": "2018-03-21T12:13:26Z"}, {"text": "clearing ni.", "author": "padenot@mozilla.com", "id": 13145417, "time": "2018-03-21T13:52:21Z"}, {"text": "*** Bug 1428528 has been marked as a duplicate of this bug. ***", "author": "padenot@mozilla.com", "id": 13168786, "time": "2018-03-30T11:30:01Z"}, {"text": "Comment on attachment 8955228\nBug 1437366 - Set the correct (possibly clamped) rate on the MediaStreamTrack when the MSG runs at a rate not compatible with the webrtc.org code, and fix interval calculation.\n\nApproval Request Comment\n[Feature/Bug causing the regression]: \n[User impact if declined]: Sites using WebRTC with inbound audio or outbound audio (or both), most of them don't work if the sample rate set on the input or output devices is not in [16k, 32k, 44.1k, 48k]. This appears to be a non-trivial number of desktop users, and some OSX users (the built-in sound card on OSX can be set to higher rates).\n\n[Is this code covered by automated tests?]: Yes, and we've had multiple independent reports of things working as expected on multiple web apps.\n\n[Has the fix been verified in Nightly?]: Yes, baked for a while no intermittents\n\n[Needs manual test from QE? If yes, steps to reproduce]: I don't think it is necessary because it's properly unit tested, but here is how to do it:\n\nFind a machine that can have a default sample-rate (input and output audio devices) of more than 48000Hz (96000Hz would be the next usual rate). Set this to be the default sample-rate. This can be a Windows desktop or laptop with an external sound card, or simply an Apple computer (any will do). It's also possible to set the sample-rate on Linux, regardless of the device.\n\nRun Firefox. In the devtools console, verify that `(new AudioContext).sampleRate` returns the rate set in the previous step.\n\nMake a WebRTC call using any service. This used to produce terrible glitchy audio, and with this patch set, the audio is clear.\n\n[List of other uplifts needed for the feature/fix]: None, but all the patches in this bug (covering respectively inbound audio, outbound audio, and tests).\n\n[Is the change risky?]: No.\n\n[Why is the change risky/not risky?]: It's been working well for everybody involved, is straightforward code and well tested, so I don't think so.\n\n[String changes made/needed]: None.\n\nThis uplift request is motivated by the fact that 60 is an ESR release, and that we've had external request of having this scenario work well for the upcoming ESR cycle.", "author": "padenot@mozilla.com", "id": 13211849, "time": "2018-04-17T09:33:25Z"}, {"text": "Comment on attachment 8955228\nBug 1437366 - Set the correct (possibly clamped) rate on the MediaStreamTrack when the MSG runs at a rate not compatible with the webrtc.org code, and fix interval calculation.\n\nwebrtc fix, approved for 60.0b14 (all patches in this bug)", "author": "jcristau@mozilla.com", "id": 13212719, "time": "2018-04-17T15:20:44Z"}, {"text": "https://hg.mozilla.org/releases/mozilla-beta/rev/d2e7192e3493\nhttps://hg.mozilla.org/releases/mozilla-beta/rev/2217c087162c\nhttps://hg.mozilla.org/releases/mozilla-beta/rev/522585f451f4\nhttps://hg.mozilla.org/releases/mozilla-beta/rev/d755d3934e22\nhttps://hg.mozilla.org/releases/mozilla-beta/rev/323d9687b9cd\nhttps://hg.mozilla.org/releases/mozilla-beta/rev/a6ea41d3dc18", "author": "ryanvm@gmail.com", "id": 13213438, "time": "2018-04-17T19:28:34Z"}, {"text": "*** Bug 1456159 has been marked as a duplicate of this bug. ***", "author": "padenot@mozilla.com", "id": 13234720, "time": "2018-04-26T08:22:15Z"}], "id": 1437366, "priority": "P2", "cc": ["adihan@cafex.com", "apehrson@mozilla.com", "astonalex5@gmail.com", "jyavenard@mozilla.com", "lpy750@outlook.com", "mcastelluccio@mozilla.com", "padenot@mozilla.com", "rjesup@jesup.org", "sescalante@mozilla.com"], "cf_crash_signature": "", "version": "59 Branch", "is_cc_accessible": true, "cf_tracking_firefox_esr52": "---", "see_also": [], "cf_tracking_thunderbird_esr60": "---", "cf_platform_rel": "---", "product": "Core", "cf_fx_iteration": "---", "blocks": [], "qa_contact": "", "creation_time": "2018-02-11T12:21:48Z", "cf_status_firefox_esr52": "---", "component": "Audio/Video: MediaStreamGraph", "assigned_to_detail": {"email": "padenot@mozilla.com", "id": 404637, "name": "padenot@mozilla.com", "real_name": "Paul Adenot (:padenot)"}, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "---", "cf_status_firefox61": "fixed", "cf_status_firefox60": "fixed", "target_milestone": "mozilla61", "cf_rank": "15", "cf_qa_whiteboard": "", "severity": "normal", "groups": [], "cf_status_thunderbird_esr52": "---", "url": "", "cf_status_thunderbird_esr60": "---", "creator_detail": {"email": "lpy750@outlook.com", "id": 605010, "name": "lpy750@outlook.com", "real_name": ""}, "whiteboard": "", "mentors": [], "summary": "Sound card sample rate affects mixer.com audio (FF 59 Beta)", "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [{"status": "+", "name": "in-testsuite", "modification_date": "2018-04-17T19:28:34Z", "type_id": 37, "creation_date": "2018-04-17T19:28:34Z", "id": 1745217, "setter": "ryanvm@gmail.com"}], "last_change_time": "2018-04-27T08:44:14Z", "assigned_to": "padenot@mozilla.com", "is_open": false, "history": [{"changes": [{"removed": "", "field_name": "cc", "added": "lpy750@outlook.com"}], "who": "lpy750@outlook.com", "when": "2018-02-11T12:23:14Z"}, {"changes": [{"removed": "lpy750@outlook.com", "field_name": "cc", "added": ""}], "who": "lpy750@outlook.com", "when": "2018-02-11T12:23:18Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "lpy750@outlook.com"}], "who": "lpy750@outlook.com", "when": "2018-02-11T12:23:25Z"}, {"changes": [{"removed": "Untriaged", "field_name": "component", "added": "Audio/Video"}, {"removed": "Firefox", "field_name": "product", "added": "Core"}], "who": "yfdyh000@gmail.com", "when": "2018-02-12T07:01:46Z"}, {"changes": [{"removed": "--", "field_name": "priority", "added": "P2"}, {"removed": "", "field_name": "cc", "added": "jyavenard@mozilla.com"}, {"removed": "Audio/Video", "field_name": "component", "added": "Audio/Video: Playback"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(jyavenard@mozilla.com)"}], "who": "giles@thaumas.net", "when": "2018-02-16T20:59:44Z"}, {"changes": [{"removed": "needinfo?(jyavenard@mozilla.com)", "field_name": "flagtypes.name", "added": "needinfo?(lpy750@outlook.com)"}], "who": "jyavenard@mozilla.com", "when": "2018-02-18T03:37:47Z"}, {"changes": [{"removed": "needinfo?(lpy750@outlook.com)", "field_name": "flagtypes.name", "added": ""}], "who": "lpy750@outlook.com", "when": "2018-02-18T05:48:04Z"}, {"changes": [{"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "jyavenard@mozilla.com"}], "who": "jyavenard@mozilla.com", "when": "2018-02-23T21:46:33Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "padenot@mozilla.com"}], "who": "padenot@mozilla.com", "when": "2018-02-28T14:42:52Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8955228, "added": "review?(jyavenard@mozilla.com)"}], "who": "padenot@mozilla.com", "when": "2018-03-01T18:10:25Z"}, {"changes": [{"removed": "jyavenard@mozilla.com", "field_name": "assigned_to", "added": "padenot@mozilla.com"}], "who": "padenot@mozilla.com", "when": "2018-03-01T18:14:22Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(jyavenard@mozilla.com)", "attachment_id": 8955228, "added": ""}], "who": "padenot@mozilla.com", "when": "2018-03-02T17:09:38Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8955228, "added": "review+"}], "who": "jyavenard@mozilla.com", "when": "2018-03-02T17:42:32Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8956086, "added": "review?(apehrson@mozilla.com)"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8956087, "added": "review?(apehrson@mozilla.com)"}, {"field_name": "attachments.description", "removed": "Bug 1437366 - Set the correct (possibly clamped) rate on the MediaStreamTrack when the MSG runs at a rate not compatible with the webrtc.org code.", "attachment_id": 8955228, "added": "Bug 1437366 - Set the correct (possibly clamped) rate on the MediaStreamTrack when the MSG runs at a rate not compatible with the webrtc.org code, and fix interval calculation."}, {"field_name": "flagtypes.name", "removed": "review+", "attachment_id": 8955228, "added": ""}, {"removed": "", "field_name": "cc", "added": "apehrson@mozilla.com"}], "who": "padenot@mozilla.com", "when": "2018-03-05T15:26:58Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8955228, "added": "review?(apehrson@mozilla.com)"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8956085, "added": "review?(apehrson@mozilla.com)"}], "who": "padenot@mozilla.com", "when": "2018-03-05T15:33:13Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(apehrson@mozilla.com)", "attachment_id": 8955228, "added": "review+"}], "who": "apehrson@mozilla.com", "when": "2018-03-05T15:55:17Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(apehrson@mozilla.com)", "attachment_id": 8956085, "added": "review+"}], "who": "apehrson@mozilla.com", "when": "2018-03-05T16:33:18Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(apehrson@mozilla.com)", "attachment_id": 8956086, "added": "review+"}], "who": "apehrson@mozilla.com", "when": "2018-03-05T16:49:13Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(apehrson@mozilla.com)", "attachment_id": 8956087, "added": "review-"}], "who": "apehrson@mozilla.com", "when": "2018-03-05T17:00:46Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review-", "attachment_id": 8956087, "added": "review?(apehrson@mozilla.com)"}], "who": "padenot@mozilla.com", "when": "2018-03-07T14:21:00Z"}, {"changes": [{"removed": "UNCONFIRMED", "field_name": "status", "added": "ASSIGNED"}, {"removed": "0", "field_name": "is_confirmed", "added": "1"}], "who": "apehrson@mozilla.com", "when": "2018-03-07T16:44:53Z"}, {"changes": [{"removed": "", "field_name": "cf_rank", "added": "15"}, {"removed": "", "field_name": "cc", "added": "rjesup@jesup.org, sescalante@mozilla.com"}, {"removed": "Audio/Video: Playback", "field_name": "component", "added": "Audio/Video: MediaStreamGraph"}], "who": "apehrson@mozilla.com", "when": "2018-03-07T16:45:20Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(apehrson@mozilla.com)", "attachment_id": 8956087, "added": "review+"}], "who": "apehrson@mozilla.com", "when": "2018-03-07T16:54:47Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(padenot@mozilla.com)"}], "who": "nbeleuzu@mozilla.com", "when": "2018-03-08T17:33:08Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8960259, "added": "review?(apehrson@mozilla.com)"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8960260, "added": "review?(apehrson@mozilla.com)"}], "who": "padenot@mozilla.com", "when": "2018-03-19T17:48:09Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(apehrson@mozilla.com)", "attachment_id": 8960259, "added": "review+"}], "who": "apehrson@mozilla.com", "when": "2018-03-19T19:44:35Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(apehrson@mozilla.com)", "attachment_id": 8960260, "added": "review+"}], "who": "apehrson@mozilla.com", "when": "2018-03-19T19:45:31Z"}, {"changes": [{"removed": "ASSIGNED", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla61"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2018-03-21 12:13:26"}, {"removed": "---", "field_name": "cf_status_firefox61", "added": "fixed"}], "who": "aryx.bugmail@gmx-topmail.de", "when": "2018-03-21T12:13:26Z"}, {"changes": [{"removed": "needinfo?(padenot@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "padenot@mozilla.com", "when": "2018-03-21T13:52:21Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "astonalex5@gmail.com"}], "who": "padenot@mozilla.com", "when": "2018-03-30T11:30:01Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8955228, "added": "approval-mozilla-beta?"}], "who": "padenot@mozilla.com", "when": "2018-04-17T09:33:25Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "approval-mozilla-beta?", "attachment_id": 8955228, "added": "approval-mozilla-beta+"}], "who": "jcristau@mozilla.com", "when": "2018-04-17T15:20:44Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "in-testsuite+"}, {"removed": "---", "field_name": "cf_status_firefox60", "added": "fixed"}], "who": "ryanvm@gmail.com", "when": "2018-04-17T19:28:34Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "adihan@cafex.com"}], "who": "padenot@mozilla.com", "when": "2018-04-26T08:22:15Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "regression"}, {"removed": "", "field_name": "cc", "added": "mcastelluccio@mozilla.com"}], "who": "mcastelluccio@mozilla.com", "when": "2018-04-27T08:44:14Z"}], "resolution": "FIXED", "op_sys": "Unspecified", "cf_fx_points": "---", "cf_blocking_fennec": "---"}