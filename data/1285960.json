{"cf_tracking_thunderbird_esr52": "---", "status": "VERIFIED", "cf_tracking_firefox60": "---", "attachments": [{"creator": "jwalden+bmo@mit.edu", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2016-12-13T18:38:31Z", "type_id": 4, "creation_date": "2016-12-13T04:25:25Z", "id": 1497935, "setter": "sphink@gmail.com"}], "content_type": "text/plain", "id": 8818160}, {"creator": "jwalden+bmo@mit.edu", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2016-12-30T05:35:27Z", "type_id": 4, "creation_date": "2016-12-14T01:51:49Z", "id": 1498328, "setter": "sphink@gmail.com"}, {"status": "+", "name": "sec-approval", "modification_date": "2016-12-30T21:10:43Z", "type_id": 799, "creation_date": "2016-12-30T18:38:35Z", "id": 1504845, "setter": "abillings@mozilla.com"}], "content_type": "text/plain", "id": 8818424}, {"creator": "jwalden+bmo@mit.edu", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2016-12-30T18:26:32Z", "type_id": 4, "creation_date": "2016-12-14T01:53:58Z", "id": 1498330, "setter": "sphink@gmail.com"}], "content_type": "text/plain", "id": 8818425}, {"creator": "jwalden+bmo@mit.edu", "is_obsolete": 0, "is_patch": 1, "flags": [], "content_type": "text/plain", "id": 8818428}, {"creator": "jwalden+bmo@mit.edu", "is_obsolete": 0, "is_patch": 1, "flags": [], "content_type": "text/plain", "id": 8818430}, {"creator": "jwalden+bmo@mit.edu", "is_obsolete": 1, "is_patch": 1, "flags": [], "content_type": "text/plain", "id": 8819444}, {"creator": "jwalden+bmo@mit.edu", "is_obsolete": 1, "is_patch": 1, "flags": [], "content_type": "text/plain", "id": 8819445}, {"creator": "jwalden+bmo@mit.edu", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "approval-mozilla-aurora", "modification_date": "2017-01-05T08:55:18Z", "type_id": 720, "creation_date": "2017-01-04T23:02:05Z", "id": 1506621, "setter": "jcristau@mozilla.com"}], "content_type": "text/plain", "id": 8823480}, {"creator": "jwalden+bmo@mit.edu", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "approval-mozilla-beta", "modification_date": "2017-01-05T08:56:30Z", "type_id": 721, "creation_date": "2017-01-04T23:02:56Z", "id": 1506622, "setter": "jcristau@mozilla.com"}], "content_type": "text/plain", "id": 8823481}, {"creator": "jwalden+bmo@mit.edu", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "approval-mozilla-esr45", "modification_date": "2017-01-05T08:55:34Z", "type_id": 905, "creation_date": "2017-01-04T23:03:25Z", "id": 1506623, "setter": "jcristau@mozilla.com"}], "content_type": "text/plain", "id": 8823482}], "cf_tracking_firefox62": "---", "creator": "andrebargull@googlemail.com", "mentors_detail": [], "depends_on": [], "cf_has_str": "---", "cf_user_story": "", "history": [{"changes": [{"removed": "", "field_name": "keywords", "added": "csectype-bounds, sec-high"}, {"removed": "", "field_name": "cc", "added": "choller@mozilla.com, continuation@gmail.com, jdemooij@mozilla.com, sphink@gmail.com"}], "who": "continuation@gmail.com", "when": "2016-07-14T17:21:52Z"}, {"changes": [{"removed": "core-security", "field_name": "groups", "added": "javascript-core-security"}], "who": "dveditz@mozilla.com", "when": "2016-07-15T23:00:23Z"}, {"changes": [{"removed": "sec-high", "field_name": "keywords", "added": "sec-critical"}, {"removed": "NEW", "field_name": "status", "added": "ASSIGNED"}, {"removed": "", "field_name": "cc", "added": "jwalden+bmo@mit.edu"}, {"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "jwalden+bmo@mit.edu"}], "who": "jwalden+bmo@mit.edu", "when": "2016-12-07T04:02:38Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8818160, "added": "review?(sphink@gmail.com)"}], "who": "jwalden+bmo@mit.edu", "when": "2016-12-13T04:25:25Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(sphink@gmail.com)", "attachment_id": 8818160, "added": "review+"}], "who": "sphink@gmail.com", "when": "2016-12-13T18:38:31Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8818424, "added": "review?(sphink@gmail.com)"}], "who": "jwalden+bmo@mit.edu", "when": "2016-12-14T01:51:49Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8818425, "added": "review?(sphink@gmail.com)"}], "who": "jwalden+bmo@mit.edu", "when": "2016-12-14T01:53:58Z"}, {"changes": [{"removed": "---", "field_name": "cf_status_firefox51", "added": "affected"}, {"removed": "---", "field_name": "cf_status_firefox52", "added": "affected"}, {"removed": "---", "field_name": "cf_status_firefox53", "added": "affected"}, {"removed": "---", "field_name": "cf_status_firefox_esr45", "added": "affected"}], "who": "lhenry@mozilla.com", "when": "2016-12-21T18:07:16Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "abillings@mozilla.com"}, {"removed": "---", "field_name": "cf_tracking_firefox51", "added": "+"}, {"removed": "---", "field_name": "cf_tracking_firefox52", "added": "+"}, {"removed": "---", "field_name": "cf_tracking_firefox53", "added": "+"}, {"removed": "---", "field_name": "cf_tracking_firefox_esr45", "added": "51+"}], "who": "abillings@mozilla.com", "when": "2016-12-21T18:07:37Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(sphink@gmail.com)", "attachment_id": 8818424, "added": "review+"}], "who": "sphink@gmail.com", "when": "2016-12-30T05:35:27Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(sphink@gmail.com)", "attachment_id": 8818425, "added": "review+"}], "who": "sphink@gmail.com", "when": "2016-12-30T18:26:32Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8818424, "added": "sec-approval?"}], "who": "jwalden+bmo@mit.edu", "when": "2016-12-30T18:38:35Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "sec-approval?", "attachment_id": 8818424, "added": "sec-approval+"}], "who": "abillings@mozilla.com", "when": "2016-12-30T21:10:43Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8818424, "added": "approval-mozilla-aurora?"}], "who": "jwalden+bmo@mit.edu", "when": "2016-12-31T03:05:53Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8819444, "added": "approval-mozilla-beta?"}], "who": "jwalden+bmo@mit.edu", "when": "2016-12-31T03:06:09Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8819445, "added": "approval-mozilla-esr45?"}], "who": "jwalden+bmo@mit.edu", "when": "2016-12-31T03:07:57Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8818424, "added": "1"}, {"field_name": "flagtypes.name", "removed": "approval-mozilla-aurora?", "attachment_id": 8818424, "added": ""}], "who": "jwalden+bmo@mit.edu", "when": "2017-01-04T00:43:20Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8819444, "added": "1"}, {"field_name": "flagtypes.name", "removed": "approval-mozilla-beta?", "attachment_id": 8819444, "added": ""}], "who": "jwalden+bmo@mit.edu", "when": "2017-01-04T00:43:40Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8819445, "added": "1"}, {"field_name": "flagtypes.name", "removed": "approval-mozilla-esr45?", "attachment_id": 8819445, "added": ""}], "who": "jwalden+bmo@mit.edu", "when": "2017-01-04T00:43:53Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "1", "attachment_id": 8818424, "added": "0"}], "who": "jwalden+bmo@mit.edu", "when": "2017-01-04T23:00:44Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8823480, "added": "approval-mozilla-aurora?"}], "who": "jwalden+bmo@mit.edu", "when": "2017-01-04T23:02:05Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8823481, "added": "approval-mozilla-beta?"}], "who": "jwalden+bmo@mit.edu", "when": "2017-01-04T23:02:56Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8823482, "added": "approval-mozilla-esr45?"}], "who": "jwalden+bmo@mit.edu", "when": "2017-01-04T23:03:25Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "approval-mozilla-aurora?", "attachment_id": 8823480, "added": "approval-mozilla-aurora+"}], "who": "jcristau@mozilla.com", "when": "2017-01-05T08:55:18Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "approval-mozilla-esr45?", "attachment_id": 8823482, "added": "approval-mozilla-esr45+"}], "who": "jcristau@mozilla.com", "when": "2017-01-05T08:55:34Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "approval-mozilla-beta?", "attachment_id": 8823481, "added": "approval-mozilla-beta+"}], "who": "jcristau@mozilla.com", "when": "2017-01-05T08:56:30Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "cbook@mozilla.com"}, {"removed": "affected", "field_name": "cf_status_firefox51", "added": "fixed"}, {"removed": "affected", "field_name": "cf_status_firefox52", "added": "fixed"}, {"removed": "affected", "field_name": "cf_status_firefox_esr45", "added": "fixed"}], "who": "cbook@mozilla.com", "when": "2017-01-05T09:26:51Z"}, {"changes": [{"removed": "ASSIGNED", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "cc", "added": "wkocher@mozilla.com"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla53"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2017-01-06 01:37:30"}, {"removed": "affected", "field_name": "cf_status_firefox53", "added": "fixed"}], "who": "kwierso@gmail.com", "when": "2017-01-06T01:37:30Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "sledru@mozilla.com"}, {"removed": "affected", "field_name": "cf_status_firefox50", "added": "wontfix"}], "who": "sledru@mozilla.com", "when": "2017-01-06T13:11:27Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "mwobensmith@mozilla.com"}, {"removed": "", "field_name": "whiteboard", "added": "[post-critsmash-triage]"}, {"removed": "", "field_name": "flagtypes.name", "added": "qe-verify+"}], "who": "mwobensmith@mozilla.com", "when": "2017-01-09T15:28:10Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "andrei.vaida@softvision.ro, florin.mezei@softvisioninc.eu"}], "who": "mwobensmith@mozilla.com", "when": "2017-01-10T18:29:25Z"}, {"changes": [{"removed": "RESOLVED", "field_name": "status", "added": "VERIFIED"}, {"removed": "", "field_name": "cc", "added": "kjozwiak@mozilla.com"}, {"removed": "fixed", "field_name": "cf_status_firefox51", "added": "verified"}, {"removed": "fixed", "field_name": "cf_status_firefox52", "added": "verified"}, {"removed": "fixed", "field_name": "cf_status_firefox53", "added": "verified"}, {"removed": "fixed", "field_name": "cf_status_firefox_esr45", "added": "verified"}], "who": "kamiljoz@gmail.com", "when": "2017-01-11T04:48:46Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "evilpies@gmail.com"}], "who": "jwalden+bmo@mit.edu", "when": "2017-01-11T21:21:46Z"}, {"changes": [{"removed": "javascript-core-security", "field_name": "groups", "added": "core-security-release"}], "who": "dveditz@mozilla.com", "when": "2017-01-12T01:23:53Z"}, {"changes": [{"removed": "[post-critsmash-triage]", "field_name": "whiteboard", "added": "[post-critsmash-triage][adv-main51+][adv-esr45.7+]"}], "who": "abillings@mozilla.com", "when": "2017-01-17T20:20:07Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "fbraun@mozilla.com"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(sphink@gmail.com), sec-bounty?"}], "who": "fbraun@mozilla.com", "when": "2017-01-25T19:09:16Z"}, {"changes": [{"removed": "needinfo?(sphink@gmail.com)", "field_name": "flagtypes.name", "added": ""}], "who": "sphink@gmail.com", "when": "2017-01-25T19:14:32Z"}, {"changes": [{"removed": "sec-bounty?", "field_name": "flagtypes.name", "added": "sec-bounty+"}], "who": "dveditz@mozilla.com", "when": "2017-01-30T18:44:37Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "mark@wolfbeast.com"}], "who": "dveditz@mozilla.com", "when": "2017-02-01T02:19:53Z"}, {"changes": [{"removed": "core-security-release", "field_name": "groups", "added": ""}], "who": "dveditz@mozilla.com", "when": "2017-08-28T20:37:33Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "in-testsuite+"}], "who": "jwalden+bmo@mit.edu", "when": "2018-05-30T21:17:42Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "regression"}, {"removed": "", "field_name": "cc", "added": "mcastelluccio@mozilla.com"}], "who": "mcastelluccio@mozilla.com", "when": "2018-06-07T13:49:46Z"}], "cf_status_firefox_esr45": "verified", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "keywords": ["csectype-bounds", "regression", "sec-critical"], "component": "JavaScript Engine", "summary": "Assertion failure: byteOffset + byteLength <= arrayBuffer->byteLength(), at js/src/vm/TypedArrayObject.cpp:1418", "cf_status_firefox52": "verified", "cf_last_resolved": "2017-01-06T01:37:30Z", "cf_status_firefox50": "wontfix", "cf_tracking_firefox61": "---", "votes": 0, "classification": "Components", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 40, "comments": [{"text": "m-c 679118259e91\n\nMarked as s-s because it involves detached array buffers.\n\n\nAssertion failure:\n---\nAssertion failure: byteOffset + byteLength <= arrayBuffer->byteLength(), at /home/andre/git/mozilla-central/js/src/vm/TypedArrayObject.cpp:1418\n---\n\n\nTest case:\n---\nvar buffer = new ArrayBuffer(10);\nvar newTarget = Object.defineProperty(function(){}.bind(), \"prototype\", {\n    get() {\n        detachArrayBuffer(buffer, \"same-data\");\n        return DataView.prototype;\n    }\n})\nReflect.construct(DataView, [buffer, 0, 1], newTarget);\n---\n\n\nBack trace:\n---\n0x0000000000e29749 in js::DataViewObject::create (cx=0x7ffff6960000, byteOffset=0, byteLength=1, arrayBuffer=..., protoArg=0x7ffff7e80080)\n    at /home/andre/git/mozilla-central/js/src/vm/TypedArrayObject.cpp:1418\n1418\t    MOZ_ASSERT(byteOffset + byteLength <= arrayBuffer->byteLength());\n(gdb) bt\n#0  0x0000000000e29749 in js::DataViewObject::create (cx=0x7ffff6960000, byteOffset=0, byteLength=1, arrayBuffer=..., protoArg=0x7ffff7e80080)\n    at /home/andre/git/mozilla-central/js/src/vm/TypedArrayObject.cpp:1418\n#1  0x0000000000e29fb5 in js::DataViewObject::constructSameCompartment (cx=0x7ffff6960000, bufobj=..., args=...) at /home/andre/git/mozilla-central/js/src/vm/TypedArrayObject.cpp:1522\n#2  0x0000000000e2a68a in js::DataViewObject::class_constructor (cx=0x7ffff6960000, argc=3, vp=0x7fffffffc8c8) at /home/andre/git/mozilla-central/js/src/vm/TypedArrayObject.cpp:1604\n#3  0x0000000000d0fdc8 in js::CallJSNative (cx=0x7ffff6960000, native=0xe2a558 <js::DataViewObject::class_constructor(JSContext*, unsigned int, JS::Value*)>, args=...)\n    at /home/andre/git/mozilla-central/js/src/jscntxtinlines.h:232\n#4  0x0000000000d0ff25 in js::CallJSNativeConstructor (cx=0x7ffff6960000, native=0xe2a558 <js::DataViewObject::class_constructor(JSContext*, unsigned int, JS::Value*)>, args=...)\n    at /home/andre/git/mozilla-central/js/src/jscntxtinlines.h:265\n#5  0x0000000000ce8132 in InternalConstruct (cx=0x7ffff6960000, args=...) at /home/andre/git/mozilla-central/js/src/vm/Interpreter.cpp:544\n#6  0x0000000000ce84ab in js::Construct (cx=0x7ffff6960000, fval=..., args=..., newTarget=..., objp=...) at /home/andre/git/mozilla-central/js/src/vm/Interpreter.cpp:595\n#7  0x0000000000ed95ac in Reflect_construct (cx=0x7ffff6960000, argc=3, vp=0x7ffff3e3f090) at /home/andre/git/mozilla-central/js/src/builtin/Reflect.cpp:113\n#8  0x0000000000d0fdc8 in js::CallJSNative (cx=0x7ffff6960000, native=0xed932a <Reflect_construct(JSContext*, unsigned int, JS::Value*)>, args=...)\n    at /home/andre/git/mozilla-central/js/src/jscntxtinlines.h:232\n#9  0x0000000000ce7a1a in js::InternalCallOrConstruct (cx=0x7ffff6960000, args=..., construct=js::NO_CONSTRUCT) at /home/andre/git/mozilla-central/js/src/vm/Interpreter.cpp:453\n#10 0x0000000000ce7d5b in InternalCall (cx=0x7ffff6960000, args=...) at /home/andre/git/mozilla-central/js/src/vm/Interpreter.cpp:498\n#11 0x0000000000ce7d99 in js::CallFromStack (cx=0x7ffff6960000, args=...) at /home/andre/git/mozilla-central/js/src/vm/Interpreter.cpp:504\n#12 0x0000000000cf5309 in Interpret (cx=0x7ffff6960000, state=...) at /home/andre/git/mozilla-central/js/src/vm/Interpreter.cpp:2873\n#13 0x0000000000ce7673 in js::RunScript (cx=0x7ffff6960000, state=...) at /home/andre/git/mozilla-central/js/src/vm/Interpreter.cpp:399\n#14 0x0000000000ce8c00 in js::ExecuteKernel (cx=0x7ffff6960000, script=..., scopeChainArg=..., newTargetValue=..., evalInFrame=..., result=0x0)\n    at /home/andre/git/mozilla-central/js/src/vm/Interpreter.cpp:679\n#15 0x0000000000ce8ee9 in js::Execute (cx=0x7ffff6960000, script=..., scopeChainArg=..., rval=0x0) at /home/andre/git/mozilla-central/js/src/vm/Interpreter.cpp:712\n#16 0x0000000000a42a8c in ExecuteScript (cx=0x7ffff6960000, scope=..., script=..., rval=0x0) at /home/andre/git/mozilla-central/js/src/jsapi.cpp:4313\n#17 0x0000000000a42e96 in JS_ExecuteScript (cx=0x7ffff6960000, scriptArg=...) at /home/andre/git/mozilla-central/js/src/jsapi.cpp:4346\n#18 0x0000000000436910 in RunFile (cx=0x7ffff6960000, filename=0x7fffffffdfd1 \"/tmp/g.js\", file=0x7ffff3e3b000, compileOnly=false) at /home/andre/git/mozilla-central/js/src/shell/js.cpp:539\n#19 0x0000000000437cd6 in Process (cx=0x7ffff6960000, filename=0x7fffffffdfd1 \"/tmp/g.js\", forceTTY=false, kind=FileScript) at /home/andre/git/mozilla-central/js/src/shell/js.cpp:860\n#20 0x000000000044e941 in ProcessArgs (cx=0x7ffff6960000, op=0x7fffffffd9a0) at /home/andre/git/mozilla-central/js/src/shell/js.cpp:6788\n#21 0x000000000044ff27 in Shell (cx=0x7ffff6960000, op=0x7fffffffd9a0, envp=0x7fffffffdbb0) at /home/andre/git/mozilla-central/js/src/shell/js.cpp:7137\n#22 0x00000000004514ae in main (argc=2, argv=0x7fffffffdb98, envp=0x7fffffffdbb0) at /home/andre/git/mozilla-central/js/src/shell/js.cpp:7518\n---", "author": "andrebargull@googlemail.com", "id": 11538450, "time": "2016-07-11T14:13:58Z"}, {"text": "Sounds like some kind of buffer overflow, so I'll mark it sec-high.", "author": "continuation@gmail.com", "id": 11548735, "time": "2016-07-14T17:21:52Z"}, {"text": "This is critical for the same reason bug 1285833, bug 991981, and bug 982974 were critical.\n\nI'd love to churn out a patch quickly now, but the mess of DataView construction handling, combined with a chokepoint function that's *supposed* to centralize this bounds-checking but does so too early to be usable, means it's non-trivial to fix in the ten minutes I have now.  Tonight or tomorrow.", "author": "jwalden+bmo@mit.edu", "id": 11908300, "time": "2016-12-07T04:02:38Z"}, {"text": "Created attachment 8818160\nJust enter the wrapped ArrayBuffer's compartment when doing |new DataView(alienBuf)|, rather than calling an intrinsic\n\nThis helps with understanding this code, and I think it may help with the next step of actually fixing this bug.  (But I'm not 100% certain of that yet, as I haven't written a fix yet, and I think there's a chance this needs a spec change -- although we may need a stopgap in advance of the spec being updated.)", "author": "jwalden+bmo@mit.edu", "id": 11915472, "time": "2016-12-13T04:25:25Z"}, {"text": "Comment on attachment 8818160\nJust enter the wrapped ArrayBuffer's compartment when doing |new DataView(alienBuf)|, rather than calling an intrinsic\n\nReview of attachment 8818160:\n-----------------------------------------------------------------\n\nI agree, this is far easier to follow.\n\n::: js/src/vm/TypedArrayObject.h\n@@ +447,5 @@\n>      defineGetter(JSContext* cx, PropertyName* name, HandleNativeObject proto);\n>  \n> +    static bool\n> +    getAndCheckConstructorArgs(JSContext* cx, HandleObject bufobj, const CallArgs& args,\n> +                               uint32_t *byteOffset, uint32_t* byteLength);\n\nAs long as you're here... uint32_t* byteOffset", "author": "sphink@gmail.com", "id": 11916580, "time": "2016-12-13T18:38:31Z"}, {"text": "Created attachment 8818424\nNon-spec-compliant spot-fix\n\nI think there's a good chance there should be one final is-detached check after the GetPrototypeFromConstructor in the spec, and this is a spec bug.  I have a patch implementing that, but it's super-finicky to set up a DataView backed by a detached ArrayBuffer, that faithfully implements the exact state that would happen if a DataView's underlying buffer were detached *after* DataView creation.  So maybe let's do a spot-fix.  (Also we can't really get the spec changed publicly without potentially tipping our hand as to exploitability.)  If the spec *doesn't* end up changing, my more-involved fix can be taken, at leisure.\n\nThis also has the small benefit of obscuring the patch slightly, but it doesn't take much to see DVO::create calls are immediately preceded by potentially-reentrant code, if you know the trick to make GetPrototypeFromConstructor invoke user-provided code.  So it's better than a well-commented fix, but still unideal.\n\nAssuming this lands, the prior patch -- still a good idea -- will move to a separate bug.", "author": "jwalden+bmo@mit.edu", "id": 11917474, "time": "2016-12-14T01:51:49Z"}, {"text": "Created attachment 8818425\nTest for non-compliant behavior", "author": "jwalden+bmo@mit.edu", "id": 11917481, "time": "2016-12-14T01:53:58Z"}, {"text": "Created attachment 8818428\nMake the test actually check spec behavior (mostly)\n\nFor the record, here's a patch to make the test check for closer to (buggy?-)spec-compliant behavior, if needed.", "author": "jwalden+bmo@mit.edu", "id": 11917500, "time": "2016-12-14T02:16:39Z"}, {"text": "Created attachment 8818430\nImplement closer to spec-compliant, but pretty finicky, behavior\n\nEmulating the exact state of a DV backed by a detached ArrayBuffer, as this patch does, is pretty scary.  Hopefully we won't need this.", "author": "jwalden+bmo@mit.edu", "id": 11917504, "time": "2016-12-14T02:18:15Z"}, {"text": "Created attachment 8819444\nSpot fix for beta", "author": "jwalden+bmo@mit.edu", "id": 11925166, "time": "2016-12-16T22:43:49Z"}, {"text": "Created attachment 8819445\nSpot fix for ESR45", "author": "jwalden+bmo@mit.edu", "id": 11925174, "time": "2016-12-16T22:47:14Z"}, {"text": "The patch against trunk works on Aurora as well.  Beta/ESR need slightly tweaked patches, just uploaded.  Will wait for r+ and sec-approval on the trunk patch before requesting branch approvals, then once we have that we can figure out how/when to land this stuff, in coordinated fashion, so as to minimize exposure time.", "author": "jwalden+bmo@mit.edu", "id": 11925177, "time": "2016-12-16T22:48:29Z"}, {"text": "Comment on attachment 8818424\nNon-spec-compliant spot-fix\n\nReview of attachment 8818424:\n-----------------------------------------------------------------\n\nAt least this is a very straightforward fix. Sorry for the delay; this slipped through the cracks.", "author": "sphink@gmail.com", "id": 11947940, "time": "2016-12-30T05:35:27Z"}, {"text": "Comment on attachment 8818425\nTest for non-compliant behavior\n\nReview of attachment 8818425:\n-----------------------------------------------------------------\n\n::: js/src/tests/ecma_6/extensions/dataview-detach-after-construction.js\n@@ +1,1 @@\n> +// |reftest| skip-if(!xulRuntime.shell) -- needs detachArrayBuffer\n\nIf it's a backport issue, detachArrayBuffer can be done with serialize(buffer, [buffer])", "author": "sphink@gmail.com", "id": 11948725, "time": "2016-12-30T18:26:32Z"}, {"text": "Comment on attachment 8818424\nNon-spec-compliant spot-fix\n\n[Security approval request comment]\n> How easily could an exploit be constructed based on the patch?\n\nDepends how easily people track DVO::create calls backward to recognize the problematic instance.  There are only a few of them, so it's really pretty easy.\n\n> Do comments in the patch, the check-in comment, or tests included\n> in the patch paint a bulls-eye on the security problem?\n\nThe test would, but that's not landing for awhile, of course.  The patch itself adds an is-detached check that clearly guards a bunch of array accesses, so it's pretty close to a bulls-eye (if not exactly one).  Worth landing as late as possible in a cycle, IMO.\n\n> Which older supported branches are affected by this flaw?\n> If not all supported branches, which bug introduced the flaw?\n> Do you have backports for the affected branches? If not, how\n> different, hard to create, and risky will they be?\n\nBackports all but painless, attached already.\n\n> How likely is this patch to cause regressions; how much testing\n> does it need?\n\nVery unlikely.  DVO::create can already throw, this just introduces another way, and the check guarding the throw is dead-simple.  The automated test in attachment 8818425 should be adequate testing.", "author": "jwalden+bmo@mit.edu", "id": 11948748, "time": "2016-12-30T18:38:35Z"}, {"text": "Comment on attachment 8818424\nNon-spec-compliant spot-fix\n\nsec-approval+ for trunk. Please nominate the backport patches when you have a chance.", "author": "abillings@mozilla.com", "id": 11948996, "time": "2016-12-30T21:10:43Z"}, {"text": "Comment on attachment 8818424\nNon-spec-compliant spot-fix\n\nApproval Request Comment\n[Feature/Bug causing the regression]: bug 1055472, introducing DataView subclassing\n[User impact if declined]: sec-critical\n[Is this code covered by automated tests?]: We have one here, but we can't well land it in advance of this.\n[Has the fix been verified in Nightly?]: Not landed yet, but it fixed the test attached here.\n[Needs manual test from QE? If yes, steps to reproduce]: Automated test should cover it.\n[List of other uplifts needed for the feature/fix]: No.\n[Is the change risky?]: Not really, per comment 14.\n[Why is the change risky/not risky?]: See comment 14.\n[String changes made/needed]: N/A", "author": "jwalden+bmo@mit.edu", "id": 11949291, "time": "2016-12-31T03:05:53Z"}, {"text": "Comment on attachment 8819445\nSpot fix for ESR45\n\n[Approval Request Comment]\nIf this is not a sec:{high,crit} bug, please state case for ESR consideration: sec-critical\nUser impact if declined: Do you want a known pwn2own-level vulnerability in the product?  :-)\nFix Landed on Version: hasn't yet, will be 51\nRisk to taking this patch (and alternatives if risky): Not really, see comment 14, comment 16.\nString or UUID changes made by this patch: N/A", "author": "jwalden+bmo@mit.edu", "id": 11949294, "time": "2016-12-31T03:07:57Z"}, {"text": "Created attachment 8823480\nAurora backport", "author": "jwalden+bmo@mit.edu", "id": 11954671, "time": "2017-01-04T00:43:14Z"}, {"text": "Created attachment 8823481\nBeta backport", "author": "jwalden+bmo@mit.edu", "id": 11954673, "time": "2017-01-04T00:43:31Z"}, {"text": "Created attachment 8823482\nESR45 backport", "author": "jwalden+bmo@mit.edu", "id": 11954674, "time": "2017-01-04T00:43:45Z"}, {"text": "Comment on attachment 8818424\nNon-spec-compliant spot-fix\n\nOops, I just blew away a bunch of stuff that had approvals pending because I thought I hadn't uploaded them.  Reverting the obsoletion here.  Because the new patches are direct from my tree-clones (so no changes would be needed to land them), I'll set approval flags on them rather than on the originals.", "author": "jwalden+bmo@mit.edu", "id": 11957638, "time": "2017-01-04T23:00:44Z"}, {"text": "Comment on attachment 8823480\nAurora backport\n\nSee comment 16.", "author": "jwalden+bmo@mit.edu", "id": 11957640, "time": "2017-01-04T23:02:05Z"}, {"text": "Comment on attachment 8823481\nBeta backport\n\nSee comment 16.", "author": "jwalden+bmo@mit.edu", "id": 11957647, "time": "2017-01-04T23:02:56Z"}, {"text": "Comment on attachment 8823482\nESR45 backport\n\nSee comment 17.", "author": "jwalden+bmo@mit.edu", "id": 11957650, "time": "2017-01-04T23:03:25Z"}, {"text": "Landed on inbound.\n\nhttps://hg.mozilla.org/integration/mozilla-inbound/rev/bd0516d2e04a\n\nMy general preference is to do a coordinated landing across all branches at once to minimize exposure time, wherever possible for 1) sufficiently-simple patches where baking on trunk is unlikely to give any new information 2) that have serious security implications best left unpublicized by public fixing, for as long as possible.  (And this bug/fix certainly qualify as such.)  However, rumor has it that patches that haven't landed don't always get quite as prompt branch-approval, and we're running close on deadlines for the various branches, so I jumped the gun against my usual preference.  :-\\  (That said, the holiday/weekend timeframe probably played a part in any \"delay\" in this particular case.)", "author": "jwalden+bmo@mit.edu", "id": 11958080, "time": "2017-01-05T03:05:58Z"}, {"text": "Comment on attachment 8823480\nAurora backport\n\nsec-critical fix for aurora52", "author": "jcristau@mozilla.com", "id": 11958497, "time": "2017-01-05T08:55:18Z"}, {"text": "Comment on attachment 8823482\nESR45 backport\n\nsec-critical fix for esr45", "author": "jcristau@mozilla.com", "id": 11958499, "time": "2017-01-05T08:55:34Z"}, {"text": "Comment on attachment 8823481\nBeta backport\n\nsec-critical fix for 51beta, should probably go in today's b12 build", "author": "jcristau@mozilla.com", "id": 11958500, "time": "2017-01-05T08:56:30Z"}, {"text": "(In reply to Jeff Walden [:Waldo] (remove +bmo to email) from comment #25)\n> Landed on inbound.\n> \n> https://hg.mozilla.org/integration/mozilla-inbound/rev/bd0516d2e04a\n> \n> My general preference is to do a coordinated landing across all branches at\n> once to minimize exposure time, wherever possible\n\nno problem at all, landed this in \n\nhttps://hg.mozilla.org/releases/mozilla-aurora/rev/4f7d41ab5f850f84b3a62b421c9474b30830f115\nhttps://hg.mozilla.org/releases/mozilla-esr45/rev/2732280adabc44ed3946b67786ec8f277db5a71f\n https://hg.mozilla.org/releases/mozilla-beta/rev/9a604441509654bd2bddc031545f4c7ae1787bd7", "author": "cbook@mozilla.com", "id": 11958603, "time": "2017-01-05T09:26:51Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/bd0516d2e04a", "author": "kwierso@gmail.com", "id": 11961103, "time": "2017-01-06T01:37:30Z"}, {"text": "I reproduced the original issue using the poc from comment#0 using revision 679118259e91:\n\n* Assertion failure: byteOffset + byteLength <= arrayBuffer->byteLength(), at /home/kjozwiak/mozcode/mozilla-central/js/src/vm/TypedArrayObject.cpp:1418\n\nOnce I managed to reproduced the original issue, I went through verification using the test case from comment#0 with the following builds:\n\n* fx53, rev: 20094311ab5e\n* fx52, rev: d173a8f450cf\n* fx51, rev: 95d20a617288\n* fx45esr, rev: 0521b0e4707c\n\nAll four of the above builds generated the following error:\n\n/home/kjozwiak/Desktop/fixedpoc.js:8:1 TypeError: attempting to access detached ArrayBuffer\nStack:\n  @/home/kjozwiak/Desktop/fixedpoc.js:8:1\n\nAs per bug#1285833comment#19, I removed the \"same-data\" argument from |detachArrayBuffer| when running through the test case using fx53, fx52 and fx51. For fx45esr, I renamed the |detachArrayBuffer| function to |neuter|.", "author": "kamiljoz@gmail.com", "id": 11972909, "time": "2017-01-11T04:48:46Z"}, {"text": "evilpie: attachment 8818430 fixes bug 1317382, but the breadth of that fix -- and the possibility that DataView should check its provided ArrayBuffer for detaching a second time -- meant that wasn't a good patch to land for a fast/safe/backportable fix.  Right now, I'm inclined to raise a spec issue once we've fixed this everywhere and given it time for people to update -- a month or so, maybe more -- and then that patch (suitably modified in response to any spec discussion) could land.\n\nWhich is *maybe* a way of saying you shouldn't take that bug, I guess?  But it's moderately unsatisfying to just sit on this work, and delay fixing that bug, just because of security stuff and spec chicaneries.  :-\\", "author": "jwalden+bmo@mit.edu", "id": 11975431, "time": "2017-01-11T21:21:46Z"}, {"text": "I filed bug 1329046 for cleaning up the DataView creation-with-compartments code, without its being entangled it in a security bug.  That bug's attachment 8824264 is identical to this bug's attachment 8818160, except to the extent of being generated more recently and possibly having been rebased some.  (Haven't written a similar linking comment in that bug, so as not to draw attention to a security issue in the code.)", "author": "jwalden+bmo@mit.edu", "id": 11975744, "time": "2017-01-11T22:54:51Z"}, {"text": ":sfink suggests this should be taken into consideration for a bounty, can you please elaborate in more detail? :)", "author": "fbraun@mozilla.com", "id": 12010536, "time": "2017-01-25T19:09:16Z"}, {"text": "(In reply to Frederik Braun [:freddyb] from comment #34)\n> :sfink suggests this should be taken into consideration for a bounty, can\n> you please elaborate in more detail? :)\n\nThis is similar to a pretty major bug that was exploited in pwn2own, it wouldn't be horribly hard to find if you were looking in nearby places, yet we hadn't noticed the similarity in the code before anba uncovered it by going through the spec. Oh, and once you spot it, it's easy to exploit. So it seems like it was pretty ripe for causing us some major trouble. And I wasn't sure if anba normally requests bounties on his own.", "author": "sphink@gmail.com", "id": 12010557, "time": "2017-01-25T19:14:32Z"}, {"text": "(In reply to Steve Fink [:sfink] [:s:] from comment #35)\n> And I wasn't sure if anba normally requests bounties on his own.\n\nNo, I don't. (I didn't even know that it's possible to self-request bounties!)", "author": "andrebargull@googlemail.com", "id": 12010580, "time": "2017-01-25T19:25:09Z"}, {"text": "Details on the client bounty program are at https://www.mozilla.org/en-US/security/client-bug-bounty/ (linked to from www.mozilla.org/security/ )\n\nFrom the page:\n\nClaiming a Bug Bounty\n\nTo claim a bounty:\n\n    Make sure you have a Bugzilla account\n    File a bug at bugzilla.mozilla.org describing the security issue.\n    When creating the bug, be sure to check the box near the bottom of the entry form that marks this bug report as confidential.\n    Attach a \"proof of concept\" testcase, or point to explicit code that identifies the vulnerability or exploit. While not required, such a testcase will help us judge submissions more quickly and accurately.\n    If you have debug output or output from a tool demonstrating the issue, please include it in the bug. (If it is very long, please attach it to the bug as an attached file.)\n    Notify the Mozilla Security Group by email to security@mozilla.org and include the number of the bug you filed and a brief summary of the issue.\n\nPer the last line, people can (and normally should) self-request bounties by emailing security@mozilla.org once they file a security bug if they want to be considered for it.", "author": "abillings@mozilla.com", "id": 12013923, "time": "2017-01-26T19:30:10Z"}, {"text": "I filed https://github.com/tc39/ecma262/pull/1025 as followup on changing the spec algorithm somehow.  Don't know yet the precise approach that the spec might take to address this, but I *think* if they do what the PR currently proposes, it would be identical to the change made here.  (But someone would have to double-check that.)", "author": "jwalden+bmo@mit.edu", "id": 12806822, "time": "2017-10-31T21:41:43Z"}, {"text": "Testcase landed:\n\nhttps://github.com/tc39/test262/pull/1504/commits/ba783aef9138c6a952b058e1a34ea7566f3ae74b\nhttps://searchfox.org/mozilla-central/source/js/src/tests/test262/built-ins/DataView/custom-proto-access-detaches-buffer.js", "author": "jwalden+bmo@mit.edu", "id": 13375774, "time": "2018-05-30T21:17:42Z"}], "id": 1285960, "priority": "--", "cc": ["abillings@mozilla.com", "andrei.vaida@softvision.ro", "cbook@mozilla.com", "choller@mozilla.com", "continuation@gmail.com", "evilpies@gmail.com", "fbraun@mozilla.com", "florin.mezei@softvisioninc.eu", "jdemooij@mozilla.com", "jwalden+bmo@mit.edu", "kamiljoz@gmail.com", "kwierso@gmail.com", "mark@wolfbeast.com", "mcastelluccio@mozilla.com", "mwobensmith@mozilla.com", "sledru@mozilla.com", "sphink@gmail.com"], "cf_crash_signature": "", "version": "Trunk", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "see_also": [], "cf_status_firefox51": "verified", "cf_platform_rel": "---", "product": "Core", "cf_fx_iteration": "---", "blocks": [], "qa_contact": "", "creation_time": "2016-07-11T14:13:58Z", "cf_status_firefox_esr52": "---", "cf_tracking_firefox_esr45": "51+", "assigned_to_detail": {"email": "jwalden+bmo@mit.edu", "id": 83595, "name": "jwalden+bmo@mit.edu", "real_name": "Jeff Walden [:Waldo]"}, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "---", "cf_status_firefox_esr60": "---", "cf_status_firefox60": "---", "target_milestone": "mozilla53", "cf_rank": null, "is_cc_accessible": true, "severity": "normal", "groups": [], "cf_status_thunderbird_esr52": "---", "cf_fx_points": "---", "cf_status_thunderbird_esr60": "---", "url": "", "resolution": "FIXED", "creator_detail": {"email": "andrebargull@googlemail.com", "id": 339940, "name": "andrebargull@googlemail.com", "real_name": "Andr\u00e9 Bargull [:anba]"}, "whiteboard": "[post-critsmash-triage][adv-main51+][adv-esr45.7+]", "mentors": [], "cc_detail": [{"email": "abillings@mozilla.com", "id": 280903, "name": "abillings@mozilla.com", "real_name": "Al Billings [:abillings]"}, {"email": "andrei.vaida@softvision.ro", "id": 488993, "name": "andrei.vaida@softvision.ro", "real_name": "Andrei Vaida [:avaida] \u2013 please ni? me"}, {"email": "cbook@mozilla.com", "id": 277293, "name": "cbook@mozilla.com", "real_name": "Carsten Book [:Tomcat]"}, {"email": "choller@mozilla.com", "id": 395101, "name": "choller@mozilla.com", "real_name": "Christian Holler (:decoder)"}, {"email": "continuation@gmail.com", "id": 406194, "name": "continuation@gmail.com", "real_name": "Andrew McCreight [:mccr8]"}, {"email": "evilpies@gmail.com", "id": 393835, "name": "evilpies@gmail.com", "real_name": "Tom Schuster [:evilpie]"}, {"email": "fbraun@mozilla.com", "id": 428608, "name": "fbraun@mozilla.com", "real_name": "Frederik Braun [:freddyb] (Unavailable until August 20th)"}, {"email": "florin.mezei@softvisioninc.eu", "id": 500713, "name": "florin.mezei@softvisioninc.eu", "real_name": "Florin Mezei, QA (:FlorinMezei)"}, {"email": "jdemooij@mozilla.com", "id": 375297, "name": "jdemooij@mozilla.com", "real_name": "Jan de Mooij [:jandem]"}, {"email": "jwalden+bmo@mit.edu", "id": 83595, "name": "jwalden+bmo@mit.edu", "real_name": "Jeff Walden [:Waldo]"}, {"email": "kamiljoz@gmail.com", "id": 455785, "name": "kamiljoz@gmail.com", "real_name": "Kamil Jozwiak [:kjozwiak]"}, {"email": "kwierso@gmail.com", "id": 308534, "name": "kwierso@gmail.com", "real_name": "Wes Kocher (:KWierso)"}, {"email": "mark@wolfbeast.com", "id": 364942, "name": "mark@wolfbeast.com", "real_name": "Mark Straver"}, {"email": "mcastelluccio@mozilla.com", "id": 420453, "name": "mcastelluccio@mozilla.com", "real_name": "Marco Castelluccio [:marco]"}, {"email": "mwobensmith@mozilla.com", "id": 452604, "name": "mwobensmith@mozilla.com", "real_name": "Matt Wobensmith [:mwobensmith][:matt:]"}, {"email": "sledru@mozilla.com", "id": 495955, "name": "sledru@mozilla.com", "real_name": "Sylvestre Ledru [:sylvestre]"}, {"email": "sphink@gmail.com", "id": 359004, "name": "sphink@gmail.com", "real_name": "Steve Fink [:sfink] [:s:] (PTO June 31)"}], "cf_status_firefox61": "---", "alias": null, "dupe_of": null, "flags": [{"status": "+", "name": "sec-bounty", "modification_date": "2017-01-30T18:44:37Z", "type_id": 803, "creation_date": "2017-01-25T19:09:16Z", "id": 1517787, "setter": "dveditz@mozilla.com"}, {"status": "+", "name": "in-testsuite", "modification_date": "2018-05-30T21:17:42Z", "type_id": 37, "creation_date": "2018-05-30T21:17:42Z", "id": 1763841, "setter": "jwalden+bmo@mit.edu"}, {"status": "+", "name": "qe-verify", "modification_date": "2017-01-09T15:28:10Z", "type_id": 864, "creation_date": "2017-01-09T15:28:10Z", "id": 1508574, "setter": "mwobensmith@mozilla.com"}], "last_change_time": "2018-06-07T13:49:46Z", "assigned_to": "jwalden+bmo@mit.edu", "cf_status_firefox53": "verified", "is_open": false, "cf_tracking_thunderbird_esr60": "---", "cf_tracking_firefox52": "+", "cf_tracking_firefox51": "+", "op_sys": "Unspecified", "cf_tracking_firefox53": "+", "cf_blocking_fennec": "---"}