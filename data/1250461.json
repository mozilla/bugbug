{"cf_tracking_thunderbird_esr52": "---", "status": "RESOLVED", "cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "cf_tracking_firefox62": "---", "creator": "patrik.bajer@giant.cz", "mentors_detail": [], "depends_on": [], "cf_status_firefox_esr60": "---", "cf_user_story": "", "cf_status_firefox56": "wontfix", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "cf_status_firefox58": "fixed", "keywords": [], "cf_status_firefox57": "fixed", "summary": "ICC profile (Late 2015 iMac with P3 Retina display)", "cf_last_resolved": "2017-10-13T15:14:36Z", "attachments": [{"creator": "patrik.bajer@giant.cz", "is_obsolete": 0, "is_patch": 0, "flags": [], "content_type": "image/png", "id": 8722950}, {"creator": "philipn@gmail.com", "is_obsolete": 0, "is_patch": 0, "flags": [], "content_type": "image/png", "id": 8915020}, {"creator": "jmuizelaar@mozilla.com", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2017-10-10T22:01:39Z", "type_id": 4, "creation_date": "2017-10-10T21:41:56Z", "id": 1662698, "setter": "mstange@themasta.com"}, {"status": "+", "name": "approval-mozilla-beta", "modification_date": "2017-10-11T21:57:22Z", "type_id": 721, "creation_date": "2017-10-11T11:46:35Z", "id": 1663016, "setter": "lhenry@mozilla.com"}], "content_type": "text/plain", "id": 8917164}, {"creator": "philipn@gmail.com", "is_obsolete": 0, "is_patch": 0, "flags": [], "content_type": "image/png", "id": 8968675}], "votes": 3, "classification": "Components", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 27, "comments": [{"text": "User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.11; rv:45.0) Gecko/20100101 Firefox/45.0\nBuild ID: 20160221141421\n\nSteps to reproduce:\n\nOpen any website\n\n\nActual results:\n\nAll images are oversaturated. Firefox doesnt respect system dispaly ICC profile. \n\n\nExpected results:\n\nSupport ICC profiles correctly :-)", "author": "patrik.bajer@giant.cz", "id": 11187254, "time": "2016-02-23T11:10:19Z"}, {"text": "This will likely work if you set 'gfx.color_management.enablev4'. If so this is a dupe of supporting ICC v4.", "author": "b56girard@gmail.com", "id": 11188483, "time": "2016-02-23T18:15:24Z"}, {"text": "@ Benoit - I have tried it but it will not help / solve the issue.", "author": "patrik.bajer@giant.cz", "id": 11190994, "time": "2016-02-24T11:39:29Z"}, {"text": "Created attachment 8722950\nDifference of colors (oversaturation in Firefox)", "author": "patrik.bajer@giant.cz", "id": 11190995, "time": "2016-02-24T11:40:25Z"}, {"text": "I have this problem on my late 2015 wide-gamut iMac as well. Firefox seems to be completely ignoring the iMac's display profile. Which means absolutely no color management is happening and all images whether ICC-tagged or untagged are oversaturating. I've played with the gfx.color_management.mode and gfx.color_management.enablev4 settings to no avail.\n\nI found this Chromium bug which seems to describe the same symptoms (https://bugs.chromium.org/p/chromium/issues/detail?id=562951). The problem they found was that the browser was rejecting the iMac display profile because the profile contained an unexpected negative XYZ value. Their solution was to allow negative values for Macs. Seems like a good place to start looking for the problem.", "author": "blockbuster7+mozilla@gmail.com", "id": 11350608, "time": "2016-04-23T19:46:16Z"}, {"text": "I wanted to add, after looking at it further, Firefox is actually doing color management, but it's assuming the monitor is sRGB. So skin tones and other colors get oversaturated. Makes it hard to look at.", "author": "blockbuster7+mozilla@gmail.com", "id": 11354980, "time": "2016-04-26T02:55:59Z"}, {"text": "Any news on this being fixed? It's really a shame that Firefox is not doing proper color management on the mac.", "author": "kimatg@gmail.com", "id": 11475992, "time": "2016-06-09T16:30:51Z"}, {"text": "Now that all the new Macbook Pros are using wide-gamut P3 displays, this problem's scope of impact is only going to get bigger and bigger. It will cover all 4K and 5K iMacs, and all new Macbook Pros. (I would bet the 12\" Macbook will get a P3 display whenever it's next refreshed, too.)\n\nFor an explanation of Apple's wide gamut implementation and why there are negative xyz numbers, see this WWDC talk: https://developer.apple.com/videos/play/wwdc2016/712/", "author": "blockbuster7+mozilla@gmail.com", "id": 11829510, "time": "2016-11-02T00:06:06Z"}, {"text": "As of May 2017, Safari and Chrome 58 both support proper color management (Chrome doesn't yet support limiting color ranges for CSS colors but only images) on Mac with a wide-gamut P3 display.\n\nFirefox still doesn't handle color profiles properly at all, displaying all images regardless of what color profile it has embedded and colors specified by CSS oversaturated (expanded to full range of display color gamut).\n\nI think it's about time if this issue is given some more priority because more and more people are going to get their hands on a wide-gamut display, and if colors are oversaturated and inaccurate it's not something you're going to want for the users to experience.", "author": "kimatg@gmail.com", "id": 12282089, "time": "2017-05-02T13:54:00Z"}, {"text": "On my 15\" 2016 MBPro the colours are so glaringly over-saturated it hurts my eyes. As a designer I can't really use Firefox for work now\u2026 What a shame.", "author": "arglborps@icloud.com", "id": 12306879, "time": "2017-05-10T08:12:35Z"}, {"text": "Created attachment 8915020\nFF with patch (top), chrome (middle), FF without patch (bottom)", "author": "philipn@gmail.com", "id": 12727058, "time": "2017-10-04T05:22:24Z"}, {"text": "I can confirm that this is happening on my 2016 13\" MBP (P3 display), and not just for images with embedded color profiles.  The color space of all of Firefox is set to sRGB rather than the system's color profile, regardless of what color_management_* settings are chosen.\n\nThe fix:\n\nI compiled Firefox with the Chromium team's patch to qcms/src/iccread.c -- described at https://bugs.chromium.org/p/chromium/issues/detail?id=562951 -- applied.  This fixed all of the issues described in this bug.  Firefox is rejecting color profiles with negative colorant tristiumlus values. Macs with P3 displays have negative values in the ICC profile.  This patch is where the issue originated:  https://bugzilla.mozilla.org/show_bug.cgi?id=498245#c18\n\nI've attached a screenshot (attachment 8915020 ) showing the behavior.  The top window is Firefox with the patch applied, the middle window is Chrome and the bottom window is Firefox without the patch.\n\nCan someone apply the patch described at https://bugs.chromium.org/p/chromium/issues/detail?id=562951 to QCMS or fix this issue in some other way?  The patch fixes the issue.  Right now millions of people have Macs with P3 displays and are seeing oversaturated / inaccurate color in Firefox.", "author": "philipn@gmail.com", "id": 12727059, "time": "2017-10-04T05:23:44Z"}, {"text": "Milan, might we get this at least into 58, since we have a potential patch (linked to in comment 11)?\nIt sounds like this may be affecting more and more Mac users with the default MacBook out of the box.  \n\nJeff, what do you think?", "author": "lhenry@mozilla.com", "id": 12740120, "time": "2017-10-09T02:55:12Z"}, {"text": "Sounds like a plan. Will have a patch this week.", "author": "milaninbugzilla@gmail.com", "id": 12744951, "time": "2017-10-10T14:43:14Z"}, {"text": "It seems like taking this patch will be fine. I'll put it together.", "author": "jmuizelaar@mozilla.com", "id": 12745941, "time": "2017-10-10T19:17:51Z"}, {"text": "Created attachment 8917164\nDo the chrome thing", "author": "jmuizelaar@mozilla.com", "id": 12746470, "time": "2017-10-10T21:41:56Z"}, {"text": "Comment on attachment 8917164\nDo the chrome thing\n\nApproval Request Comment\n[Feature/Bug causing the regression]: 460629\n[User impact if declined]: New Macs or those with new displays will get oversaturated colours with Firefox.\n[Is this code covered by automated tests?]:\n[Has the fix been verified in Nightly?]:\n[Needs manual test from QE? If yes, steps to reproduce]: \n[List of other uplifts needed for the feature/fix]:\n[Is the change risky?]: No, this change has been in Chromium for a while now\n[Why is the change risky/not risky?]:\n[String changes made/needed]:", "author": "milaninbugzilla@gmail.com", "id": 12748075, "time": "2017-10-11T11:46:35Z"}, {"text": "Comment on attachment 8917164\nDo the chrome thing\n\nFix affecting newer Macs, doesn't look risky, let's take it for beta 8.", "author": "lhenry@mozilla.com", "id": 12750650, "time": "2017-10-11T21:57:22Z"}, {"text": " https://treeherder.mozilla.org/#/jobs?repo=try&revision=97ead3f9ad62d26536ff3979b070f5e1f53db474", "author": "jmuizelaar@mozilla.com", "id": 12750874, "time": "2017-10-11T22:47:23Z"}, {"text": "Pushed by jmuizelaar@mozilla.com:\nhttps://hg.mozilla.org/integration/mozilla-inbound/rev/319d79157004\nDon't reject profiles with negative colorant tristiumlus value on macOS. r=mstange", "author": "pulsebot@bots.tld", "id": 12753130, "time": "2017-10-12T15:46:31Z"}, {"text": "https://hg.mozilla.org/releases/mozilla-beta/rev/2b73168324dd", "author": "ryanvm@gmail.com", "id": 12754011, "time": "2017-10-12T19:32:11Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/319d79157004", "author": "aryx.bugmail@gmx-topmail.de", "id": 12756709, "time": "2017-10-13T15:14:36Z"}, {"text": "I'm not seeing this fixed in Firefox 59.0.2 or 61.0a1 (2018-04-17). Screenshot attached.", "author": "philipn@gmail.com", "id": 13213821, "time": "2018-04-17T22:00:54Z"}, {"text": "Created attachment 8968675\nComparison of Chrome 65.0.3325.181, Firefox 59.0.2 and Firefox 61.0a1 (2018-04-17)", "author": "philipn@gmail.com", "id": 13213824, "time": "2018-04-17T22:02:27Z"}, {"text": "(In reply to philipn from comment #22)\n> I'm not seeing this fixed in Firefox 59.0.2 or 61.0a1 (2018-04-17).\n> Screenshot attached.\n\nDid you set the gfx.color_management.mode to 1 in about:config? By default Firefox sets it to 2, which only applies color management on images that have a profile embedded. 1 applies to everything including native CSS colors (limited to sRGB at all times)", "author": "kimatg@gmail.com", "id": 13214269, "time": "2018-04-18T01:35:09Z"}, {"text": "Yeah like Hansol said you need to change the gfx.color_management.mode setting. \n\nFirefox should really make it default to 1. Otherwise, people are still going to be seeing the wrong colors.", "author": "blockbuster7+mozilla@gmail.com", "id": 13214281, "time": "2018-04-18T01:44:06Z"}, {"text": "Okay great, that did the trick!  I agree that it makes sense for `gfx.color_management.mode` to be set to 1 by default!", "author": "philipn@gmail.com", "id": 13220626, "time": "2018-04-20T06:28:29Z"}], "id": 1250461, "priority": "P3", "cc": ["arglborps@icloud.com", "b56girard@gmail.com", "benny.wydooghe@gmail.com", "blockbuster7+mozilla@gmail.com", "david@schweikert.ch", "dietrich@mozilla.com", "hujq@live.com", "jmuizelaar@mozilla.com", "kimatg@gmail.com", "lsalzman@mozilla.com", "milaninbugzilla@gmail.com", "mstange@themasta.com", "philipn@gmail.com", "yoasif@gmail.com"], "cf_crash_signature": "", "version": "45 Branch", "is_cc_accessible": true, "cf_tracking_firefox_esr52": "---", "see_also": [], "cf_tracking_thunderbird_esr60": "---", "cf_platform_rel": "---", "product": "Core", "cf_fx_iteration": "---", "blocks": [], "qa_contact": "", "creation_time": "2016-02-23T11:10:19Z", "cf_status_firefox_esr52": "---", "component": "Graphics", "assigned_to_detail": {"email": "jmuizelaar@mozilla.com", "id": 309398, "name": "jmuizelaar@mozilla.com", "real_name": "Jeff Muizelaar [:jrmuizel] on parental leave until at least June 25"}, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "---", "cf_status_firefox61": "---", "cf_status_firefox60": "---", "target_milestone": "mozilla58", "cf_rank": null, "cf_qa_whiteboard": "", "severity": "normal", "groups": [], "cf_status_thunderbird_esr52": "---", "url": "", "cf_status_thunderbird_esr60": "---", "creator_detail": {"email": "patrik.bajer@giant.cz", "id": 563457, "name": "patrik.bajer@giant.cz", "real_name": "Patrik"}, "whiteboard": "[gfx-noted]", "mentors": [], "cc_detail": [{"email": "arglborps@icloud.com", "id": 545189, "name": "arglborps@icloud.com", "real_name": "Wonder Warthog"}, {"email": "b56girard@gmail.com", "id": 368375, "name": "b56girard@gmail.com", "real_name": "Benoit Girard (:BenWa)"}, {"email": "benny.wydooghe@gmail.com", "id": 601745, "name": "benny.wydooghe@gmail.com", "real_name": ""}, {"email": "blockbuster7+mozilla@gmail.com", "id": 569643, "name": "blockbuster7+mozilla@gmail.com", "real_name": "CPx"}, {"email": "david@schweikert.ch", "id": 77151, "name": "david@schweikert.ch", "real_name": "David Schweikert"}, {"email": "dietrich@mozilla.com", "id": 213632, "name": "dietrich@mozilla.com", "real_name": "Dietrich Ayala (:dietrich)"}, {"email": "hujq@live.com", "id": 538286, "name": "hujq@live.com", "real_name": ""}, {"email": "jmuizelaar@mozilla.com", "id": 309398, "name": "jmuizelaar@mozilla.com", "real_name": "Jeff Muizelaar [:jrmuizel] on parental leave until at least June 25"}, {"email": "kimatg@gmail.com", "id": 319031, "name": "kimatg@gmail.com", "real_name": "Hansol Kim (zvuc)"}, {"email": "lsalzman@mozilla.com", "id": 536714, "name": "lsalzman@mozilla.com", "real_name": "Lee Salzman [:lsalzman]"}, {"email": "milaninbugzilla@gmail.com", "id": 456486, "name": "milaninbugzilla@gmail.com", "real_name": "Milan Sreckovic [:milan] (needinfo for best results)"}, {"email": "mstange@themasta.com", "id": 293943, "name": "mstange@themasta.com", "real_name": "Markus Stange [:mstange]"}, {"email": "philipn@gmail.com", "id": 537658, "name": "philipn@gmail.com", "real_name": ""}, {"email": "yoasif@gmail.com", "id": 347239, "name": "yoasif@gmail.com", "real_name": "Asif Youssuff"}], "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "last_change_time": "2018-05-29T21:54:28Z", "assigned_to": "jmuizelaar@mozilla.com", "is_open": false, "history": [{"changes": [{"removed": "Untriaged", "field_name": "component", "added": "Graphics"}, {"removed": "Firefox", "field_name": "product", "added": "Core"}], "who": "kohei.yoshino@gmail.com", "when": "2016-02-23T14:16:59Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "bgirard@mozilla.com, lsalzman@mozilla.com"}, {"removed": "", "field_name": "whiteboard", "added": "[gfx-noted]"}], "who": "lsalzman@mozilla.com", "when": "2016-02-23T18:12:48Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "blockbuster7+mozilla@gmail.com"}], "who": "blockbuster7+mozilla@gmail.com", "when": "2016-04-23T19:46:16Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "kimatg@gmail.com"}], "who": "kimatg@gmail.com", "when": "2016-06-09T16:30:51Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "david@schweikert.ch"}], "who": "david@schweikert.ch", "when": "2017-01-27T09:36:52Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "kilian.muster@gmail.com"}], "who": "arglborps@icloud.com", "when": "2017-05-10T08:12:35Z"}, {"changes": [{"removed": "--", "field_name": "priority", "added": "P3"}], "who": "milaninbugzilla@gmail.com", "when": "2017-08-01T14:27:30Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "yoasif@gmail.com"}], "who": "yoasif@gmail.com", "when": "2017-09-19T00:33:42Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "hujq@live.com"}], "who": "hujq@live.com", "when": "2017-09-19T05:55:52Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "benny.wydooghe@gmail.com"}], "who": "benny.wydooghe@gmail.com", "when": "2017-09-20T05:15:58Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "philipn@gmail.com"}], "who": "philipn@gmail.com", "when": "2017-10-04T05:23:44Z"}, {"changes": [{"removed": "UNCONFIRMED", "field_name": "status", "added": "NEW"}, {"removed": "", "field_name": "cc", "added": "jmuizelaar@mozilla.com, milan@mozilla.com"}, {"removed": "0", "field_name": "is_confirmed", "added": "1"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(jmuizelaar@mozilla.com), needinfo?(milan@mozilla.com)"}, {"removed": "---", "field_name": "cf_status_firefox56", "added": "wontfix"}, {"removed": "---", "field_name": "cf_status_firefox57", "added": "affected"}, {"removed": "---", "field_name": "cf_status_firefox58", "added": "affected"}], "who": "lhenry@mozilla.com", "when": "2017-10-09T02:55:12Z"}, {"changes": [{"removed": "needinfo?(jmuizelaar@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "jmuizelaar@mozilla.com", "when": "2017-10-10T19:17:51Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "mstange@themasta.com"}, {"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "jmuizelaar@mozilla.com"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8917164, "added": "review?(mstange@themasta.com)"}], "who": "jmuizelaar@mozilla.com", "when": "2017-10-10T21:41:56Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(mstange@themasta.com)", "attachment_id": 8917164, "added": "review+"}], "who": "mstange@themasta.com", "when": "2017-10-10T22:01:39Z"}, {"changes": [{"removed": "needinfo?(milan@mozilla.com)", "field_name": "flagtypes.name", "added": ""}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8917164, "added": "approval-mozilla-beta?"}], "who": "milaninbugzilla@gmail.com", "when": "2017-10-11T11:46:35Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "approval-mozilla-beta?", "attachment_id": 8917164, "added": "approval-mozilla-beta+"}], "who": "lhenry@mozilla.com", "when": "2017-10-11T21:57:22Z"}, {"changes": [{"removed": "affected", "field_name": "cf_status_firefox57", "added": "fixed"}], "who": "ryanvm@gmail.com", "when": "2017-10-12T19:32:11Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla58"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2017-10-13 15:14:36"}, {"removed": "affected", "field_name": "cf_status_firefox58", "added": "fixed"}], "who": "aryx.bugmail@gmx-topmail.de", "when": "2017-10-13T15:14:36Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "dietrich@mozilla.com"}], "who": "dietrich@mozilla.com", "when": "2018-05-29T21:54:28Z"}], "resolution": "FIXED", "op_sys": "Unspecified", "cf_fx_points": "---", "cf_blocking_fennec": "---"}