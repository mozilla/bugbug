{"cf_tracking_thunderbird_esr52": "---", "status": "VERIFIED", "cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "cf_tracking_firefox62": "---", "creator": "agashlin@mozilla.com", "mentors_detail": [], "depends_on": [], "cf_status_firefox_esr60": "fixed", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "All", "keywords": ["regression"], "cc_detail": [{"email": "adrian.florinescu@softvision.ro", "id": 556562, "name": "adrian.florinescu@softvision.ro", "real_name": "Adrian Florinescu [:adrian_sv]"}, {"email": "bugmail@mozilla.staktrace.com", "id": 426788, "name": "bugmail@mozilla.staktrace.com", "real_name": "Kartikaya Gupta (email:kats@mozilla.com)"}, {"email": "gijskruitbosch+bugs@gmail.com", "id": 159069, "name": "gijskruitbosch+bugs@gmail.com", "real_name": ":Gijs (he/him)"}, {"email": "jhofmann@mozilla.com", "id": 522029, "name": "jhofmann@mozilla.com", "real_name": "Johann Hofmann [:johannh]"}, {"email": "mcastelluccio@mozilla.com", "id": 420453, "name": "mcastelluccio@mozilla.com", "real_name": "Marco Castelluccio [:marco]"}, {"email": "ryanvm@gmail.com", "id": 75935, "name": "ryanvm@gmail.com", "real_name": "Ryan VanderMeulen [:RyanVM]"}, {"email": "sledru@mozilla.com", "id": 495955, "name": "sledru@mozilla.com", "real_name": "Sylvestre Ledru [:sylvestre]"}], "cf_last_resolved": "2018-05-09T17:29:28Z", "attachments": [{"creator": "jhofmann@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-05-04T13:41:18Z", "type_id": 4, "creation_date": "2018-05-04T13:28:34Z", "id": 1752725, "setter": "bugmail@mozilla.staktrace.com"}, {"status": "+", "name": "approval-mozilla-beta", "modification_date": "2018-05-14T14:58:05Z", "type_id": 721, "creation_date": "2018-05-14T12:37:01Z", "id": 1756386, "setter": "ryanvm@gmail.com"}, {"status": "+", "name": "approval-mozilla-esr60", "modification_date": "2018-05-25T18:25:43Z", "type_id": 929, "creation_date": "2018-05-25T18:25:43Z", "id": 1761874, "setter": "jcristau@mozilla.com"}], "content_type": "text/x-review-board-request", "id": 8973196}], "votes": 0, "classification": "Components", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 23, "comments": [{"text": "Steps to reproduce:\n1. Create a new tab (Ctrl+T)\n2. Tap (with the touchscreen) on the tab handle\n3. Try to drag the tabs around with the mouse\n\nResult:\nDragging tabs, or any other drag 'n drop with the mouse (besides text selection), does not work for the window\n\nExpected:\nDragging with the mouse should continue to work\n\nRegression range:\nhttps://hg.mozilla.org/integration/autoland/pushloghtml?fromchange=e6ecac1e488465a34471999306e1776e7fe11a1d&tochange=83a2d9c67bb62fa3355ea7cc0541c8c296190a40", "author": "agashlin@mozilla.com", "id": 13237135, "time": "2018-04-26T23:41:45Z"}, {"text": ":kats, might you know what's going on here? I'm pretty worried about this turning up as a regression for 60...\n\nAlso setting in-testsuite flag because it'd be nice if we got some automated test coverage for this type of issue. Not a lot of us use Windows as our primary machines, and if/when we do, apparently not a lot of us use touch screens or it seems we would have noticed this sooner...\n\n\nAdam: is there a workaround to get dragging to work around after breaking it as you suggest (tapping it again; something else)?", "author": "gijskruitbosch+bugs@gmail.com", "id": 13238604, "time": "2018-04-27T16:20:52Z"}, {"text": "Hm, weird. I can't reproduce this on my Surface device with either Nightly or Beta.\n\nI agree it would be nice to get automated test coverage for this but in general testing these sorts of user interactions is pretty hard and brittle. We have some machinery [1] for simulating touch input and we use it for testing touch-based APZ interactions, but I don't think we have any chrome/UI tests that use it. It should be possible but I haven't done much in the way of chrome mochitests before so I don't really know where to start.\n\nJohann, are you able to reproduce this issue?\n\n[1] https://searchfox.org/mozilla-central/rev/78dbe34925f04975f16cb9a5d4938be714d41897/dom/interfaces/base/nsIDOMWindowUtils.idl#608,639", "author": "bugmail@mozilla.staktrace.com", "id": 13238717, "time": "2018-04-27T17:14:47Z"}, {"text": "(In reply to :Gijs (he/him) from comment #1)\n> \n> Adam: is there a workaround to get dragging to work around after breaking it\n> as you suggest (tapping it again; something else)?\n\nI haven't found anything yet. Touch dragging tabs still works. If I open a new window that new window behaves normally.\n\n(In reply to Kartikaya Gupta (email:kats@mozilla.com) from comment #2)\n> Hm, weird. I can't reproduce this on my Surface device with either Nightly\n> or Beta.\n\nfwiw, I'm on a Dell XPS 15-inch (2017) (aka XPS 15 9560 Signature Edition) running Windows 10 Pro build 16299.371. Maybe Dell has some funky touch driver, but it doesn't look like it from Device Manager.", "author": "agashlin@mozilla.com", "id": 13238845, "time": "2018-04-27T18:19:19Z"}, {"text": "Man, these touch bugs always come in before the long weekends. I'll have a chance to take a look at this at the earliest on Wednesday next week. I have a Dell XPS 13 from 2017, so I guess my chances of reproducing it aren't so bad. I'll post an update once I've investigated. Generally the description totally sounds like it could have been produced by bug 1446904 (though I still think we did the right thing there).\n\nDuring fixing bug 1446904 I noticed a couple of places where we're not setting mInTouchDrag = false, but where it would intuitively make sense to do so. Back in the day I thought it might do more harm than good to change it, but now that would be my first approach in investigating...\n\nThanks for reporting this!\n\n(In reply to :Gijs (he/him) from comment #1)\n> :kats, might you know what's going on here? I'm pretty worried about this\n> turning up as a regression for 60...\n\nI'm not really worried about this for 60, considering that we've lived with bug 1446904 for two releases. That also affected touch users and in a much worse way. It also seems to affect only certain systems.\n\n> Also setting in-testsuite flag because it'd be nice if we got some automated\n> test coverage for this type of issue. Not a lot of us use Windows as our\n> primary machines, and if/when we do, apparently not a lot of us use touch\n> screens or it seems we would have noticed this sooner...\n\nI agree with kats that it sounds pretty brittle to test. I think I've tried testing this for the original touch drag feature but wasn't really successful, though I can try again. In general I don't see a way how this bug could have been caught by automated tests, it sounds pretty edge case-y (first touch-tapping and then dragging tabs with the mouse) unless you have a specific regression test for it.\n\n> Adam: is there a workaround to get dragging to work around after breaking it\n> as you suggest (tapping it again; something else)?\n\nPresumably the tap enters a touch drag session but doesn't end it, so touch-dragging again should fix it.\n\nThanks everyone!", "author": "jhofmann@mozilla.com", "id": 13239757, "time": "2018-04-28T11:03:20Z"}, {"text": "Created attachment 8973196\nBug 1457338 - Stop touch drag on mouseUp.\n\nReview commit: https://reviewboard.mozilla.org/r/241690/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/241690/", "author": "jhofmann@mozilla.com", "id": 13254576, "time": "2018-05-04T13:28:34Z"}, {"text": "Comment on attachment 8973196\nBug 1457338 - Stop touch drag on mouseUp.\n\nhttps://reviewboard.mozilla.org/r/241690/#review247514\n\nSure... why not :/", "author": "bugmail@mozilla.staktrace.com", "id": 13254608, "time": "2018-05-04T13:41:18Z"}, {"text": "Yeah, so this patch fixes the issue for me. I'll put up a try build in a second to make it easier for Adam to try it out...\n\nStill looking into testing...", "author": "jhofmann@mozilla.com", "id": 13254710, "time": "2018-05-04T14:20:19Z"}, {"text": "Adam, can you check whether the build here fixes the issue for you:\n\nhttps://treeherder.mozilla.org/#/jobs?repo=try&revision=59ced74cd362d1de442ae38082990c8cd730fe64&selectedJob=176963983\n\nThanks!", "author": "jhofmann@mozilla.com", "id": 13255073, "time": "2018-05-04T16:19:37Z"}, {"text": "Thanks Johann, just touch tapping doesn't lock up mouse dragging anymore! However I'm noticing that actually touch dragging a tab will cause the next mouse drag (of tabs or otherwise) to be ignored (not always, though I'm not sure what the difference is, and not if you click the mouse first).\n\nAfter the first drag things seem to go back to normal, but there is also this odd issue:\n1. Select text\n2. Touch drag the current tab\n3. Attempt to mouse drag the selected text, nothing seems to happen though the text becomes unselected at the end of the drag\n4. Select a different section of text\n5. Attempt to drag this new section\n\nThe drag is animated as if you were dragging the text from step 1 instead of the current selection from step 4. If both selections are in a textarea, the text from step 4 is removed when the drag and drop completes but the text from step 1 is inserted at the target.", "author": "agashlin@mozilla.com", "id": 13255479, "time": "2018-05-04T18:56:04Z"}, {"text": "(In reply to Adam Gashlin [:agashlin] from comment #9)\n> Thanks Johann, just touch tapping doesn't lock up mouse dragging anymore!\n> However I'm noticing that actually touch dragging a tab will cause the next\n> mouse drag (of tabs or otherwise) to be ignored (not always, though I'm not\n> sure what the difference is, and not if you click the mouse first).\n> \n> After the first drag things seem to go back to normal, but there is also\n> this odd issue:\n> 1. Select text\n> 2. Touch drag the current tab\n> 3. Attempt to mouse drag the selected text, nothing seems to happen though\n> the text becomes unselected at the end of the drag\n> 4. Select a different section of text\n> 5. Attempt to drag this new section\n> \n> The drag is animated as if you were dragging the text from step 1 instead of\n> the current selection from step 4. If both selections are in a textarea, the\n> text from step 4 is removed when the drag and drop completes but the text\n> from step 1 is inserted at the target.\n\nAre these regressions from my patch? If not I'd consider all these edge-casey enough that we can just file backlog bugs for them.\n\nThanks for testing!", "author": "jhofmann@mozilla.com", "id": 13258827, "time": "2018-05-07T08:24:09Z"}, {"text": "Hofmann [:johannh] from comment #10)\n> Are these regressions from my patch? If not I'd consider all these\n> edge-casey enough that we can just file backlog bugs for them.\n\nI'm not sure, they don't seem to have been introduced by bug 1362065 which added the touch gesture, but it is hard to tell after bug 1446904 since currently mouse drags don't work at all after touch interactions with tabs.\n\nI think things are sufficiently less broken with your patch that it'd probably be fine to file as another bug or two. Thanks!", "author": "agashlin@mozilla.com", "id": 13259740, "time": "2018-05-07T15:19:06Z"}, {"text": "Right, I meant whether the patch in this bug introduced any new regressions, not the one in bug 1362065. :)\n\nI presume there are more cases where we don't correctly exit touchdrag and it just didn't really occur before because few people were using the double-tap-to-drag feature.\n\nAs for testing, there's https://searchfox.org/mozilla-central/rev/f30847c12e5fb13791401ed4330ced3e1b9c8d81/gfx/layers/apz/test/mochitest/apz_test_native_event_utils.js#292 but I can't really seem to get it to work on the tab strip in my local testing. It feels like this requires a lot more digging into the synthesizing code which I just don't have the bandwidth for right now, so if we want to land this patch we probably need to defer having test coverage for touch dragging to a follow-up bug.\n\nIn general touch drag is already covered by all the mouse drag tests because the whole thing was written so that the platform layer just applies the mouse drag when a touch drag is performed, so we would just need to have regression tests for the edge cases in the platform code, e.g. this bug.", "author": "jhofmann@mozilla.com", "id": 13261828, "time": "2018-05-08T09:09:27Z"}, {"text": "Pushed by jhofmann@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/1aeaff1e13f8\nStop touch drag on mouseUp. r=kats", "author": "pulsebot@bots.tld", "id": 13265321, "time": "2018-05-09T13:45:34Z"}, {"text": "I filed bug 1460280 for the tests. Adam, can you please file the bugs you mentioned in comment 9?\n\nThanks!", "author": "jhofmann@mozilla.com", "id": 13265344, "time": "2018-05-09T13:54:12Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/1aeaff1e13f8", "author": "csabou@mozilla.com", "id": 13266049, "time": "2018-05-09T17:29:28Z"}, {"text": "(In reply to Johann Hofmann [:johannh] from comment #14)\n> I filed bug 1460280 for the tests. Adam, can you please file the bugs you\n> mentioned in comment 9?\n\nFiled bug 1460637 and bug 1460640.", "author": "agashlin@mozilla.com", "id": 13268523, "time": "2018-05-10T15:56:31Z"}, {"text": "Comment on attachment 8973196\nBug 1457338 - Stop touch drag on mouseUp.\n\nApproval Request Comment\n[Feature/Bug causing the regression]: Bug 1446904\n[User impact if declined]: Touch-dragging tabs in the tab strip or customize mode makes mouse-dragging afterwards impossible (on certain systems)\n[Is this code covered by automated tests?]: No\n[Has the fix been verified in Nightly?]: Not yet\n[Needs manual test from QE? If yes, steps to reproduce]: See comment 0, note that we have only been able to reproduce this on Dell Touch Laptops so far\n[List of other uplifts needed for the feature/fix]: None\n[Is the change risky?]: Not really\n[Why is the change risky/not risky?]: One line fix that exits touch drag on certain mouse events. If there is a problem with this patch it affects touch dragging at best.\n[String changes made/needed]: None", "author": "jhofmann@mozilla.com", "id": 13275497, "time": "2018-05-14T12:37:01Z"}, {"text": "Comment on attachment 8973196\nBug 1457338 - Stop touch drag on mouseUp.\n\nOne-liner fix for tab dragging via touch. Approved for 61.0b5.", "author": "ryanvm@gmail.com", "id": 13275897, "time": "2018-05-14T14:58:05Z"}, {"text": "https://hg.mozilla.org/releases/mozilla-beta/rev/ede4d13c43c6", "author": "ryanvm@gmail.com", "id": 13275918, "time": "2018-05-14T15:05:00Z"}, {"text": "I've managed to reproduce the issue as described in comment 0 on a Dell Optiplex 9020 AIO desktop with Windows 8.1 x64 Pro with touch support on 61.0b3 20180507191226.\n\nVerified as fixed on 62.0a1 20180515100038 and on 61.0b5 20180514150347.", "author": "adrian.florinescu@softvision.ro", "id": 13279145, "time": "2018-05-15T16:46:15Z"}, {"text": "Comment on attachment 8973196\nBug 1457338 - Stop touch drag on mouseUp.\n\nlet's do this for esr60 as well", "author": "jcristau@mozilla.com", "id": 13364732, "time": "2018-05-25T18:25:43Z"}, {"text": "https://hg.mozilla.org/releases/mozilla-esr60/rev/12bcae394943", "author": "ryanvm@gmail.com", "id": 13365107, "time": "2018-05-25T20:50:42Z"}], "id": 1457338, "priority": "--", "cc": ["adrian.florinescu@softvision.ro", "bugmail@mozilla.staktrace.com", "gijskruitbosch+bugs@gmail.com", "jhofmann@mozilla.com", "mcastelluccio@mozilla.com", "ryanvm@gmail.com", "sledru@mozilla.com"], "cf_crash_signature": "", "version": "60 Branch", "is_cc_accessible": true, "cf_tracking_firefox_esr52": "---", "see_also": [], "cf_tracking_thunderbird_esr60": "---", "cf_platform_rel": "---", "product": "Core", "cf_fx_iteration": "---", "blocks": [1446904], "qa_contact": "", "creation_time": "2018-04-26T23:41:45Z", "cf_status_firefox_esr52": "unaffected", "component": "Widget: Win32", "assigned_to_detail": {"email": "jhofmann@mozilla.com", "id": 522029, "name": "jhofmann@mozilla.com", "real_name": "Johann Hofmann [:johannh]"}, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "verified", "cf_status_firefox61": "verified", "cf_status_firefox60": "wontfix", "target_milestone": "mozilla62", "cf_rank": null, "cf_qa_whiteboard": "", "severity": "normal", "groups": [], "cf_status_thunderbird_esr52": "---", "url": "", "cf_status_thunderbird_esr60": "---", "creator_detail": {"email": "agashlin@mozilla.com", "id": 583776, "name": "agashlin@mozilla.com", "real_name": "Adam Gashlin [:agashlin]"}, "whiteboard": "", "mentors": [], "summary": "Tap in tab strip stops mouse drags", "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [{"status": "?", "name": "in-testsuite", "modification_date": "2018-04-27T16:20:52Z", "type_id": 37, "creation_date": "2018-04-27T16:20:52Z", "id": 1750020, "setter": "gijskruitbosch+bugs@gmail.com"}], "last_change_time": "2018-05-25T20:50:42Z", "assigned_to": "jhofmann@mozilla.com", "is_open": false, "history": [{"changes": [{"removed": "", "field_name": "keywords", "added": "regression"}, {"removed": "", "field_name": "cc", "added": "mcastelluccio@mozilla.com"}], "who": "mcastelluccio@mozilla.com", "when": "2018-04-27T13:33:47Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "bugmail@mozilla.staktrace.com, gijskruitbosch+bugs@gmail.com, jhofmann@mozilla.com"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(bugmail@mozilla.staktrace.com), needinfo?(agashlin@mozilla.com), in-testsuite?"}], "who": "gijskruitbosch+bugs@gmail.com", "when": "2018-04-27T16:20:52Z"}, {"changes": [{"removed": "needinfo?(bugmail@mozilla.staktrace.com)", "field_name": "flagtypes.name", "added": "needinfo?(jhofmann@mozilla.com)"}], "who": "bugmail@mozilla.staktrace.com", "when": "2018-04-27T17:14:47Z"}, {"changes": [{"removed": "needinfo?(agashlin@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "agashlin@mozilla.com", "when": "2018-04-27T18:19:19Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "ASSIGNED"}, {"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "jhofmann@mozilla.com"}, {"removed": "needinfo?(jhofmann@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "jhofmann@mozilla.com", "when": "2018-04-28T11:03:20Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8973196, "added": "review?(bugmail@mozilla.staktrace.com)"}], "who": "jhofmann@mozilla.com", "when": "2018-05-04T13:28:34Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(bugmail@mozilla.staktrace.com)", "attachment_id": 8973196, "added": "review+"}], "who": "bugmail@mozilla.staktrace.com", "when": "2018-05-04T13:41:18Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(agashlin@mozilla.com)"}], "who": "jhofmann@mozilla.com", "when": "2018-05-04T16:19:37Z"}, {"changes": [{"removed": "needinfo?(agashlin@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "agashlin@mozilla.com", "when": "2018-05-04T18:56:04Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(jhofmann@mozilla.com)"}, {"removed": "---", "field_name": "cf_status_firefox60", "added": "affected"}, {"removed": "---", "field_name": "cf_status_firefox61", "added": "affected"}, {"removed": "---", "field_name": "cf_status_firefox62", "added": "affected"}], "who": "jhofmann@mozilla.com", "when": "2018-05-09T13:54:12Z"}, {"changes": [{"removed": "needinfo?(jhofmann@mozilla.com)", "field_name": "flagtypes.name", "added": "needinfo?(agashlin@mozilla.com)"}], "who": "jhofmann@mozilla.com", "when": "2018-05-09T13:54:26Z"}, {"changes": [{"removed": "ASSIGNED", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla62"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2018-05-09 17:29:28"}, {"removed": "affected", "field_name": "cf_status_firefox62", "added": "fixed"}], "who": "csabou@mozilla.com", "when": "2018-05-09T17:29:28Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "ryanvm@gmail.com"}, {"removed": "", "field_name": "flagtypes.name", "added": "qe-verify+"}, {"removed": "---", "field_name": "cf_status_firefox_esr52", "added": "unaffected"}, {"removed": "---", "field_name": "cf_status_firefox_esr60", "added": "affected"}], "who": "ryanvm@gmail.com", "when": "2018-05-10T01:22:33Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "sledru@mozilla.com"}, {"removed": "affected", "field_name": "cf_status_firefox60", "added": "wontfix"}], "who": "sledru@mozilla.com", "when": "2018-05-10T12:11:57Z"}, {"changes": [{"removed": "needinfo?(agashlin@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "agashlin@mozilla.com", "when": "2018-05-10T15:56:31Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8973196, "added": "approval-mozilla-beta?"}], "who": "jhofmann@mozilla.com", "when": "2018-05-14T12:37:01Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "approval-mozilla-beta?", "attachment_id": 8973196, "added": "approval-mozilla-beta+"}], "who": "ryanvm@gmail.com", "when": "2018-05-14T14:58:05Z"}, {"changes": [{"removed": "affected", "field_name": "cf_status_firefox61", "added": "fixed"}], "who": "ryanvm@gmail.com", "when": "2018-05-14T15:05:00Z"}, {"changes": [{"removed": "RESOLVED", "field_name": "status", "added": "VERIFIED"}, {"removed": "", "field_name": "cc", "added": "adrian.florinescu@softvision.ro"}, {"removed": "qe-verify+", "field_name": "flagtypes.name", "added": ""}, {"removed": "fixed", "field_name": "cf_status_firefox61", "added": "verified"}, {"removed": "fixed", "field_name": "cf_status_firefox62", "added": "verified"}], "who": "adrian.florinescu@softvision.ro", "when": "2018-05-15T16:46:15Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8973196, "added": "approval-mozilla-esr60+"}], "who": "jcristau@mozilla.com", "when": "2018-05-25T18:25:43Z"}, {"changes": [{"removed": "affected", "field_name": "cf_status_firefox_esr60", "added": "fixed"}], "who": "ryanvm@gmail.com", "when": "2018-05-25T20:50:42Z"}], "resolution": "FIXED", "op_sys": "Windows", "cf_fx_points": "---", "cf_blocking_fennec": "---"}