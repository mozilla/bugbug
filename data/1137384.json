{"cf_status_firefox39": "fixed", "cf_tracking_firefox60": "---", "attachments": [{"creator": "jlong@mozilla.com", "is_obsolete": 1, "is_patch": 1, "flags": [], "content_type": "text/plain", "id": 8572208}, {"creator": "jlong@mozilla.com", "is_obsolete": 1, "is_patch": 1, "flags": [], "content_type": "text/plain", "id": 8575603}, {"creator": "jlong@mozilla.com", "is_obsolete": 1, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2015-03-11T11:39:52Z", "type_id": 748, "creation_date": "2015-03-10T22:04:12Z", "id": 1118847, "setter": "ejpbruel@mozilla.com"}], "content_type": "text/plain", "id": 8575606}, {"creator": "jlong@mozilla.com", "is_obsolete": 1, "is_patch": 1, "flags": [], "content_type": "text/plain", "id": 8580186}, {"creator": "jlong@mozilla.com", "is_obsolete": 1, "is_patch": 1, "flags": [], "content_type": "text/plain", "id": 8580717}, {"creator": "jlong@mozilla.com", "is_obsolete": 0, "is_patch": 1, "flags": [], "content_type": "text/plain", "id": 8581775}], "classification": "Client Software", "creator": "jlong@mozilla.com", "cc": ["ejpbruel@mozilla.com", "nfitzgerald@mozilla.com"], "depends_on": [1059308, 1149910], "creation_time": "2015-02-26T19:40:07Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "x86", "cf_status_firefox58": "---", "cf_status_firefox59": "---", "keywords": [], "summary": "Move ThreadSources into its own devtools-wide file", "cf_last_resolved": "2015-03-25T01:15:50Z", "assigned_to_detail": {"email": "jlong@mozilla.com", "id": 402289, "name": "jlong@mozilla.com", "real_name": "James Long (:jlongster)"}, "severity": "normal", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "assigned_to": "jlong@mozilla.com", "comment_count": 20, "comments": [{"text": "The idea of `ThreadSources` was to have a single places that sources are managed, and anything like sourcemapping can be done there, and eventually we could make this available to other tools. That time is now, since we need sourcemaps in the console.\n\nI don't think it should be too hard to move `ThreadSources` into something per-tab. I'm not exactly where this should be yet, but I wanted to go ahead and file this bug because Eddy is working on the backend so I'll need to coordinate with him carefully so I don't conflict with this work.", "author": "jlong@mozilla.com", "id": 9963485, "time": "2015-02-26T19:40:07Z"}, {"text": "Eddy, this is not extremely urgent, so I'm happy to wait for a window that will work well for you. I don't know how much you are touching ThreadSources right now.", "author": "jlong@mozilla.com", "id": 9963491, "time": "2015-02-26T19:41:15Z"}, {"text": "Created attachment 8572208\n1137384.patch\n\nThis actually wasn't that hard. This patch just moves ThreadSources up into the tab actors (and renamed TabSources) and makes everything work with that move. This doesn't add any new functionality, it just refactors the code and makes sure everything still works.\n\nI need to wait for bug 1059308 to land before I finish the patch because that changes how the browser debugger works. The browser debugger will inherit from TabActor and get this for free, instead of now I'd have to manually patch the chrome debugger (and it's actually not clear to do it). That bug should land this week.\n\nNo need to review until I get that change in", "author": "jlong@mozilla.com", "id": 9981650, "time": "2015-03-03T22:16:56Z"}, {"text": "Created attachment 8575603\n1137384.patch\n\nAll tests pass! Ready for review. I rebased this yesterday so it should be up-to-date. Hopefully it doesn't conflict much with any work you have in your repo.", "author": "jlong@mozilla.com", "id": 10011918, "time": "2015-03-10T21:59:37Z"}, {"text": "Nick was interested in this too, this is a big enough change that more reviewers would be good.", "author": "jlong@mozilla.com", "id": 10011926, "time": "2015-03-10T22:00:29Z"}, {"text": "Created attachment 8575606\n1137384.patch\n\nOops, forgot to add some comments in TabSources", "author": "jlong@mozilla.com", "id": 10011949, "time": "2015-03-10T22:04:12Z"}, {"text": "Comment on attachment 8575603\n1137384.patch\n\nReview of attachment 8575603:\n-----------------------------------------------------------------\n\nOverall, very nice. We've needed this for a while.\n\n::: toolkit/devtools/server/actors/script.js\n@@ +2026,5 @@\n>      let endLine = aScript.startLine + aScript.lineCount - 1;\n> +    for (let _actor of this.breakpointActorMap.findActors()) {\n> +      // We do async work in here, so we need to create a fresh\n> +      // binding because for/of does not yet do that in SpiderMonkey\n> +      // (remove this when bug 1101653 is fixed)\n\nNit: file a follow up that depends on bug 1101653 (and gets an auto update when that bug is fixed) and link it here so that we don't forget.\n\n    // XXX Bug #######: We do async work in here ...\n\n::: toolkit/devtools/server/actors/utils/TabSources.js\n@@ +153,5 @@\n> +    if (id) {\n> +      actor.actorID = id;\n> +    }\n> +\n> +    this._thread.threadLifetimePool.addActor(actor);\n\nThe `SourceActor`s should be children of the `TabActor` in the actor hierarchy, that way non-ThreadActor actors can safely use them and not worry about lifetimes.", "author": "nfitzgerald@mozilla.com", "id": 10011989, "time": "2015-03-10T22:12:21Z"}, {"text": "Comment on attachment 8575603\n1137384.patch\n\nStupid splinter", "author": "nfitzgerald@mozilla.com", "id": 10011991, "time": "2015-03-10T22:12:50Z"}, {"text": "Comment on attachment 8575606\n1137384.patch\n\nReview of attachment 8575606:\n-----------------------------------------------------------------\n\nI only looked whether this patch would interfere with my work on breakpoint sliding. If I read the patch correctly, the API of ThreadSources didn't change, and is still available via threadActor.sources. I only need access to source map functions like getGeneratedLocation etc.\n\nIf correct, this should be fairly easy for me to rebase on top of, so feel free to land.", "author": "ejpbruel@mozilla.com", "id": 10014419, "time": "2015-03-11T11:39:52Z"}, {"text": "https://treeherder.mozilla.org/#/jobs?repo=try&revision=eae4a82bb523", "author": "jlong@mozilla.com", "id": 10016016, "time": "2015-03-11T17:18:40Z"}, {"text": "Turns out ThreadSources had a bunch of dependencies on the synchronous `resolve` promise method, and making it async is showing a few race conditions. Bah.", "author": "jlong@mozilla.com", "id": 10023381, "time": "2015-03-12T22:07:56Z"}, {"text": "Still trying to track down the intermittent. I used to be able to reproduce it locally, but can't anymore, so I wonder if recent refactorings fixed it. Two try pushes:\n\nTabSources using sync promises: https://treeherder.mozilla.org/#/jobs?repo=try&revision=87ae08be00ab\nTabSources using async promises: https://treeherder.mozilla.org/#/jobs?repo=try&revision=d6604c2b9703\n\nI'm not going to use sync promises in the end, but its just a test case to see if the former succeeds and the latter fails.", "author": "jlong@mozilla.com", "id": 10047334, "time": "2015-03-18T20:26:56Z"}, {"text": "Above try looks green, but was only on linux. Here's a full try: https://treeherder.mozilla.org/#/jobs?repo=try&revision=8f382813f929", "author": "jlong@mozilla.com", "id": 10051621, "time": "2015-03-19T16:29:57Z"}, {"text": "Created attachment 8580186\n1137384.patch\n\nrebased", "author": "jlong@mozilla.com", "id": 10052304, "time": "2015-03-19T18:31:44Z"}, {"text": "Hm, looks like there might be some leaks... let's see if this fixes it: https://treeherder.mozilla.org/#/jobs?repo=try&revision=69694a28eba4", "author": "jlong@mozilla.com", "id": 10053201, "time": "2015-03-19T21:34:25Z"}, {"text": "Created attachment 8580717\n1137384.patch\n\nrebased", "author": "jlong@mozilla.com", "id": 10056576, "time": "2015-03-20T15:41:51Z"}, {"text": "Windows debug failure doesn't look like mine, and OSX seems to have trouble building, I just retriggered it though to see if works.", "author": "jlong@mozilla.com", "id": 10056587, "time": "2015-03-20T15:44:48Z"}, {"text": "Created attachment 8581775\n1137384.patch\n\nrebased", "author": "jlong@mozilla.com", "id": 10065543, "time": "2015-03-23T17:50:35Z"}, {"text": "https://hg.mozilla.org/integration/fx-team/rev/977b4598da47", "author": "ryanvm@gmail.com", "id": 10070034, "time": "2015-03-24T14:19:52Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/977b4598da47", "author": "kwierso@gmail.com", "id": 10073652, "time": "2015-03-25T01:15:50Z"}], "id": 1137384, "priority": "--", "mentors_detail": [], "cf_crash_signature": "", "version": "unspecified", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox59": "---", "last_change_time": "2015-04-02T08:55:58Z", "cf_platform_rel": "---", "product": "Firefox", "cf_status_firefox_esr52": "---", "blocks": [1021925, 1132501], "qa_contact": "", "see_also": [], "cf_fx_iteration": "---", "component": "Developer Tools: Debugger", "votes": 0, "groups": [], "cf_status_firefox60": "---", "target_milestone": "Firefox 39", "is_cc_accessible": true, "status": "RESOLVED", "url": "", "creator_detail": {"email": "jlong@mozilla.com", "id": 402289, "name": "jlong@mozilla.com", "real_name": "James Long (:jlongster)"}, "whiteboard": "", "mentors": [], "cc_detail": [{"email": "ejpbruel@mozilla.com", "id": 417505, "name": "ejpbruel@mozilla.com", "real_name": "Eddy Bruel [:ejpbruel]"}, {"email": "nfitzgerald@mozilla.com", "id": 417695, "name": "nfitzgerald@mozilla.com", "real_name": "Nick Fitzgerald [:fitzgen] [\u23f0PST; UTC-8]"}], "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [{"status": "+", "name": "in-testsuite", "modification_date": "2015-03-24T14:19:52Z", "type_id": 37, "creation_date": "2015-03-24T14:19:52Z", "id": 1129860, "setter": "ryanvm@gmail.com"}], "cf_tracking_firefox58": "---", "cf_rank": null, "is_open": false, "resolution": "FIXED", "op_sys": "Mac OS X", "cf_fx_points": "---", "history": [{"changes": [{"removed": "", "field_name": "cc", "added": "ejpbruel@mozilla.com, nfitzgerald@mozilla.com"}], "who": "jlong@mozilla.com", "when": "2015-02-26T19:40:28Z"}, {"changes": [{"removed": "", "field_name": "blocks", "added": "1132501"}], "who": "jlong@mozilla.com", "when": "2015-02-26T19:41:45Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1059308"}], "who": "jlong@mozilla.com", "when": "2015-03-03T21:55:46Z"}, {"changes": [{"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "jlong@mozilla.com"}], "who": "jlong@mozilla.com", "when": "2015-03-09T20:22:10Z"}, {"changes": [{"removed": "", "field_name": "blocks", "added": "1021925"}], "who": "nfitzgerald@mozilla.com", "when": "2015-03-10T16:59:44Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8572208, "added": "1"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8575603, "added": "review?(ejpbruel@mozilla.com)"}], "who": "jlong@mozilla.com", "when": "2015-03-10T21:59:37Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(nfitzgerald@mozilla.com)"}], "who": "jlong@mozilla.com", "when": "2015-03-10T22:00:29Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8575603, "added": "1"}, {"field_name": "flagtypes.name", "removed": "review?(ejpbruel@mozilla.com)", "attachment_id": 8575603, "added": ""}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8575606, "added": "review?(ejpbruel@mozilla.com)"}], "who": "jlong@mozilla.com", "when": "2015-03-10T22:04:12Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "1", "attachment_id": 8575603, "added": "0"}], "who": "nfitzgerald@mozilla.com", "when": "2015-03-10T22:12:21Z"}, {"changes": [{"removed": "needinfo?(nfitzgerald@mozilla.com)", "field_name": "flagtypes.name", "added": ""}, {"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8575603, "added": "1"}], "who": "nfitzgerald@mozilla.com", "when": "2015-03-10T22:12:50Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(ejpbruel@mozilla.com)", "attachment_id": 8575606, "added": "review+"}], "who": "ejpbruel@mozilla.com", "when": "2015-03-11T11:39:52Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8575606, "added": "1"}], "who": "jlong@mozilla.com", "when": "2015-03-19T18:31:44Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8580186, "added": "1"}], "who": "jlong@mozilla.com", "when": "2015-03-20T15:41:51Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "checkin-needed"}], "who": "jlong@mozilla.com", "when": "2015-03-20T15:42:01Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8580717, "added": "1"}], "who": "jlong@mozilla.com", "when": "2015-03-23T17:50:35Z"}, {"changes": [{"removed": "", "field_name": "whiteboard", "added": "[fixed-in-fx-team]"}, {"removed": "", "field_name": "flagtypes.name", "added": "in-testsuite+"}, {"removed": "checkin-needed", "field_name": "keywords", "added": ""}], "who": "ryanvm@gmail.com", "when": "2015-03-24T14:19:52Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "Firefox 39"}, {"removed": "[fixed-in-fx-team]", "field_name": "whiteboard", "added": ""}, {"removed": "", "field_name": "cf_last_resolved", "added": "2015-03-24 18:15:50"}, {"removed": "---", "field_name": "cf_status_firefox39", "added": "fixed"}], "who": "kwierso@gmail.com", "when": "2015-03-25T01:15:50Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1149910"}], "who": "jryans@gmail.com", "when": "2015-04-02T08:55:58Z"}]}