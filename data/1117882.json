{"cf_status_firefox38": "fixed", "cf_tracking_thunderbird_esr52": "---", "cf_tracking_firefox60": "---", "attachments": [{"creator": "azakai@mozilla.com", "is_obsolete": 1, "is_patch": 0, "flags": [], "content_type": "application/javascript", "id": 8544098}, {"creator": "nth10sd@gmail.com", "is_obsolete": 0, "is_patch": 0, "flags": [], "content_type": "text/plain", "id": 8544151}, {"creator": "sunfish@mozilla.com", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2015-02-11T18:54:20Z", "type_id": 4, "creation_date": "2015-02-10T16:30:32Z", "id": 1096574, "setter": "nicolas.b.pierron@mozilla.com"}], "content_type": "text/plain", "id": 8562158}], "classification": "Components", "creator": "azakai@mozilla.com", "cc": ["choller@mozilla.com", "jdemooij@mozilla.com", "jruderman@gmail.com", "nicolas.b.pierron@mozilla.com", "nth10sd@gmail.com", "sunfish@mozilla.com"], "depends_on": [], "creation_time": "2015-01-05T18:46:41Z", "cf_status_firefox37": "affected", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "x86_64", "cf_status_firefox58": "---", "cf_status_firefox59": "---", "keywords": ["assertion", "regression", "testcase"], "summary": "\"Assertion failure: phi->hasUses() (Missed an unused phi)\" on asm.js testcase", "id": 1117882, "assigned_to_detail": {"email": "sunfish@mozilla.com", "id": 468136, "name": "sunfish@mozilla.com", "real_name": "Dan Gohman [:sunfish]"}, "severity": "critical", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "assigned_to": "sunfish@mozilla.com", "comment_count": 8, "comments": [{"text": "Created attachment 8544098\nfc.out.js\n\nAttached testcase asserts in a debug build of SpiderMonkey on\n\nAssertion failure: phi->hasUses() (Missed an unused phi), at /home/alon/Dev/mozilla-inbound/js/src/jit/ValueNumbering.cpp:676\nSegmentation fault (core dumped)\n\nGary, this is the only bug I found after a weekend of csmith fuzzing on debug builds.", "author": "azakai@mozilla.com", "id": 9753273, "time": "2015-01-05T18:46:41Z"}, {"text": "(function() {\n    'use asm'\n    function f(i1) {\n        i1 = i1 | 0\n        var i2 = 0\n        while (1) {\n            while (0 < 1);\n            i1 = d(i1, i2) | 0\n            i2 = 0\n        }\n    }\n})()\n\nasserts js debug builds on m-c rev 912036eeb024 with --fuzzing-safe --no-threads --ion-eager at Assertion failure: phi->hasUses() (Missed an unused phi), at jit/ValueNumbering.cpp\n\nautoBisect shows this is probably related to the following changeset:\n\nThe first bad revision is:\nchangeset:   https://hg.mozilla.org/mozilla-central/rev/8f27a48a25d5\nuser:        Dan Gohman\ndate:        Wed Sep 17 10:27:25 2014 -0700\nsummary:     Bug 1029830 - IonMonkey: GVN: Replace UCE with GVN r=nbp\n\nDan, is bug 1029830 a likely regressor?", "author": "nth10sd@gmail.com", "id": 9753799, "time": "2015-01-05T20:05:12Z"}, {"text": "Created attachment 8544151\nstack\n\n(lldb) bt 5\n* thread #1: tid = 0x63ced, 0x0000000100440293 js-dbg-opt-64-dm-nsprBuild-darwin-912036eeb024`js::jit::ValueNumberer::loopHasOptimizablePhi(this=<unavailable>, header=<unavailable>) const + 291 at ValueNumbering.cpp:676, queue = 'com.apple.main-thread', stop reason = EXC_BAD_ACCESS (code=1, address=0x0)\n  * frame #0: 0x0000000100440293 js-dbg-opt-64-dm-nsprBuild-darwin-912036eeb024`js::jit::ValueNumberer::loopHasOptimizablePhi(this=<unavailable>, header=<unavailable>) const + 291 at ValueNumbering.cpp:676\n    frame #1: 0x0000000100441285 js-dbg-opt-64-dm-nsprBuild-darwin-912036eeb024`js::jit::ValueNumberer::visitDominatorTree(this=0x00007fff5fbfb048, dominatorRoot=0x0000000102116188) + 357 at ValueNumbering.cpp:985\n    frame #2: 0x00000001004414cb js-dbg-opt-64-dm-nsprBuild-darwin-912036eeb024`js::jit::ValueNumberer::visitGraph(this=0x00007fff5fbfb048) + 75 at ValueNumbering.cpp:1016\n    frame #3: 0x0000000100441779 js-dbg-opt-64-dm-nsprBuild-darwin-912036eeb024`js::jit::ValueNumberer::run(this=0x00007fff5fbfb048, updateAliasAnalysis=<unavailable>) + 73 at ValueNumbering.cpp:1087\n    frame #4: 0x00000001002c1437 js-dbg-opt-64-dm-nsprBuild-darwin-912036eeb024`js::jit::OptimizeMIR(mir=0x00000001021160d8) + 2327 at Ion.cpp:1431\n(lldb)\n\n\nWe should also check that fc.out.js no longer asserts after this bug is fixed.", "author": "nth10sd@gmail.com", "id": 9753810, "time": "2015-01-05T20:07:11Z"}, {"text": "Fortunately, this bug is not security sensitive. The assert is just asserting that we didn't miss an opportunity to optimize -- to delete an unused phi in this case.", "author": "sunfish@mozilla.com", "id": 9754188, "time": "2015-01-05T21:12:58Z"}, {"text": "Opening up as per comment 3.", "author": "nth10sd@gmail.com", "id": 9754194, "time": "2015-01-05T21:14:07Z"}, {"text": "Created attachment 8562158\ngvn-dce-pinned-phi.patch\n\nIn a loop, walking the use-def chain from a phi operand in the loop header can lead us back around to other phis in the same loop header. The nextDef_ mechanism protects us from invalidating our iterator, but it was also causing us to leave unused phis sitting around, in cases such as the testcase above. The attached patch adds code to check for such cases and cleans them up.\n\nIt also fixes a harmless-in-practice dereference of an end iterator.", "author": "sunfish@mozilla.com", "id": 9903231, "time": "2015-02-10T16:30:32Z"}, {"text": "https://hg.mozilla.org/integration/mozilla-inbound/rev/59512894ddd4", "author": "sunfish@mozilla.com", "id": 9919549, "time": "2015-02-14T00:37:54Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/59512894ddd4", "author": "cbook@mozilla.com", "id": 9923596, "time": "2015-02-16T15:17:36Z"}], "cf_last_resolved": "2015-02-16T15:17:36Z", "priority": "--", "mentors_detail": [], "cf_crash_signature": "", "version": "Trunk", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox59": "---", "last_change_time": "2015-02-16T15:17:36Z", "cf_platform_rel": "---", "product": "Core", "cf_status_firefox_esr52": "---", "blocks": [1029830], "qa_contact": "", "see_also": [], "cf_fx_iteration": "---", "component": "JavaScript Engine: JIT", "votes": 0, "groups": [], "cf_status_firefox60": "---", "target_milestone": "mozilla38", "is_cc_accessible": true, "status": "RESOLVED", "cf_status_thunderbird_esr52": "---", "url": "", "creator_detail": {"email": "azakai@mozilla.com", "id": 381546, "name": "azakai@mozilla.com", "real_name": "Alon Zakai (:azakai)"}, "whiteboard": "[jsbugmon:update,testComment=1,origRev=912036eeb024]", "mentors": [], "cc_detail": [{"email": "choller@mozilla.com", "id": 395101, "name": "choller@mozilla.com", "real_name": "Christian Holler (:decoder)"}, {"email": "jdemooij@mozilla.com", "id": 375297, "name": "jdemooij@mozilla.com", "real_name": "Jan de Mooij [:jandem] (PTO Mar 8)"}, {"email": "jruderman@gmail.com", "id": 11608, "name": "jruderman@gmail.com", "real_name": "Jesse Ruderman"}, {"email": "nicolas.b.pierron@mozilla.com", "id": 422187, "name": "nicolas.b.pierron@mozilla.com", "real_name": "Nicolas B. Pierron [:nbp] {backlog: ~36}"}, {"email": "nth10sd@gmail.com", "id": 132034, "name": "nth10sd@gmail.com", "real_name": "Gary Kwong [:gkw] [:nth10sd]"}, {"email": "sunfish@mozilla.com", "id": 468136, "name": "sunfish@mozilla.com", "real_name": "Dan Gohman [:sunfish]"}], "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "cf_tracking_firefox58": "---", "cf_rank": null, "is_open": false, "history": [{"changes": [{"removed": "", "field_name": "cc", "added": "gary@rumblingedge.com"}], "who": "azakai@mozilla.com", "when": "2015-01-05T18:47:09Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "jdemooij@mozilla.com"}, {"removed": "JavaScript Engine", "field_name": "component", "added": "JavaScript Engine: JIT"}], "who": "jdemooij@mozilla.com", "when": "2015-01-05T18:50:14Z"}, {"changes": [{"removed": "unspecified", "field_name": "version", "added": "Trunk"}, {"removed": "", "field_name": "keywords", "added": "assertion, regression, testcase"}, {"removed": "", "field_name": "cc", "added": "nicolas.b.pierron@mozilla.com, sunfish@mozilla.com"}, {"removed": "", "field_name": "blocks", "added": "1029830"}, {"removed": "", "field_name": "whiteboard", "added": "[jsbugmon:update,testComment=1,origRev=912036eeb024]"}, {"removed": "normal", "field_name": "severity", "added": "critical"}, {"removed": "Linux", "field_name": "op_sys", "added": "All"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(sunfish@mozilla.com)"}, {"removed": "---", "field_name": "cf_status_firefox37", "added": "affected"}], "who": "nth10sd@gmail.com", "when": "2015-01-05T20:05:12Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "choller@mozilla.com, jruderman@gmail.com"}], "who": "nth10sd@gmail.com", "when": "2015-01-05T20:05:45Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8544098, "added": "1"}], "who": "nth10sd@gmail.com", "when": "2015-01-05T20:07:11Z"}, {"changes": [{"removed": "core-security", "field_name": "groups", "added": ""}], "who": "nth10sd@gmail.com", "when": "2015-01-05T21:14:07Z"}, {"changes": [{"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "sunfish@mozilla.com"}, {"removed": "needinfo?(sunfish@mozilla.com)", "field_name": "flagtypes.name", "added": ""}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8562158, "added": "review?(nicolas.b.pierron@mozilla.com)"}], "who": "sunfish@mozilla.com", "when": "2015-02-10T16:30:32Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(nicolas.b.pierron@mozilla.com)", "attachment_id": 8562158, "added": "review+"}], "who": "nicolas.b.pierron@mozilla.com", "when": "2015-02-11T18:54:20Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla38"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2015-02-16 07:17:36"}, {"removed": "---", "field_name": "cf_status_firefox38", "added": "fixed"}], "who": "cbook@mozilla.com", "when": "2015-02-16T15:17:36Z"}], "resolution": "FIXED", "op_sys": "All", "cf_fx_points": "---", "cf_blocking_fennec": "---"}