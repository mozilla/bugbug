{"status": "UNCONFIRMED", "cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "classification": "Client Software", "creator": "support@quickmacros.com", "cc": ["adrian.florinescu@softvision.ro", "mcastelluccio@mozilla.com"], "depends_on": [], "creation_time": "2018-06-06T19:53:50Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "keywords": ["regression", "regressionwindow-wanted"], "summary": "IAccessible(ROLE_SYSTEM_TEXT): CoMarshalInterface fails; QueryInterface(IID_IUnknown) fails", "cf_last_resolved": null, "attachments": [], "assigned_to_detail": {"email": "nobody@mozilla.org", "id": 1, "name": "nobody@mozilla.org", "real_name": "Nobody; OK to take it and work on it"}, "severity": "normal", "is_confirmed": false, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 4, "comments": [{"text": "User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:62.0) Gecko/20100101 Firefox/62.0\nBuild ID: 20180606100133\n\nSteps to reproduce:\n\nIn Firefox main process, find an IAccessible object iacc and call CoMarshalInterface(istream, IID_IAccessible, iacc, MSHCTX_LOCAL, NULL, MSHLFLAGS_NORMAL).\n\n\nActual results:\n\nFor objects of role ROLE_SYSTEM_TEXT it fails and returns 0x8000FFFF. For other objects succeeds. Also succeeds if multi-process mode is off. I tested objects in web page.\n\nPossible reason: iacc->QueryInterface(IID_IUnknown) fails for objects of this role.\nAlso QueryInterface(IID_IMarshal) fails for objects of this role.\n\n\nExpected results:\n\nCoMarshalInterface should return 0.", "author": "support@quickmacros.com", "id": 13391985, "time": "2018-06-06T19:53:50Z"}, {"text": "Tested with Firefox 61.0b10 and 62.0a1. In previous versions worked, but I don't know in which exactly version this started.", "author": "support@quickmacros.com", "id": 13391988, "time": "2018-06-06T19:56:14Z"}, {"text": "Thank you for the bug report. Could you please be more detailed in the STR to help us reproduce and triage this issue. \nBest would be if you could provide a reduced test case for the above purpose.\n\nAlso, in comment 1 you say that this is tested with 61.0b10 and 62.0a1, so just to confirm: does this means that you can reproduce this issue with both versions? Also based on comment 1, if this is a regression, then could you perhaps use mozregression (https://mozilla.github.io/mozregression/) to find a regression range.", "author": "adrian.florinescu@softvision.ro", "id": 13400646, "time": "2018-06-11T12:46:42Z"}, {"text": "Strange, cannot reproduce when Firefox runs from mozregression, even when testing the same version (62.0a1), the same profile, the same pages, the same extensions, both multi-process.\n\nAnyway, the whole story:\n\nMy program:\n1. Injects a dll into the main Firefox process.\n2. The dll finds an accessible object (calls AccessibleChildren recursively) or gets from point (calls AccessibleObjectFromPoint).\n3. Then the dll marshals the found IAccessible to my process.\n\nThis is to make finding accessible objects faster. Normally makes faster ~100 times. In multi-process Firefox ~2 times. Also it allows to use ISimpleDOMNode and IAccessible2. Works with all objects in all my tested programs where dll injection is possible.\n\nIn Firefox 61.0b10 and 62.0a1 it does not work if the object has role ROLE_SYSTEM_TEXT.\n\nAlso I noticed that IAccessible::QueryInterface for ROLE_SYSTEM_TEXT objects fails if riid is IID_IUnknown. Works if IID_IAccessible or IID_IDispatch. CoMarshalInterface calls QueryInterface(IID_IUnknown) and fails when it fails.\n\nCode to reproduce:\n\nIAccessible* iacc=an_accessible_object_in_the_main_process_of_multiprocess_Firefox;\nIStream* istream=NULL; CreateStreamOnHGlobal(0, TRUE, &stream);\nHRESULT hr=CoMarshalInterface(istream, IID_IAccessible, iacc, MSHCTX_LOCAL, NULL, MSHLFLAGS_NORMAL);\nif(hr!=0) ... //0x8000FFFF if object of role ROLE_SYSTEM_TEXT", "author": "support@quickmacros.com", "id": 13400720, "time": "2018-06-11T14:41:33Z"}], "id": 1467257, "priority": "--", "mentors_detail": [], "cf_crash_signature": "", "version": "61 Branch", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox62": "---", "cf_platform_rel": "---", "product": "Firefox", "cf_status_firefox_esr52": "---", "blocks": [], "qa_contact": "", "see_also": [], "cf_fx_iteration": "---", "component": "Untriaged", "votes": 0, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "---", "cf_status_firefox61": "---", "cf_status_firefox60": "---", "target_milestone": "---", "is_cc_accessible": true, "cf_rank": null, "groups": [], "url": "", "creator_detail": {"email": "support@quickmacros.com", "id": 603297, "name": "support@quickmacros.com", "real_name": "gindi"}, "whiteboard": "", "mentors": [], "cc_detail": [{"email": "adrian.florinescu@softvision.ro", "id": 556562, "name": "adrian.florinescu@softvision.ro", "real_name": "Adrian Florinescu [:adrian_sv]"}, {"email": "mcastelluccio@mozilla.com", "id": 420453, "name": "mcastelluccio@mozilla.com", "real_name": "Marco Castelluccio [:marco]"}], "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "last_change_time": "2018-06-13T16:22:21Z", "cf_status_firefox_esr60": "---", "assigned_to": "nobody@mozilla.org", "is_open": true, "resolution": "", "op_sys": "Unspecified", "cf_fx_points": "---", "history": [{"changes": [{"removed": "", "field_name": "cc", "added": "adrian.florinescu@softvision.ro"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(support@quickmacros.com)"}], "who": "adrian.florinescu@softvision.ro", "when": "2018-06-11T12:46:42Z"}, {"changes": [{"removed": "needinfo?(support@quickmacros.com)", "field_name": "flagtypes.name", "added": ""}], "who": "support@quickmacros.com", "when": "2018-06-11T14:41:33Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "regression, regressionwindow-wanted"}, {"removed": "", "field_name": "cc", "added": "mcastelluccio@mozilla.com"}], "who": "mcastelluccio@mozilla.com", "when": "2018-06-13T16:22:21Z"}]}