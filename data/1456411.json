{"status": "RESOLVED", "cf_tracking_firefox60": "---", "cf_tracking_firefox61": "+", "classification": "Client Software", "creator": "igoldan@mozilla.com", "cc": ["dao+bmo@mozilla.com", "felipc@gmail.com", "igoldan@mozilla.com", "jmaher@mozilla.com", "josh@joshmatthews.net", "kmaglione+bmo@mozilla.com", "mconley@mozilla.com", "nika@thelayzells.com", "rwood@mozilla.com", "ryanvm@gmail.com", "Tobias.Marty@gmx.de"], "depends_on": [], "creation_time": "2018-04-24T08:58:33Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "cf_status_firefox59": "unaffected", "keywords": ["perf", "regression", "talos-regression"], "summary": "22.5 - 34.46% tp5o responsiveness (linux64, windows10-64, windows7-32) regression on push a7fc392e48ab (Fri Apr 20 2018)", "id": 1456411, "attachments": [], "assigned_to_detail": {"email": "nobody@mozilla.org", "id": 1, "name": "nobody@mozilla.org", "real_name": "Nobody; OK to take it and work on it"}, "severity": "normal", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 6, "comments": [{"text": "Talos has detected a Firefox performance regression from push:\n\nhttps://hg.mozilla.org/integration/autoland/pushloghtml?fromchange=4895ec59cf2b5240ad79fa35d3a9d32cc1f206d9&tochange=a7fc392e48ab87dc3d02c155188c9e433425c7d7\n\nAs author of one of the patches included in that push, we need your help to address this regression.\n\nRegressions:\n\n 34%  tp5o responsiveness windows10-64 pgo e10s stylo     0.31 -> 0.41\n 25%  tp5o responsiveness windows7-32 pgo e10s stylo      0.33 -> 0.41\n 23%  tp5o responsiveness linux64 pgo e10s stylo          0.49 -> 0.60\n 23%  tp5o responsiveness linux64 opt e10s stylo          0.60 -> 0.73\n\n\nYou can find links to graphs and comparison views for each of the above tests at: https://treeherder.mozilla.org/perf.html#/alerts?id=12840\n\nOn the page above you can see an alert for each affected platform as well as a link to a graph showing the history of scores for this test. There is also a link to a treeherder page showing the Talos jobs in a pushlog format.\n\nTo learn more about the regressing test(s), please see: https://wiki.mozilla.org/Buildbot/Talos/Tests\n\nFor information on reproducing and debugging the regression, either on try or locally, see: https://wiki.mozilla.org/Buildbot/Talos/Running\n\n*** Please let us know your plans within 3 business days, or the offending patch(es) will be backed out! ***\n\nOur wiki page outlines the common responses and expectations: https://wiki.mozilla.org/Buildbot/Talos/RegressionBugsHandling", "author": "igoldan@mozilla.com", "id": 13228938, "time": "2018-04-24T08:58:33Z"}, {"text": ":mconley It looks like big perf regressions got in since bug 1358712 landed. Can we do something to resolve this? Or should we back this out and find another approach?", "author": "igoldan@mozilla.com", "id": 13228942, "time": "2018-04-24T09:00:41Z"}, {"text": "Thanks, investigating.", "author": "mconley@mozilla.com", "id": 13230454, "time": "2018-04-24T18:26:21Z"}, {"text": "Just for the record, \"big\" is pretty ill-defined when it comes to e10s responsiveness regressions. .31 -> .41 is probably not a user-observable difference if it happens in consistent, small chunks. If it happens in 3 or 4 big chunks, it probably is.\n\nWe really need responsive numbers broken into percentiles...", "author": "kmaglione+bmo@mozilla.com", "id": 13230473, "time": "2018-04-24T18:31:44Z"}, {"text": "(In reply to Kris Maglione [:kmag] (long backlog; ping on IRC if you're blocked) from comment #3)\n> Just for the record, \"big\" is pretty ill-defined when it comes to e10s\n> responsiveness regressions. .31 -> .41 is probably not a user-observable\n> difference if it happens in consistent, small chunks.\n\nI suspect this is what's happening.\n\nHaving looked over some instrumented profiles, I think I know what's happening.\n\nBefore, with the sync layout flushes for the StatusPanel, when the parent process wanted to update the string in the StatusPanel and display it, it'd set the label in the (invisible) panel, and then synchronously flush layout in script to determine on which side to reveal the StatusPanel. That means that usually, in the parent, we'd have a sync flush, and then a paint to show the StatusPanel during the next refresh driver tick.\n\nWith bug 1358712, in order to avoid sync flushes, we set the label on the StatusPanel, and then wait for the next refresh driver tick to get the panel's dimensions, and then make the panel visible in a requestAnimationFrame.\n\nThat means we went from;\n\nUpdate label\n*sync layout flush*\nMake panel visible\nRefresh driver tick\n  Style\n  Layout\n  Paint\n\nto:\n\nUpdate label\nRefresh driver tick\n  Style\n  Layout\n  Paint\nGet cheap dimensions for panel, wait for next refresh driver tick...\nRefresh driver tick\n  Make panel visible\n  Style\n  Layout\n  Paint\n\n\nSo we're spreading the work out a little bit in the main thread of the parent process over multiple refresh driver ticks, which I think is affecting the responsiveness score, since we're more likely to impact more EventTracer samples.\n\nI don't think this is user perceivable, and I believe the removal of the layout flush is worth it. I'm going to WONTFIX this for now.", "author": "mconley@mozilla.com", "id": 13236390, "time": "2018-04-26T19:02:56Z"}, {"text": "Thanks for the detailed analysis, Mike.", "author": "ryanvm@gmail.com", "id": 13236464, "time": "2018-04-26T19:34:45Z"}], "cf_last_resolved": "2018-04-26T19:02:56Z", "priority": "--", "mentors_detail": [], "cf_crash_signature": "", "version": "unspecified", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox62": "---", "cf_platform_rel": "---", "product": "Firefox", "cf_status_firefox_esr52": "unaffected", "blocks": [1445214, 1358712], "qa_contact": "", "see_also": [], "cf_fx_iteration": "---", "component": "General", "votes": 0, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "---", "cf_status_firefox61": "wontfix", "cf_status_firefox60": "unaffected", "target_milestone": "---", "is_cc_accessible": true, "cf_rank": null, "groups": [], "url": "", "creator_detail": {"email": "igoldan@mozilla.com", "id": 590618, "name": "igoldan@mozilla.com", "real_name": "Ionu\u021b Goldan [:igoldan], Performance Sheriffing"}, "whiteboard": "", "mentors": [], "cc_detail": [{"email": "dao+bmo@mozilla.com", "id": 219124, "name": "dao+bmo@mozilla.com", "real_name": "D\u00e3o Gottwald [::dao]"}, {"email": "felipc@gmail.com", "id": 208747, "name": "felipc@gmail.com", "real_name": ":Felipe Gomes (needinfo me!)"}, {"email": "igoldan@mozilla.com", "id": 590618, "name": "igoldan@mozilla.com", "real_name": "Ionu\u021b Goldan [:igoldan], Performance Sheriffing"}, {"email": "jmaher@mozilla.com", "id": 324370, "name": "jmaher@mozilla.com", "real_name": "Joel Maher ( :jmaher ) (UTC-4)"}, {"email": "josh@joshmatthews.net", "id": 241497, "name": "josh@joshmatthews.net", "real_name": "Josh Matthews [:jdm]"}, {"email": "kmaglione+bmo@mozilla.com", "id": 106098, "name": "kmaglione+bmo@mozilla.com", "real_name": "Kris Maglione [:kmag]"}, {"email": "mconley@mozilla.com", "id": 403756, "name": "mconley@mozilla.com", "real_name": "Mike Conley (:mconley) (:\u2699\ufe0f) (Catching up on needinfos / reviews)"}, {"email": "nika@thelayzells.com", "id": 534482, "name": "nika@thelayzells.com", "real_name": ":Nika Layzell"}, {"email": "rwood@mozilla.com", "id": 447387, "name": "rwood@mozilla.com", "real_name": "Robert Wood [:rwood]"}, {"email": "ryanvm@gmail.com", "id": 75935, "name": "ryanvm@gmail.com", "real_name": "Ryan VanderMeulen [:RyanVM]"}, {"email": "Tobias.Marty@gmx.de", "id": 572549, "name": "Tobias.Marty@gmx.de", "real_name": "TMart"}], "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "last_change_time": "2018-05-02T13:24:19Z", "cf_status_firefox_esr60": "---", "assigned_to": "nobody@mozilla.org", "is_open": false, "resolution": "WONTFIX", "op_sys": "Unspecified", "cf_fx_points": "---", "history": [{"changes": [{"removed": "Untriaged", "field_name": "component", "added": "General"}], "who": "igoldan@mozilla.com", "when": "2018-04-24T08:59:13Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(mconley@mozilla.com)"}], "who": "igoldan@mozilla.com", "when": "2018-04-24T09:00:41Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "ryanvm@gmail.com"}, {"removed": "---", "field_name": "cf_status_firefox_esr52", "added": "unaffected"}, {"removed": "---", "field_name": "cf_status_firefox59", "added": "unaffected"}, {"removed": "---", "field_name": "cf_status_firefox60", "added": "unaffected"}, {"removed": "---", "field_name": "cf_tracking_firefox61", "added": "+"}, {"removed": "---", "field_name": "cf_status_firefox61", "added": "affected"}], "who": "ryanvm@gmail.com", "when": "2018-04-24T09:01:21Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "Tobias.Marty@gmx.de"}], "who": "Tobias.Marty@gmx.de", "when": "2018-04-25T07:53:36Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "WONTFIX"}, {"removed": "needinfo?(mconley@mozilla.com)", "field_name": "flagtypes.name", "added": ""}, {"removed": "", "field_name": "cf_last_resolved", "added": "2018-04-26 19:02:56"}], "who": "mconley@mozilla.com", "when": "2018-04-26T19:02:56Z"}, {"changes": [{"removed": "affected", "field_name": "cf_status_firefox61", "added": "wontfix"}], "who": "ryanvm@gmail.com", "when": "2018-04-26T19:34:45Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "josh@joshmatthews.net"}], "who": "josh@joshmatthews.net", "when": "2018-05-01T17:47:07Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "grayshade@gmail.com"}], "who": "grayshade@gmail.com", "when": "2018-05-02T13:24:16Z"}, {"changes": [{"removed": "grayshade@gmail.com", "field_name": "cc", "added": ""}], "who": "grayshade@gmail.com", "when": "2018-05-02T13:24:19Z"}]}