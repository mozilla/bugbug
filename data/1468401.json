{"cf_tracking_thunderbird_esr52": "---", "status": "RESOLVED", "cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "cf_tracking_firefox62": "---", "creator": "dothayer@mozilla.com", "mentors_detail": [], "depends_on": [], "cf_status_firefox_esr60": "unaffected", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "keywords": ["regression"], "cc_detail": [{"email": "matt.woodrow@gmail.com", "id": 380838, "name": "matt.woodrow@gmail.com", "real_name": "Matt Woodrow (:mattwoodrow)"}, {"email": "mcastelluccio@mozilla.com", "id": 420453, "name": "mcastelluccio@mozilla.com", "real_name": "Marco Castelluccio [:marco]"}, {"email": "mconley@mozilla.com", "id": 403756, "name": "mconley@mozilla.com", "real_name": "Mike Conley (:mconley) (:\u2699\ufe0f) (Catching up on needinfos / reviews)"}], "cf_last_resolved": "2018-06-15T09:53:53Z", "attachments": [{"creator": "dothayer@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-06-14T22:02:30Z", "type_id": 4, "creation_date": "2018-06-14T16:56:51Z", "id": 1768952, "setter": "matt.woodrow@gmail.com"}], "content_type": "text/x-review-board-request", "id": 8985389}], "votes": 1, "classification": "Components", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 8, "comments": [{"text": "Seeing a somewhat substantial regression[1] in the CSS_bouncing_filter_circles test[2] as a result of bug 1467619. Running the test with layers.draw-borders on, I notice that before the change, we just had a bunch of little textures, one for each circle. With 1467619, we combine some of the layers because mFilters changes[3], and what we get are occasionally some large rectangles closing in multiple circles. The end result is that we are painting and compositing a greater area because of the space in between the circles that we now have to \"draw\". So overall we're just doing more work. Looking into how we can mitigate this, but any thoughts from more experienced people are welcome.\n\n[1] https://treeherder.mozilla.org/perf.html#/graphs?timerange=7776000&series=mozilla-central,1661664,1,1\n[2] https://browserbench.org/MotionMark/developer.html?test-interval=15&display=minimal&tiles=big&controller=fixed&frame-rate=30&kalman-process-error=1&kalman-measurement-error=4&time-measurement=performance&suite-name=HTMLsuite&test-name=CSSbouncingfiltercircles&complexity=189\n[3] https://searchfox.org/mozilla-central/rev/d544b118e26422877108c42723b26e9bb4539721/layout/style/nsStyleStruct.cpp#4840", "author": "dothayer@mozilla.com", "id": 13402773, "time": "2018-06-12T21:51:22Z"}, {"text": "(In reply to Doug Thayer [:dthayer] (PTO on June 4) from comment #0)\n> The end result is that we are painting and compositing a greater area because of the\n> space in between the circles that we now have to \"draw\".\n\nClarifying: we're compositing the same area, but the total size of all of the textures we have to composite is increased.", "author": "dothayer@mozilla.com", "id": 13402775, "time": "2018-06-12T21:53:07Z"}, {"text": "Tentatively (I'm completely unfamiliar with this code), it looks like in ContainerState::ProcessDisplayItems, when finishing an inactive layer tree (here?[1]), we could get a measure of how sparse the rect is - maybe the rect's area compared to the area of all of the items inside it. If it's past a threshold, we would need to undo the work on it and process all of its children as though they were active layers (if undoing is not possible, we would need to look ahead in order to do this? Not sure yet how to accomplish this.)\n\nMatt, does any of this sound at all reasonable?\n\n[1] https://searchfox.org/mozilla-central/rev/d544b118e26422877108c42723b26e9bb4539721/layout/painting/FrameLayerBuilder.cpp#4809", "author": "dothayer@mozilla.com", "id": 13403102, "time": "2018-06-13T04:25:25Z"}, {"text": "Created attachment 8985389\nBug 1468401 - Restrict ACTIVITY_TRIGGERED_REPAINT heuristic\n\nSee comment for explanation. This seemed like the most conservative\nway to solve the motionmark regression from bug 1468401.\n\nReview commit: https://reviewboard.mozilla.org/r/251022/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/251022/", "author": "dothayer@mozilla.com", "id": 13405389, "time": "2018-06-14T16:56:51Z"}, {"text": "Comment on attachment 8985389\nBug 1468401 - Restrict ACTIVITY_TRIGGERED_REPAINT heuristic\n\nhttps://reviewboard.mozilla.org/r/251022/#review257360\n\nHmm, bit sad, as this is somewhat unrelated to the actual problem that's causing the regression. Playing an unbounded game of whack-a-mole is pretty unappealing though, so just restricting the previous optimization is probably ok.\n\nI do think getting the smaller layers pref enabled, and making sole-transforms active is valuable, but not a huge priority.", "author": "matt.woodrow@gmail.com", "id": 13405984, "time": "2018-06-14T22:02:30Z"}, {"text": "Pushed by dothayer@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/b9f0b3d013f2\nRestrict ACTIVITY_TRIGGERED_REPAINT heuristic r=mattwoodrow", "author": "pulsebot@bots.tld", "id": 13406096, "time": "2018-06-14T23:17:31Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/b9f0b3d013f2", "author": "aciure@mozilla.com", "id": 13406542, "time": "2018-06-15T09:53:53Z"}, {"text": "Looks like we kept the animometer win and dropped the htmlsuite regression, as intended:\n\nhttps://treeherder.mozilla.org/perf.html#/graphs?series=mozilla-central,1661649,1,1&series=mozilla-central,1661659,1,1", "author": "dothayer@mozilla.com", "id": 13407354, "time": "2018-06-15T19:48:26Z"}], "id": 1468401, "priority": "--", "cc": ["matt.woodrow@gmail.com", "mcastelluccio@mozilla.com", "mconley@mozilla.com"], "cf_crash_signature": "", "version": "unspecified", "is_cc_accessible": true, "cf_tracking_firefox_esr52": "---", "see_also": [], "cf_tracking_thunderbird_esr60": "---", "cf_platform_rel": "---", "product": "Core", "cf_fx_iteration": "---", "blocks": [1467619], "qa_contact": "", "creation_time": "2018-06-12T21:51:22Z", "cf_status_firefox_esr52": "unaffected", "component": "Graphics: Layers", "assigned_to_detail": {"email": "dothayer@mozilla.com", "id": 582499, "name": "dothayer@mozilla.com", "real_name": "Doug Thayer [:dthayer] (PTO on June 4)"}, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "fixed", "cf_status_firefox61": "unaffected", "cf_status_firefox60": "unaffected", "target_milestone": "mozilla62", "cf_rank": null, "cf_qa_whiteboard": "", "severity": "normal", "groups": [], "cf_status_thunderbird_esr52": "---", "url": "", "cf_status_thunderbird_esr60": "---", "creator_detail": {"email": "dothayer@mozilla.com", "id": 582499, "name": "dothayer@mozilla.com", "real_name": "Doug Thayer [:dthayer] (PTO on June 4)"}, "whiteboard": "", "mentors": [], "summary": "motionmark_htmlsuite CSS_bouncing_filter_circles pgo regression", "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [{"requestee": "matt.woodrow@gmail.com", "status": "?", "name": "needinfo", "modification_date": "2018-06-13T04:25:25Z", "type_id": 800, "creation_date": "2018-06-13T04:25:25Z", "id": 1768519, "setter": "dothayer@mozilla.com"}], "last_change_time": "2018-06-18T00:53:43Z", "assigned_to": "dothayer@mozilla.com", "is_open": false, "history": [{"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(matt.woodrow@gmail.com)"}], "who": "dothayer@mozilla.com", "when": "2018-06-13T04:25:25Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8985389, "added": "review?(matt.woodrow@gmail.com)"}], "who": "dothayer@mozilla.com", "when": "2018-06-14T16:56:51Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(matt.woodrow@gmail.com)", "attachment_id": 8985389, "added": "review+"}], "who": "matt.woodrow@gmail.com", "when": "2018-06-14T22:02:30Z"}, {"changes": [{"removed": "ASSIGNED", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla62"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2018-06-15 09:53:53"}, {"removed": "---", "field_name": "cf_status_firefox62", "added": "fixed"}], "who": "aciure@mozilla.com", "when": "2018-06-15T09:53:53Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "regression"}, {"removed": "", "field_name": "cc", "added": "mcastelluccio@mozilla.com"}], "who": "mcastelluccio@mozilla.com", "when": "2018-06-15T19:31:38Z"}, {"changes": [{"removed": "---", "field_name": "cf_status_firefox_esr52", "added": "unaffected"}, {"removed": "---", "field_name": "cf_status_firefox_esr60", "added": "unaffected"}, {"removed": "---", "field_name": "cf_status_firefox60", "added": "unaffected"}, {"removed": "---", "field_name": "cf_status_firefox61", "added": "unaffected"}], "who": "ryanvm@gmail.com", "when": "2018-06-18T00:53:43Z"}], "resolution": "FIXED", "op_sys": "Unspecified", "cf_fx_points": "---", "cf_blocking_fennec": "---"}