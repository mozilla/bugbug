{"status": "RESOLVED", "cf_tracking_firefox60": "---", "attachments": [{"creator": "nfitzgerald@mozilla.com", "is_obsolete": 1, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2015-04-08T16:24:14Z", "type_id": 748, "creation_date": "2015-04-07T04:07:45Z", "id": 1140430, "setter": "bugs@pettay.fi"}], "content_type": "text/plain", "id": 8588909}, {"creator": "nfitzgerald@mozilla.com", "is_obsolete": 1, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2015-04-07T16:37:43Z", "type_id": 748, "creation_date": "2015-04-07T04:08:03Z", "id": 1140431, "setter": "jordan@jsantell.com"}], "content_type": "text/plain", "id": 8588910}, {"creator": "nfitzgerald@mozilla.com", "is_obsolete": 1, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2015-04-07T16:53:21Z", "type_id": 748, "creation_date": "2015-04-07T04:08:17Z", "id": 1140432, "setter": "jordan@jsantell.com"}], "content_type": "text/plain", "id": 8588911}, {"creator": "nfitzgerald@mozilla.com", "is_obsolete": 0, "is_patch": 1, "flags": [], "content_type": "text/plain", "id": 8589766}, {"creator": "nfitzgerald@mozilla.com", "is_obsolete": 0, "is_patch": 1, "flags": [], "content_type": "text/plain", "id": 8589767}, {"creator": "nfitzgerald@mozilla.com", "is_obsolete": 0, "is_patch": 1, "flags": [], "content_type": "text/plain", "id": 8589768}], "classification": "Client Software", "creator": "nfitzgerald@mozilla.com", "cc": ["bugs@pettay.fi", "jordan@jsantell.com", "nfitzgerald@mozilla.com"], "depends_on": [1145247], "creation_time": "2015-04-07T02:36:38Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "x86", "cf_status_firefox58": "---", "cf_status_firefox59": "---", "keywords": [], "summary": "Add profiler timeline markers for HTML/XML parsing", "cf_last_resolved": "2015-04-09T00:27:34Z", "assigned_to_detail": {"email": "nfitzgerald@mozilla.com", "id": 417695, "name": "nfitzgerald@mozilla.com", "real_name": "Nick Fitzgerald [:fitzgen] [\u23f0PST; UTC-8]"}, "severity": "normal", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "assigned_to": "nfitzgerald@mozilla.com", "comment_count": 17, "comments": [{"text": "We should have timeline markers for tracing HTML/XML parsing.", "author": "nfitzgerald@mozilla.com", "id": 10123874, "time": "2015-04-07T02:36:38Z"}, {"text": "Created attachment 8588909\nPart 1: Add timeline tracing markers for HTML and XML parsing", "author": "nfitzgerald@mozilla.com", "id": 10124083, "time": "2015-04-07T04:06:27Z"}, {"text": "Created attachment 8588910\nPart 2: Show XML and HTML parsing markers in the performance tool", "author": "nfitzgerald@mozilla.com", "id": 10124084, "time": "2015-04-07T04:06:35Z"}, {"text": "Created attachment 8588911\nPart 3: Add a test for HTML parsing markers", "author": "nfitzgerald@mozilla.com", "id": 10124085, "time": "2015-04-07T04:06:50Z"}, {"text": "Comment on attachment 8588910\nPart 2: Show XML and HTML parsing markers in the performance tool\n\nReview of attachment 8588910:\n-----------------------------------------------------------------\n\nr+ with rebasing changes, and using \"colorName\"\n\n::: browser/devtools/shared/timeline/global.js\n@@ +65,5 @@\n> +  \"Parse XML\": {\n> +    group: 1,\n> +    fill: \"hsl(39,82%,69%)\",\n> +    stroke: \"hsl(39,82%,49%)\",\n> +    label: L10N.getStr(\"timeline.label.parseXML\")\n\nAs of bug 1150112, the fill and stroke properties are gone, replaced by `colorName` -- these use the theme colors, so can be for example:\n\n`colorName: \"highlight-purple'`\n\nColors currently used are here: https://developer.mozilla.org/en-US/docs/Tools/DevToolsColors\n\nThey may be ugly in some scenarios now, but we're working on good themeing this release. Rebasing will give you the updated globals.js", "author": "jordan@jsantell.com", "id": 10126483, "time": "2015-04-07T16:37:43Z"}, {"text": "Comment on attachment 8588911\nPart 3: Add a test for HTML parsing markers\n\nReview of attachment 8588911:\n-----------------------------------------------------------------\n\n::: browser/devtools/performance/test/browser.ini\n@@ +69,5 @@\n>  [browser_perf-overview-selection-01.js]\n>  [browser_perf-overview-selection-02.js]\n>  [browser_perf-overview-selection-03.js]\n>  [browser_perf-overview-time-interval.js]\n> +[browser_perf-parse-html-markers.js]\n\nLet's change this to browser_markers-parse-html.js, for example, so we can easily point marker tests to others, maybe? We should probably figure out where we test markers maybe OUTSIDE of perf tools for others to make tests, not sure where we wound up when talking about that (for op instrumentation)\n\n::: browser/devtools/performance/test/browser_perf-parse-html-markers.js\n@@ +27,5 @@\n> +  let { target, front } = yield initBackend(TEST_URL);\n> +\n> +  const markers = yield getMarkers(front);\n> +  debugger;\n> +  ok(markers.some(m => m.name === \"Parse HTML\"),\n\nare we testing anything else on these markers? Not sure what other properties they have that would be relevant (stack?)", "author": "jordan@jsantell.com", "id": 10126586, "time": "2015-04-07T16:53:21Z"}, {"text": "Comment on attachment 8588909\nPart 1: Add timeline tracing markers for HTML and XML parsing\n\nSo what case do you want to capture here?\ninnerHTML and range's createContextualFragment().\n\nThe patch doesn't catch the common case when innerHTML is used for text only.\nSee FragmentOrElement::SetInnerHTMLInternal", "author": "bugs@pettay.fi", "id": 10126672, "time": "2015-04-07T17:09:55Z"}, {"text": "Looked at all SetInnerHTML calls:\n\nFragmentOrElement::SetInnerHTMLInternal - Has a fast path where it avoids parsing HTML if for plain text, as you pointed out. I think it is fine to implicitly expose that we avoid parsing HTML when there are no tags by not emitting markers for this fast path. The slow path will be traced through nsContentUtils::ParseHTMLFragment. Exposing performance tools is all about exposing implementation, after all :)\n\nElement::SetInnerHTML - Calls FragmentOrElement::SetInnerHTMLInternal. See above.\n\nShadowRoot::SetInnerHTML - Calls FragmentOrElement::SetInnerHTMLInternal. See above.\n\nHTMLScriptElement::SetInnerHTML - Doesn't parse HTML, just sets text content. Don't think this makes sense because we are trying to trace HTML parsing here, not setting any innerHTML.\n\nHTMLStyleElement::SetInnerHTML - This sets text content and then I think it re-parses CSS and recalculates styles and then layout. We have markers for style recalc and layout, but not for CSS parsing yet. I think we should have that, but in a different bug. Filed bug 1152097.", "author": "nfitzgerald@mozilla.com", "id": 10128355, "time": "2015-04-07T22:18:35Z"}, {"text": "Comment on attachment 8588909\nPart 1: Add timeline tracing markers for HTML and XML parsing\n\nRe-flagging for review based on comment 7.", "author": "nfitzgerald@mozilla.com", "id": 10128364, "time": "2015-04-07T22:19:32Z"}, {"text": "I thought I found a bug in that I wasn't getting \"Parse HTML\" markers when refreshing a page, however :smaug tells me that is done off-main-thread, so I think we can punt on it until we figure out how to trace multiple threads well. Filed bug 1152416 for figuring out which events/tasks we should trace during page load.", "author": "nfitzgerald@mozilla.com", "id": 10132024, "time": "2015-04-08T17:22:47Z"}, {"text": "Created attachment 8589766\nPart 1: Add timeline tracing markers for HTML and XML parsing", "author": "nfitzgerald@mozilla.com", "id": 10132289, "time": "2015-04-08T17:56:11Z"}, {"text": "Created attachment 8589767\nPart 2: Show XML and HTML parsing markers in the performance tool", "author": "nfitzgerald@mozilla.com", "id": 10132294, "time": "2015-04-08T17:56:19Z"}, {"text": "Created attachment 8589768\nPart 3: Add a test for HTML parsing markers", "author": "nfitzgerald@mozilla.com", "id": 10132296, "time": "2015-04-08T17:56:29Z"}, {"text": "remote:   https://hg.mozilla.org/integration/fx-team/rev/33842f1465fe\nremote:   https://hg.mozilla.org/integration/fx-team/rev/4542c8a866bd\nremote:   https://hg.mozilla.org/integration/fx-team/rev/bf3d9456b067", "author": "nfitzgerald@mozilla.com", "id": 10132458, "time": "2015-04-08T18:27:34Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/33842f1465fe\nhttps://hg.mozilla.org/mozilla-central/rev/4542c8a866bd\nhttps://hg.mozilla.org/mozilla-central/rev/bf3d9456b067", "author": "kwierso@gmail.com", "id": 10134093, "time": "2015-04-09T00:27:34Z"}, {"text": "Got failures for this patch/test in a try push https://treeherder.mozilla.org/#/jobs?repo=try&revision=4688879dc761", "author": "jordan@jsantell.com", "id": 10134698, "time": "2015-04-09T04:21:18Z"}, {"text": "Disregard comment #15, it actually is an issue with console.profile and parsing HTML.", "author": "jordan@jsantell.com", "id": 10135478, "time": "2015-04-09T10:18:47Z"}], "id": 1151703, "priority": "--", "mentors_detail": [], "cf_crash_signature": "", "version": "unspecified", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox59": "---", "last_change_time": "2015-04-09T10:18:47Z", "cf_platform_rel": "---", "product": "Firefox", "cf_status_firefox_esr52": "---", "blocks": [1145271], "qa_contact": "", "see_also": ["https://bugzilla.mozilla.org/show_bug.cgi?id=1152097", "https://bugzilla.mozilla.org/show_bug.cgi?id=1152416"], "cf_fx_iteration": "---", "component": "Developer Tools: Performance Tools (Profiler/Timeline)", "votes": 0, "groups": [], "cf_status_firefox60": "---", "cf_status_firefox40": "fixed", "target_milestone": "Firefox 40", "is_cc_accessible": true, "url": "", "creator_detail": {"email": "nfitzgerald@mozilla.com", "id": 417695, "name": "nfitzgerald@mozilla.com", "real_name": "Nick Fitzgerald [:fitzgen] [\u23f0PST; UTC-8]"}, "whiteboard": "", "mentors": [], "cc_detail": [{"email": "bugs@pettay.fi", "id": 39966, "name": "bugs@pettay.fi", "real_name": "Olli Pettay [:smaug]"}, {"email": "jordan@jsantell.com", "id": 464691, "name": "jordan@jsantell.com", "real_name": "Jordan Santell [:jsantell] [@jsantell]"}, {"email": "nfitzgerald@mozilla.com", "id": 417695, "name": "nfitzgerald@mozilla.com", "real_name": "Nick Fitzgerald [:fitzgen] [\u23f0PST; UTC-8]"}], "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "cf_tracking_firefox58": "---", "cf_rank": null, "is_open": false, "resolution": "FIXED", "op_sys": "Mac OS X", "cf_fx_points": "---", "history": [{"changes": [{"removed": "", "field_name": "blocks", "added": "1145271"}], "who": "nfitzgerald@mozilla.com", "when": "2015-04-07T02:36:46Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1145247"}], "who": "nfitzgerald@mozilla.com", "when": "2015-04-07T02:38:19Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "bugs@pettay.fi"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8588909, "added": "review?(bugs@pettay.fi)"}], "who": "nfitzgerald@mozilla.com", "when": "2015-04-07T04:07:45Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "jsantell@mozilla.com"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8588910, "added": "review?(jsantell@mozilla.com)"}], "who": "nfitzgerald@mozilla.com", "when": "2015-04-07T04:08:03Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8588911, "added": "review?(jsantell@mozilla.com)"}], "who": "nfitzgerald@mozilla.com", "when": "2015-04-07T04:08:17Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "nfitzgerald@mozilla.com"}], "who": "nfitzgerald@mozilla.com", "when": "2015-04-07T04:08:28Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(jsantell@mozilla.com)", "attachment_id": 8588910, "added": "review+"}], "who": "jordan@jsantell.com", "when": "2015-04-07T16:37:43Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(jsantell@mozilla.com)", "attachment_id": 8588911, "added": "review+"}], "who": "jordan@jsantell.com", "when": "2015-04-07T16:53:21Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(bugs@pettay.fi)", "attachment_id": 8588909, "added": "review-"}], "who": "bugs@pettay.fi", "when": "2015-04-07T17:09:55Z"}, {"changes": [{"removed": "", "field_name": "see_also", "added": "https://bugzilla.mozilla.org/show_bug.cgi?id=1152097"}], "who": "nfitzgerald@mozilla.com", "when": "2015-04-07T22:18:35Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review-", "attachment_id": 8588909, "added": "review?(bugs@pettay.fi)"}], "who": "nfitzgerald@mozilla.com", "when": "2015-04-07T22:19:32Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(bugs@pettay.fi)", "attachment_id": 8588909, "added": "review+"}], "who": "bugs@pettay.fi", "when": "2015-04-08T16:24:14Z"}, {"changes": [{"removed": "", "field_name": "see_also", "added": "https://bugzilla.mozilla.org/show_bug.cgi?id=1152416"}], "who": "nfitzgerald@mozilla.com", "when": "2015-04-08T17:22:47Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8588909, "added": "1"}], "who": "nfitzgerald@mozilla.com", "when": "2015-04-08T17:56:11Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8588910, "added": "1"}], "who": "nfitzgerald@mozilla.com", "when": "2015-04-08T17:56:19Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8588911, "added": "1"}], "who": "nfitzgerald@mozilla.com", "when": "2015-04-08T17:56:29Z"}, {"changes": [{"removed": "ASSIGNED", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "Firefox 40"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2015-04-08 17:27:34"}, {"removed": "---", "field_name": "cf_status_firefox40", "added": "fixed"}], "who": "kwierso@gmail.com", "when": "2015-04-09T00:27:34Z"}]}