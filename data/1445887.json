{"cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "classification": "Components", "creator": "xuxinhang4567@126.com", "mentors_detail": [], "depends_on": [], "creation_time": "2018-03-15T09:07:44Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "keywords": ["regression"], "summary": "DevTool shows wrong return value of Promise#then", "cf_last_resolved": null, "attachments": [], "assigned_to_detail": {"email": "nobody@mozilla.org", "id": 1, "name": "nobody@mozilla.org", "real_name": "Nobody; OK to take it and work on it"}, "severity": "normal", "is_confirmed": true, "is_creator_accessible": true, "comments": [{"text": "User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:58.0) Gecko/20100101 Firefox/58.0\nBuild ID: 20180206200532\n\nSteps to reproduce:\n\nRun the following code in Devtool's Console.\n\nPromise.resolve(123).then(() => 456)\n\n\n\nActual results:\n\nPromise { <state>: \"pending\" }\n\nDevTool's output can not reflect the real value.\n\n\nExpected results:\n\nPromise {[[PromiseStatus]]: \"resolved\", [[PromiseValue]]: 456}\n\nThe above console output is from Chrome.", "author": "xuxinhang4567@126.com", "id": 13130175, "time": "2018-03-15T09:07:44Z"}, {"text": "User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:61.0) Gecko/20100101 Firefox/61.0\nFirefox: 61.0a1, Build ID 20180320100122\n\nI have managed to reproduce the issue on Windows 10, Mac 10.13, and Arch Linux, with Firefox release (59.0.1) and the latest Nightly (61.0a1) build. \n\nHowever, I've also tried the same in different browsers and have conflicting results:\nChrome - Promise\u00a0{<resolved>: 456}\nEdge - [object Promise]{}\nOpera - Promise\u00a0{<resolved>: 456}\nCliqz - Promise { <state>: \"pending\" }\nInternet Explorer - Syntax error\n\nAlso, using the Mozregression tool, I've tracked this issue until Firefox 36 (see the pushlog from bellow) and bug #1033153 stands out.\n\nPushlog:\n\nLast good revision: 441055ff60e5 (2014-10-26)\nFirst bad revision: da125623d9cb (2014-10-27)\nPushlog:\nhttps://hg.mozilla.org/mozilla-central/pushloghtml?fromchange=441055ff60e5&tochange=da125623d9cb\n\n@Jason, could you please give us your opinion regarding this behavior?", "author": "marius.coman@softvision.ro", "id": 13142662, "time": "2018-03-20T14:58:21Z"}, {"text": "I think this bug is from FF DevTool, instead of JavaScript engine.\n\nMaybe the following code snippets can explain my view. You can see, the outputs by `console.log` are correct, which means JS engine can execute the code correctly. But, the devtool outputs for expression values are wrong. \n\n\n\nnew Promise((resolve) => resolve(123))\n.then(() => console.log(456))\n.then(() => console.log(789))\n\n\nnew Promise((resolve) => 123)\n.then(() => console.log(456))\n.then(() => console.log(789))", "author": "xuxinhang4567@126.com", "id": 13153811, "time": "2018-03-25T04:15:04Z"}, {"text": "I believe this is an issue with how console messages are shown.", "author": "jlaster@mozilla.com", "id": 13169177, "time": "2018-03-30T15:46:03Z"}, {"text": "This looks similar to Bug 1439963\nAnd I think it might have regressed in Bug 1033153, but I'm not sure how it was working before.\n\nA workaround would be to always console.log in then or catch `Promise.resolve(123).then(() => 456).then(console.log)`, but this is not ideal for sure. I'll have a look when I can", "author": "nchevobbe@mozilla.com", "id": 13169211, "time": "2018-03-30T15:59:39Z"}, {"text": "So annoying, I always need to use something like\n  promise.then(console.log, console.error)\n\nMaybe the console could wait a tick, but it will be a bit inconsistent. Chrome behaves like this:\n  Promise.resolve().then(() => 123);       // Promise\u00a0{<resolved>: 123}\n  new Promise(f => setTimeout(f, 0, 123)); // Promise\u00a0{<pending>}\n\nSo I think what should be fixed is bug 1380711. Then, no matter whether the promise was previewed before or after being resolved, you can inspect it and see the resolution. Chrome does this.", "author": "oriol-bugzilla@hotmail.com", "id": 13256709, "time": "2018-05-05T22:53:54Z"}], "id": 1445887, "priority": "P3", "platform": "Unspecified", "comment_count": 6, "version": "58 Branch", "is_cc_accessible": true, "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox62": "---", "status": "NEW", "product": "DevTools", "cf_fx_iteration": "---", "blocks": [], "qa_contact": "", "see_also": ["https://bugzilla.mozilla.org/show_bug.cgi?id=1380711"], "cf_status_firefox_esr52": "---", "component": "Console", "votes": 0, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "---", "cf_status_firefox61": "---", "cf_status_firefox60": "---", "target_milestone": "---", "cc": ["jlaster@mozilla.com", "marius.coman@softvision.ro", "mcastelluccio@mozilla.com", "nchevobbe@mozilla.com", "oriol-bugzilla@hotmail.com"], "groups": [], "url": "", "creator_detail": {"email": "xuxinhang4567@126.com", "id": 613933, "name": "xuxinhang4567@126.com", "real_name": ""}, "whiteboard": "", "mentors": [], "cc_detail": [{"email": "jlaster@mozilla.com", "id": 555817, "name": "jlaster@mozilla.com", "real_name": "Jason Laster [:jlast]"}, {"email": "marius.coman@softvision.ro", "id": 599795, "name": "marius.coman@softvision.ro", "real_name": "Marius Coman [:cmarius]"}, {"email": "mcastelluccio@mozilla.com", "id": 420453, "name": "mcastelluccio@mozilla.com", "real_name": "Marco Castelluccio [:marco]"}, {"email": "nchevobbe@mozilla.com", "id": 557153, "name": "nchevobbe@mozilla.com", "real_name": "Nicolas Chevobbe [:nchevobbe]"}, {"email": "oriol-bugzilla@hotmail.com", "id": 541576, "name": "oriol-bugzilla@hotmail.com", "real_name": "Oriol Brufau [:Oriol]"}], "alias": null, "dupe_of": null, "flags": [], "last_change_time": "2018-06-13T17:24:18Z", "cf_status_firefox_esr60": "---", "assigned_to": "nobody@mozilla.org", "is_open": true, "cf_qa_whiteboard": "", "resolution": "", "op_sys": "Unspecified", "cf_fx_points": "---", "history": [{"changes": [{"removed": "", "field_name": "cc", "added": "jlaster@mozilla.com, marius.coman@softvision.ro"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(jlaster@mozilla.com)"}], "who": "marius.coman@softvision.ro", "when": "2018-03-20T14:58:21Z"}, {"changes": [{"removed": "UNCONFIRMED", "field_name": "status", "added": "NEW"}, {"removed": "0", "field_name": "is_confirmed", "added": "1"}], "who": "marius.coman@softvision.ro", "when": "2018-03-20T15:03:53Z"}, {"changes": [{"removed": "Untriaged", "field_name": "component", "added": "Developer Tools: Console"}, {"removed": "needinfo?(jlaster@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "jlaster@mozilla.com", "when": "2018-03-30T15:45:15Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "nchevobbe@mozilla.com"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(nchevobbe@mozilla.com)"}], "who": "jlaster@mozilla.com", "when": "2018-03-30T15:46:03Z"}, {"changes": [{"removed": "--", "field_name": "priority", "added": "P3"}, {"removed": "needinfo?(nchevobbe@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "nchevobbe@mozilla.com", "when": "2018-03-30T15:59:39Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "oriol-bugzilla@hotmail.com"}, {"removed": "", "field_name": "see_also", "added": "https://bugzilla.mozilla.org/show_bug.cgi?id=1380711"}], "who": "oriol-bugzilla@hotmail.com", "when": "2018-05-05T22:53:54Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "regression"}, {"removed": "", "field_name": "cc", "added": "mcastelluccio@mozilla.com"}], "who": "mcastelluccio@mozilla.com", "when": "2018-05-07T18:36:21Z"}, {"changes": [{"removed": "Firefox", "field_name": "product", "added": "DevTools"}], "who": "automation@bmo.tld", "when": "2018-06-13T17:24:18Z"}]}