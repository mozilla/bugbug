{"cf_tracking_thunderbird_esr52": "---", "cf_tracking_firefox60": "+", "attachments": [{"creator": "mixedpuppy@gmail.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-04-20T20:44:51Z", "type_id": 4, "creation_date": "2018-04-20T19:09:38Z", "id": 1747103, "setter": "lgreco@mozilla.com"}, {"status": "+", "name": "approval-mozilla-beta", "modification_date": "2018-04-26T13:41:06Z", "type_id": 721, "creation_date": "2018-04-24T14:18:28Z", "id": 1748253, "setter": "jcristau@mozilla.com"}, {"status": "+", "name": "approval-mozilla-release", "modification_date": "2018-04-26T13:41:06Z", "type_id": 737, "creation_date": "2018-04-26T13:41:06Z", "id": 1749404, "setter": "jcristau@mozilla.com"}], "content_type": "text/x-review-board-request", "id": 8969765}, {"creator": "mixedpuppy@gmail.com", "is_obsolete": 0, "is_patch": 1, "flags": [], "content_type": "text/plain", "id": 8971263}], "cf_tracking_firefox62": "---", "creator": "mixedpuppy@gmail.com", "mentors_detail": [], "depends_on": [], "cf_status_firefox_esr60": "verified", "cf_user_story": "", "history": [{"changes": [{"removed": "---", "field_name": "cf_status_firefox59", "added": "wontfix"}, {"removed": "---", "field_name": "cf_tracking_firefox60", "added": "?"}, {"removed": "---", "field_name": "cf_status_firefox60", "added": "affected"}, {"removed": "---", "field_name": "cf_status_firefox61", "added": "affected"}], "who": "mixedpuppy@gmail.com", "when": "2018-04-20T18:02:12Z"}, {"changes": [{"removed": "--", "field_name": "priority", "added": "P1"}, {"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "mixedpuppy@gmail.com"}], "who": "mixedpuppy@gmail.com", "when": "2018-04-20T18:02:22Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "eros_uk@yahoo.co.uk"}], "who": "eros_uk@yahoo.co.uk", "when": "2018-04-20T18:21:59Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8969765, "added": "review?(lgreco@mozilla.com)"}, {"removed": "", "field_name": "cc", "added": "lgreco@mozilla.com"}], "who": "mixedpuppy@gmail.com", "when": "2018-04-20T19:09:38Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(lgreco@mozilla.com)", "attachment_id": 8969765, "added": "review+"}], "who": "lgreco@mozilla.com", "when": "2018-04-20T20:44:51Z"}, {"changes": [{"removed": "", "field_name": "blocks", "added": "1455755"}], "who": "mixedpuppy@gmail.com", "when": "2018-04-20T21:09:21Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "richard.neomy@teknik.io"}], "who": "mixedpuppy@gmail.com", "when": "2018-04-21T00:31:01Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla61"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2018-04-24 01:18:05"}, {"removed": "affected", "field_name": "cf_status_firefox61", "added": "fixed"}], "who": "aciure@mozilla.com", "when": "2018-04-24T01:18:05Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8969765, "added": "approval-mozilla-beta?"}], "who": "mixedpuppy@gmail.com", "when": "2018-04-24T14:18:28Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "jcristau@mozilla.com"}, {"removed": "---", "field_name": "cf_status_firefox_esr52", "added": "unaffected"}, {"removed": "?", "field_name": "cf_tracking_firefox60", "added": "+"}], "who": "jcristau@mozilla.com", "when": "2018-04-25T13:37:44Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "approval-mozilla-beta?", "attachment_id": 8969765, "added": "approval-mozilla-beta+, approval-mozilla-release+"}], "who": "jcristau@mozilla.com", "when": "2018-04-26T13:41:06Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "ryanvm@gmail.com"}, {"removed": "---", "field_name": "cf_status_firefox_esr60", "added": "fixed"}, {"removed": "affected", "field_name": "cf_status_firefox60", "added": "fixed"}], "who": "ryanvm@gmail.com", "when": "2018-04-27T07:09:47Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "vcarciu@softvision.ro"}], "who": "vcarciu@softvision.ro", "when": "2018-04-27T14:02:55Z"}, {"changes": [{"removed": "RESOLVED", "field_name": "status", "added": "VERIFIED"}], "who": "vcarciu@softvision.ro", "when": "2018-04-27T14:46:46Z"}, {"changes": [{"removed": "fixed", "field_name": "cf_status_firefox_esr60", "added": "verified"}, {"removed": "fixed", "field_name": "cf_status_firefox60", "added": "verified"}, {"removed": "fixed", "field_name": "cf_status_firefox61", "added": "verified"}], "who": "vcarciu@softvision.ro", "when": "2018-04-27T14:47:04Z"}], "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "cf_status_firefox59": "wontfix", "keywords": [], "cc_detail": [{"email": "eros_uk@yahoo.co.uk", "id": 512314, "name": "eros_uk@yahoo.co.uk", "real_name": "erosman"}, {"email": "jcristau@mozilla.com", "id": 580382, "name": "jcristau@mozilla.com", "real_name": "Julien Cristau [:jcristau]"}, {"email": "lgreco@mozilla.com", "id": 339062, "name": "lgreco@mozilla.com", "real_name": "Luca Greco [:rpl]"}, {"email": "richard.neomy@teknik.io", "id": 600357, "name": "richard.neomy@teknik.io", "real_name": "Richard"}, {"email": "ryanvm@gmail.com", "id": 75935, "name": "ryanvm@gmail.com", "real_name": "Ryan VanderMeulen [:RyanVM]"}, {"email": "vcarciu@softvision.ro", "id": 431489, "name": "vcarciu@softvision.ro", "real_name": "Victor Carciu"}], "cf_last_resolved": "2018-04-24T01:18:05Z", "cf_tracking_firefox61": "---", "votes": 0, "classification": "Components", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 18, "comments": [{"text": "We passed urls into prefs where hostnames are required. non-socks settings fail due to this.", "author": "mixedpuppy@gmail.com", "id": 13222109, "time": "2018-04-20T18:01:41Z"}, {"text": "Created attachment 8969765\nBug 1455705 fix how browserSettings.proxyConfig sets network prefs,\n\nproxyConfig set urls onto the pref rather than host names.  This adds a round-trip test\nwith a test that uses the proxy after setting the config.  Also fixes setting prefs\nwhen httpProxyAll is true.\n\nReview commit: https://reviewboard.mozilla.org/r/238576/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/238576/", "author": "mixedpuppy@gmail.com", "id": 13222265, "time": "2018-04-20T19:09:38Z"}, {"text": "Comment on attachment 8969765\nBug 1455705 fix how browserSettings.proxyConfig sets network prefs,\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/238576/diff/1-2/", "author": "mixedpuppy@gmail.com", "id": 13222272, "time": "2018-04-20T19:12:55Z"}, {"text": "Comment on attachment 8969765\nBug 1455705 fix how browserSettings.proxyConfig sets network prefs,\n\nhttps://reviewboard.mozilla.org/r/238576/#review244322\n\nThanks Shane, it looks good to me, follows some review comments (just some small nits or proposed small tweaks).\n\n::: toolkit/components/extensions/parent/ext-browserSettings.js:202\n(Diff revision 2)\n> +    if (value.httpProxyAll) {\n> +      // Match what about:preferences does with proxy settings\n> +      // since the proxy service does not check the value\n> +      // of share_proxy_settings.\n> +      for (let prop of [\"ftp\", \"ssl\", \"socks\"]) {\n> +        value[prop] = value.http;\n> +      }\n> +    }\n\nNit, How about moving this block that handle the \"httpProxyAll\" property right after the block that normalize all these values at line 390?\n\n::: toolkit/components/extensions/parent/ext-browserSettings.js:394\n(Diff revision 2)\n> -                    new URL(url);\n> +                    // Fixup in case a full url is passed.\n> +                    if (host.includes(\"://\")) {\n> +                      host = value[prop] = new URL(host).host;\n> +                    }\n> +                    // Validate the host value.\n> +                    new URL(`http://${host}`);\n\nGiven that we are executing \"new URL\" at line 399 in any case, to ensure the host is valid, how about avoiding the double assignment inside the `if`?\n\nSomething like:\n\n```\n// Fixup in case a full url is passed.\nif (host.includes(\"://\")) {\n  host = new URL(host).host;\n}\n\n// Validate and retrieve the normalized \"hostname:port\" value.\nvalue[prop] = new URL(`http://${host}`).host;\n\n```\n\n::: toolkit/components/extensions/test/xpcshell/test_ext_browserSettings.js:238\n(Diff revision 2)\n>      if (AppConstants.platform === \"android\") {\n>        return Promise.resolve();\n>      }\n>  \n>      let proxyConfig = {\n> -      proxyType: \"system\",\n> +      proxyType: \"none\",\n\nis this change needed?\nI'm not against it but it doesn't seem to make any difference based on what I saw.\n\n::: toolkit/components/extensions/test/xpcshell/test_ext_browserSettings.js:301\n(Diff revision 2)\n>  \n>    await testProxy(\n>      {\n>        proxyType: \"manual\",\n>        http: \"http://www.mozilla.org\",\n>        autoConfigUrl: \"\",\n\nNit, we could also add one of the other ones (e.g. ftp) to check that the http property overwrites it even when specified.", "author": "lgreco@mozilla.com", "id": 13222482, "time": "2018-04-20T20:44:51Z"}, {"text": "Comment on attachment 8969765\nBug 1455705 fix how browserSettings.proxyConfig sets network prefs,\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/238576/diff/2-3/", "author": "mixedpuppy@gmail.com", "id": 13222662, "time": "2018-04-20T21:49:55Z"}, {"text": "Comment on attachment 8969765\nBug 1455705 fix how browserSettings.proxyConfig sets network prefs,\n\nhttps://reviewboard.mozilla.org/r/238576/#review244322\n\n> is this change needed?\n> I'm not against it but it doesn't seem to make any difference based on what I saw.\n\nnone is actually the default and i wanted to reflect that.  It otherwise doesn't matter.\n\n> Nit, we could also add one of the other ones (e.g. ftp) to check that the http property overwrites it even when specified.\n\ndone", "author": "mixedpuppy@gmail.com", "id": 13222665, "time": "2018-04-20T21:51:23Z"}, {"text": "*** Bug 1455636 has been marked as a duplicate of this bug. ***", "author": "mixedpuppy@gmail.com", "id": 13222968, "time": "2018-04-21T00:31:01Z"}, {"text": "Comment on attachment 8969765\nBug 1455705 fix how browserSettings.proxyConfig sets network prefs,\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/238576/diff/3-4/", "author": "mixedpuppy@gmail.com", "id": 13222983, "time": "2018-04-21T00:46:06Z"}, {"text": "Pushed by mixedpuppy@gmail.com:\nhttps://hg.mozilla.org/integration/autoland/rev/1bd0b3c256ab\nfix how browserSettings.proxyConfig sets network prefs, r=rpl", "author": "pulsebot@bots.tld", "id": 13227753, "time": "2018-04-23T20:52:00Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/1bd0b3c256ab", "author": "aciure@mozilla.com", "id": 13228284, "time": "2018-04-24T01:18:05Z"}, {"text": "Comment on attachment 8969765\nBug 1455705 fix how browserSettings.proxyConfig sets network prefs,\n\nApproval Request Comment\n[Feature/Bug causing the regression]: 1425535\n[User impact if declined]: some proxy configurations are unavailable\n[Is this code covered by automated tests?]: yes\n[Has the fix been verified in Nightly?]: yes\n[Needs manual test from QE? If yes, steps to reproduce]: no\n[List of other uplifts needed for the feature/fix]: Possibly 1455755.  This bug fixes breakage of the api.  Since the api is broken, it is the ideal time to change the API, 1455755 does that.\n[Is the change risky?]: no\n[Why is the change risky/not risky?]: It changes what was set into preferences, is limited to a single api, and now has a complete test cycle that includes using a proxy after changing the settings to verify the settings work.\n[String changes made/needed]: none", "author": "mixedpuppy@gmail.com", "id": 13229590, "time": "2018-04-24T14:18:28Z"}, {"text": "Comment on attachment 8969765\nBug 1455705 fix how browserSettings.proxyConfig sets network prefs,\n\napproved for 60.0b16 and 60.0rc", "author": "jcristau@mozilla.com", "id": 13235210, "time": "2018-04-26T13:41:06Z"}, {"text": "Created attachment 8971263\nbeta version of patch", "author": "mixedpuppy@gmail.com", "id": 13235657, "time": "2018-04-26T15:15:15Z"}, {"text": "try run with this and bug 1455755\nhttps://treeherder.mozilla.org/#/jobs?repo=try&revision=44f15f0af1dc37cb26313d2537dfb9804c8d8483", "author": "mixedpuppy@gmail.com", "id": 13235659, "time": "2018-04-26T15:15:43Z"}, {"text": "https://hg.mozilla.org/releases/mozilla-beta/rev/b45730352d20 (FIREFOX_60b_RELBRANCH)\n\nLeaving 60 as affected until the m-r push.", "author": "jcristau@mozilla.com", "id": 13236088, "time": "2018-04-26T17:15:25Z"}, {"text": "https://hg.mozilla.org/releases/mozilla-release/rev/9bb4207e5c14\nhttps://hg.mozilla.org/releases/mozilla-esr60/rev/9bb4207e5c14", "author": "ryanvm@gmail.com", "id": 13237527, "time": "2018-04-27T07:09:47Z"}, {"text": "Testing for this bug was covered by steps from https://bugzilla.mozilla.org/show_bug.cgi?id=1455755#c15 and I am waiting for Shane's response for NI added in https://bugzilla.mozilla.org/show_bug.cgi?id=1455755#c37 in order to see if everything is okay.\n\nThanks", "author": "vcarciu@softvision.ro", "id": 13238193, "time": "2018-04-27T14:02:55Z"}, {"text": "Shane responded and looks that everything is ok for FF 60, esr60 and Nightly. Marking issue as verified", "author": "vcarciu@softvision.ro", "id": 13238327, "time": "2018-04-27T14:46:46Z"}], "id": 1455705, "priority": "P1", "cc": ["eros_uk@yahoo.co.uk", "jcristau@mozilla.com", "lgreco@mozilla.com", "richard.neomy@teknik.io", "ryanvm@gmail.com", "vcarciu@softvision.ro"], "cf_crash_signature": "", "version": "58 Branch", "is_cc_accessible": true, "cf_tracking_firefox_esr52": "---", "see_also": [], "cf_tracking_thunderbird_esr60": "---", "status": "VERIFIED", "product": "Toolkit", "cf_fx_iteration": "---", "blocks": [1425535, 1455755], "qa_contact": "", "creation_time": "2018-04-20T18:01:41Z", "cf_status_firefox_esr52": "unaffected", "component": "WebExtensions: Untriaged", "assigned_to_detail": {"email": "mixedpuppy@gmail.com", "id": 372685, "name": "mixedpuppy@gmail.com", "real_name": "Shane Caraveo (:mixedpuppy)"}, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "---", "cf_status_firefox61": "verified", "cf_status_firefox60": "verified", "target_milestone": "mozilla61", "cf_rank": null, "cf_qa_whiteboard": "", "severity": "normal", "groups": [], "cf_status_thunderbird_esr52": "---", "url": "", "cf_status_thunderbird_esr60": "---", "creator_detail": {"email": "mixedpuppy@gmail.com", "id": 372685, "name": "mixedpuppy@gmail.com", "real_name": "Shane Caraveo (:mixedpuppy)"}, "whiteboard": "", "mentors": [], "summary": "proxyConfig settings store incorrect prefs", "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "last_change_time": "2018-04-27T14:47:04Z", "assigned_to": "mixedpuppy@gmail.com", "is_open": false, "cf_blocking_webextensions": "---", "resolution": "FIXED", "op_sys": "Unspecified", "cf_fx_points": "---", "cf_blocking_fennec": "---"}