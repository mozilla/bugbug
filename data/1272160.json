{"cf_tracking_thunderbird_esr52": "---", "status": "RESOLVED", "cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "cf_tracking_firefox62": "---", "creator": "khuey@kylehuey.com", "mentors_detail": [], "depends_on": [], "cf_status_firefox_esr60": "---", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "keywords": ["regression"], "cc_detail": [{"email": "bobbyholley@gmail.com", "id": 313730, "name": "bobbyholley@gmail.com", "real_name": "Bobby Holley (On Leave Until June 11th)"}, {"email": "bzbarsky@mit.edu", "id": 20209, "name": "bzbarsky@mit.edu", "real_name": "Boris Zbarsky [:bz] (Vacation Jun 16-24) (no decent commit message means r-)"}, {"email": "cbook@mozilla.com", "id": 277293, "name": "cbook@mozilla.com", "real_name": "Carsten Book [:Tomcat]"}, {"email": "khuey@kylehuey.com", "id": 336670, "name": "khuey@kylehuey.com", "real_name": "Kyle Huey [:khuey] (Exited; not receiving bugmail, email if necessary)"}, {"email": "mcastelluccio@mozilla.com", "id": 420453, "name": "mcastelluccio@mozilla.com", "real_name": "Marco Castelluccio [:marco]"}, {"email": "milaninbugzilla@gmail.com", "id": 456486, "name": "milaninbugzilla@gmail.com", "real_name": "Milan Sreckovic [:milan] (needinfo for best results)"}, {"email": "mozillamarcia.knous@gmail.com", "id": 8519, "name": "mozillamarcia.knous@gmail.com", "real_name": "Marcia Knous [:marcia - needinfo? me]"}, {"email": "sledru@mozilla.com", "id": 495955, "name": "sledru@mozilla.com", "real_name": "Sylvestre Ledru [:sylvestre]"}], "cf_last_resolved": "2016-05-15T01:26:15Z", "attachments": [{"creator": "khuey@kylehuey.com", "is_obsolete": 0, "is_patch": 0, "flags": [], "content_type": "text/plain", "id": 8751504}, {"creator": "bzbarsky@mit.edu", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2016-05-14T00:26:00Z", "type_id": 4, "creation_date": "2016-05-14T00:22:23Z", "id": 1394000, "setter": "bzbarsky@mit.edu"}, {"status": "+", "name": "approval-mozilla-aurora", "modification_date": "2016-05-24T19:41:02Z", "type_id": 720, "creation_date": "2016-05-14T00:25:39Z", "id": 1394001, "setter": "sledru@mozilla.com"}], "content_type": "text/plain", "id": 8752406}], "votes": 0, "classification": "Components", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 14, "comments": [{"text": "Created attachment 8751504\ngdb log", "author": "khuey@kylehuey.com", "id": 11401900, "time": "2016-05-11T22:39:44Z"}, {"text": "This blocks me from debugging bug 1272078.", "author": "khuey@kylehuey.com", "id": 11401927, "time": "2016-05-11T22:49:06Z"}, {"text": "Gah.  This is presumably a result of the fix for bug 1268845.  This line:\n\n917     if (dom::HasProtoAndIfaceCache(mGlobalJSObject)) {\n\nis assuming mGlobalJSObject is a JSCLASS_DOM_GLOBAL.  That happens to be the case with all xpconnect globals right now, I guess, but there are lots of codepaths that do NOT assume that, and the globals from bug 1268845 use XPCWrappedNativeScope but are NOT JSCLASS_DOM_GLOBAL.\n\nBobby, what's the story here?  Are we seriously expecting all mainthread JS globals to both have XPCWrappedNativeScopes _and_ be JSCLASS_DOM_GLOBAL with all the resulting baggage?  If not, seems like XPCWrappedNativeScope::AddSizeOfIncludingThis just needs to be checking for that flag before doing dom::HasProtoAndIfaceCache...", "author": "bzbarsky@mit.edu", "id": 11402392, "time": "2016-05-12T04:04:25Z"}, {"text": "Oh, and once we decide what we want here, I guess we should uplift this too, along with bug 1268845.", "author": "bzbarsky@mit.edu", "id": 11402393, "time": "2016-05-12T04:05:11Z"}, {"text": "(In reply to Boris Zbarsky [:bz] from comment #2)\n> Gah.  This is presumably a result of the fix for bug 1268845.  This line:\n> \n> 917     if (dom::HasProtoAndIfaceCache(mGlobalJSObject)) {\n> \n> is assuming mGlobalJSObject is a JSCLASS_DOM_GLOBAL.  That happens to be the\n> case with all xpconnect globals right now, I guess, but there are lots of\n> codepaths that do NOT assume that, and the globals from bug 1268845 use\n> XPCWrappedNativeScope but are NOT JSCLASS_DOM_GLOBAL.\n> \n> Bobby, what's the story here?  Are we seriously expecting all mainthread JS\n> globals to both have XPCWrappedNativeScopes _and_ be JSCLASS_DOM_GLOBAL with\n> all the resulting baggage?\n\nI don't think we should require that.\n\n>  If not, seems like\n> XPCWrappedNativeScope::AddSizeOfIncludingThis just needs to be checking for\n> that flag before doing dom::HasProtoAndIfaceCache...\n\nThat seems reasonable to me offhand. Maybe we should have two functions: HasProtoAndIFaceCache, which checks the bit, and either returns false or delegates to DOMGlobalHasProtoAndIFaceCache, which asserts the bit. The former is the more obvious function to call, so that would reduce the chances for further screwups like this in the future.", "author": "bobbyholley@gmail.com", "id": 11404613, "time": "2016-05-12T17:42:46Z"}, {"text": "[Tracking Requested - why for this release]:  Seems to be causing bug 1272746, which is a borderline topcrash.", "author": "dbaron@dbaron.org", "id": 11408778, "time": "2016-05-14T00:00:44Z"}, {"text": "Created attachment 8752406\nFix XPCWrappedNativeScope::AddSizeOfIncludingThis to not blindly poke at non-DOM globals as if they were DOM globals\n\nI did audit the XPConnect callers of TraceProtoAndIfaceCache and DestroyProtoAndIfaceCache, and they all check JSCLASS_DOM_GLOBAL.", "author": "bzbarsky@mit.edu", "id": 11408834, "time": "2016-05-14T00:22:23Z"}, {"text": "Comment on attachment 8752406\nFix XPCWrappedNativeScope::AddSizeOfIncludingThis to not blindly poke at non-DOM globals as if they were DOM globals\n\nApproval Request Comment\n[Feature/regressing bug #]: Bug 1268845\n[User impact if declined]: Crashes and other bad things to do with poking memory\n   that isn't there.\n[Describe test coverage new/current, TreeHerder]: Hard to trigger this: have to\n   do a memory measurement while particular very temporary globals are live.\n[Risks and why]: I think this is low-risk.  But hey, I said that about bug\n   1268845 too!\n[String/UUID change made/needed]: None.", "author": "bzbarsky@mit.edu", "id": 11408837, "time": "2016-05-14T00:25:39Z"}, {"text": "https://hg.mozilla.org/integration/mozilla-inbound/rev/8da9fde2d10b", "author": "pulsebot@bots.tld", "id": 11408839, "time": "2016-05-14T00:26:21Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/8da9fde2d10b", "author": "philringnalda@gmail.com", "id": 11409486, "time": "2016-05-15T01:26:15Z"}, {"text": "Tracking for 49.", "author": "mozillamarcia.knous@gmail.com", "id": 11411974, "time": "2016-05-16T18:19:05Z"}, {"text": "Comment on attachment 8752406\nFix XPCWrappedNativeScope::AddSizeOfIncludingThis to not blindly poke at non-DOM globals as if they were DOM globals\n\nFix an assertion, taking it in aurora", "author": "sledru@mozilla.com", "id": 11433184, "time": "2016-05-24T19:41:02Z"}, {"text": "https://hg.mozilla.org/releases/mozilla-aurora/rev/bcac6066d926", "author": "cbook@mozilla.com", "id": 11433616, "time": "2016-05-24T21:11:46Z"}, {"text": "*** Bug 1272746 has been marked as a duplicate of this bug. ***", "author": "n.nethercote@gmail.com", "id": 11477492, "time": "2016-06-10T06:43:01Z"}], "id": 1272160, "priority": "--", "cc": ["bobbyholley@gmail.com", "bzbarsky@mit.edu", "cbook@mozilla.com", "khuey@kylehuey.com", "mcastelluccio@mozilla.com", "milaninbugzilla@gmail.com", "mozillamarcia.knous@gmail.com", "sledru@mozilla.com"], "cf_crash_signature": "", "version": "unspecified", "is_cc_accessible": true, "cf_tracking_firefox_esr52": "---", "see_also": [], "cf_tracking_thunderbird_esr60": "---", "cf_platform_rel": "---", "product": "Core", "cf_fx_iteration": "---", "blocks": [1268845, 1272078, 1272746], "qa_contact": "", "creation_time": "2016-05-11T22:39:44Z", "cf_status_firefox_esr52": "---", "component": "DOM", "assigned_to_detail": {"email": "bzbarsky@mit.edu", "id": 20209, "name": "bzbarsky@mit.edu", "real_name": "Boris Zbarsky [:bz] (Vacation Jun 16-24) (no decent commit message means r-)"}, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "---", "cf_status_firefox61": "---", "cf_status_firefox60": "---", "target_milestone": "mozilla49", "cf_rank": null, "cf_qa_whiteboard": "", "severity": "normal", "groups": [], "cf_status_thunderbird_esr52": "---", "url": "", "cf_status_thunderbird_esr60": "---", "creator_detail": {"email": "khuey@kylehuey.com", "id": 336670, "name": "khuey@kylehuey.com", "real_name": "Kyle Huey [:khuey] (Exited; not receiving bugmail, email if necessary)"}, "whiteboard": "", "mentors": [], "summary": "Assertion failure: js::GetObjectClass(global)->flags & (1<<7), at /home/khuey/dev/gecko-dev/obj-x86_64-pc-linux-gnu/dist/include/mozilla/dom/DOMJSClass.h:409 when getting a memory report", "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "last_change_time": "2018-06-03T00:18:09Z", "assigned_to": "bzbarsky@mit.edu", "is_open": false, "history": [{"changes": [{"removed": "", "field_name": "cc", "added": "bzbarsky@mit.edu"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(bzbarsky@mit.edu)"}], "who": "khuey@kylehuey.com", "when": "2016-05-11T22:39:44Z"}, {"changes": [{"removed": "", "field_name": "blocks", "added": "1272078"}], "who": "khuey@kylehuey.com", "when": "2016-05-11T22:49:06Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "bobbyholley@gmail.com"}, {"removed": "needinfo?(bzbarsky@mit.edu)", "field_name": "flagtypes.name", "added": "needinfo?(bobbyholley@gmail.com)"}], "who": "bzbarsky@mit.edu", "when": "2016-05-12T04:04:25Z"}, {"changes": [{"removed": "1246153", "field_name": "blocks", "added": "1268845"}], "who": "bzbarsky@mit.edu", "when": "2016-05-12T04:05:11Z"}, {"changes": [{"removed": "needinfo?(bobbyholley@gmail.com)", "field_name": "flagtypes.name", "added": ""}], "who": "bobbyholley@gmail.com", "when": "2016-05-12T17:42:46Z"}, {"changes": [{"removed": "", "field_name": "blocks", "added": "1272746"}], "who": "dbaron@dbaron.org", "when": "2016-05-13T23:57:23Z"}, {"changes": [{"removed": "---", "field_name": "cf_tracking_firefox49", "added": "?"}, {"removed": "---", "field_name": "cf_status_firefox49", "added": "affected"}], "who": "dbaron@dbaron.org", "when": "2016-05-14T00:00:44Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8752406, "added": "review?(khuey@kylehuey.com)"}, {"removed": "", "field_name": "cc", "added": "khuey@kylehuey.com"}], "who": "bzbarsky@mit.edu", "when": "2016-05-14T00:22:23Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "ASSIGNED"}, {"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "bzbarsky@mit.edu"}], "who": "bzbarsky@mit.edu", "when": "2016-05-14T00:22:27Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(khuey@kylehuey.com)", "attachment_id": 8752406, "added": "review+"}], "who": "khuey@kylehuey.com", "when": "2016-05-14T00:24:19Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review+", "attachment_id": 8752406, "added": "review?(khuey@kylehuey.com), approval-mozilla-aurora?"}], "who": "bzbarsky@mit.edu", "when": "2016-05-14T00:25:39Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(khuey@kylehuey.com)", "attachment_id": 8752406, "added": "review+"}], "who": "bzbarsky@mit.edu", "when": "2016-05-14T00:26:00Z"}, {"changes": [{"removed": "ASSIGNED", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla49"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2016-05-15 01:26:15"}, {"removed": "affected", "field_name": "cf_status_firefox49", "added": "fixed"}], "who": "philringnalda@gmail.com", "when": "2016-05-15T01:26:15Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "mozillamarcia.knous@gmail.com"}, {"removed": "?", "field_name": "cf_tracking_firefox49", "added": "+"}], "who": "mozillamarcia.knous@gmail.com", "when": "2016-05-16T18:19:05Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "sledru@mozilla.com"}, {"removed": "---", "field_name": "cf_status_firefox48", "added": "affected"}], "who": "sledru@mozilla.com", "when": "2016-05-24T19:14:53Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "approval-mozilla-aurora?", "attachment_id": 8752406, "added": "approval-mozilla-aurora+"}], "who": "sledru@mozilla.com", "when": "2016-05-24T19:41:02Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "cbook@mozilla.com"}, {"removed": "affected", "field_name": "cf_status_firefox48", "added": "fixed"}], "who": "cbook@mozilla.com", "when": "2016-05-24T21:11:46Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "milan@mozilla.com"}], "who": "n.nethercote@gmail.com", "when": "2016-06-10T06:43:01Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "regression"}, {"removed": "", "field_name": "cc", "added": "mcastelluccio@mozilla.com"}], "who": "mcastelluccio@mozilla.com", "when": "2018-06-03T00:18:09Z"}], "resolution": "FIXED", "op_sys": "Unspecified", "cf_fx_points": "---", "cf_blocking_fennec": "---"}