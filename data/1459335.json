{"cf_tracking_thunderbird_esr52": "---", "status": "RESOLVED", "cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "cf_tracking_firefox62": "---", "creator": "madperson@gmx.at", "mentors_detail": [], "depends_on": [], "cf_status_firefox_esr60": "---", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "keywords": [], "cc_detail": [{"email": "aklotz@mozilla.com", "id": 454100, "name": "aklotz@mozilla.com", "real_name": "Aaron Klotz [:aklotz]"}, {"email": "davidp99@gmail.com", "id": 506442, "name": "davidp99@gmail.com", "real_name": "David Parks (dparks) [:handyman]"}, {"email": "ryanvm@gmail.com", "id": 75935, "name": "ryanvm@gmail.com", "real_name": "Ryan VanderMeulen [:RyanVM]"}], "cf_last_resolved": "2018-05-30T09:27:13Z", "attachments": [{"creator": "davidp99@gmail.com", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2018-05-29T19:04:37Z", "type_id": 4, "creation_date": "2018-05-24T00:04:47Z", "id": 1760885, "setter": "aklotz@mozilla.com"}], "content_type": "text/plain", "id": 8980137}], "votes": 0, "classification": "Components", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 7, "comments": [{"text": "This bug was filed from the Socorro interface and is\nreport bp-075ea3bc-7eb4-4b01-8703-679530180504.\n=============================================================\n\nTop 10 frames of crashing thread:\n\n0 xul.dll mozilla::interceptor::VMSharingPolicyUnique<mozilla::interceptor::MMPolicyInProcess, 128>::GetNextTrampoline mozglue/misc/interceptor/VMSharingPolicies.h:38\n1 xul.dll mozilla::interceptor::WindowsDllDetourPatcher<mozilla::interceptor::VMSharingPolicyUnique<mozilla::interceptor::MMPolicyInProcess, 128> >::CreateTrampoline mozglue/misc/interceptor/PatcherDetour.h:402\n2 xul.dll mozilla::interceptor::WindowsDllDetourPatcher<mozilla::interceptor::VMSharingPolicyUnique<mozilla::interceptor::MMPolicyInProcess, 128> >::AddHook mozglue/misc/interceptor/PatcherDetour.h:166\n3 xul.dll mozilla::interceptor::WindowsDllInterceptor<mozilla::interceptor::VMSharingPolicyUnique<mozilla::interceptor::MMPolicyInProcess, 128> >::AddHook mozglue/misc/nsWindowsDllInterceptor.h:192\n4 xul.dll mozilla::plugins::BasicFunctionHook<15, int >::Register dom/plugins/ipc/FunctionHook.h:168\n5 xul.dll mozilla::plugins::PluginModuleChild::AllocPPluginInstanceChild dom/plugins/ipc/PluginModuleChild.cpp:1821\n6 xul.dll mozilla::plugins::PPluginModuleChild::OnMessageReceived ipc/ipdl/PPluginModuleChild.cpp:622\n7 xul.dll mozilla::ipc::MessageChannel::DispatchAsyncMessage ipc/glue/MessageChannel.cpp:2141\n8 xul.dll mozilla::ipc::MessageChannel::DispatchMessageW ipc/glue/MessageChannel.cpp:2071\n9 xul.dll mozilla::ipc::MessageChannel::RunMessage ipc/glue/MessageChannel.cpp:1917\n\n=============================================================\n\ncrashes with this signature are newly appearing in firefox 61 on windows, around half of them in the plugin process.", "author": "madperson@gmx.at", "id": 13255756, "time": "2018-05-04T20:59:06Z"}, {"text": "The main issue that I am seeing in these dumps is that the interceptor's AddHook method is failing, but BasicFunctionHook doesn't distinguish between \"we haven't hooked this yet\" and \"we tried to hook this but failed.\"\n\nEvery time a new plugin instance is created, we re-attempt to set the hook. Each attempt fails, but each attempt also consumes a trampoline, until the trampoline space is eventually exhausted.\n\nWhile adding a more sophisticated allocator for interceptor trampolines could fix that, I think that would be overkill given the nature of the problem, and is better addressed at the BasicFunctionHook level.\n\nni? over to David to see what he thinks.", "author": "aklotz@mozilla.com", "id": 13263098, "time": "2018-05-08T17:29:45Z"}, {"text": "I have created bug 1460002 as a meta to track similar problems in other areas of the code. Non-plugin crashes with the same signature will be fixed there.", "author": "aklotz@mozilla.com", "id": 13263183, "time": "2018-05-08T17:59:18Z"}, {"text": "FYI, david is on pto. He'll be back next week.", "author": "jmathies@mozilla.com", "id": 13263200, "time": "2018-05-08T18:07:37Z"}, {"text": "Created attachment 8980137\nDistinguish between unregistered and failed DLL function interceptions\n\nThis just does the straight-forward thing of distinguishing between having never attempted to register vs having failed to register.\n\nI had also wanted to move the initialization of the interceptions (the call to HookFunctions) from PluginModuleChild::AllocPPluginInstanceChild since, fundamentally, the mistake is that we keep trying to initialize every time we need a new PPluginInstance but the quirks system looks like it got mangled in the e10s move so we are doing some sketchy stuff about re-initialization that I _think_ is all moot anyway but, in the end, I decided it's not important enough to risk bothering.  Still, this implementation is kind of a cop-out.\n\n---\n\nTests: https://treeherder.mozilla.org/#/jobs?repo=try&revision=ac1abcb7feece928d541cd08a9572d8a3ed92813", "author": "davidp99@gmail.com", "id": 13306186, "time": "2018-05-24T00:04:47Z"}, {"text": "Pushed by csabou@mozilla.com:\nhttps://hg.mozilla.org/integration/mozilla-inbound/rev/2f9400fe51c4\nDistinguish between unregistered and failed DLL function interceptions. r=aklotz", "author": "pulsebot@bots.tld", "id": 13373074, "time": "2018-05-30T00:42:57Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/2f9400fe51c4", "author": "ncsoregi@mozilla.com", "id": 13373777, "time": "2018-05-30T09:27:13Z"}], "id": 1459335, "priority": "P1", "cc": ["aklotz@mozilla.com", "davidp99@gmail.com", "ryanvm@gmail.com"], "cf_crash_signature": "", "version": "61 Branch", "is_cc_accessible": true, "cf_tracking_firefox_esr52": "---", "see_also": [], "cf_tracking_thunderbird_esr60": "---", "cf_platform_rel": "---", "product": "Core", "cf_fx_iteration": "---", "blocks": [1460002, 1432653], "qa_contact": "", "creation_time": "2018-05-04T20:59:06Z", "cf_status_firefox_esr52": "---", "component": "Plug-ins", "assigned_to_detail": {"email": "davidp99@gmail.com", "id": 506442, "name": "davidp99@gmail.com", "real_name": "David Parks (dparks) [:handyman]"}, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "fixed", "cf_status_firefox61": "---", "cf_status_firefox60": "---", "target_milestone": "mozilla62", "cf_rank": null, "cf_qa_whiteboard": "", "severity": "critical", "groups": [], "cf_status_thunderbird_esr52": "---", "url": "", "cf_status_thunderbird_esr60": "---", "creator_detail": {"email": "madperson@gmx.at", "id": 209011, "name": "madperson@gmx.at", "real_name": "[:philipp]"}, "whiteboard": "inj+", "mentors": [], "summary": "Repeated failed function hook attempts cause exhaustion of interceptor trampoline space", "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "last_change_time": "2018-05-30T09:27:13Z", "assigned_to": "davidp99@gmail.com", "is_open": false, "history": [{"changes": [{"removed": "", "field_name": "cc", "added": "aklotz@mozilla.com, ryanvm@gmail.com"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(aklotz@mozilla.com)"}, {"removed": "---", "field_name": "cf_status_firefox62", "added": "affected"}], "who": "ryanvm@gmail.com", "when": "2018-05-08T01:41:37Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "davidp99@gmail.com"}, {"removed": "General", "field_name": "component", "added": "Plug-ins"}, {"removed": "Crash in mozilla::interceptor::VMSharingPolicyUnique<T>::GetNextTrampoline", "field_name": "summary", "added": "Repeated failed function hook attempts cause exhaustion of interceptor trampoline space"}, {"removed": "needinfo?(aklotz@mozilla.com)", "field_name": "flagtypes.name", "added": "needinfo?(davidp99@gmail.com)"}], "who": "aklotz@mozilla.com", "when": "2018-05-08T17:29:45Z"}, {"changes": [{"removed": "", "field_name": "blocks", "added": "1460002"}], "who": "aklotz@mozilla.com", "when": "2018-05-08T17:39:39Z"}, {"changes": [{"removed": "[@ mozilla::interceptor::VMSharingPolicyUnique<T>::GetNextTrampoline]", "field_name": "cf_crash_signature", "added": ""}], "who": "aklotz@mozilla.com", "when": "2018-05-08T17:59:18Z"}, {"changes": [{"removed": "--", "field_name": "priority", "added": "P3"}, {"removed": "", "field_name": "whiteboard", "added": "inj+"}, {"removed": "unaffected", "field_name": "cf_status_firefox60", "added": "affected"}], "who": "aklotz@mozilla.com", "when": "2018-05-09T21:54:04Z"}, {"changes": [{"removed": "crash", "field_name": "keywords", "added": ""}], "who": "aklotz@mozilla.com", "when": "2018-05-09T21:54:24Z"}, {"changes": [{"removed": "needinfo?(davidp99@gmail.com)", "field_name": "flagtypes.name", "added": ""}], "who": "jmathies@mozilla.com", "when": "2018-05-16T15:24:25Z"}, {"changes": [{"removed": "unaffected", "field_name": "cf_status_firefox_esr52", "added": "---"}, {"removed": "unaffected", "field_name": "cf_status_firefox_esr60", "added": "---"}, {"removed": "unaffected", "field_name": "cf_status_firefox59", "added": "---"}, {"removed": "affected", "field_name": "cf_status_firefox60", "added": "---"}, {"removed": "affected", "field_name": "cf_status_firefox61", "added": "---"}, {"removed": "affected", "field_name": "cf_status_firefox62", "added": "---"}], "who": "jmathies@mozilla.com", "when": "2018-05-16T15:24:48Z"}, {"changes": [{"removed": "regression", "field_name": "keywords", "added": ""}], "who": "jmathies@mozilla.com", "when": "2018-05-16T15:26:45Z"}, {"changes": [{"removed": "P3", "field_name": "priority", "added": "P1"}, {"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "davidp99@gmail.com"}], "who": "davidp99@gmail.com", "when": "2018-05-21T21:03:55Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8980137, "added": "review?(aklotz@mozilla.com)"}], "who": "davidp99@gmail.com", "when": "2018-05-24T00:04:47Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(aklotz@mozilla.com)", "attachment_id": 8980137, "added": "review+"}], "who": "aklotz@mozilla.com", "when": "2018-05-29T19:04:37Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "checkin-needed"}], "who": "davidp99@gmail.com", "when": "2018-05-30T00:29:44Z"}, {"changes": [{"removed": "checkin-needed", "field_name": "keywords", "added": ""}], "who": "pulsebot@bots.tld", "when": "2018-05-30T00:42:57Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla62"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2018-05-30 09:27:13"}, {"removed": "---", "field_name": "cf_status_firefox62", "added": "fixed"}], "who": "ncsoregi@mozilla.com", "when": "2018-05-30T09:27:13Z"}], "resolution": "FIXED", "op_sys": "Windows", "cf_fx_points": "---", "cf_blocking_fennec": "---"}