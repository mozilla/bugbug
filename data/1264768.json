{"cf_tracking_thunderbird_esr52": "---", "status": "RESOLVED", "cf_tracking_firefox60": "---", "attachments": [{"creator": "ben.tian@gmail.com", "is_obsolete": 1, "is_patch": 1, "flags": [], "content_type": "text/plain", "id": 8755688}, {"creator": "ben.tian@gmail.com", "is_obsolete": 1, "is_patch": 1, "flags": [], "content_type": "text/plain", "id": 8756204}, {"creator": "ben.tian@gmail.com", "is_obsolete": 1, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2016-06-08T17:20:25Z", "type_id": 4, "creation_date": "2016-05-31T03:17:23Z", "id": 1402961, "setter": "hsivonen@hsivonen.fi"}], "content_type": "text/plain", "id": 8757799}, {"creator": "ben.tian@gmail.com", "is_obsolete": 0, "is_patch": 1, "flags": [], "content_type": "text/plain", "id": 8762666}], "classification": "Components", "creator": "josh@joshmatthews.net", "cc": ["hsivonen@hsivonen.fi", "top12345tw@gmail.com"], "depends_on": [], "creation_time": "2016-04-14T19:30:35Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "cf_status_firefox58": "---", "cf_status_firefox59": "---", "keywords": [], "summary": "Image loads for URLs that fail to resolve don't dispatch error event", "id": 1264768, "assigned_to_detail": {"email": "ben.tian@gmail.com", "id": 464639, "name": "ben.tian@gmail.com", "real_name": "Ben Tian (inactive)"}, "severity": "normal", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "assigned_to": "ben.tian@gmail.com", "comment_count": 17, "comments": [{"text": "According to the specification (https://html.spec.whatwg.org/multipage/embedded-content.html#update-the-image-data), in step 11.4 we should be dispatching an error event.\n\nhttp://software.hixie.ch/utilities/js/live-dom-viewer/?saved=4060", "author": "josh@joshmatthews.net", "id": 11327543, "time": "2016-04-14T19:30:35Z"}, {"text": "Created attachment 8755688\nPatch 1 (v1): Dispatch error event when image loads for URLs that fail to resolve\n\nWIP patch that passes comment 0 test. Will verify flow based on spec and run try.", "author": "ben.tian@gmail.com", "id": 11432168, "time": "2016-05-24T10:48:01Z"}, {"text": "Created attachment 8756204\nPatch 1 (v2): Dispatch error event when image loads for URLs that fail to resolve\n\nChange:\n- dispatch error event as long as method |StringToURI| fails.", "author": "ben.tian@gmail.com", "id": 11436161, "time": "2016-05-25T13:54:18Z"}, {"text": "Created attachment 8757799\nPatch 1 (v3): Dispatch error event when image loads for URLs that fail to resolve\n\nChange\n- dispatch error event AFTER canceling image requests, per comment 0 spec\n- add some comment to clarify", "author": "ben.tian@gmail.com", "id": 11447826, "time": "2016-05-30T08:54:20Z"}, {"text": "Try result: https://treeherder.mozilla.org/#/jobs?repo=try&revision=aab607f59038\n\nComment 3 patch seems irrelevant to the failed test cases (all copy/paste related on Win7).", "author": "ben.tian@gmail.com", "id": 11449897, "time": "2016-05-31T02:45:28Z"}, {"text": "Comment on attachment 8757799\nPatch 1 (v3): Dispatch error event when image loads for URLs that fail to resolve\n\nHenri,\n\nCan you review my patch that dispatches error event when image loads for URLs that fail to resolve? The patch is based on comment 0 spec and passes comment 0 test. Try result is in comment 4.", "author": "ben.tian@gmail.com", "id": 11449921, "time": "2016-05-31T03:17:23Z"}, {"text": "Comment on attachment 8757799\nPatch 1 (v3): Dispatch error event when image loads for URLs that fail to resolve\n\nReview of attachment 8757799:\n-----------------------------------------------------------------\n\n::: dom/base/nsImageLoadingContent.cpp\n@@ +755,5 @@\n> +  if (NS_FAILED(rv)) {\n> +    // Cancel image requests and fire error event per spec\n> +    CancelImageRequests(aNotify);\n> +    FireEvent(NS_LITERAL_STRING(\"error\"));\n> +    return rv;\n\nWhy is rv returned instead of NS_OK? The other similar cases where \"error\" is fired, NS_OK is returned.", "author": "hsivonen@hsivonen.fi", "id": 11454248, "time": "2016-06-01T11:45:15Z"}, {"text": "(In reply to Henri Sivonen (:hsivonen) from comment #6)\n> Why is rv returned instead of NS_OK? The other similar cases where \"error\"\n> is fired, NS_OK is returned.\n\nI just want to keep original behavior that returns rv in NS_ENSURE_SUCCESS, in case any existing caller expects rv returned. I'm fine to return NS_OK if you suggest.", "author": "ben.tian@gmail.com", "id": 11456787, "time": "2016-06-02T02:04:29Z"}, {"text": "(In reply to Ben Tian [:btian][PTO: 6/20 ~ 7/1] from comment #7)\n> I just want to keep original behavior that returns rv in NS_ENSURE_SUCCESS,\n> in case any existing caller expects rv returned. I'm fine to return NS_OK if\n> you suggest.\n\nIf NS_OK is returned here, both |LoadImage| methods can return void instead for always returning NS_OK. And so does method |FireEvent|. I can open another bug to clean these up.", "author": "ben.tian@gmail.com", "id": 11456839, "time": "2016-06-02T02:35:30Z"}, {"text": "(In reply to Ben Tian [:btian][PTO: 6/18 ~ 7/3] from comment #7)\n> (In reply to Henri Sivonen (:hsivonen) from comment #6)\n> > Why is rv returned instead of NS_OK? The other similar cases where \"error\"\n> > is fired, NS_OK is returned.\n> \n> I just want to keep original behavior that returns rv in NS_ENSURE_SUCCESS,\n> in case any existing caller expects rv returned. I'm fine to return NS_OK if\n> you suggest.\n\nHenri, do you suggest to return NS_OK instead? Let me know for any other suggestion on my patch.", "author": "ben.tian@gmail.com", "id": 11471541, "time": "2016-06-08T07:07:51Z"}, {"text": "(In reply to Ben Tian [:btian][PTO: 6/18 ~ 7/3] from comment #9)\n> (In reply to Ben Tian [:btian][PTO: 6/18 ~ 7/3] from comment #7)\n> > (In reply to Henri Sivonen (:hsivonen) from comment #6)\n> > > Why is rv returned instead of NS_OK? The other similar cases where \"error\"\n> > > is fired, NS_OK is returned.\n> > \n> > I just want to keep original behavior that returns rv in NS_ENSURE_SUCCESS,\n> > in case any existing caller expects rv returned. I'm fine to return NS_OK if\n> > you suggest.\n> \n> Henri, do you suggest to return NS_OK instead? Let me know for any other\n> suggestion on my patch.\n\nBased on an MXR search, yes, I'm suggesting return NS_OK instead.", "author": "hsivonen@hsivonen.fi", "id": 11473154, "time": "2016-06-08T17:19:30Z"}, {"text": "Comment on attachment 8757799\nPatch 1 (v3): Dispatch error event when image loads for URLs that fail to resolve\n\nr+ if the return value is changed to NS_OK.", "author": "hsivonen@hsivonen.fi", "id": 11473158, "time": "2016-06-08T17:20:25Z"}, {"text": "Created attachment 8762666\n[final] Patch 1: Dispatch error event when image loads for URLs that fail to resolve, r=hsivonen\n\nThanks for the review! Revise per reviewer's comment.", "author": "ben.tian@gmail.com", "id": 11482904, "time": "2016-06-14T12:22:51Z"}, {"text": "Try result of comment 12 patch:\nhttps://treeherder.mozilla.org/#/jobs?repo=try&revision=73914b2ea3e4", "author": "ben.tian@gmail.com", "id": 11520652, "time": "2016-07-04T09:42:50Z"}, {"text": "Pushed by cbook@mozilla.com:\nhttps://hg.mozilla.org/integration/mozilla-inbound/rev/066be6391756\nDispatch error event when image loads for URLs that fail to resolve, r=hsivonen", "author": "pulsebot@bots.tld", "id": 11521192, "time": "2016-07-04T14:21:49Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/066be6391756", "author": "philringnalda@gmail.com", "id": 11522015, "time": "2016-07-04T22:04:18Z"}, {"text": "This cause a unexpected error event in non-responsive mode, see bug 1321300 comment #7.\nIt is because we load image for each src attribute assignment if in non-responsive mode. Bug 1076583 will fix that (load image from last associated src value only). However, bug 1076583 still has ongoning work and may not be landed soon, so we consider back out this change first (at least we have consistent behavior as 49 and earlier versions) and reland it after bug 1076583 is fixed.", "author": "top12345tw@gmail.com", "id": 11958082, "time": "2017-01-05T03:08:11Z"}], "cf_last_resolved": "2016-07-04T22:04:18Z", "priority": "--", "mentors_detail": [], "cf_crash_signature": "", "version": "unspecified", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox59": "---", "last_change_time": "2017-01-05T03:08:11Z", "cf_platform_rel": "---", "product": "Core", "cf_status_firefox_esr52": "---", "blocks": [], "qa_contact": "", "see_also": [], "cf_fx_iteration": "---", "component": "DOM", "votes": 0, "cf_status_firefox49": "---", "groups": [], "cf_status_firefox60": "---", "target_milestone": "mozilla50", "is_cc_accessible": true, "cf_status_thunderbird_esr52": "---", "url": "", "creator_detail": {"email": "josh@joshmatthews.net", "id": 241497, "name": "josh@joshmatthews.net", "real_name": "Josh Matthews [:jdm]"}, "whiteboard": "[tw-dom] btpp-active", "mentors": [], "cc_detail": [{"email": "hsivonen@hsivonen.fi", "id": 5490, "name": "hsivonen@hsivonen.fi", "real_name": "Henri Sivonen (:hsivonen)"}, {"email": "top12345tw@gmail.com", "id": 455480, "name": "top12345tw@gmail.com", "real_name": "Edgar Chen [:edgar]"}], "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "cf_tracking_firefox58": "---", "cf_rank": null, "is_open": false, "history": [{"changes": [{"removed": "", "field_name": "cc", "added": "echen@mozilla.com"}], "who": "top12345tw@gmail.com", "when": "2016-04-14T20:34:48Z"}, {"changes": [{"removed": "", "field_name": "whiteboard", "added": "[tw-dom] btpp-fixlater"}], "who": "overholt@mozilla.com", "when": "2016-04-22T18:15:51Z"}, {"changes": [{"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "btian@mozilla.com"}], "who": "ben.tian@gmail.com", "when": "2016-05-24T10:48:01Z"}, {"changes": [{"removed": "[tw-dom] btpp-fixlater", "field_name": "whiteboard", "added": "[tw-dom] btpp-active"}], "who": "ben.tian@gmail.com", "when": "2016-05-24T10:48:15Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8755688, "added": "1"}], "who": "ben.tian@gmail.com", "when": "2016-05-25T13:54:18Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8756204, "added": "1"}], "who": "ben.tian@gmail.com", "when": "2016-05-30T08:54:20Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "hsivonen@hsivonen.fi"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8757799, "added": "review?(hsivonen@hsivonen.fi)"}], "who": "ben.tian@gmail.com", "when": "2016-05-31T03:17:23Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(hsivonen@hsivonen.fi)"}], "who": "ben.tian@gmail.com", "when": "2016-06-08T07:07:51Z"}, {"changes": [{"removed": "needinfo?(hsivonen@hsivonen.fi)", "field_name": "flagtypes.name", "added": ""}], "who": "hsivonen@hsivonen.fi", "when": "2016-06-08T17:19:30Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(hsivonen@hsivonen.fi)", "attachment_id": 8757799, "added": "review+"}], "who": "hsivonen@hsivonen.fi", "when": "2016-06-08T17:20:25Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8757799, "added": "1"}], "who": "ben.tian@gmail.com", "when": "2016-06-14T12:22:51Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "checkin-needed"}], "who": "ben.tian@gmail.com", "when": "2016-07-04T09:42:50Z"}, {"changes": [{"removed": "checkin-needed", "field_name": "keywords", "added": ""}], "who": "pulsebot@bots.tld", "when": "2016-07-04T14:21:49Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla50"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2016-07-04 22:04:18"}, {"removed": "---", "field_name": "cf_status_firefox50", "added": "fixed"}], "who": "philringnalda@gmail.com", "when": "2016-07-04T22:04:18Z"}], "resolution": "FIXED", "op_sys": "Unspecified", "cf_fx_points": "---", "cf_blocking_fennec": "---"}