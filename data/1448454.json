{"cf_tracking_thunderbird_esr52": "---", "status": "RESOLVED", "cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "cf_tracking_firefox62": "---", "creator": "continuation@gmail.com", "mentors_detail": [], "depends_on": [1438688], "cf_status_firefox_esr60": "---", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "keywords": [], "cc_detail": [{"email": "apavel@mozilla.com", "id": 600553, "name": "apavel@mozilla.com", "real_name": "Andreea Pavel [:apavel]"}, {"email": "gps@mozilla.com", "id": 420446, "name": "gps@mozilla.com", "real_name": "Gregory Szorc [:gps]"}, {"email": "jmaher@mozilla.com", "id": 324370, "name": "jmaher@mozilla.com", "real_name": "Joel Maher ( :jmaher ) (UTC-4)"}, {"email": "mcastelluccio@mozilla.com", "id": 420453, "name": "mcastelluccio@mozilla.com", "real_name": "Marco Castelluccio [:marco]"}, {"email": "n.nethercote@gmail.com", "id": 334849, "name": "n.nethercote@gmail.com", "real_name": "Nicholas Nethercote [:njn]"}, {"email": "nfroyd@mozilla.com", "id": 417288, "name": "nfroyd@mozilla.com", "real_name": "Nathan Froyd [:froydnj]"}, {"email": "nika@thelayzells.com", "id": 534482, "name": "nika@thelayzells.com", "real_name": ":Nika Layzell"}, {"email": "ted@mielczarek.org", "id": 39022, "name": "ted@mielczarek.org", "real_name": "Ted Mielczarek [:ted.mielczarek]"}], "cf_last_resolved": "2018-05-24T21:23:51Z", "attachments": [{"creator": "continuation@gmail.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-04-03T23:31:34Z", "type_id": 4, "creation_date": "2018-04-03T15:14:11Z", "id": 1738493, "setter": "n.nethercote@gmail.com"}], "content_type": "text/x-review-board-request", "id": 8964579}, {"creator": "continuation@gmail.com", "is_obsolete": 0, "is_patch": 1, "flags": [], "content_type": "text/plain", "id": 8966283}], "votes": 0, "classification": "Components", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 28, "comments": [{"text": "Bug 1438688 changes many fields of the data structures in xpt_struct.h to be accessed only via accessors. These fields should be made private. This will require defining and using constexpr constructors for the classes, instead of aggregate initialization. Once somebody writes a patch, they will need to double check that all of the data structures in the generated code are still rodata.", "author": "continuation@gmail.com", "id": 13152517, "time": "2018-03-23T20:08:56Z"}, {"text": "Created attachment 8964579\nBug 1448454 - Make some fields in xpt_struct.h private.\n\nMany of these fields have accessors, and can only be read indirectly\nby going through the XPTHeader data structure anyways, so they should\nbe marked private. This makes the generated XPT data file noisier due\nto the need for constexpr constructors.\n\nI had to fix the ctors for the classes in xptinfo.h to be less weird\nbecause there was a compiler error.\n\nMembers in two of the classes need to be marked protected because they\nhave subclasses in xptinfo.h. Ideally those classes would be merged\nin.\n\nReview commit: https://reviewboard.mozilla.org/r/233294/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/233294/", "author": "continuation@gmail.com", "id": 13176624, "time": "2018-04-03T15:14:11Z"}, {"text": "Comment on attachment 8964579\nBug 1448454 - Make some fields in xpt_struct.h private.\n\nhttps://reviewboard.mozilla.org/r/233294/#review239034\n\nr=me if the tables are still rodata.", "author": "n.nethercote@gmail.com", "id": 13178251, "time": "2018-04-03T23:31:34Z"}, {"text": "Yeah, I think I checked that, but I should recheck it.", "author": "continuation@gmail.com", "id": 13178255, "time": "2018-04-03T23:33:28Z"}, {"text": "Pushed by amccreight@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/5eaa657f6e06\nMake some fields in xpt_struct.h private. r=njn", "author": "pulsebot@bots.tld", "id": 13178283, "time": "2018-04-03T23:47:45Z"}, {"text": "Backed out for build bustages at /builds/worker/workspace/build/src/xpcom/typelib/xpt/xpt_struct.h:16\n\nPush that started the failures: https://treeherder.mozilla.org/#/jobs?repo=autoland&revision=5eaa657f6e06a62072c04c9f233f4e4508c15f51\n\nFailure log: https://treeherder.mozilla.org/logviewer.html#?job_id=171754031&repo=autoland&lineNumber=8251\n\nBackout: https://hg.mozilla.org/integration/autoland/rev/7d7ad254494eee551d26aafb9fc44906679480e6", "author": "apavel@mozilla.com", "id": 13178304, "time": "2018-04-04T00:03:05Z"}, {"text": "Oops. I didn't think about the fact that one mandatory and one optional argument would mean the implicit/explicit stuff was in play...", "author": "continuation@gmail.com", "id": 13180235, "time": "2018-04-04T16:42:48Z"}, {"text": "Err, two optional arguments.", "author": "continuation@gmail.com", "id": 13180236, "time": "2018-04-04T16:42:58Z"}, {"text": "Comment on attachment 8964579\nBug 1448454 - Make some fields in xpt_struct.h private.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/233294/diff/1-2/", "author": "continuation@gmail.com", "id": 13180248, "time": "2018-04-04T16:45:01Z"}, {"text": "Pushed by amccreight@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/e5f7b0762928\nMake some fields in xpt_struct.h private. r=njn", "author": "pulsebot@bots.tld", "id": 13180267, "time": "2018-04-04T16:49:20Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/e5f7b0762928", "author": "nbeleuzu@mozilla.com", "id": 13181485, "time": "2018-04-04T22:04:53Z"}, {"text": "I was looking at perfherder, and it seems like this may have caused a big installer size regression. Very odd.", "author": "continuation@gmail.com", "id": 13184106, "time": "2018-04-05T18:49:47Z"}, {"text": "It may have also regressed compile time on Windows by about 8%, which seems bad. Maybe MSVC just is not very fast at compiling a 26000 line file full of constexpr constructors...", "author": "continuation@gmail.com", "id": 13184307, "time": "2018-04-05T19:56:51Z"}, {"text": "Are you sure that new code got compiled into straight data, rather than some giant static constructor(s)?", "author": "nfroyd@mozilla.com", "id": 13184364, "time": "2018-04-05T20:09:57Z"}, {"text": "(In reply to Nathan Froyd [:froydnj] from comment #13)\n> Are you sure that new code got compiled into straight data, rather than some\n> giant static constructor(s)?\n\nI don't know how to check that. I checked that on Linux that the various arrays were all still in .rodata.", "author": "continuation@gmail.com", "id": 13184367, "time": "2018-04-05T20:11:04Z"}, {"text": "One option might be to paste some of the generated code into https://gcc.godbolt.org/ and see what it compiles to.  The other option is to actually look at an MSVC build tree somehow and see what the relevant .obj looks like.", "author": "nfroyd@mozilla.com", "id": 13184416, "time": "2018-04-05T20:27:11Z"}, {"text": "this change looks to have caused a build time regression:\n== Change summary for alert #12502 (as of Wed, 04 Apr 2018 20:49:08 GMT) ==\n\nRegressions:\n\n  8%  build times windows2012-32 pgo taskcluster-c4.4xlarge     4,538.91 -> 4,917.75\n  5%  build times windows2012-64 pgo taskcluster-c4.4xlarge     4,530.61 -> 4,766.80\n\nFor up to date results, see: https://treeherder.mozilla.org/perf.html#/alerts?id=12502\n\nI am not 100% sure if this is the cause, but looking at the related graphs seems to highlight the patch from here.", "author": "jmaher@mozilla.com", "id": 13192336, "time": "2018-04-09T16:07:52Z"}, {"text": "(In reply to Joel Maher ( :jmaher) (UTC-5) from comment #16)\n> I am not 100% sure if this is the cause, but looking at the related graphs\n> seems to highlight the patch from here.\n\nYeah, the version of MSVC we're using seems to not deal with constexprs very well, so it is plausible. Between this and (more importantly) the installer size regression I see I think this should get backed out. I don't think there's a lot of danger that people are going to start poking around in these data structures, as it is very obscure. Maybe Nika's approach in bug 1444745 will work better.", "author": "continuation@gmail.com", "id": 13192548, "time": "2018-04-09T17:10:57Z"}, {"text": "Created attachment 8966283\nBack out bug 1448454 for compile time and installer size regressions.", "author": "continuation@gmail.com", "id": 13192594, "time": "2018-04-09T17:24:49Z"}, {"text": "Please land the backout patch I just attached. I checked it locally to make sure it builds and runs.", "author": "continuation@gmail.com", "id": 13192598, "time": "2018-04-09T17:25:38Z"}, {"text": "The installer size regression looks like this:\n  59,119,719.00 (lower is better)\n  \u0394 180,407.00 (0.3%)\n175kb isn't the end of the world I guess, if there was a stronger reason for taking it.", "author": "continuation@gmail.com", "id": 13192615, "time": "2018-04-09T17:30:20Z"}, {"text": "175K of *installer* size probably translates to something like 250-300K of libxul size (perfherder will tell you if you click the \"include subtests\" checkbox and search for \"xul\" to find the appropriate timeseries)...which is quite large.  Unless there was a *really* good reason for needing the feature, a cleanup patch that regresses installer size by 175K is not acceptable.", "author": "nfroyd@mozilla.com", "id": 13192640, "time": "2018-04-09T17:40:31Z"}, {"text": "Yeah, I agree.", "author": "continuation@gmail.com", "id": 13192645, "time": "2018-04-09T17:41:50Z"}, {"text": "I apologize for suggesting this change in the first place. It's a good example of what looks like a zero-cost abstraction but actually isn't.", "author": "n.nethercote@gmail.com", "id": 13193544, "time": "2018-04-09T22:17:30Z"}, {"text": "That's alright. I agree that it would be better if those fields were private.", "author": "continuation@gmail.com", "id": 13193570, "time": "2018-04-09T22:25:44Z"}, {"text": "Pushed https://hg.mozilla.org/integration/mozilla-inbound/rev/09c9390d42d6 \nBack out bug 1448454 for compile time and installer size regressions. r=mccr8", "author": "apavel@mozilla.com", "id": 13193792, "time": "2018-04-10T01:18:47Z"}, {"text": "backout shows build time improvements:\n== Change summary for alert #12618 (as of Tue, 10 Apr 2018 05:08:57 GMT) ==\n\nImprovements:\n\n  5%  build times windows2012-64 pgo taskcluster-c4.4xlarge     4,796.76 -> 4,567.30\n\nFor up to date results, see: https://treeherder.mozilla.org/perf.html#/alerts?id=12618", "author": "jmaher@mozilla.com", "id": 13195306, "time": "2018-04-10T16:20:01Z"}, {"text": "Somebody can try again if MSVC gets better.", "author": "continuation@gmail.com", "id": 13362237, "time": "2018-05-24T21:23:51Z"}], "id": 1448454, "priority": "--", "cc": ["apavel@mozilla.com", "gps@mozilla.com", "jmaher@mozilla.com", "mcastelluccio@mozilla.com", "n.nethercote@gmail.com", "nfroyd@mozilla.com", "nika@thelayzells.com", "ted@mielczarek.org"], "cf_crash_signature": "", "version": "unspecified", "is_cc_accessible": true, "cf_tracking_firefox_esr52": "---", "see_also": [], "cf_tracking_thunderbird_esr60": "---", "cf_platform_rel": "---", "product": "Core", "cf_fx_iteration": "---", "blocks": [1451425], "qa_contact": "", "creation_time": "2018-03-23T20:08:56Z", "cf_status_firefox_esr52": "---", "component": "XPCOM", "assigned_to_detail": {"email": "nobody@mozilla.org", "id": 1, "name": "nobody@mozilla.org", "real_name": "Nobody; OK to take it and work on it"}, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "---", "cf_status_firefox61": "fixed", "cf_status_firefox60": "---", "target_milestone": "mozilla61", "cf_rank": null, "cf_qa_whiteboard": "", "severity": "normal", "groups": [], "cf_status_thunderbird_esr52": "---", "url": "", "cf_status_thunderbird_esr60": "---", "creator_detail": {"email": "continuation@gmail.com", "id": 406194, "name": "continuation@gmail.com", "real_name": "Andrew McCreight [:mccr8]"}, "whiteboard": "", "mentors": [], "summary": "Make more fields private in xpt_struct.h", "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "last_change_time": "2018-05-24T21:23:51Z", "assigned_to": "nobody@mozilla.org", "is_open": false, "history": [{"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8964579, "added": "review?(n.nethercote@gmail.com)"}], "who": "continuation@gmail.com", "when": "2018-04-03T15:14:11Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(n.nethercote@gmail.com)", "attachment_id": 8964579, "added": "review+"}], "who": "n.nethercote@gmail.com", "when": "2018-04-03T23:31:34Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "nika@thelayzells.com"}], "who": "continuation@gmail.com", "when": "2018-04-03T23:33:04Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "apavel@mozilla.com"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(continuation@gmail.com)"}], "who": "apavel@mozilla.com", "when": "2018-04-04T00:03:05Z"}, {"changes": [{"removed": "needinfo?(continuation@gmail.com)", "field_name": "flagtypes.name", "added": ""}], "who": "continuation@gmail.com", "when": "2018-04-04T16:42:48Z"}, {"changes": [{"removed": "", "field_name": "blocks", "added": "1451425"}], "who": "continuation@gmail.com", "when": "2018-04-04T17:53:53Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla61"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2018-04-04 22:04:53"}, {"removed": "---", "field_name": "cf_status_firefox61", "added": "fixed"}], "who": "nbeleuzu@mozilla.com", "when": "2018-04-04T22:04:53Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "nfroyd@mozilla.com"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(continuation@gmail.com)"}], "who": "nfroyd@mozilla.com", "when": "2018-04-05T20:09:57Z"}, {"changes": [{"removed": "needinfo?(continuation@gmail.com)", "field_name": "flagtypes.name", "added": ""}], "who": "continuation@gmail.com", "when": "2018-04-05T20:11:04Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "gps@mozilla.com, jmaher@mozilla.com, ted@mielczarek.org"}], "who": "jmaher@mozilla.com", "when": "2018-04-09T16:07:52Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "checkin-needed"}, {"removed": "RESOLVED", "field_name": "status", "added": "REOPENED"}, {"removed": "FIXED", "field_name": "resolution", "added": ""}], "who": "continuation@gmail.com", "when": "2018-04-09T17:25:38Z"}, {"changes": [{"removed": "checkin-needed", "field_name": "keywords", "added": ""}], "who": "ryanvm@gmail.com", "when": "2018-04-10T01:25:51Z"}, {"changes": [{"removed": "continuation@gmail.com", "field_name": "assigned_to", "added": "nobody@mozilla.org"}], "who": "continuation@gmail.com", "when": "2018-04-19T19:59:35Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "mcastelluccio@mozilla.com"}], "who": "mcastelluccio@mozilla.com", "when": "2018-04-27T11:19:29Z"}, {"changes": [{"removed": "REOPENED", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "WONTFIX"}, {"removed": "2018-04-04 22:04:53", "field_name": "cf_last_resolved", "added": "2018-05-24 21:23:51"}], "who": "continuation@gmail.com", "when": "2018-05-24T21:23:51Z"}], "resolution": "WONTFIX", "op_sys": "Unspecified", "cf_fx_points": "---", "cf_blocking_fennec": "---"}