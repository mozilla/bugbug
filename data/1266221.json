{"cf_tracking_thunderbird_esr52": "---", "status": "RESOLVED", "cf_tracking_firefox60": "---", "attachments": [{"creator": "bkelly@mozilla.com", "is_obsolete": 1, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2016-04-21T19:31:49Z", "type_id": 4, "creation_date": "2016-04-21T18:46:40Z", "id": 1380999, "setter": "bzbarsky@mit.edu"}], "content_type": "text/plain", "id": 8743993}, {"creator": "bkelly@mozilla.com", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2016-04-21T20:56:30Z", "type_id": 4, "creation_date": "2016-04-21T19:56:44Z", "id": 1381046, "setter": "poirot.alex@gmail.com"}], "content_type": "text/plain", "id": 8744025}, {"creator": "bkelly@mozilla.com", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2016-04-21T21:12:08Z", "type_id": 4, "creation_date": "2016-04-21T21:12:08Z", "id": 1381088, "setter": "bkelly@mozilla.com"}], "content_type": "text/plain", "id": 8744043}], "classification": "Components", "creator": "bkelly@mozilla.com", "cc": ["bgrinstead@mozilla.com", "bzbarsky@mit.edu", "jryans@gmail.com"], "depends_on": [1268849], "creation_time": "2016-04-20T21:27:23Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "cf_status_firefox58": "---", "cf_status_firefox59": "---", "keywords": [], "summary": "service workers should check for devtools http testing option on top window", "id": 1266221, "assigned_to_detail": {"email": "bkelly@mozilla.com", "id": 465500, "name": "bkelly@mozilla.com", "real_name": "Ben Kelly [PTO, back late March][:bkelly]"}, "severity": "normal", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "assigned_to": "bkelly@mozilla.com", "comment_count": 9, "comments": [{"text": "Currently we have a number of places that call GetServiceWorkerTestingEnabled() on the current documents window.  This works for the top level page, but fails for embedded iframes since devtools only sets the option on the top window.  We should call GetScriptableTop() and check the value there.", "author": "bkelly@mozilla.com", "id": 11342639, "time": "2016-04-20T21:27:23Z"}, {"text": "Created attachment 8743993\nGet devtools http service worker testing option from top window. r=bz\n\nSo, we have this devtools option that enables service workers on http, but only when devtools is open.  This is implemented by devtools calling SetServiceWorkersTestingEnabled() on the window which then sets a flag.\n\nOf course, devtools only calls this on the top level window, but we have lots of code that just checks for the flag on the current document's window.  This means that code running in an http iframe in a browser tab with devtools open won't see the setting properly.  So embedded iframes won't correctly have access to service workers, Clients.matchAll() won't see these iframes, etc.\n\nRather than fix all these callers to use GetScriptableTop(), I instead changed the window GetServiceWorkersTestingEnabled() method to internally use GetScriptableTop() automatically.\n\nI will look in to writing a test.  There should be some devtools test somewhere I can piggy back off of.\n\nhttps://treeherder.mozilla.org/#/jobs?repo=try&revision=3ff66fa01126", "author": "bkelly@mozilla.com", "id": 11345762, "time": "2016-04-21T18:46:40Z"}, {"text": "Comment on attachment 8743993\nGet devtools http service worker testing option from top window. r=bz\n\nr=me", "author": "bzbarsky@mit.edu", "id": 11345893, "time": "2016-04-21T19:31:49Z"}, {"text": "Created attachment 8744025\nP2 Expand devtools test to verify toolbox service worker option works with nested iframes. r=bgrins\n\nThis fails before the P1 patch and succeeds with the patch.\n\n  https://treeherder.mozilla.org/#/jobs?repo=try&revision=f46ceabe574e", "author": "bkelly@mozilla.com", "id": 11345967, "time": "2016-04-21T19:56:44Z"}, {"text": "Comment on attachment 8744025\nP2 Expand devtools test to verify toolbox service worker option works with nested iframes. r=bgrins\n\nReview of attachment 8744025:\n-----------------------------------------------------------------\n\nRedirecting to jryans, who's done reviews for this file before (feel free to re-redirect - I could look at this next week if needed)", "author": "bgrinstead@mozilla.com", "id": 11346062, "time": "2016-04-21T20:28:40Z"}, {"text": "Comment on attachment 8744025\nP2 Expand devtools test to verify toolbox service worker option works with nested iframes. r=bgrins\n\nReview of attachment 8744025:\n-----------------------------------------------------------------\n\nOffloading jryans as he has some other interesting pending r?.\n\nLooks good.\n(Oh! ContentTask is so nice now that I look at this old message manager code!)", "author": "poirot.alex@gmail.com", "id": 11346166, "time": "2016-04-21T20:56:30Z"}, {"text": "Created attachment 8744043\nP1 Get devtools http service worker testing option from top window. r=bz\n\nUpdated patch that relaxes the assertion that SetServiceWorkersTestingEnabled() is only ever called on top level windows.  It seems devtools calls it with false to defensively clear the setting on every window it directly works with.  This caused the assertion to trigger in an iframe inspector test.\n\nSo lets just assert that SetServiceWorkersTestingEnabled(true) is called on the top window.\n\nhttps://treeherder.mozilla.org/#/jobs?repo=try&revision=2aeedab78c9d", "author": "bkelly@mozilla.com", "id": 11346219, "time": "2016-04-21T21:12:08Z"}, {"text": "https://hg.mozilla.org/integration/mozilla-inbound/rev/b47cf480c22f\nhttps://hg.mozilla.org/integration/mozilla-inbound/rev/969dc22def18", "author": "pulsebot@bots.tld", "id": 11348238, "time": "2016-04-22T14:09:12Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/b47cf480c22f\nhttps://hg.mozilla.org/mozilla-central/rev/969dc22def18", "author": "cbook@mozilla.com", "id": 11352259, "time": "2016-04-25T10:02:05Z"}], "cf_last_resolved": "2016-04-25T10:02:05Z", "priority": "--", "mentors_detail": [], "cf_crash_signature": "", "version": "48 Branch", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox59": "---", "last_change_time": "2016-04-29T20:00:09Z", "cf_platform_rel": "---", "product": "Core", "cf_status_firefox_esr52": "---", "blocks": [1262699, 1263204], "qa_contact": "", "see_also": [], "cf_fx_iteration": "---", "component": "DOM: Service Workers", "votes": 0, "cf_status_firefox48": "fixed", "groups": [], "cf_status_firefox60": "---", "target_milestone": "mozilla48", "is_cc_accessible": true, "cf_status_thunderbird_esr52": "---", "url": "", "creator_detail": {"email": "bkelly@mozilla.com", "id": 465500, "name": "bkelly@mozilla.com", "real_name": "Ben Kelly [PTO, back late March][:bkelly]"}, "whiteboard": "btpp-active", "mentors": [], "cc_detail": [{"email": "bgrinstead@mozilla.com", "id": 476442, "name": "bgrinstead@mozilla.com", "real_name": "Brian Grinstead [:bgrins]"}, {"email": "bzbarsky@mit.edu", "id": 20209, "name": "bzbarsky@mit.edu", "real_name": "Boris Zbarsky [:bz] (no decent commit message means r-)"}, {"email": "jryans@gmail.com", "id": 282978, "name": "jryans@gmail.com", "real_name": "J. Ryan Stinnett [:jryans] (use ni?)"}], "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "cf_tracking_firefox58": "---", "cf_rank": null, "is_open": false, "history": [{"changes": [{"removed": "", "field_name": "cc", "added": "bzbarsky@mit.edu"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8743993, "added": "review?(bzbarsky@mit.edu)"}], "who": "bkelly@mozilla.com", "when": "2016-04-21T18:46:40Z"}, {"changes": [{"removed": "", "field_name": "blocks", "added": "1262699"}], "who": "bkelly@mozilla.com", "when": "2016-04-21T18:47:34Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(bzbarsky@mit.edu)", "attachment_id": 8743993, "added": "review+"}], "who": "bzbarsky@mit.edu", "when": "2016-04-21T19:31:49Z"}, {"changes": [{"removed": "", "field_name": "whiteboard", "added": "btpp-active"}], "who": "overholt@mozilla.com", "when": "2016-04-21T19:41:28Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "bgrinstead@mozilla.com"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8744025, "added": "review?(bgrinstead@mozilla.com)"}], "who": "bkelly@mozilla.com", "when": "2016-04-21T19:56:44Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "jryans@gmail.com"}, {"field_name": "flagtypes.name", "removed": "review?(bgrinstead@mozilla.com)", "attachment_id": 8744025, "added": "review?(jryans@gmail.com)"}], "who": "bgrinstead@mozilla.com", "when": "2016-04-21T20:28:40Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(jryans@gmail.com)", "attachment_id": 8744025, "added": "review+"}], "who": "poirot.alex@gmail.com", "when": "2016-04-21T20:56:30Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8743993, "added": "1"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8744043, "added": "review+"}], "who": "bkelly@mozilla.com", "when": "2016-04-21T21:12:08Z"}, {"changes": [{"removed": "ASSIGNED", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla48"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2016-04-25 03:02:05"}, {"removed": "affected", "field_name": "cf_status_firefox48", "added": "fixed"}], "who": "cbook@mozilla.com", "when": "2016-04-25T10:02:05Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1268849"}], "who": "bkelly@mozilla.com", "when": "2016-04-29T20:00:09Z"}], "resolution": "FIXED", "op_sys": "Unspecified", "cf_fx_points": "---", "cf_blocking_fennec": "---"}