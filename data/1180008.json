{"cf_tracking_thunderbird_esr52": "---", "status": "RESOLVED", "cf_tracking_firefox60": "---", "attachments": [{"creator": "karlt@mozbugz.karlt.net", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2015-07-02T23:35:23Z", "type_id": 4, "creation_date": "2015-07-02T22:48:32Z", "id": 1201265, "setter": "mh+mozilla@glandium.org"}], "content_type": "text/plain", "id": 8629119}, {"creator": "karlt@mozbugz.karlt.net", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2015-07-02T23:08:32Z", "type_id": 4, "creation_date": "2015-07-02T22:48:55Z", "id": 1201266, "setter": "andrew@comminos.com"}], "content_type": "text/plain", "id": 8629120}, {"creator": "karlt@mozbugz.karlt.net", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2015-07-02T23:10:31Z", "type_id": 4, "creation_date": "2015-07-02T22:49:11Z", "id": 1201269, "setter": "andrew@comminos.com"}], "content_type": "text/plain", "id": 8629122}, {"creator": "andrew@comminos.com", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2015-07-06T23:17:27Z", "type_id": 4, "creation_date": "2015-07-06T15:26:24Z", "id": 1202476, "setter": "karlt@mozbugz.karlt.net"}], "content_type": "text/plain", "id": 8629986}], "classification": "Components", "creator": "karlt@mozbugz.karlt.net", "cc": ["andrew@comminos.com", "karlt@mozbugz.karlt.net", "mh+mozilla@glandium.org", "tnikkel@gmail.com"], "depends_on": [], "creation_time": "2015-07-02T22:26:13Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "cf_status_firefox58": "---", "cf_status_firefox59": "---", "keywords": [], "summary": "don't measure size of decorations for override-redirect windows", "id": 1180008, "assigned_to_detail": {"email": "karlt@mozbugz.karlt.net", "id": 274246, "name": "karlt@mozbugz.karlt.net", "real_name": "Karl Tomlinson (:karlt)"}, "severity": "normal", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "assigned_to": "karlt@mozbugz.karlt.net", "comment_count": 16, "comments": [{"text": "override-redirect windows (GTK_WINDOW_POPUP) are positioned by the client, not the window manager.  They do not typically have window manager decorations, and even if they did, the offsets would not be relevant to Gecko's positioning.\n_NET_FRAME_EXTENTS is only relevant for managed windows, and so a waste of time for override-redirect windows.\n\nI initially wrote these when trying to understand the proposed solution in bug 1146297 as they may help reduce the number of situations of possible unintended consequences observed in https://bugzilla.mozilla.org/show_bug.cgi?id=1146297#c23 with the first proposed solution (though I'm not clear why the problem happens only with popup windows).  However, I think the changes are worthwhile on their own.", "author": "karlt@mozbugz.karlt.net", "id": 10448216, "time": "2015-07-02T22:26:13Z"}, {"text": "Created attachment 8629119\nprovide gtk_window_get_window_type for old GTK versions", "author": "karlt@mozbugz.karlt.net", "id": 10448328, "time": "2015-07-02T22:48:32Z"}, {"text": "Created attachment 8629120\nuse mGdkWindow instead of finding it from gtk_widget_get_window(mShell)\n\nSince https://hg.mozilla.org/mozilla-central/rev/9541dbf6e020#l2.184\nthere is only one GdkWindow per nsWindow.\n\nThe mGdkWindow pointer is cleared in OnContainerUnrealize() before the shell\nwidget destruction completes:\nhttps://hg.mozilla.org/mozilla-central/annotate/50b95032152c/widget/gtk/nsWindow.cpp#l2480", "author": "karlt@mozbugz.karlt.net", "id": 10448329, "time": "2015-07-02T22:48:55Z"}, {"text": "Created attachment 8629122\ndon't measure size of decorations for override-redirect windows", "author": "karlt@mozbugz.karlt.net", "id": 10448332, "time": "2015-07-02T22:49:11Z"}, {"text": "Comment on attachment 8629120\nuse mGdkWindow instead of finding it from gtk_widget_get_window(mShell)\n\nReview of attachment 8629120:\n-----------------------------------------------------------------\n\nLooks good to me.", "author": "andrew@comminos.com", "id": 10448395, "time": "2015-07-02T23:08:32Z"}, {"text": "Comment on attachment 8629122\ndon't measure size of decorations for override-redirect windows\n\nReview of attachment 8629122:\n-----------------------------------------------------------------\n\n::: widget/gtk/nsWindow.cpp\n@@ +1520,5 @@\n>  {\n>      PROFILER_LABEL(\"nsWindow\", \"GetClientOffset\", js::ProfileEntry::Category::GRAPHICS);\n>  \n> +    if (!mIsTopLevel || !mShell || !mGdkWindow ||\n> +        gtk_window_get_window_type(GTK_WINDOW(mShell)) == GTK_WINDOW_POPUP) {\n\nPerhaps it might be better to be more general and use gtk_window_get_decorated (or gdk_window_get_decorations) to determine if a window has no border?", "author": "andrew@comminos.com", "id": 10448400, "time": "2015-07-02T23:10:31Z"}, {"text": "(In reply to Andrew Comminos [:acomminos] from comment #5)\n> Perhaps it might be better to be more general and use\n> gtk_window_get_decorated (or gdk_window_get_decorations) to determine if a\n> window has no border?\n\ngtk_window_get_decorated() sounds like the function we want, but, AFAICS from GTK source code, it returns true even for GTK_WINDOW_POPUP windows if they have not had gtk_window_set_decorated() explicitly called.\n\ngdk_window_get_decorations would correctly return FALSE for override-redirect windows, but requires a round trip for managed windows.\n\nWe could probably use both gtk_window_get_window_type and gtk_window_get_decorated, but the number of instances where the addition of gtk_window_get_decorated would avoid an unnecessary property get is small, and there may be a risk of some window managers decorating when we have asked them not to.", "author": "karlt@mozbugz.karlt.net", "id": 10457417, "time": "2015-07-06T01:36:56Z"}, {"text": "https://hg.mozilla.org/integration/mozilla-inbound/rev/1c545ed125da\nhttps://hg.mozilla.org/integration/mozilla-inbound/rev/14c98ce60b8a\nhttps://hg.mozilla.org/integration/mozilla-inbound/rev/7afaa79f611e", "author": "pulsebot@bots.tld", "id": 10457424, "time": "2015-07-06T01:43:52Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/1c545ed125da\nhttps://hg.mozilla.org/mozilla-central/rev/14c98ce60b8a\nhttps://hg.mozilla.org/mozilla-central/rev/7afaa79f611e", "author": "cbook@mozilla.com", "id": 10458219, "time": "2015-07-06T09:42:37Z"}, {"text": "This busts linking on GTK3 builds due to gtk_window_get_window_type not being defined as a stub in mozgtk.c. Uploading a patch for it.", "author": "andrew@comminos.com", "id": 10459350, "time": "2015-07-06T15:25:33Z"}, {"text": "Created attachment 8629986\nDefine gtk_window_get_window_type in mozgtk.", "author": "andrew@comminos.com", "id": 10459357, "time": "2015-07-06T15:26:24Z"}, {"text": "Comment on attachment 8629986\nDefine gtk_window_get_window_type in mozgtk.\n\nThank you.\n\nI'm not certain whether this is better in COMMON_SYMBOLS or GTK3_SYMBOLS, but I think COMMON_SYMBOLS as you have here should be fine because I expect at least version 2.20 of GTK2 on systems with GTK3.\n\nwidget/gtk/compat/gtk/gtkwindow.h should prevent Gecko from using this symbol with GTK2, but there could be a risk of problems if this was in GTK3_SYMBOLS and some plugin or library loaded from the plugin-container was looking for the symbol.", "author": "karlt@mozbugz.karlt.net", "id": 10461844, "time": "2015-07-06T23:17:27Z"}, {"text": "Improvement: Mozilla-Inbound-Non-PGO - Customization Animation Tests - Ubuntu HW 12.04 x64 - 8.51% decrease\n-----------------------------------------------------------------------------------------------------------\n    Previous: avg 32.456 stddev 0.496 of 12 runs up to revision c51f9fc02d33\n    New     : avg 29.694 stddev 0.343 of 12 runs since revision 797634c4fd75\n    Change  : -2.762 (8.51% / z=5.570)\n    Graph   : http://mzl.la/1M7AWO9\n\nImprovement: Mozilla-Inbound-Non-PGO - Customization Animation Tests - Ubuntu HW 12.04 - 7.26% decrease\n-------------------------------------------------------------------------------------------------------\n    Previous: avg 33.946 stddev 0.390 of 12 runs up to revision c51f9fc02d33\n    New     : avg 31.481 stddev 0.181 of 12 runs since revision 797634c4fd75\n    Change  : -2.464 (7.26% / z=6.317)\n    Graph   : http://mzl.la/1M7B00m\n\nI didn't expect these tests to use popup windows.", "author": "karlt@mozbugz.karlt.net", "id": 10461859, "time": "2015-07-06T23:20:52Z"}, {"text": "https://hg.mozilla.org/integration/mozilla-inbound/rev/0fa40c837b53", "author": "pulsebot@bots.tld", "id": 10463087, "time": "2015-07-07T08:28:51Z"}, {"text": "Improvement: Mozilla-Inbound - Devtools At Maximum Performance - Ubuntu HW 12.04 x64 - 3.28% decrease\n-----------------------------------------------------------------------------------------------------\n    Previous: avg 253.703 stddev 2.338 of 12 runs up to revision d9074143dc58\n    New     : avg 245.384 stddev 1.682 of 12 runs since revision 797634c4fd75\n    Change  : -8.319 (3.28% / z=3.559)\n    Graph   : http://mzl.la/1eBRpyP", "author": "karlt@mozbugz.karlt.net", "id": 10463526, "time": "2015-07-07T11:09:15Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/0fa40c837b53", "author": "kwierso@gmail.com", "id": 10465741, "time": "2015-07-07T19:58:56Z"}], "cf_last_resolved": "2015-07-06T09:42:37Z", "priority": "--", "mentors_detail": [], "cf_crash_signature": "", "version": "Trunk", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox59": "---", "last_change_time": "2015-07-07T19:58:56Z", "cf_platform_rel": "---", "product": "Core", "cf_status_firefox_esr52": "---", "blocks": [1146297], "qa_contact": "", "see_also": [], "cf_fx_iteration": "---", "component": "Widget: Gtk", "votes": 0, "groups": [], "cf_status_firefox60": "---", "cf_status_firefox41": "---", "target_milestone": "mozilla42", "is_cc_accessible": true, "cf_status_thunderbird_esr52": "---", "url": "", "creator_detail": {"email": "karlt@mozbugz.karlt.net", "id": 274246, "name": "karlt@mozbugz.karlt.net", "real_name": "Karl Tomlinson (:karlt)"}, "whiteboard": "", "mentors": [], "cc_detail": [{"email": "andrew@comminos.com", "id": 502464, "name": "andrew@comminos.com", "real_name": "Andrew Comminos [:acomminos]"}, {"email": "karlt@mozbugz.karlt.net", "id": 274246, "name": "karlt@mozbugz.karlt.net", "real_name": "Karl Tomlinson (:karlt)"}, {"email": "mh+mozilla@glandium.org", "id": 47192, "name": "mh+mozilla@glandium.org", "real_name": "Mike Hommey [:glandium]"}, {"email": "tnikkel@gmail.com", "id": 255010, "name": "tnikkel@gmail.com", "real_name": "Timothy Nikkel (:tnikkel)"}], "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "cf_tracking_firefox58": "---", "cf_rank": null, "is_open": false, "history": [{"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8629119, "added": "review?(mh+mozilla@glandium.org)"}, {"removed": "", "field_name": "cc", "added": "mh+mozilla@glandium.org"}], "who": "karlt@mozbugz.karlt.net", "when": "2015-07-02T22:48:32Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8629120, "added": "review?(acomminos@mozilla.com)"}, {"removed": "", "field_name": "cc", "added": "acomminos@mozilla.com"}], "who": "karlt@mozbugz.karlt.net", "when": "2015-07-02T22:48:55Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8629122, "added": "review?(acomminos@mozilla.com)"}], "who": "karlt@mozbugz.karlt.net", "when": "2015-07-02T22:49:11Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(acomminos@mozilla.com)", "attachment_id": 8629120, "added": "review+"}], "who": "andrew@comminos.com", "when": "2015-07-02T23:08:32Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(acomminos@mozilla.com)", "attachment_id": 8629122, "added": "review+"}], "who": "andrew@comminos.com", "when": "2015-07-02T23:10:31Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(mh+mozilla@glandium.org)", "attachment_id": 8629119, "added": "review+"}], "who": "mh+mozilla@glandium.org", "when": "2015-07-02T23:35:23Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "karlt@mozbugz.karlt.net"}], "who": "karlt@mozbugz.karlt.net", "when": "2015-07-06T01:36:56Z"}, {"changes": [{"removed": "ASSIGNED", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla42"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2015-07-06 02:42:37"}, {"removed": "affected", "field_name": "cf_status_firefox42", "added": "fixed"}], "who": "cbook@mozilla.com", "when": "2015-07-06T09:42:37Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8629986, "added": "review?(karlt@mozbugz.karlt.net)"}], "who": "andrew@comminos.com", "when": "2015-07-06T15:26:24Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(karlt@mozbugz.karlt.net)", "attachment_id": 8629986, "added": "review+"}], "who": "karlt@mozbugz.karlt.net", "when": "2015-07-06T23:17:27Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "checkin-needed"}], "who": "andrew@comminos.com", "when": "2015-07-07T04:35:19Z"}, {"changes": [{"removed": "checkin-needed", "field_name": "keywords", "added": ""}], "who": "pulsebot@bots.tld", "when": "2015-07-07T08:28:51Z"}], "resolution": "FIXED", "op_sys": "Unspecified", "cf_fx_points": "---", "cf_blocking_fennec": "---"}