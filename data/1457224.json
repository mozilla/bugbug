{"cf_tracking_thunderbird_esr52": "---", "cf_tracking_firefox60": "---", "attachments": [{"creator": "aswan@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"requestee": "kmaglione+bmo@mozilla.com", "status": "?", "name": "review", "modification_date": "2018-05-01T05:25:22Z", "type_id": 4, "creation_date": "2018-05-01T05:25:22Z", "id": 1751029, "setter": "aswan@mozilla.com"}, {"status": "+", "name": "review", "modification_date": "2018-05-07T22:40:01Z", "type_id": 4, "creation_date": "2018-05-07T17:19:34Z", "id": 1753552, "setter": "tomica@gmail.com"}], "content_type": "text/x-review-board-request", "id": 8972235}, {"creator": "aswan@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"requestee": "kmaglione+bmo@mozilla.com", "status": "?", "name": "review", "modification_date": "2018-05-01T05:25:22Z", "type_id": 4, "creation_date": "2018-05-01T05:25:22Z", "id": 1751030, "setter": "aswan@mozilla.com"}, {"status": "+", "name": "review", "modification_date": "2018-05-07T21:39:33Z", "type_id": 4, "creation_date": "2018-05-07T17:19:34Z", "id": 1753553, "setter": "tomica@gmail.com"}], "content_type": "text/x-review-board-request", "id": 8972236}], "cf_tracking_firefox62": "---", "creator": "aswan@mozilla.com", "mentors_detail": [], "depends_on": [1378459, 1460607], "cf_status_firefox_esr60": "---", "cf_user_story": "", "history": [{"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8972235, "added": "review?(kmaglione+bmo@mozilla.com)"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8972236, "added": "review?(kmaglione+bmo@mozilla.com)"}, {"removed": "", "field_name": "cc", "added": "kmaglione+bmo@mozilla.com"}], "who": "aswan@mozilla.com", "when": "2018-05-01T05:25:22Z"}, {"changes": [{"removed": "--", "field_name": "priority", "added": "P1"}], "who": "aswan@mozilla.com", "when": "2018-05-03T18:14:41Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8972235, "added": "review?(tomica@gmail.com)"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8972236, "added": "review?(tomica@gmail.com)"}, {"removed": "", "field_name": "cc", "added": "tomica@gmail.com"}], "who": "aswan@mozilla.com", "when": "2018-05-07T17:19:34Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(tomica@gmail.com)", "attachment_id": 8972236, "added": "review+"}], "who": "tomica@gmail.com", "when": "2018-05-07T21:39:33Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(tomica@gmail.com)", "attachment_id": 8972235, "added": "review+"}], "who": "tomica@gmail.com", "when": "2018-05-07T22:40:01Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla62"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2018-05-08 23:08:46"}, {"removed": "---", "field_name": "cf_status_firefox62", "added": "fixed"}], "who": "aciure@mozilla.com", "when": "2018-05-08T23:08:46Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "igoldan@mozilla.com"}], "who": "igoldan@mozilla.com", "when": "2018-05-10T07:28:08Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1460607"}], "who": "alice0775@yahoo.co.jp", "when": "2018-05-11T08:26:27Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "vcarciu@softvision.ro"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(aswan@mozilla.com)"}], "who": "vcarciu@softvision.ro", "when": "2018-05-21T15:35:45Z"}, {"changes": [{"removed": "needinfo?(aswan@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "aswan@mozilla.com", "when": "2018-05-21T22:53:29Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "Tobias.Marty@gmx.de"}], "who": "Tobias.Marty@gmx.de", "when": "2018-05-22T21:11:13Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "simon.mainey@gmail.com"}], "who": "simon.mainey@gmail.com", "when": "2018-06-01T15:36:55Z"}], "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "keywords": [], "cc_detail": [{"email": "igoldan@mozilla.com", "id": 590618, "name": "igoldan@mozilla.com", "real_name": "Ionu\u021b Goldan [:igoldan], Performance Sheriffing"}, {"email": "kmaglione+bmo@mozilla.com", "id": 106098, "name": "kmaglione+bmo@mozilla.com", "real_name": "Kris Maglione [:kmag]"}, {"email": "simon.mainey@gmail.com", "id": 587136, "name": "simon.mainey@gmail.com", "real_name": "Simon Mainey"}, {"email": "Tobias.Marty@gmx.de", "id": 572549, "name": "Tobias.Marty@gmx.de", "real_name": "TMart"}, {"email": "tomica@gmail.com", "id": 445095, "name": "tomica@gmail.com", "real_name": "Tomislav Jovanovic :zombie"}, {"email": "vcarciu@softvision.ro", "id": 431489, "name": "vcarciu@softvision.ro", "real_name": "Victor Carciu"}], "cf_last_resolved": "2018-05-08T23:08:46Z", "cf_tracking_firefox61": "---", "votes": 0, "classification": "Components", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 15, "comments": [{"text": "", "author": "aswan@mozilla.com", "id": 13236129, "time": "2018-04-26T17:28:33Z"}, {"text": "Created attachment 8972235\nBug 1457224 Clean up extension testing helpers\n\n- Remove outdated appChanged logic from test helper function to start\n  the AddonManager\n- Avoid calling to the AddonManager in webextension tests that don't\n  otherwise require the AddonManager\n\nReview commit: https://reviewboard.mozilla.org/r/240902/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/240902/", "author": "aswan@mozilla.com", "id": 13245451, "time": "2018-05-01T05:22:35Z"}, {"text": "Created attachment 8972236\nBug 1457224 Enable delayed background page startup on Nightly\n\nReview commit: https://reviewboard.mozilla.org/r/240904/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/240904/", "author": "aswan@mozilla.com", "id": 13245452, "time": "2018-05-01T05:22:35Z"}, {"text": "https://treeherder.mozilla.org/#/jobs?repo=try&revision=79ae27f13215d9a3dd5a9dc0df8cfb9fb1aa7f5a", "author": "aswan@mozilla.com", "id": 13245453, "time": "2018-05-01T05:22:51Z"}, {"text": "Comment on attachment 8972236\nBug 1457224 Enable delayed background page startup on Nightly\n\nhttps://reviewboard.mozilla.org/r/240904/#review248044\n\n::: toolkit/components/extensions/test/xpcshell/test_ext_permissions.js:14\n(Diff revision 1)\n>  \n>  AddonTestUtils.init(this);\n>  AddonTestUtils.overrideCertDB();\n>  AddonTestUtils.createAppInfo(\"xpcshell@tests.mozilla.org\", \"XPCShell\", \"1\", \"42\");\n>  \n> +Services.prefs.setBoolPref(\"extensions.webextensions.background-delayed-startup\", false);\n\nHow come this isn't required for all xpcshell tests?", "author": "tomica@gmail.com", "id": 13260843, "time": "2018-05-07T21:39:33Z"}, {"text": "Comment on attachment 8972236\nBug 1457224 Enable delayed background page startup on Nightly\n\nhttps://reviewboard.mozilla.org/r/240904/#review248044\n\n> How come this isn't required for all xpcshell tests?\n\nThis is only an issue for tests that use the addon manager (ExtensionTestUtils.loadExtension() bypasses the addon manager unless you explicitly supply the useAddonManager option).  And for tests that do use the addon manager, its only an issue if they restart the manager (delayed background script startup only applies during browser startup, the behavior when an extension is installed for the first time isn't affected)", "author": "aswan@mozilla.com", "id": 13260866, "time": "2018-05-07T21:49:20Z"}, {"text": "Comment on attachment 8972235\nBug 1457224 Clean up extension testing helpers\n\nhttps://reviewboard.mozilla.org/r/240902/#review248048\n\n::: toolkit/components/extensions/ExtensionTestCommon.jsm:390\n(Diff revision 1)\n>        id,\n>        resourceURI: jarURI,\n>        cleanupFile: file,\n>        signedState,\n>        temporarilyInstalled: !!data.temporarilyInstalled,\n> +      TEST_NO_ADDON_MANAGER: true,\n\nnit: name isn't exactly in style, don't think we ever use that for something not global or static.\n\n::: toolkit/components/extensions/test/xpcshell/test_ext_webRequest_startup.js:50\n(Diff revision 1)\n>      },\n>    });\n>  \n>    await extension.startup();\n>  \n> -  await promiseRestartManager(false);\n> +  await promiseRestartManager();\n\nWas passing `false` ever right?  Can you please add a JSDoc to `promiseRestartManager` explaining the correct usage.\n\nAlso, looks like you missed one https://searchfox.org/mozilla-central/source/toolkit/components/extensions/test/xpcshell/test_ext_proxy_startup.js#90\n\n::: toolkit/mozapps/extensions/internal/AddonTestUtils.jsm:733\n(Diff revision 1)\n>    },\n>  \n>    /**\n>     * Starts up the add-on manager as if it was started by the application.\n>     *\n>     * @param {boolean} [appChanged = true]\n\nUpdate the JSDoc please.\n\n::: toolkit/mozapps/extensions/test/xpcshell/head_addons.js:675\n(Diff revision 1)\n>      Assert.equal(aActual[size], aExpected[size]);\n>    }\n>  }\n>  \n> -function startupManager(aAppChanged) {\n> -  promiseStartupManager(aAppChanged);\n> +function startupManager() {\n> +  promiseStartupManager();\n\nThis is not returning the promise, and not getting awaited anywhere.  That's either 1) on purpose, or 2) a mistake from when startup was converted to async.  Please document or fix accordingly.\n\n\nAlso, looks like you missed one https://searchfox.org/mozilla-central/source/toolkit/mozapps/extensions/test/xpcshell/test_distribution.js#72", "author": "tomica@gmail.com", "id": 13261017, "time": "2018-05-07T22:40:01Z"}, {"text": "Comment on attachment 8972235\nBug 1457224 Clean up extension testing helpers\n\nhttps://reviewboard.mozilla.org/r/240902/#review248048\n\n> Was passing `false` ever right?  Can you please add a JSDoc to `promiseRestartManager` explaining the correct usage.\n> \n> Also, looks like you missed one https://searchfox.org/mozilla-central/source/toolkit/components/extensions/test/xpcshell/test_ext_proxy_startup.js#90\n\nIt might have been right ages ago, this code has evolved quite a bit recently.\nI'll fix the proxy test, that was added since I wrote this patch.\n\n> This is not returning the promise, and not getting awaited anywhere.  That's either 1) on purpose, or 2) a mistake from when startup was converted to async.  Please document or fix accordingly.\n> \n> \n> Also, looks like you missed one https://searchfox.org/mozilla-central/source/toolkit/mozapps/extensions/test/xpcshell/test_distribution.js#72\n\nUgh, this is kind of a mess.  Short story is I don't think this is a problem in practice and we want to get rid of all the synchronous test apis in favor of asynchronous ones.  But I'll add some comments to hopefully reduce future confusion.", "author": "aswan@mozilla.com", "id": 13261143, "time": "2018-05-07T23:45:30Z"}, {"text": "Comment on attachment 8972235\nBug 1457224 Clean up extension testing helpers\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/240902/diff/1-2/", "author": "aswan@mozilla.com", "id": 13263439, "time": "2018-05-08T19:23:10Z"}, {"text": "Comment on attachment 8972236\nBug 1457224 Enable delayed background page startup on Nightly\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/240904/diff/1-2/", "author": "aswan@mozilla.com", "id": 13263440, "time": "2018-05-08T19:23:10Z"}, {"text": "https://hg.mozilla.org/integration/mozilla-inbound/rev/933708924c6fac7fe66962ebf79d9aa91888e960\nBug 1457224 Clean up extension testing helpers r=zombie\n\nhttps://hg.mozilla.org/integration/mozilla-inbound/rev/7201982e0481cbc237a21756ef88827c4dcfb2c8\nBug 1457224 Enable delayed background page startup on Nightly r=zombie", "author": "aswan@mozilla.com", "id": 13263486, "time": "2018-05-08T19:36:26Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/933708924c6f\nhttps://hg.mozilla.org/mozilla-central/rev/7201982e0481", "author": "aciure@mozilla.com", "id": 13263975, "time": "2018-05-08T23:08:46Z"}, {"text": "Congratulations for the perf wins! \\0/\n\n== Change summary for alert #13155 (as of Tue, 08 May 2018 16:44:13 GMT) ==\n\nImprovements:\n\n  6%  ts_paint_webext osx-10-10 opt e10s stylo     848.50 -> 796.17\n  3%  ts_paint_webext windows7-32 pgo e10s stylo   386.25 -> 373.83\n  3%  ts_paint_webext windows7-32 opt e10s stylo   422.33 -> 410.92\n  3%  ts_paint_webext windows10-64 opt e10s stylo  385.75 -> 375.58\n  3%  ts_paint_webext windows10-64 pgo e10s stylo  358.79 -> 349.58\n\nFor up to date results, see: https://treeherder.mozilla.org/perf.html#/alerts?id=13155", "author": "igoldan@mozilla.com", "id": 13267537, "time": "2018-05-10T07:28:08Z"}, {"text": "Can you please add some STRs to this bug(and test extension if possible) or mark it as \"qe-verify-\" ?", "author": "vcarciu@softvision.ro", "id": 13294326, "time": "2018-05-21T15:35:45Z"}, {"text": "See https://bugzilla.mozilla.org/show_bug.cgi?id=1447551#c23 and also separate email thread with addonsqa", "author": "aswan@mozilla.com", "id": 13295319, "time": "2018-05-21T22:53:29Z"}], "id": 1457224, "priority": "P1", "cc": ["igoldan@mozilla.com", "kmaglione+bmo@mozilla.com", "simon.mainey@gmail.com", "Tobias.Marty@gmx.de", "tomica@gmail.com", "vcarciu@softvision.ro"], "cf_crash_signature": "", "version": "unspecified", "is_cc_accessible": true, "cf_tracking_firefox_esr52": "---", "see_also": [], "cf_tracking_thunderbird_esr60": "---", "status": "RESOLVED", "product": "Toolkit", "cf_fx_iteration": "---", "blocks": [], "qa_contact": "", "creation_time": "2018-04-26T17:28:33Z", "cf_status_firefox_esr52": "---", "component": "WebExtensions: General", "assigned_to_detail": {"email": "aswan@mozilla.com", "id": 561655, "name": "aswan@mozilla.com", "real_name": "Andrew Swan [:aswan] (on PTO until 6/25)"}, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "fixed", "cf_status_firefox61": "---", "cf_status_firefox60": "---", "target_milestone": "mozilla62", "cf_rank": null, "cf_qa_whiteboard": "", "severity": "normal", "groups": [], "cf_status_thunderbird_esr52": "---", "url": "", "cf_status_thunderbird_esr60": "---", "creator_detail": {"email": "aswan@mozilla.com", "id": 561655, "name": "aswan@mozilla.com", "real_name": "Andrew Swan [:aswan] (on PTO until 6/25)"}, "whiteboard": "", "mentors": [], "summary": "Enable delayed background page startup on Nightly", "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "last_change_time": "2018-06-01T15:36:55Z", "assigned_to": "aswan@mozilla.com", "is_open": false, "cf_blocking_webextensions": "---", "resolution": "FIXED", "op_sys": "Unspecified", "cf_fx_points": "---", "cf_blocking_fennec": "---"}