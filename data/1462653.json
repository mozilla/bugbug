{"cf_tracking_thunderbird_esr52": "---", "status": "NEW", "cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "cf_tracking_firefox62": "---", "creator": "muhammed+bugzilla@influo.be", "mentors_detail": [], "depends_on": [], "cf_status_firefox_esr60": "---", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "keywords": [], "cc_detail": [{"email": "bugs@junglecode.net", "id": 384647, "name": "bugs@junglecode.net", "real_name": "Jet Villegas (:jet)"}, {"email": "daniel.aschilean@softvision.ro", "id": 613468, "name": "daniel.aschilean@softvision.ro", "real_name": "Daniel_A"}, {"email": "jfkthame@gmail.com", "id": 329583, "name": "jfkthame@gmail.com", "real_name": "Jonathan Kew (:jfkthame)"}, {"email": "mcastelluccio@mozilla.com", "id": 420453, "name": "mcastelluccio@mozilla.com", "real_name": "Marco Castelluccio [:marco]"}, {"email": "xidorn+moz@upsuper.org", "id": 373403, "name": "xidorn+moz@upsuper.org", "real_name": "Xidorn Quan [:xidorn] UTC+10"}], "cf_last_resolved": null, "attachments": [{"creator": "muhammed+bugzilla@influo.be", "is_obsolete": 0, "is_patch": 0, "flags": [], "content_type": "image/gif", "id": 8976978}], "votes": 0, "classification": "Components", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 7, "comments": [{"text": "Created attachment 8976978\nDemonstration of what's happening using the most recent (60 as of today) Firefox.\n\nUser Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:60.0) Gecko/20100101 Firefox/60.0\nBuild ID: 20180516032328\n\nSteps to reproduce:\n\n1. Visit https://www.influo.com/\n2. Navigate elsewhere within the website\n3. Try step 2 as many times as you'd like\n\n\nActual results:\n\nF(lash) O(f) U(nstyled) T(ext) even after the first navigation.\n\n\nExpected results:\n\nThe webfont should have immediately rendered instead of flashing from a system font to the webfont itself.", "author": "muhammed+bugzilla@influo.be", "id": 13287266, "time": "2018-05-18T14:00:41Z"}, {"text": "Using mozregression, I can confirm that this behaviour was introduced on 2016-11-23. The build one day prior to this date works perfectly as expected. \n\nWhat we're basically doing to achieve this FOUT that should only happen once (as long as the font stays cached):\n\n- Preload a separate stylesheet containing the @font-face rules with inline Base64 WOFF2 fonts. (=> for optimal download speeds)\n- Using JavaScript, check if the fonts are ready to be used and as soon as they are, add a CSS class to the root tag to use the fonts. Basically faking the brand new font-display: swap; to maximize browser support.\n- This method works flawlessly until FF v52. WebKit does not have this issue.\n\nNote: Replacing the Base64 with external binary woff2 resource files and using the same methodology, FOUT does NOT occur after the first visit...", "author": "muhammed+bugzilla@influo.be", "id": 13287376, "time": "2018-05-18T14:41:04Z"}, {"text": "User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:60.0) Gecko/20100101 Firefox/60.0\nBuild ID: 20180516032328 \n\nI manage to reproduce this issue on Windows 10 x64 with the latest  Firefox 60.0.1 (64-bit) and 62.0a1 (2018-05-22) (64-bit). Please note that this issue is also displayed after reloading the page.", "author": "daniel.aschilean@softvision.ro", "id": 13299129, "time": "2018-05-23T11:48:24Z"}, {"text": "Hey Jonathan, can we get a priority on this?", "author": "jmathies@mozilla.com", "id": 13299777, "time": "2018-05-23T15:27:32Z"}, {"text": "The immediate cause of the issue here seems to be the patch in bug 1283302, which greatly reduced the amount of time we allow a page to finish its initial layout before painting to the screen.\n\nTo quote comment 0 there: \"By setting it to a lower number, the user can potentially see content sooner, though that content may change again (causing FOUT or other visible layout shifts.)\"\n\nAnd that seems to be exactly the case here. If I set nglayout.initialpaint.delay to 100, for example, I no longer see the FOUT (at least on my Mac), whereas with it set to 50 (let alone the default of 5) I do see it.\n\nNote that embedding the fonts as data URLs in a stylesheet is probably -not- the best approach for a site like this, anyhow. Doing this means that each time the stylesheet is reloaded (even though the reload is generally from cache), we're instantiating an entirely new font from the data, whereas using a linked WOFF2 file will allow the user-font cache to re-use the same font instance (because it's the same resource, loaded by the same origin) across multiple pages (or multiple reloads of the same page).\n\nSo at the moment, it's unclear to me whether there is actually a bug here, or if the behavior is expected in the light of the new setting. Maybe Jet remembers more about how the initialpaint.delay value was chosen and the expected effects.", "author": "jfkthame@gmail.com", "id": 13300335, "time": "2018-05-23T18:57:10Z"}, {"text": "(In reply to Jonathan Kew (:jfkthame) from comment #4)\n\nThe rationale behind this approach is the time for first paint on mobile devices that have a slow 3G connection. The webfont being used consists of 10 (!!!) font-face rules and there is currently no option for us to use HTTP/2, which means costly RTTs with HTTP/1.1 delaying the first meaningful paint immensely. I do understand now though why FOUT does not occur when WOFF2 files are being used, but it looked like a visual glitch to me since Firefox is the only browser causing this \"issue\" (if you may call it an issue).", "author": "muhammed+bugzilla@influo.be", "id": 13306203, "time": "2018-05-24T00:05:06Z"}, {"text": "(In reply to Jonathan Kew (:jfkthame) from comment #4)\n> Note that embedding the fonts as data URLs in a stylesheet is probably -not-\n> the best approach for a site like this, anyhow. Doing this means that each\n> time the stylesheet is reloaded (even though the reload is generally from\n> cache), we're instantiating an entirely new font from the data, whereas\n> using a linked WOFF2 file will allow the user-font cache to re-use the same\n> font instance (because it's the same resource, loaded by the same origin)\n> across multiple pages (or multiple reloads of the same page).\n\nI guess we can use a hash table (with LRU) to cache font isntance from embeded data URL font if that's common enough... And that can be done ignoring principal, which is good.", "author": "xidorn+moz@upsuper.org", "id": 13382543, "time": "2018-06-03T01:31:29Z"}], "id": 1462653, "priority": "--", "cc": ["bugs@junglecode.net", "daniel.aschilean@softvision.ro", "jfkthame@gmail.com", "mcastelluccio@mozilla.com", "xidorn+moz@upsuper.org"], "cf_crash_signature": "", "version": "60 Branch", "is_cc_accessible": true, "cf_tracking_firefox_esr52": "---", "see_also": [], "cf_tracking_thunderbird_esr60": "---", "cf_platform_rel": "---", "product": "Core", "cf_fx_iteration": "---", "blocks": [], "qa_contact": "", "creation_time": "2018-05-18T14:00:41Z", "cf_status_firefox_esr52": "---", "component": "Layout: Text", "assigned_to_detail": {"email": "nobody@mozilla.org", "id": 1, "name": "nobody@mozilla.org", "real_name": "Nobody; OK to take it and work on it"}, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "affected", "cf_status_firefox61": "fix-optional", "cf_status_firefox60": "wontfix", "target_milestone": "---", "cf_rank": null, "cf_qa_whiteboard": "", "severity": "normal", "groups": [], "cf_status_thunderbird_esr52": "---", "url": "", "cf_status_thunderbird_esr60": "---", "creator_detail": {"email": "muhammed+bugzilla@influo.be", "id": 617834, "name": "muhammed+bugzilla@influo.be", "real_name": "Muhammed"}, "whiteboard": "", "mentors": [], "summary": "Recurring FOUT with successive navigations using cached inline Base64 webfont", "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [{"requestee": "bugs@junglecode.net", "status": "?", "name": "needinfo", "modification_date": "2018-05-23T18:57:10Z", "type_id": 800, "creation_date": "2018-05-23T18:57:10Z", "id": 1760717, "setter": "jfkthame@gmail.com"}], "last_change_time": "2018-06-03T01:31:29Z", "assigned_to": "nobody@mozilla.org", "is_open": true, "history": [{"changes": [{"removed": "", "field_name": "keywords", "added": "regression"}, {"removed": "", "field_name": "cc", "added": "mcastelluccio@mozilla.com"}], "who": "mcastelluccio@mozilla.com", "when": "2018-05-22T05:53:33Z"}, {"changes": [{"removed": "UNCONFIRMED", "field_name": "status", "added": "NEW"}, {"removed": "", "field_name": "cc", "added": "daniel.aschilean@softvision.ro"}, {"removed": "Untriaged", "field_name": "component", "added": "Layout: Text"}, {"removed": "Firefox", "field_name": "product", "added": "Core"}, {"removed": "0", "field_name": "is_confirmed", "added": "1"}, {"removed": "Unspecified", "field_name": "op_sys", "added": "Windows 10"}, {"removed": "---", "field_name": "cf_status_firefox60", "added": "affected"}, {"removed": "---", "field_name": "cf_status_firefox61", "added": "affected"}, {"removed": "---", "field_name": "cf_status_firefox62", "added": "affected"}], "who": "daniel.aschilean@softvision.ro", "when": "2018-05-23T11:48:24Z"}, {"changes": [{"removed": "regression", "field_name": "keywords", "added": ""}, {"removed": "", "field_name": "cc", "added": "jfkthame@gmail.com"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(jfkthame@gmail.com)"}, {"removed": "affected", "field_name": "cf_status_firefox60", "added": "wontfix"}, {"removed": "affected", "field_name": "cf_status_firefox61", "added": "fix-optional"}], "who": "jmathies@mozilla.com", "when": "2018-05-23T15:27:32Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "bugs@junglecode.net"}, {"removed": "needinfo?(jfkthame@gmail.com)", "field_name": "flagtypes.name", "added": "needinfo?(bugs@junglecode.net)"}], "who": "jfkthame@gmail.com", "when": "2018-05-23T18:57:10Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "xidorn+moz@upsuper.org"}], "who": "xidorn+moz@upsuper.org", "when": "2018-06-03T01:31:29Z"}], "resolution": "", "op_sys": "Windows 10", "cf_fx_points": "---", "cf_blocking_fennec": "---"}