{"cf_tracking_thunderbird_esr52": "---", "status": "NEW", "cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "cf_tracking_firefox62": "---", "creator": "jmuizelaar@mozilla.com", "mentors_detail": [], "depends_on": [1465474, 1464813], "cf_status_firefox_esr60": "---", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "keywords": ["regression"], "cc_detail": [{"email": "cam@mcc.id.au", "id": 54040, "name": "cam@mcc.id.au", "real_name": "Cameron McCormack (:heycam)"}, {"email": "daniel@glazman.org", "id": 21851, "name": "daniel@glazman.org", "real_name": "Daniel Glazman (:glazou)"}, {"email": "emilio@crisal.io", "id": 546716, "name": "emilio@crisal.io", "real_name": "Emilio Cobos \u00c1lvarez [:emilio]"}, {"email": "jan@ikenmeyer.eu", "id": 580271, "name": "jan@ikenmeyer.eu", "real_name": "Jan Andre Ikenmeyer [:darkspirit]"}, {"email": "jgong@mozilla.com", "id": 489805, "name": "jgong@mozilla.com", "real_name": "Jean Gong :jgong"}, {"email": "mcastelluccio@mozilla.com", "id": 420453, "name": "mcastelluccio@mozilla.com", "real_name": "Marco Castelluccio [:marco]"}, {"email": "mconley@mozilla.com", "id": 403756, "name": "mconley@mozilla.com", "real_name": "Mike Conley (:mconley) (:\u2699\ufe0f) (Catching up on needinfos / reviews)"}, {"email": "past@mozilla.com", "id": 363318, "name": "past@mozilla.com", "real_name": "Panos Astithas [:past] (please ni?)"}, {"email": "xidorn+moz@upsuper.org", "id": 373403, "name": "xidorn+moz@upsuper.org", "real_name": "Xidorn Quan [:xidorn] UTC+10"}], "cf_last_resolved": null, "attachments": [], "votes": 0, "classification": "Components", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 10, "comments": [{"text": "https://perfht.ml/2H2fPnn", "author": "jmuizelaar@mozilla.com", "id": 13187372, "time": "2018-04-06T20:27:22Z"}, {"text": "5k elements are traversed and styled, which is exactly expected, but it shouldn't generally take that much time I suppose...", "author": "xidorn+moz@upsuper.org", "id": 13287053, "time": "2018-05-18T12:20:33Z"}, {"text": "This is a profile with a single stylo thread: https://perfht.ml/2KD1NXB\n\nIt seems the majority of time happens in StrongRuleNode::ensure_child. This is a case where one element has tons of children which don't share style at all, so the cost of rule tree becomes significant. We are probably experiencing O(N^2) performance issue here that we are scanning all the child nodes under the parent element for each children.\n\nI don't immediately have idea how should this be avoided. Maybe we should exclude rule nodes with only style attribute from rule tree iterating.", "author": "xidorn+moz@upsuper.org", "id": 13293066, "time": "2018-05-21T01:56:53Z"}, {"text": "(In reply to Xidorn Quan [:xidorn] UTC+10 from comment #2)\n> Maybe we should exclude rule nodes with only style attribute from rule tree iterating.\n\nI mean, maybe each rule node can have two subtree, one for rule nodes of style attributes (maybe also animations / transitions?), the other for those from style rules, so that we don't waste time on checking reusability of the former.", "author": "xidorn+moz@upsuper.org", "id": 13293071, "time": "2018-05-21T01:59:52Z"}, {"text": "The old nsRuleNode switched its children representation from a linked list to a hash table when we reached a threshold of a certain number of children, which I think would have helped this test.  We'd need a lock free way to do that, which isn't impossible, but would complicate the RuleNode implementation even more.\n\nSeparating style attribute rule nodes out into a separate child list might be reasonable, at the expense of increasing RuleNode's size, though there's probably something clever we could do to avoid that.", "author": "cam@mcc.id.au", "id": 13293076, "time": "2018-05-21T02:13:06Z"}, {"text": "It's unclear to me why we spend so much time in ensure_child. That means that the rule node was replaced completely, right? One would think we'd hit[1] often instead.\n\nAre we copying the declaration block all the time? If so the bug is in CSSOM I'd think...\n\n[1]: https://searchfox.org/mozilla-central/rev/2aa42f2cab4a110edf21dd7281ac23a1ea8901f9/servo/components/style/rule_tree/mod.rs#432", "author": "emilio@crisal.io", "id": 13296421, "time": "2018-05-22T13:01:53Z"}, {"text": "So I'm moderately sure this was regressed by bug 1402218... We still have other bugs related to first-line and such. I think we need to fix the first-line reparenting code instead of that fix, that would allow us to reuse the node.\n\nWill take a look when I have the time.", "author": "emilio@crisal.io", "id": 13296451, "time": "2018-05-22T13:13:10Z"}, {"text": "To be clear, the issue here is that we reparent first-line styles even from frames that are about to go away. I'd love to get rid of the first-line reparenting code, but we can presumably do better instead...", "author": "emilio@crisal.io", "id": 13296463, "time": "2018-05-22T13:18:04Z"}, {"text": "Hey emilio - where do you feel this falls in terms of priority? Given that moving-balls.html is a tech demo, we're not sure how representative it is for the web in general... would you consider this a nice to have (qf:p3), or an important-to-fix (qf:p1)?", "author": "mconley@mozilla.com", "id": 13297587, "time": "2018-05-22T19:14:21Z"}, {"text": "I'd say it's somewhere in between, p2 probably.", "author": "emilio@crisal.io", "id": 13363639, "time": "2018-05-25T12:25:32Z"}], "id": 1452214, "priority": "P3", "cc": ["cam@mcc.id.au", "daniel@glazman.org", "emilio@crisal.io", "jan@ikenmeyer.eu", "jgong@mozilla.com", "mcastelluccio@mozilla.com", "mconley@mozilla.com", "past@mozilla.com", "xidorn+moz@upsuper.org"], "cf_crash_signature": "", "version": "unspecified", "is_cc_accessible": true, "cf_tracking_firefox_esr52": "---", "see_also": [], "cf_tracking_thunderbird_esr60": "---", "cf_platform_rel": "---", "product": "Core", "cf_fx_iteration": "---", "blocks": [], "qa_contact": "", "creation_time": "2018-04-06T20:27:22Z", "cf_status_firefox_esr52": "---", "component": "CSS Parsing and Computation", "assigned_to_detail": {"email": "nobody@mozilla.org", "id": 1, "name": "nobody@mozilla.org", "real_name": "Nobody; OK to take it and work on it"}, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "---", "cf_status_firefox61": "---", "cf_status_firefox60": "---", "target_milestone": "---", "cf_rank": null, "cf_qa_whiteboard": "", "severity": "normal", "groups": [], "cf_status_thunderbird_esr52": "---", "url": "", "cf_status_thunderbird_esr60": "---", "creator_detail": {"email": "jmuizelaar@mozilla.com", "id": 309398, "name": "jmuizelaar@mozilla.com", "real_name": "Jeff Muizelaar [:jrmuizel] on parental leave until at least June 25"}, "whiteboard": "[qf:p3:f64]", "mentors": [], "summary": "https://jrmuizel.github.io/perf-tests/moving-balls.html spends a long time > 110ms in style", "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [{"requestee": "emilio@crisal.io", "status": "?", "name": "needinfo", "modification_date": "2018-05-22T13:13:10Z", "type_id": 800, "creation_date": "2018-05-22T13:13:10Z", "id": 1759956, "setter": "emilio@crisal.io"}], "last_change_time": "2018-06-07T03:19:11Z", "assigned_to": "nobody@mozilla.org", "is_open": true, "history": [{"changes": [{"removed": "", "field_name": "cc", "added": "jan@ikenmeyer.eu"}], "who": "jan@ikenmeyer.eu", "when": "2018-04-07T14:34:34Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "frgrahl@gmx.net"}, {"removed": "CSS Styles", "field_name": "component", "added": "CSS Parsing and Computation"}, {"removed": "other", "field_name": "version", "added": "unspecified"}, {"removed": "Composer", "field_name": "product", "added": "Core"}], "who": "frgrahl@gmx.net", "when": "2018-05-17T21:17:01Z"}, {"changes": [{"removed": "frgrahl@gmx.net", "field_name": "cc", "added": ""}], "who": "frgrahl@gmx.net", "when": "2018-05-17T21:17:22Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "xidorn+moz@upsuper.org"}], "who": "xidorn+moz@upsuper.org", "when": "2018-05-18T12:20:33Z"}, {"changes": [{"removed": "--", "field_name": "priority", "added": "P3"}, {"removed": "", "field_name": "cc", "added": "cam@mcc.id.au, emilio@crisal.io"}], "who": "xidorn+moz@upsuper.org", "when": "2018-05-21T01:56:53Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "past@mozilla.com"}, {"removed": "", "field_name": "whiteboard", "added": "[qf]"}], "who": "past@mozilla.com", "when": "2018-05-21T23:33:59Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(emilio@crisal.io)"}], "who": "emilio@crisal.io", "when": "2018-05-22T13:13:10Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "mconley@mozilla.com"}], "who": "mconley@mozilla.com", "when": "2018-05-22T19:14:21Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "regression"}, {"removed": "", "field_name": "cc", "added": "mcastelluccio@mozilla.com"}], "who": "mcastelluccio@mozilla.com", "when": "2018-05-24T06:26:59Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1464813"}], "who": "emilio@crisal.io", "when": "2018-05-28T13:03:29Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "jgong@mozilla.com"}, {"removed": "[qf]", "field_name": "whiteboard", "added": "[qf:f64][qf:p3]"}], "who": "jgong@mozilla.com", "when": "2018-05-29T19:14:56Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1465474"}], "who": "emilio@crisal.io", "when": "2018-05-30T14:54:11Z"}, {"changes": [{"removed": "[qf:f64][qf:p3]", "field_name": "whiteboard", "added": "[qf:p3:f64]"}], "who": "jgong@mozilla.com", "when": "2018-06-07T03:19:11Z"}], "resolution": "", "op_sys": "Unspecified", "cf_fx_points": "---", "cf_blocking_fennec": "---"}