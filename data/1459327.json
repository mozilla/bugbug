{"cf_tracking_thunderbird_esr52": "---", "status": "NEW", "cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "cf_tracking_firefox62": "---", "creator": "agashlin@mozilla.com", "mentors_detail": [], "depends_on": [], "cf_status_firefox_esr60": "---", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "keywords": ["regression"], "cc_detail": [{"email": "florian@queze.net", "id": 149052, "name": "florian@queze.net", "real_name": "Florian Qu\u00e8ze [:florian]"}, {"email": "m_kato@ga2.so-net.ne.jp", "id": 8636, "name": "m_kato@ga2.so-net.ne.jp", "real_name": "Makoto Kato [:m_kato]"}, {"email": "sledru@mozilla.com", "id": 495955, "name": "sledru@mozilla.com", "real_name": "Sylvestre Ledru [:sylvestre]"}], "cf_last_resolved": null, "attachments": [], "votes": 0, "classification": "Components", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 2, "comments": [{"text": "Steps to reproduce:\n1. Open a new window\n2. Go to a page with a text field (e.g. data:text/html,<textarea> )\n3. Drag that tab back into the old window\n\nExpected result:\nText field behaves normally, with visible cursor and selection\n\nActual result:\nCursor and selection are invisible, though text can still be entered and edited. Spelling errors are highlighted ok. Switching to another tab fixes it, navigating to another page in the same tab does not.\n\nPossibly bug 1399840 involves something similar?\n\nRegression range:\nhttps://hg.mozilla.org/integration/mozilla-inbound/pushloghtml?fromchange=fab7bacb59284801d9c47f6ef5d0529f5ae20154&tochange=9e59ca9dd30d73c57dad6a7e6220b159dd1e6db5\n\nDue to this range and how the bug seems to only happen with the last tab being dragged out of the window, I suspect bug 1391704 is part of the cause.\n\nOccasionally this will cause a crash in debug at:\nhttps://searchfox.org/mozilla-central/rev/53afcfdbabed96883126d0ebbcac499b358e32f2/gfx/layers/apz/src/FocusState.cpp#45\nunfortunately `this` is optimized away.\nThis is the stack:\n \txul.dll!mozilla::layers::FocusState::IsCurrent(const mozilla::BaseAutoLock<mozilla::Mutex> & aProofOfLock) Line 45\n \txul.dll!mozilla::layers::FocusState::CanIgnoreKeyboardShortcutMisses() Line 236\n \txul.dll!mozilla::layers::APZCTreeManager::ReceiveInputEvent(mozilla::InputData & aEvent, mozilla::layers::ScrollableLayerGuid * aOutTargetGuid, unsigned __int64 * aOutInputBlockId) Line 1428\n \txul.dll!mozilla::layers::APZInputBridgeParent::RecvReceiveKeyboardInputEvent(const mozilla::KeyboardInput & aEvent, nsEventStatus * aOutStatus, mozilla::KeyboardInput * aOutEvent, mozilla::layers::ScrollableLayerGuid * aOutTargetGuid, unsigned __int64 * aOutInputBlockId) Line 153\n \txul.dll!mozilla::layers::PAPZInputBridgeParent::OnMessageReceived(const IPC::Message & msg__, IPC::Message * & reply__) Line 485\n \txul.dll!mozilla::gfx::PGPUParent::OnMessageReceived(const IPC::Message & msg__, IPC::Message * & reply__) Line 1111\n \txul.dll!mozilla::ipc::MessageChannel::DispatchSyncMessage(const IPC::Message & aMsg, IPC::Message * & aReply) Line 2109\n \txul.dll!mozilla::ipc::MessageChannel::DispatchMessageW(IPC::Message && aMsg) Line 2068\n \txul.dll!mozilla::ipc::MessageChannel::RunMessage(mozilla::ipc::MessageChannel::MessageTask & aTask) Line 1918\n \txul.dll!mozilla::ipc::MessageChannel::MessageTask::Run() Line 1951\n \txul.dll!nsThread::ProcessNextEvent(bool aMayWait, bool * aResult) Line 1093\n \txul.dll!NS_ProcessNextEvent(nsIThread * aThread, bool aMayWait) Line 519\n \txul.dll!mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate * aDelegate) Line 125\n \txul.dll!mozilla::ipc::MessagePumpForChildProcess::Run(base::MessagePump::Delegate * aDelegate) Line 301\n \txul.dll!MessageLoop::RunInternal() Line 326\n \txul.dll!MessageLoop::RunHandler() Line 320\n \txul.dll!MessageLoop::Run() Line 300\n \txul.dll!nsBaseAppShell::Run() Line 159\n \txul.dll!nsAppShell::Run() Line 401\n \txul.dll!XRE_RunAppShell() Line 893\n \txul.dll!mozilla::ipc::MessagePumpForChildProcess::Run(base::MessagePump::Delegate * aDelegate) Line 269\n \txul.dll!MessageLoop::RunInternal() Line 326\n \txul.dll!MessageLoop::RunHandler() Line 320\n \txul.dll!MessageLoop::Run() Line 300\n \txul.dll!XRE_InitChildProcess(int aArgc, char * * aArgv, const XREChildData * aChildData) Line 723\n \txul.dll!mozilla::BootstrapImpl::XRE_InitChildProcess(int argc, char * * argv, const XREChildData * aChildData) Line 69\n \tfirefox.exe!content_process_main(mozilla::Bootstrap * bootstrap, int argc, char * * argv) Line 51\n \tfirefox.exe!NS_internal_main(int argc, char * * argv, char * * envp) Line 280\n \tfirefox.exe!wmain(int argc, wchar_t * * argv) Line 132", "author": "agashlin@mozilla.com", "id": 13255703, "time": "2018-05-04T20:39:50Z"}, {"text": "It seems to be focus manager or selection.", "author": "m_kato@ga2.so-net.ne.jp", "id": 13258110, "time": "2018-05-07T01:28:05Z"}], "id": 1459327, "priority": "P3", "cc": ["florian@queze.net", "m_kato@ga2.so-net.ne.jp", "sledru@mozilla.com"], "cf_crash_signature": "", "version": "57 Branch", "is_cc_accessible": true, "cf_tracking_firefox_esr52": "---", "see_also": [], "cf_tracking_thunderbird_esr60": "---", "cf_platform_rel": "---", "product": "Core", "cf_fx_iteration": "---", "blocks": [1391704], "qa_contact": "", "creation_time": "2018-05-04T20:39:50Z", "cf_status_firefox_esr52": "---", "component": "Selection", "assigned_to_detail": {"email": "nobody@mozilla.org", "id": 1, "name": "nobody@mozilla.org", "real_name": "Nobody; OK to take it and work on it"}, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "---", "cf_status_firefox61": "---", "cf_status_firefox60": "---", "target_milestone": "---", "cf_rank": null, "cf_qa_whiteboard": "", "severity": "normal", "groups": [], "cf_status_thunderbird_esr52": "---", "url": "data:text/html,<textarea>", "cf_status_thunderbird_esr60": "---", "creator_detail": {"email": "agashlin@mozilla.com", "id": 583776, "name": "agashlin@mozilla.com", "real_name": "Adam Gashlin [:agashlin]"}, "whiteboard": "", "mentors": [], "summary": "Dragging the last tab into another window temporarily breaks text editing selection and cursor", "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "last_change_time": "2018-06-04T13:35:43Z", "assigned_to": "nobody@mozilla.org", "is_open": true, "history": [{"changes": [{"removed": "", "field_name": "cc", "added": "m_kato@ga2.so-net.ne.jp"}, {"removed": "Editor", "field_name": "component", "added": "Selection"}], "who": "m_kato@ga2.so-net.ne.jp", "when": "2018-05-07T01:28:05Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "regression"}, {"removed": "", "field_name": "cc", "added": "sledru@mozilla.com"}], "who": "sledru@mozilla.com", "when": "2018-05-07T12:43:57Z"}, {"changes": [{"removed": "--", "field_name": "priority", "added": "P3"}], "who": "mreavy@mozilla.com", "when": "2018-05-08T04:55:31Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "florian@queze.net"}], "who": "florian@queze.net", "when": "2018-06-04T13:35:43Z"}], "resolution": "", "op_sys": "Windows", "cf_fx_points": "---", "cf_blocking_fennec": "---"}