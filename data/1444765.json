{"cf_tracking_thunderbird_esr52": "---", "status": "RESOLVED", "cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "cf_tracking_firefox62": "---", "creator": "bugmail@mozilla.staktrace.com", "mentors_detail": [], "depends_on": [], "cf_status_firefox_esr60": "---", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "cf_status_firefox58": "---", "cf_status_firefox59": "---", "keywords": [], "summary": "Add ability to quickly profile all threads for a given PID", "cf_last_resolved": "2018-06-15T09:53:01Z", "attachments": [{"creator": "bugmail@mozilla.staktrace.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-06-14T16:31:16Z", "type_id": 4, "creation_date": "2018-06-07T20:22:33Z", "id": 1767313, "setter": "n.nethercote@gmail.com"}], "content_type": "text/x-review-board-request", "id": 8984275}], "votes": 0, "classification": "Components", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 13, "comments": [{"text": "Sometimes the browser slows to a crawl with high CPU usage and the OS task manager (e.g. Activity Monitor on macOS) can tell you which process is misbehaving. But running the profiler reveals that the main thread is mostly idle, some other thread must be eating the CPU. But finding that thread is hard. It might be easier if the profiler had an option to profile all the threads for the guilty pid, or at least all the ones that it knows about.", "author": "bugmail@mozilla.staktrace.com", "id": 13119768, "time": "2018-03-11T20:37:00Z"}, {"text": "This would help with e.g. bug 1404042 comment 157.", "author": "bugmail@mozilla.staktrace.com", "id": 13393896, "time": "2018-06-07T15:06:34Z"}, {"text": "For the record, right now if you leave the threads filter empty it will record all the threads across all the processes. Which is useful too. But I'd like to be able to enter something like \"pid:<x>\" into the thread filter field and have it record all the threads from that pid. From glancing around the code it looks like we would want to add the pid to the ThreadInfo structure being constructed at [1] and modify the ThreadSelected call at [2] to also pass the pid, and modify the implementation of that function to check for \"pid:<x>\" as one of the filters in mFilters and match against the pid instead. This shouldn't require any changes to the addon or perf-html.io frontend as far as I can tell.\n\n[1] https://searchfox.org/mozilla-central/rev/cf464eabfeba64e866c1fa36b9fefd674dca9c51/tools/profiler/core/platform.cpp#2324\n[2] https://searchfox.org/mozilla-central/rev/cf464eabfeba64e866c1fa36b9fefd674dca9c51/tools/profiler/core/platform.cpp#495", "author": "bugmail@mozilla.staktrace.com", "id": 13394047, "time": "2018-06-07T16:03:18Z"}, {"text": "https://treeherder.mozilla.org/#/jobs?repo=try&revision=a377bc981865274f67d3eed72ffb010c0e76d80b\n\nThe patch was actually even simpler than I thought, since the ThreadSelected check can just pull the pid directly. Try push to make sure it compiles everywhere. I tested locally on macOS and it seems to have as desired.", "author": "bugmail@mozilla.staktrace.com", "id": 13394642, "time": "2018-06-07T19:48:34Z"}, {"text": "Looks like there's infra issues ongoing, so not sure if/when the try jobs will be done. I'll put the patch up for review anyway for now. If there's compilation errors they should be easy enough to fix.", "author": "bugmail@mozilla.staktrace.com", "id": 13394758, "time": "2018-06-07T20:21:35Z"}, {"text": "Created attachment 8984275\nBug 1444765 - Allow setting a pid:<pid> thread filter to capture all threads for a process.\n\nReview commit: https://reviewboard.mozilla.org/r/250076/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/250076/", "author": "bugmail@mozilla.staktrace.com", "id": 13394763, "time": "2018-06-07T20:22:33Z"}, {"text": "Comment on attachment 8984275\nBug 1444765 - Allow setting a pid:<pid> thread filter to capture all threads for a process.\n\nhttps://reviewboard.mozilla.org/r/250076/#review256456\n\nSeems ok, though it should be documented somewhere, maybe in the comment on `profiler_start` in GeckoProfiler.h.\n\nmstange, I seem to recall that you could put something like ',' into the filters in the profiler UI and it would match all threads, is that right? Maybe we should do something with that?", "author": "n.nethercote@gmail.com", "id": 13395464, "time": "2018-06-08T05:35:30Z"}, {"text": "(In reply to Nicholas Nethercote [:njn] from comment #6)\n> mstange, I seem to recall that you could put something like ',' into the\n> filters in the profiler UI and it would match all threads, is that right?\n\nIf you leave the filter field empty it will match all the threads, but across all pids. (see comment 2)", "author": "bugmail@mozilla.staktrace.com", "id": 13396134, "time": "2018-06-08T13:14:48Z"}, {"text": "Comment on attachment 8984275\nBug 1444765 - Allow setting a pid:<pid> thread filter to capture all threads for a process.\n\nhttps://reviewboard.mozilla.org/r/250076/#review257232", "author": "n.nethercote@gmail.com", "id": 13405310, "time": "2018-06-14T16:31:16Z"}, {"text": "Comment on attachment 8984275\nBug 1444765 - Allow setting a pid:<pid> thread filter to capture all threads for a process.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/250076/diff/1-2/", "author": "bugmail@mozilla.staktrace.com", "id": 13405335, "time": "2018-06-14T16:42:29Z"}, {"text": "Thanks! I updated the comment on profiler_start like you suggested.", "author": "bugmail@mozilla.staktrace.com", "id": 13405339, "time": "2018-06-14T16:43:03Z"}, {"text": "Pushed by kgupta@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/035cac21d2b1\nAllow setting a pid:<pid> thread filter to capture all threads for a process. r=njn", "author": "pulsebot@bots.tld", "id": 13405358, "time": "2018-06-14T16:46:46Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/035cac21d2b1", "author": "aciure@mozilla.com", "id": 13406520, "time": "2018-06-15T09:53:01Z"}], "id": 1444765, "priority": "P3", "cc": ["dslupytskyi@gmail.com", "mstange@themasta.com", "n.nethercote@gmail.com", "nfroyd@mozilla.com", "past@mozilla.com"], "cf_crash_signature": "", "version": "unspecified", "is_cc_accessible": true, "cf_tracking_firefox_esr52": "---", "see_also": [], "cf_tracking_thunderbird_esr60": "---", "cf_platform_rel": "---", "product": "Core", "cf_fx_iteration": "---", "blocks": [1404042], "qa_contact": "", "creation_time": "2018-03-11T20:37:00Z", "cf_status_firefox_esr52": "---", "component": "Gecko Profiler", "assigned_to_detail": {"email": "bugmail@mozilla.staktrace.com", "id": 426788, "name": "bugmail@mozilla.staktrace.com", "real_name": "Kartikaya Gupta (email:kats@mozilla.com)"}, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "fixed", "cf_status_firefox61": "---", "cf_status_firefox60": "---", "target_milestone": "mozilla62", "cf_rank": null, "cf_qa_whiteboard": "", "severity": "normal", "groups": [], "cf_status_thunderbird_esr52": "---", "url": "", "cf_status_thunderbird_esr60": "---", "creator_detail": {"email": "bugmail@mozilla.staktrace.com", "id": 426788, "name": "bugmail@mozilla.staktrace.com", "real_name": "Kartikaya Gupta (email:kats@mozilla.com)"}, "whiteboard": "", "mentors": [], "cc_detail": [{"email": "dslupytskyi@gmail.com", "id": 549115, "name": "dslupytskyi@gmail.com", "real_name": ""}, {"email": "mstange@themasta.com", "id": 293943, "name": "mstange@themasta.com", "real_name": "Markus Stange [:mstange]"}, {"email": "n.nethercote@gmail.com", "id": 334849, "name": "n.nethercote@gmail.com", "real_name": "Nicholas Nethercote [:njn]"}, {"email": "nfroyd@mozilla.com", "id": 417288, "name": "nfroyd@mozilla.com", "real_name": "Nathan Froyd [:froydnj]"}, {"email": "past@mozilla.com", "id": 363318, "name": "past@mozilla.com", "real_name": "Panos Astithas [:past] (please ni?)"}], "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "last_change_time": "2018-06-15T09:53:01Z", "assigned_to": "bugmail@mozilla.staktrace.com", "is_open": false, "history": [{"changes": [{"removed": "--", "field_name": "priority", "added": "P3"}, {"removed": "", "field_name": "cc", "added": "past@mozilla.com"}], "who": "past@mozilla.com", "when": "2018-05-25T20:20:42Z"}, {"changes": [{"removed": "", "field_name": "blocks", "added": "1404042"}], "who": "bugmail@mozilla.staktrace.com", "when": "2018-06-07T15:06:34Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "nfroyd@mozilla.com"}], "who": "nfroyd@mozilla.com", "when": "2018-06-07T15:08:46Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "wojtek@unir.se"}], "who": "wojtek@unir.se", "when": "2018-06-07T15:35:34Z"}, {"changes": [{"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "bugmail@mozilla.staktrace.com"}], "who": "bugmail@mozilla.staktrace.com", "when": "2018-06-07T19:48:34Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8984275, "added": "review?(n.nethercote@gmail.com)"}, {"removed": "", "field_name": "cc", "added": "n.nethercote@gmail.com"}], "who": "bugmail@mozilla.staktrace.com", "when": "2018-06-07T20:22:33Z"}, {"changes": [{"removed": "wojtek@unir.se", "field_name": "cc", "added": ""}], "who": "wojtek@unir.se", "when": "2018-06-07T20:25:23Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8984275, "added": "feedback?(mstange@themasta.com)"}], "who": "n.nethercote@gmail.com", "when": "2018-06-08T05:35:45Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "dslupytskyi@gmail.com"}], "who": "dslupytskyi@gmail.com", "when": "2018-06-08T12:06:47Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(n.nethercote@gmail.com)", "attachment_id": 8984275, "added": "review+"}], "who": "n.nethercote@gmail.com", "when": "2018-06-14T16:31:16Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "feedback?(mstange@themasta.com)", "attachment_id": 8984275, "added": ""}], "who": "bugmail@mozilla.staktrace.com", "when": "2018-06-14T16:42:29Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla62"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2018-06-15 09:53:01"}, {"removed": "---", "field_name": "cf_status_firefox62", "added": "fixed"}], "who": "aciure@mozilla.com", "when": "2018-06-15T09:53:01Z"}], "resolution": "FIXED", "op_sys": "Unspecified", "cf_fx_points": "---", "cf_blocking_fennec": "---"}