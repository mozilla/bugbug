{"status": "RESOLVED", "cf_tracking_firefox60": "---", "attachments": [{"creator": "felipc@gmail.com", "is_obsolete": 0, "is_patch": 0, "flags": [], "content_type": "application/zip", "id": 8670554}, {"creator": "mh+mozilla@glandium.org", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2015-10-07T16:04:22Z", "type_id": 748, "creation_date": "2015-10-07T00:49:40Z", "id": 1266992, "setter": "gps@mozilla.com"}], "content_type": "text/plain", "id": 8670561}], "classification": "Client Software", "creator": "gijskruitbosch+bugs@gmail.com", "cc": ["felipc@gmail.com", "gijskruitbosch+bugs@gmail.com", "gps@mozilla.com", "mh+mozilla@glandium.org", "nalexander@mozilla.com"], "depends_on": [], "creation_time": "2015-10-06T16:16:06Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "cf_status_firefox58": "---", "cf_status_firefox59": "---", "keywords": [], "summary": "mach build faster doesn't update resource:///modules/MigrationUtils.jsm", "cf_last_resolved": "2015-10-08T14:27:42Z", "assigned_to_detail": {"email": "mh+mozilla@glandium.org", "id": 47192, "name": "mh+mozilla@glandium.org", "real_name": "Mike Hommey [:glandium]"}, "severity": "normal", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "assigned_to": "mh+mozilla@glandium.org", "comment_count": 16, "comments": [{"text": "STR:\n\n1. ./mach build\n2. ./mach build faster\n3. edit browser/components/migration/MigrationUtils.jsm\n4. ./mach build faster\n5. open resource:///modules/MigrationUtils.jsm in a tab\n\nER:\nsee updated version\n\nAR:\nsee old version\n\nMike, any idea what's going on here?", "author": "gijskruitbosch+bugs@gmail.com", "id": 10812942, "time": "2015-10-06T16:16:06Z"}, {"text": "(in case it's relevant, this is on OS X 10.10, with hg 3.5.1)", "author": "gijskruitbosch+bugs@gmail.com", "id": 10812947, "time": "2015-10-06T16:16:41Z"}, {"text": "Gijs: did you restart the browser?  I wonder if you're seeing caching.  When I was mucking with the Fennec bootstrapper, I had to basically disable the browser cache.", "author": "nalexander@mozilla.com", "id": 10812956, "time": "2015-10-06T16:17:55Z"}, {"text": "(In reply to Nick Alexander :nalexander from comment #2)\n> Gijs: did you restart the browser?  I wonder if you're seeing caching.  When\n> I was mucking with the Fennec bootstrapper, I had to basically disable the\n> browser cache.\n\nYes, the browser was not running when I ran ./mach build faster.\n\nIt works if I run:\n\n./mach build browser/modules browser/components/migration\n\n\nmaybe a jar.mn/manifest thing is being missed as part of the jar.mn/moz.build/makefile DAG linearization?", "author": "gijskruitbosch+bugs@gmail.com", "id": 10813085, "time": "2015-10-06T16:43:52Z"}, {"text": "I've verified that ./mach build faster does not create the .purgecaches file, which e.g. ./mach build browser/modules does.", "author": "felipc@gmail.com", "id": 10813329, "time": "2015-10-06T17:39:33Z"}, {"text": "Although touching the file manually didn't fix this problem.\n\nI'm on OSX and did:\nmach build faster\ntouch ../ff-opt/dist/Nightly.app/Contents/Resources/browser/.purgecaches\nmach run\n\non launch, that file gets deleted as expected, but MigrationUtils was still not updated", "author": "felipc@gmail.com", "id": 10813365, "time": "2015-10-06T17:46:45Z"}, {"text": "If you apply the following patch, what does `mach build -X faster/install-dist/bin/browser` output?\n\ndiff --git a/python/mozbuild/mozpack/files.py b/python/mozbuild/mozpack/files.py\nindex 7203918..ddb0742 100644\n--- a/python/mozbuild/mozpack/files.py\n+++ b/python/mozbuild/mozpack/files.py\n@@ -457,24 +457,26 @@ class PreprocessedFile(BaseFile):\n             # assume that the preprocessor needs to be rerun. That will\n             # regenerate the dependency file.\n             if self.depfile and not os.path.exists(self.depfile):\n                 skip = False\n             else:\n                 skip = not BaseFile.any_newer(dest.path, pp_deps)\n \n         if skip:\n+            print('skipping %s' % dest.path)\n             return False\n \n         deps_out = None\n         if self.depfile:\n             deps_out = FileAvoidWrite(self.depfile)\n         pp = Preprocessor(defines=self.defines, marker=self.marker)\n         pp.setSilenceDirectiveWarnings(self.silence_missing_directive_warnings)\n \n+        print('preprocessing %s' % dest.path)\n         with open(self.path, 'rU') as input:\n             pp.processFile(input=input, output=dest, depfile=deps_out)\n \n         dest.close()\n         if self.depfile:\n             deps_out.close()\n \n         return True", "author": "mh+mozilla@glandium.org", "id": 10814325, "time": "2015-10-06T22:05:25Z"}, {"text": "Updated the tree and got:\n\n> $ mach build -X faster/install-dist/bin/browser\n>  0:00.19 /usr/bin/make -C /Users/felipe/moz/mozilla-central/ff-opt -j8 -s backend.RecursiveMakeBackend\n>  0:00.44 /usr/bin/make -C faster -j8 -s install-dist/bin/browser\n>  0:00.84 preprocessing /Users/felipe/moz/mozilla-central/ff-opt/dist/bin/browser/components/BrowserComponents.> manifest\n>  0:00.84 preprocessing /Users/felipe/moz/mozilla-central/ff-opt/dist/bin/browser/components/BrowserProfileMigrators.> manifest\n>  0:00.84 preprocessing /Users/felipe/moz/mozilla-central/ff-opt/dist/bin/browser/components/ChromeProfileMigrator.js\n>  0:00.84 preprocessing /Users/felipe/moz/mozilla-central/ff-opt/dist/bin/browser/components/FeedWriter.js\n>  0:00.84 preprocessing /Users/felipe/moz/mozilla-central/ff-opt/dist/bin/browser/components/SafariProfileMigrator.js\n>  0:00.84 preprocessing /Users/felipe/moz/mozilla-central/ff-opt/dist/bin/browser/components/browsermodules.manifest\n>  0:00.84 preprocessing /Users/felipe/moz/mozilla-central/ff-opt/dist/bin/browser/components/fuelApplication.js\n>  0:00.84 preprocessing /Users/felipe/moz/mozilla-central/ff-opt/dist/bin/browser/components/nsBrowserGlue.js\n>  0:00.84 preprocessing /Users/felipe/moz/mozilla-central/ff-opt/dist/bin/browser/defaults/preferences/firefox-> branding.js\n>  0:00.84 preprocessing /Users/felipe/moz/mozilla-central/ff-opt/dist/bin/browser/defaults/preferences/firefox.js\n>  0:00.84 preprocessing /Users/felipe/moz/mozilla-central/ff-opt/dist/bin/browser/defaults/preferences/webide-prefs.> js\n>  0:00.84 preprocessing /Users/felipe/moz/mozilla-central/ff-opt/dist/bin/browser/modules/CustomizableUI.jsm\n>  0:00.84 preprocessing /Users/felipe/moz/mozilla-central/ff-opt/dist/bin/browser/modules/CustomizableWidgets.jsm\n>  0:00.84 preprocessing /Users/felipe/moz/mozilla-central/ff-opt/dist/bin/browser/modules/CustomizeMode.jsm\n>  0:00.84 preprocessing /Users/felipe/moz/mozilla-central/ff-opt/dist/bin/browser/modules/MigrationUtils.jsm\n>  0:00.84 preprocessing /Users/felipe/moz/mozilla-central/ff-opt/dist/bin/browser/modules/PanelWideWidgetTracker.jsm\n>  0:00.84 From /Users/felipe/moz/mozilla-central/ff-opt/dist/bin/browser: Kept 321 existing; Added/updated 16; > Removed 0 files and 0 directories.\n>  0:00.90 Your build was successful!\n\nSo MigrationUtils is there in the preprocessing, but it doesn't get picked up", "author": "felipc@gmail.com", "id": 10814671, "time": "2015-10-07T00:19:46Z"}, {"text": "Created attachment 8670554\nzip of obj-dir/faster", "author": "felipc@gmail.com", "id": 10814673, "time": "2015-10-07T00:22:08Z"}, {"text": "I did a `mach build faster` and then a `mach build browser/app` and the changes get picked up. So is it just a matter of faster not rebuilding the .app package on OSX?", "author": "felipc@gmail.com", "id": 10814692, "time": "2015-10-07T00:36:03Z"}, {"text": "Ah yes, that would be it.", "author": "mh+mozilla@glandium.org", "id": 10814707, "time": "2015-10-07T00:43:48Z"}, {"text": "Created attachment 8670561\nAdd the repackage step at the end of a faster build on Mac", "author": "mh+mozilla@glandium.org", "id": 10814712, "time": "2015-10-07T00:49:40Z"}, {"text": "Works for me with this patch", "author": "felipc@gmail.com", "id": 10814722, "time": "2015-10-07T00:55:47Z"}, {"text": "Comment on attachment 8670561\nAdd the repackage step at the end of a faster build on Mac\n\nReview of attachment 8670561:\n-----------------------------------------------------------------\n\nI question the necessity of this build step now that we have install manifests. But that's for another bug.", "author": "gps@mozilla.com", "id": 10816660, "time": "2015-10-07T16:04:22Z"}, {"text": "https://hg.mozilla.org/integration/mozilla-inbound/rev/993c6f004f39", "author": "pulsebot@bots.tld", "id": 10819548, "time": "2015-10-08T08:14:59Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/993c6f004f39", "author": "cbook@mozilla.com", "id": 10820500, "time": "2015-10-08T14:27:42Z"}], "id": 1211957, "priority": "--", "mentors_detail": [], "cf_crash_signature": "", "version": "Trunk", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox59": "---", "last_change_time": "2015-10-08T14:27:42Z", "cf_platform_rel": "---", "product": "Firefox", "cf_status_firefox_esr52": "---", "blocks": [], "qa_contact": "", "see_also": [], "cf_fx_iteration": "---", "component": "Build Config", "votes": 0, "groups": [], "cf_status_firefox60": "---", "target_milestone": "Firefox 44", "cf_status_firefox44": "fixed", "is_cc_accessible": true, "url": "", "creator_detail": {"email": "gijskruitbosch+bugs@gmail.com", "id": 159069, "name": "gijskruitbosch+bugs@gmail.com", "real_name": ":Gijs (under the weather; responses will be slow)"}, "whiteboard": "", "mentors": [], "cc_detail": [{"email": "felipc@gmail.com", "id": 208747, "name": "felipc@gmail.com", "real_name": ":Felipe Gomes (needinfo me!)"}, {"email": "gijskruitbosch+bugs@gmail.com", "id": 159069, "name": "gijskruitbosch+bugs@gmail.com", "real_name": ":Gijs (under the weather; responses will be slow)"}, {"email": "gps@mozilla.com", "id": 420446, "name": "gps@mozilla.com", "real_name": "Gregory Szorc [:gps]"}, {"email": "mh+mozilla@glandium.org", "id": 47192, "name": "mh+mozilla@glandium.org", "real_name": "Mike Hommey [:glandium]"}, {"email": "nalexander@mozilla.com", "id": 432887, "name": "nalexander@mozilla.com", "real_name": "Nick Alexander :nalexander"}], "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "cf_tracking_firefox58": "---", "cf_rank": null, "is_open": false, "resolution": "FIXED", "op_sys": "Mac OS X", "cf_fx_points": "---", "history": [{"changes": [{"removed": "", "field_name": "cc", "added": "mh+mozilla@glandium.org"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(mh+mozilla@glandium.org)"}], "who": "gijskruitbosch+bugs@gmail.com", "when": "2015-10-06T16:16:06Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "felipc@gmail.com"}], "who": "felipc@gmail.com", "when": "2015-10-06T16:17:01Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "nalexander@mozilla.com"}], "who": "nalexander@mozilla.com", "when": "2015-10-06T16:17:55Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "gijskruitbosch+bugs@gmail.com"}, {"removed": "needinfo?(mh+mozilla@glandium.org)", "field_name": "flagtypes.name", "added": "needinfo?(gijskruitbosch+bugs@gmail.com), needinfo?(felipc@gmail.com)"}], "who": "mh+mozilla@glandium.org", "when": "2015-10-06T22:05:25Z"}, {"changes": [{"removed": "needinfo?(felipc@gmail.com)", "field_name": "flagtypes.name", "added": ""}], "who": "felipc@gmail.com", "when": "2015-10-07T00:19:46Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "gps@mozilla.com"}, {"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "mh+mozilla@glandium.org"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8670561, "added": "review?(gps@mozilla.com)"}], "who": "mh+mozilla@glandium.org", "when": "2015-10-07T00:49:40Z"}, {"changes": [{"removed": "Unspecified", "field_name": "op_sys", "added": "Mac OS X"}], "who": "mh+mozilla@glandium.org", "when": "2015-10-07T00:50:01Z"}, {"changes": [{"removed": "needinfo?(gijskruitbosch+bugs@gmail.com)", "field_name": "flagtypes.name", "added": ""}], "who": "gijskruitbosch+bugs@gmail.com", "when": "2015-10-07T10:41:10Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(gps@mozilla.com)", "attachment_id": 8670561, "added": "review+"}], "who": "gps@mozilla.com", "when": "2015-10-07T16:04:22Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "Firefox 44"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2015-10-08 07:27:42"}, {"removed": "affected", "field_name": "cf_status_firefox44", "added": "fixed"}], "who": "cbook@mozilla.com", "when": "2015-10-08T14:27:42Z"}]}