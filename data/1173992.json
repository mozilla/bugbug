{"cf_tracking_thunderbird_esr52": "---", "status": "RESOLVED", "cf_tracking_firefox60": "---", "attachments": [{"creator": "sstangl@mozilla.com", "is_obsolete": 1, "is_patch": 1, "flags": [{"status": "-", "name": "review", "modification_date": "2015-06-12T00:17:26Z", "type_id": 4, "creation_date": "2015-06-11T22:06:43Z", "id": 1190014, "setter": "mh+mozilla@glandium.org"}], "content_type": "text/plain", "id": 8621269}, {"creator": "sstangl@mozilla.com", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2015-06-16T07:44:32Z", "type_id": 4, "creation_date": "2015-06-12T22:19:25Z", "id": 1190857, "setter": "mh+mozilla@glandium.org"}], "content_type": "text/plain", "id": 8621879}], "classification": "Components", "creator": "sstangl@mozilla.com", "cc": ["choller@mozilla.com", "mh+mozilla@glandium.org", "nth10sd@gmail.com"], "depends_on": [], "creation_time": "2015-06-11T22:06:43Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "cf_status_firefox58": "---", "cf_status_firefox59": "---", "keywords": [], "summary": "ARM64: Add build support", "id": 1173992, "assigned_to_detail": {"email": "sstangl@mozilla.com", "id": 383201, "name": "sstangl@mozilla.com", "real_name": "Sean Stangl [:sstangl]"}, "severity": "normal", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "assigned_to": "sstangl@mozilla.com", "comment_count": 10, "comments": [{"text": "Created attachment 8621269\n0001-Add-ARM64-build-support.patch\n\nThis patch includes the configure.in and moz.build changes necessary to get the simulator building on ARM64. This does not include the ability to build on ARM64 hardware.", "author": "sstangl@mozilla.com", "id": 10377766, "time": "2015-06-11T22:06:43Z"}, {"text": "Comment on attachment 8621269\n0001-Add-ARM64-build-support.patch\n\nReview of attachment 8621269:\n-----------------------------------------------------------------\n\n::: js/src/configure.in\n@@ +2106,5 @@\n>      AC_DEFINE(JS_CPU_ARM)\n>      ;;\n> +aarch64*-*)\n> +    ENABLE_ION=1\n> +    AC_DEFINE(JS_CPU_ARM64)\n\nThis contradicts comment 0's \"This does not include the ability to build on ARM64 hardware.\"\n\n@@ +3129,5 @@\n> +dnl JS_CODEGEN_foo is defined if JS_CPU_foo is defined.\n> +MOZ_ARG_ENABLE_BOOL(arm64-simulator,\n> +[  --enable-arm64-simulator Enable ARM64 simulator for JIT code],\n> +    JS_ARM64_SIMULATOR=1,\n> +    JS_ARM64_SIMULATOR= )\n\nThis needs to conflict with --enable-arm-simulator and --enable-mips-simulator... and then you realize that it's complicated and going to get worse for each additional one. Since we only really support one at a time, we should just change the option to be:\n--enable-simulator=arch.\n\n@@ +3171,5 @@\n>      AC_DEFINE(JS_CODEGEN_ARM)\n>      JS_CODEGEN_ARM=1\n> +elif test \"$CPU_ARCH\" = \"aarch64\"; then\n> +    AC_DEFINE(JS_CODEGEN_ARM64)\n> +    JS_CODEGEN_ARM64=1\n\nThis contradicts comment 0's \"This does not include the ability to build on ARM64 hardware.\"", "author": "mh+mozilla@glandium.org", "id": 10378269, "time": "2015-06-12T00:17:26Z"}, {"text": "Created attachment 8621879\nPatch, Version 2\n\nThis patch is the previous patch, minus the aarch64 hardware bits that snuck in, plus changing the simulator configuration syntax to --enable-simulator=(arm, arm64, mips).\n\nA number of places in the codebase contain code that looks like the following:\n> #if defined(JS_ARM_SIMULATOR) || defined(JS_ARM64_SIMULATOR) || defined(JS_MIPS_SIMULATOR)\n\nwhich suffers similar blowup. So this patch adds a JS_SIMULATOR for just checking that some simulator is present.\n\nAdditionally, since I was in the area, I changed the defines to match JS_CODEGEN_foo and JS_CPU_foo: JS_foo_SIMULATOR becomes JS_SIMULATOR_foo.", "author": "sstangl@mozilla.com", "id": 10383969, "time": "2015-06-12T22:19:25Z"}, {"text": "Comment on attachment 8621879\nPatch, Version 2\n\nReview of attachment 8621879:\n-----------------------------------------------------------------\n\n::: js/src/asmjs/AsmJSModule.cpp\n@@ +661,4 @@\n>  static void*\n>  RedirectCall(void* fun, ABIFunctionType type)\n>  {\n> +#ifdef JS_SIMULATOR\n\nJust to be sure, adding arm64 here is intended, right? (same question for other similar changes)\n\n::: js/src/configure.in\n@@ -971,5 @@\n>      CPU_ARCH=\"mips\"\n>      ;;\n>  \n> -aarch64*)\n> -    CPU_ARCH=aarch64\n\nPlease don't remove this, it has no effect on the rest, but is useful regardless of JIT support.\n\n@@ +3108,5 @@\n> +if test -n \"$JS_SIMULATOR\"; then\n> +    case \"$JS_SIMULATOR\" in\n> +        arm) ;;\n> +        arm64) ;;\n> +        mips) ;;\n\nyou can say arm|arm64|mips) ;;\n\nyou should also add:\n  no)\n    JS_SIMULATOR=\n    ;;\n\n(you get \"no\" if you pass --disable-simulator)\n\n@@ +3126,2 @@\n>      AC_DEFINE(JS_CODEGEN_ARM)\n> +    JS_SIMULATOR=1\n\nYou don't actually need to set JS_SIMULATOR to 1. The value it has when you reach here (and the other ones below) is just fine.\n\n::: js/src/jit/arm/MacroAssembler-arm.cpp\n@@ +3758,4 @@\n>      passedArgs_ = 0;\n>      passedArgTypes_ = 0;\n>      usedIntSlots_ = 0;\n> +#if defined(JS_CODEGEN_ARM_HARDFP) || defined(JS_SIMULATOR_ARM)\n\nshouldn't simulator=arm just enable CODEGEN_ARM_HARDFP, like it does enable CODEGEN_ARM ?", "author": "mh+mozilla@glandium.org", "id": 10393207, "time": "2015-06-16T07:44:32Z"}, {"text": "Setting needinfo on Gary's request:\n\nThis bug changes the flag --enable-arm-simulator to --enable-simulator=arm.\nAfter this lands, --enable-arm-simulator will surprisingly do an x86 build.", "author": "sstangl@mozilla.com", "id": 10396123, "time": "2015-06-16T20:25:31Z"}, {"text": "https://hg.mozilla.org/integration/mozilla-inbound/rev/25e99bc12482", "author": "pulsebot@bots.tld", "id": 10396201, "time": "2015-06-16T20:32:50Z"}, {"text": "(In reply to Sean Stangl [:sstangl] from comment #4)\n> Setting needinfo on Gary's request:\n> \n> This bug changes the flag --enable-arm-simulator to --enable-simulator=arm.\n> After this lands, --enable-arm-simulator will surprisingly do an x86 build.\n\nIf that's a problem, you could add back dummy --enable-arm-simulator and --enable-mips-simulator arguments that fail the build indicating the change.", "author": "mh+mozilla@glandium.org", "id": 10396348, "time": "2015-06-16T20:56:18Z"}, {"text": "So new values are going to be:\n\n--enable-simulator=arm\n--enable-simulator=arm64\n--enable-simulator=mips\n\nreplacing --enable-arm-simulator.", "author": "nth10sd@gmail.com", "id": 10396355, "time": "2015-06-16T20:57:00Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/25e99bc12482", "author": "ryanvm@gmail.com", "id": 10401360, "time": "2015-06-17T19:17:27Z"}, {"text": "Harness is fixed in fuzzing rev 20bfe49788bb. Thanks for the headsup!", "author": "nth10sd@gmail.com", "id": 10401804, "time": "2015-06-17T20:33:49Z"}], "cf_last_resolved": "2015-06-17T19:17:27Z", "priority": "--", "mentors_detail": [], "cf_crash_signature": "", "version": "unspecified", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox59": "---", "last_change_time": "2015-06-17T20:33:49Z", "cf_platform_rel": "---", "product": "Core", "cf_status_firefox_esr52": "---", "blocks": [1088326], "qa_contact": "", "see_also": [], "cf_fx_iteration": "---", "component": "JavaScript Engine: JIT", "votes": 0, "groups": [], "cf_status_firefox60": "---", "cf_status_firefox41": "fixed", "target_milestone": "mozilla41", "is_cc_accessible": true, "cf_status_thunderbird_esr52": "---", "url": "", "creator_detail": {"email": "sstangl@mozilla.com", "id": 383201, "name": "sstangl@mozilla.com", "real_name": "Sean Stangl [:sstangl]"}, "whiteboard": "", "mentors": [], "cc_detail": [{"email": "choller@mozilla.com", "id": 395101, "name": "choller@mozilla.com", "real_name": "Christian Holler (:decoder)"}, {"email": "mh+mozilla@glandium.org", "id": 47192, "name": "mh+mozilla@glandium.org", "real_name": "Mike Hommey [:glandium]"}, {"email": "nth10sd@gmail.com", "id": 132034, "name": "nth10sd@gmail.com", "real_name": "Gary Kwong [:gkw] [:nth10sd]"}], "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "cf_tracking_firefox58": "---", "cf_rank": null, "is_open": false, "history": [{"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8621269, "added": "review?(mh+mozilla@glandium.org)"}, {"removed": "", "field_name": "cc", "added": "mh+mozilla@glandium.org"}], "who": "sstangl@mozilla.com", "when": "2015-06-11T22:06:43Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(mh+mozilla@glandium.org)", "attachment_id": 8621269, "added": "review-"}], "who": "mh+mozilla@glandium.org", "when": "2015-06-12T00:17:26Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8621269, "added": "1"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8621879, "added": "review?(mh+mozilla@glandium.org)"}], "who": "sstangl@mozilla.com", "when": "2015-06-12T22:19:25Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(mh+mozilla@glandium.org)", "attachment_id": 8621879, "added": "review+"}], "who": "mh+mozilla@glandium.org", "when": "2015-06-16T07:44:32Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "choller@mozilla.com, gary@rumblingedge.com"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(choller@mozilla.com), needinfo?(gary@rumblingedge.com)"}], "who": "sstangl@mozilla.com", "when": "2015-06-16T20:25:31Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla41"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2015-06-17 12:17:27"}, {"removed": "---", "field_name": "cf_status_firefox41", "added": "fixed"}], "who": "ryanvm@gmail.com", "when": "2015-06-17T19:17:27Z"}, {"changes": [{"removed": "needinfo?(choller@mozilla.com), needinfo?(gary@rumblingedge.com)", "field_name": "flagtypes.name", "added": ""}], "who": "nth10sd@gmail.com", "when": "2015-06-17T20:33:49Z"}], "resolution": "FIXED", "op_sys": "Unspecified", "cf_fx_points": "---", "cf_blocking_fennec": "---"}