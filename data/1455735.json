{"status": "VERIFIED", "cf_tracking_firefox60": "---", "cf_tracking_firefox61": "blocking", "classification": "Client Software", "creator": "mcooper@mozilla.com", "cc": ["adrian.florinescu@softvision.ro", "gijskruitbosch+bugs@gmail.com", "iulia.cristescu@softvision.ro", "jcristau@mozilla.com", "mpasciutowood@mozilla.com", "ryanvm@gmail.com"], "depends_on": [1456785], "creation_time": "2018-04-20T20:04:14Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "All", "keywords": [], "summary": "Normandy can't enroll in addon studies due to Indexeddb problems", "cf_last_resolved": "2018-04-26T04:58:29Z", "attachments": [{"creator": "mcooper@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-04-25T10:03:43Z", "type_id": 748, "creation_date": "2018-04-24T19:50:43Z", "id": 1748471, "setter": "gijskruitbosch+bugs@gmail.com"}], "content_type": "text/x-review-board-request", "id": 8970677}], "assigned_to_detail": {"email": "mcooper@mozilla.com", "id": 446256, "name": "mcooper@mozilla.com", "real_name": "Michael Cooper [:mythmon]"}, "severity": "normal", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 11, "comments": [{"text": "Chutten found this while working on bug 1450690. Here's a traceback of the error preventing enrollment:\n\nInvalidStateError: A mutation operation was attempted on a database that did not allow mutations. JS Stack trace: transaction@IndexedDB.jsm:289:39\nobjectStore@IndexedDB.jsm:317:23\ngetStore@AddonStudies.jsm:87:10\nstart@AddonStudies.jsm:273:13\nAsync*wrapAsync/</<@SandboxManager.jsm:108:9\nwrapAsync/<@SandboxManager.jsm:103:14\nexecute@SandboxManager.jsm:57:2272\nasync*registerAction/<@SandboxManager.jsm:61:18\n@SandboxManager.jsm:58:53\nevalInSandbox@SandboxManager.jsm:57:12\nrunAsyncCallback@ActionSandboxManager.jsm:74:26\nasync*runRecipe@ActionsManager.jsm:97:17\nasync*run@RecipeRunner.jsm:240:9\nasync*init@RecipeRunner.jsm:80:13\nasync*finishInit@Normandy.jsm:97:11\nasync*observe@Normandy.jsm:53:7\nssi_sendRestoreCompletedNotifications@SessionStore.jsm:4584:7\nssi_restoreWindow@SessionStore.jsm:3523:5\nssi_restoreWindows@SessionStore.jsm:3629:5\ninitializeWindow@SessionStore.jsm:1177:11\nonBeforeBrowserWindowShown/<@SessionStore.jsm:1328:9\npromise callback*onBeforeBrowserWindowShown@SessionStore.jsm:1313:5\nssi_observe@SessionStore.jsm:764:9\nonLoad@browser.js:1337:5\nonload@browser.xul:1:1", "author": "mcooper@mozilla.com", "id": 13222380, "time": "2018-04-20T20:04:14Z"}, {"text": "In my testing,. Fx60 is not affected by this.", "author": "mcooper@mozilla.com", "id": 13222427, "time": "2018-04-20T20:15:31Z"}, {"text": "Chutten: I'm having trouble reproducing this on a fresh profile with a build from mozilla-central (cset 5d73549d363f, if it matters). I'm using the STR from bug 1450690, and everything seems to be working fine.\n\nAn easier way to exercise the code path in question is something like this in the console:\n\nChromeUtils.import(\"resource://normandy/lib/AddonStudies\");\nAddonStudies.start({recipeId: 1, name: \"test\", description: \"test test\", addonUrl: \"https://net-mozaws-prod-us-west-2-normandy.s3.amazonaws.com/extensions/taarexpv2@shield.mozilla.org-1.0.13-signed.xpi\"})\n\nCan you get some situation where you can reproduce the error? Either with the stage server, or with the snippet above? I'm starting to wonder if this is an intermittent bug, or if there is something else going on that we haven't noticed.", "author": "mcooper@mozilla.com", "id": 13222650, "time": "2018-04-20T21:42:42Z"}, {"text": "Using the default settings in a prefs.js as follows with a new profile:\n\nuser_pref(\"security.content.signature.root_hash\", \"DB:74:CE:58:E4:F9:D0:9E:E0:42:36:BE:6C:C5:C4:F6:6A:E7:74:7D:C0:21:42:7A:03:BC:2F:57:0C:8B:9B:90\");\nuser_pref(\"extensions.shield-recipe-client.api_url\", \"https://normandy.stage.mozaws.net/api/v1\");\nuser_pref(\"app.normandy.dev_mode\", true);\nuser_pref(\"app.normandy.logging.level\", 0);\n\nI'm getting 8 addons installed currently from staging, nothing in about:studies, no enrollment in about:telemetry.\n\nAlso browser console logs:\n\n1524573762197\tapp.normandy.normandy-driver.actions\tDEBUG\tStarting study for recipe 329\n1524573762200\tapp.normandy.normandy-driver.actions\tDEBUG\tStarting study for recipe 309\n1524573762201\tapp.normandy.normandy-driver.actions\tDEBUG\tStarting study for recipe 308\n1524573762202\tapp.normandy.normandy-driver.actions\tDEBUG\tStarting study for recipe 304\n1524573762203\tapp.normandy.normandy-driver.actions\tDEBUG\tStarting study for recipe 302\n1524573762204\tapp.normandy.normandy-driver.actions\tDEBUG\tStarting study for recipe 298\n1524573762205\tapp.normandy.normandy-driver.actions\tDEBUG\tStarting study for recipe 269\n1524573762205\tapp.normandy.normandy-driver.actions\tDEBUG\tStarting study for recipe 268", "author": "adrian.florinescu@softvision.ro", "id": 13229375, "time": "2018-04-24T12:46:18Z"}, {"text": "Created attachment 8970677\nBug 1455735 - Await running recipes\n\nReview commit: https://reviewboard.mozilla.org/r/239412/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/239412/", "author": "mcooper@mozilla.com", "id": 13230713, "time": "2018-04-24T19:50:43Z"}, {"text": "My reduced test case in 2 bypassed the actual problem. I was able to reproduce the problem today, and the attached patch fixes the problem for me. The problem I fixed here was a regression caused by the changes in bug 1436113.", "author": "mcooper@mozilla.com", "id": 13230718, "time": "2018-04-24T19:53:20Z"}, {"text": "Comment on attachment 8970677\nBug 1455735 - Await running recipes\n\nhttps://reviewboard.mozilla.org/r/239412/#review245280\n\nGah, sorry for not catching this in review. :-(", "author": "gijskruitbosch+bugs@gmail.com", "id": 13232103, "time": "2018-04-25T10:03:43Z"}, {"text": "Pushed by mcooper@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/801fa27ae7b8\nAwait running recipes r=Gijs", "author": "pulsebot@bots.tld", "id": 13233243, "time": "2018-04-25T18:10:49Z"}, {"text": "I mispoke in comment 5. The regressing bug is *not* bug 1436113. The regressing bug is bug 1440777.", "author": "mcooper@mozilla.com", "id": 13233663, "time": "2018-04-25T20:40:33Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/801fa27ae7b8", "author": "dluca@mozilla.com", "id": 13234362, "time": "2018-04-26T04:58:29Z"}, {"text": "Marking this as verified per https://bugzilla.mozilla.org/show_bug.cgi?id=1450690#c54.", "author": "iulia.cristescu@softvision.ro", "id": 13274966, "time": "2018-05-14T07:50:51Z"}], "id": 1455735, "priority": "P1", "mentors_detail": [], "cf_crash_signature": "", "version": "Trunk", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox62": "---", "cf_platform_rel": "---", "product": "Firefox", "cf_status_firefox_esr52": "---", "blocks": [1450690], "qa_contact": "", "see_also": [], "cf_fx_iteration": "---", "component": "Normandy Client", "votes": 0, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "---", "cf_status_firefox61": "verified", "cf_status_firefox60": "unaffected", "target_milestone": "Firefox 61", "is_cc_accessible": true, "cf_rank": null, "groups": [], "url": "", "creator_detail": {"email": "mcooper@mozilla.com", "id": 446256, "name": "mcooper@mozilla.com", "real_name": "Michael Cooper [:mythmon]"}, "whiteboard": "", "mentors": [], "cc_detail": [{"email": "adrian.florinescu@softvision.ro", "id": 556562, "name": "adrian.florinescu@softvision.ro", "real_name": "Adrian Florinescu [:adrian_sv]"}, {"email": "gijskruitbosch+bugs@gmail.com", "id": 159069, "name": "gijskruitbosch+bugs@gmail.com", "real_name": ":Gijs (he/him)"}, {"email": "iulia.cristescu@softvision.ro", "id": 565219, "name": "iulia.cristescu@softvision.ro", "real_name": "Iulia Cristescu, QA [:JuliaC]"}, {"email": "jcristau@mozilla.com", "id": 580382, "name": "jcristau@mozilla.com", "real_name": "Julien Cristau [:jcristau]"}, {"email": "mpasciutowood@mozilla.com", "id": 607597, "name": "mpasciutowood@mozilla.com", "real_name": "Marnie Pasciuto-Wood [:marnie]"}, {"email": "ryanvm@gmail.com", "id": 75935, "name": "ryanvm@gmail.com", "real_name": "Ryan VanderMeulen [:RyanVM]"}], "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "last_change_time": "2018-05-14T07:50:51Z", "cf_status_firefox_esr60": "---", "assigned_to": "mcooper@mozilla.com", "is_open": false, "resolution": "FIXED", "op_sys": "All", "cf_fx_points": "---", "history": [{"changes": [{"removed": "", "field_name": "cc", "added": "ryanvm@gmail.com"}, {"removed": "?", "field_name": "cf_tracking_firefox61", "added": "blocking"}], "who": "ryanvm@gmail.com", "when": "2018-04-20T20:11:03Z"}, {"changes": [{"removed": "---", "field_name": "cf_status_firefox60", "added": "unaffected"}], "who": "mcooper@mozilla.com", "when": "2018-04-20T20:15:31Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "adrian.florinescu@softvision.ro"}], "who": "adrian.florinescu@softvision.ro", "when": "2018-04-24T12:46:18Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "mpasciutowood@mozilla.com"}], "who": "mpasciutowood@mozilla.com", "when": "2018-04-24T19:09:05Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8970677, "added": "review?(gijskruitbosch+bugs@gmail.com)"}, {"removed": "", "field_name": "cc", "added": "gijskruitbosch+bugs@gmail.com"}], "who": "mcooper@mozilla.com", "when": "2018-04-24T19:50:43Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "iulia.cristescu@softvision.ro"}], "who": "adrian.florinescu@softvision.ro", "when": "2018-04-25T09:01:15Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(gijskruitbosch+bugs@gmail.com)", "attachment_id": 8970677, "added": "review+"}], "who": "gijskruitbosch+bugs@gmail.com", "when": "2018-04-25T10:03:43Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1456785"}], "who": "adrian.florinescu@softvision.ro", "when": "2018-04-25T11:29:46Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "jcristau@mozilla.com"}], "who": "jcristau@mozilla.com", "when": "2018-04-25T12:02:21Z"}, {"changes": [{"removed": "ASSIGNED", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "Firefox 61"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2018-04-26 04:58:29"}, {"removed": "affected", "field_name": "cf_status_firefox61", "added": "fixed"}], "who": "dluca@mozilla.com", "when": "2018-04-26T04:58:29Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "qe-verify+"}], "who": "ryanvm@gmail.com", "when": "2018-04-26T09:29:18Z"}, {"changes": [{"removed": "RESOLVED", "field_name": "status", "added": "VERIFIED"}, {"removed": "qe-verify+", "field_name": "flagtypes.name", "added": ""}, {"removed": "fixed", "field_name": "cf_status_firefox61", "added": "verified"}], "who": "iulia.cristescu@softvision.ro", "when": "2018-05-14T07:50:51Z"}]}