{"status": "VERIFIED", "cf_tracking_firefox60": "---", "attachments": [{"creator": "pbrosset@mozilla.com", "is_obsolete": 1, "is_patch": 1, "flags": [], "content_type": "text/plain", "id": 8555243}, {"creator": "pbrosset@mozilla.com", "is_obsolete": 1, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2015-02-03T18:43:09Z", "type_id": 748, "creation_date": "2015-02-03T09:59:33Z", "id": 1090293, "setter": "bgrinstead@mozilla.com"}], "content_type": "text/plain", "id": 8558428}, {"creator": "pbrosset@mozilla.com", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2015-02-04T13:06:25Z", "type_id": 748, "creation_date": "2015-02-04T13:06:25Z", "id": 1091515, "setter": "pbrosset@mozilla.com"}], "content_type": "text/plain", "id": 8559105}, {"creator": "jgriffin@mozilla.com", "is_obsolete": 1, "is_patch": 1, "flags": [], "content_type": "text/plain", "id": 8570130}], "classification": "Client Software", "creator": "pbrosset@mozilla.com", "cc": ["bgrinstead@mozilla.com", "cam@mcc.id.au", "mihai.boldan@softvision.ro", "pbrosset@mozilla.com"], "depends_on": [], "creation_time": "2015-01-13T11:07:19Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "All", "cf_status_firefox58": "---", "cf_status_firefox59": "---", "keywords": [], "summary": "Refresh animation player widgets if duration, delay or iterationCount change.", "cf_last_resolved": "2015-02-05T01:27:17Z", "assigned_to_detail": {"email": "jgriffin@mozilla.com", "id": 347295, "name": "jgriffin@mozilla.com", "real_name": "Jonathan Griffin (:jgriffin)"}, "severity": "normal", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "assigned_to": "jgriffin@mozilla.com", "comment_count": 16, "comments": [{"text": "The animation inspector panel assumes these values don't change during the lifetime of an animation. This is an incorrect assumption.\n\nWhenever duration, delay or iteration count change, the UI of the player widget should be refreshed.", "author": "pbrosset@mozilla.com", "id": 9786834, "time": "2015-01-13T11:07:19Z"}, {"text": "Note that the way we update things like currentTime in the devtools UI is by polling the AnimationPlayer object on the actor-side, so it's easy for the UI to know when the duration or delay change, but it would still be useful to have the webanimations API emit events when these values change. This way we could reduce our protocol traffic.\n\nCameron: Do you think it would be possible to add events for when the animation-delay, or duration, or iterationCount, or keyframes change in an animation?", "author": "pbrosset@mozilla.com", "id": 9797985, "time": "2015-01-15T10:01:53Z"}, {"text": "Created attachment 8555243\nbug1120899-extract-player-metadata-to-component v1.patch\n\nIn this patch, I extracted the part that deals with the animation title, duration, delay, iteration count into its own UI component class, therefore making it easier to update when needed.\n\nAs I said in a previous comment, since we already poll the AnimationPlayerActor for new state data, we are already being notified when any of these values change.\nSo in this patch, I just use this to refresh the component when needed.\n\nI've updated the impacted tests and added a new one for this feature.", "author": "pbrosset@mozilla.com", "id": 9847362, "time": "2015-01-27T14:24:09Z"}, {"text": "Pending try build: https://treeherder.mozilla.org/#/jobs?repo=try&revision=a5699e52c493", "author": "pbrosset@mozilla.com", "id": 9847836, "time": "2015-01-27T15:45:00Z"}, {"text": "Comment on attachment 8555243\nbug1120899-extract-player-metadata-to-component v1.patch\n\nReview of attachment 8555243:\n-----------------------------------------------------------------\n\nReally minor stuff, but clearing the review so I can take another look at it before landing\n\n::: browser/devtools/animationinspector/animation-panel.js\n@@ +186,5 @@\n>          \"class\": \"player-widget \" + state.playState\n>        }\n>      });\n>  \n> +    this.metaDataComponent.render(this.el);\n\nNit on naming: 'render' here implies to me that it's doing what the 'updateState' function does (and should be called multiple time any time the UI changed).  I would probably call render -> createMarkup then call updateState -> render.\n\n@@ +418,5 @@\n> +    this.nameLabel = createNode({\n> +      parent: this.el,\n> +      nodeType: \"span\"\n> +    });\n> +    this.nameLabel.textContent = L10N.getStr(\"player.animationNameLabel\");\n\nLooks like this textContent shouldn't need to be set here.  It's set in updateState and handling both animations/transitions there.\n\n::: browser/devtools/animationinspector/test/browser_animation_playerWidgets_dont_show_time_after_duration.js\n@@ +34,5 @@\n>  \n>    is(widget.currentTimeEl.value, front.state.duration,\n>      \"The timeline slider has the right value\");\n>    is(widget.timeDisplayEl.textContent,\n> +    getFormattedTime(front.state.duration) + \"s\",\n\nI guess it depends on what we want to test here, but I still think that getFormattedTime should be moved somewhere shared (like ViewHelpers).  And then this test plus the animation-panel view can just use function.\n\nOr at least move this copy/pasted code into head.js so it's only duplicated in one place.\n\n::: browser/devtools/animationinspector/test/browser_animation_playerWidgets_meta_data.js\n@@ +54,3 @@\n>  });\n> +\n> +function isVisible(node) {\n\nMaybe move this isVisible function into head.js", "author": "bgrinstead@mozilla.com", "id": 9870020, "time": "2015-02-02T16:39:27Z"}, {"text": "Created attachment 8558428\nbug1120899-extract-player-metadata-to-component v2.patch\n\nThanks Brian, here's an updated patch with changes according to your review comments.\nPending try build: https://treeherder.mozilla.org/#/jobs?repo=try&revision=a4581933ed5f\n\n(In reply to Brian Grinstead [:bgrins] from comment #4)\n> ::: browser/devtools/animationinspector/animation-panel.js\n> @@ +186,5 @@\n> >          \"class\": \"player-widget \" + state.playState\n> >        }\n> >      });\n> >  \n> > +    this.metaDataComponent.render(this.el);\n> \n> Nit on naming: 'render' here implies to me that it's doing what the\n> 'updateState' function does (and should be called multiple time any time the\n> UI changed).  I would probably call render -> createMarkup then call\n> updateState -> render.\nDone.\n\n> @@ +418,5 @@\n> > +    this.nameLabel = createNode({\n> > +      parent: this.el,\n> > +      nodeType: \"span\"\n> > +    });\n> > +    this.nameLabel.textContent = L10N.getStr(\"player.animationNameLabel\");\n> \n> Looks like this textContent shouldn't need to be set here.  It's set in\n> updateState and handling both animations/transitions there.\nGood catch, changed.\n\n> :::\n> browser/devtools/animationinspector/test/\n> browser_animation_playerWidgets_dont_show_time_after_duration.js\n> @@ +34,5 @@\n> >  \n> >    is(widget.currentTimeEl.value, front.state.duration,\n> >      \"The timeline slider has the right value\");\n> >    is(widget.timeDisplayEl.textContent,\n> > +    getFormattedTime(front.state.duration) + \"s\",\n> \n> I guess it depends on what we want to test here, but I still think that\n> getFormattedTime should be moved somewhere shared (like ViewHelpers).  And\n> then this test plus the animation-panel view can just use function.\n> \n> Or at least move this copy/pasted code into head.js so it's only duplicated\n> in one place.\nSo I ended up just using L10N.numberWithDecimals (from ViewHelpers) instead of my own time formatting utils, therefore avoiding any duplication.\nThe reason why I didn't use it from the beggining is that when numbers don't have decimals, they aren't padded with 0s. So 5 will be returned as \"5\" and not \"5.00\". I wanted to always have padding, no matter what, to make sure numbers would not jump in the label element when time passes.\nBut that isn't a big deal, it's better not have code duplication right now, especially that bug 1121879 is ongoing and will make what I wanted to do possible using numberWithDecimals.\n\n> :::\n> browser/devtools/animationinspector/test/\n> browser_animation_playerWidgets_meta_data.js\n> @@ +54,3 @@\n> >  });\n> > +\n> > +function isVisible(node) {\n> \n> Maybe move this isVisible function into head.js\nDone.", "author": "pbrosset@mozilla.com", "id": 9873796, "time": "2015-02-03T09:59:33Z"}, {"text": "Comment on attachment 8558428\nbug1120899-extract-player-metadata-to-component v2.patch\n\nReview of attachment 8558428:\n-----------------------------------------------------------------\n\nLooks good\n\n::: browser/devtools/animationinspector/animation-panel.js\n@@ +485,5 @@\n> +  },\n> +\n> +  destroy: function() {\n> +    this.el.remove();\n> +    this.containerEl = this.el = null;\n\nthis.containerEl is never set in the first place.  Also, should we be nulling out this.state?  Not sure if it's really necessary in this case.", "author": "bgrinstead@mozilla.com", "id": 9875803, "time": "2015-02-03T18:43:09Z"}, {"text": "Created attachment 8559105\nbug1120899-extract-player-metadata-to-component v3.patch\n\nThanks Brian.\nAddressed the review comments in this new patch.\nI also found out that I forgot to change 2 function calls in animation-panel.js after I changed the function's signature in this patch. The effect wasn't immediately visible, and there was no specific test to avoid this from regressing, so I added a test for this.\n\nTry was green, so I'm pushing this to fx-team: https://hg.mozilla.org/integration/fx-team/rev/76666ba94d14", "author": "pbrosset@mozilla.com", "id": 9879378, "time": "2015-02-04T13:06:25Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/76666ba94d14", "author": "kwierso@gmail.com", "id": 9882910, "time": "2015-02-05T01:27:17Z"}, {"text": "Created attachment 8570130\nmozharness script for luciddream, WIP", "author": "jgriffin@mozilla.com", "id": 9964169, "time": "2015-02-26T21:37:40Z"}, {"text": "Comment on attachment 8570130\nmozharness script for luciddream, WIP\n\nwrong bug, sorry", "author": "jgriffin@mozilla.com", "id": 9964174, "time": "2015-02-26T21:38:22Z"}, {"text": "Patrick, can you please provide me more reliable STR in order to verify this issue?", "author": "mihai.boldan@softvision.ro", "id": 10877515, "time": "2015-10-27T15:11:26Z"}, {"text": "(In reply to Mihai Boldan, QA [:mboldan] from comment #11)\n> Patrick, can you please provide me more reliable STR in order to verify this\n> issue?\n- Open http://bgrins.github.io/devtools-demos/inspector/animation-timing.html\n- Open the inspector and switch to the animation-inspector panel\n- Select #box1 in the inspector\n- You should see a single animation displayed in the timeline. It should be cut off at the end because it's an infinite animation.\n- Now, switch back to the \"Rules\" panel, and in the #box1 {...} rule, add:\n  animation-iteration-count: 5;\n- Switch back to the animation panel\n- You should see that the animation displayed in the timeline has changed. It isn't cut off at the end anymore, but instead displays 5 segments (plus the initial delay which was there already). Also the tooltip should show 'repeats: 5'.\n\nYou could also try with animation-delay, or animation-duration.", "author": "pbrosset@mozilla.com", "id": 10884638, "time": "2015-10-29T10:13:00Z"}, {"text": "Using STR from Comment 12, I managed to verify this feature on Nightly 44.0a1 (2015-10-28) across platforms.\nWhile testing, I observed two potential issues:\n\n1. STR:\n- Start FF with a clean profile;\n- Follow the STR from Comment 12;\n- Click on the Rewind button;\n- Click on the play button and wait until the animation is played the second time;\n- Go to Rules panel and change the no.5 from the 'animation-iteration-count: 5;' with 2.\n- Switch back to the animation panel\n\nAR: - The animation displayed in the timeline is not changed until the Play/Pause button is selected.\n    - Note that if the STR from Comment 12 are followed on a clean profile, the animation displayed in the timeline is not changed until the Play/Pause button is selected.\n\n2. STR:\n- Follow the STR from Comment 12;\n- Go to Rules panel and change the no.5 from the 'animation-iteration-count: 5;' with 8.\n- click on the time elapsed bar in order to select the scrubbed and move it back and forward.\n\nAR: The scrubber is not displayed.\n\nPatrick, should I file new bugs for this issues?", "author": "mihai.boldan@softvision.ro", "id": 10885770, "time": "2015-10-29T15:58:51Z"}, {"text": "Yes can you please file a bug about this issue?\nAt first sight, it looks like changing the duration, delay or iteration-count only works some of the times, and sort of randomly. Testing this a little more showed that:\n- if the animation is paused (either because you pressed the rewind button, or pause button while it was playing): then changing any of these things in the rule-view does refresh the animation-panel correctly\n- if the animation has ended (you just let it play until the end): then changing these things does *not* refresh the animation-panel.\nPressing play/pause/rewind does force a refresh so you see the changes then.\nThe fact that the scrubber is not displayed is related and should be fixed in the same bug.", "author": "pbrosset@mozilla.com", "id": 10897478, "time": "2015-11-03T10:03:32Z"}, {"text": "I've logged Bug 1221088 for the issue found while testing this bug, so I'm marking this issue Verified Fix.", "author": "mihai.boldan@softvision.ro", "id": 10898020, "time": "2015-11-03T13:55:53Z"}], "id": 1120899, "priority": "--", "mentors_detail": [], "cf_crash_signature": "", "version": "unspecified", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox59": "---", "last_change_time": "2015-12-15T15:55:12Z", "cf_platform_rel": "---", "product": "Firefox", "cf_status_firefox_esr52": "---", "blocks": [1120900], "qa_contact": "", "see_also": [], "cf_fx_iteration": "---", "component": "Developer Tools: Animation Inspector", "votes": 0, "groups": [], "cf_status_firefox60": "---", "target_milestone": "Firefox 38", "cf_status_firefox44": "verified", "is_cc_accessible": true, "url": "", "creator_detail": {"email": "pbrosset@mozilla.com", "id": 478661, "name": "pbrosset@mozilla.com", "real_name": "Patrick Brosset <:pbro>"}, "whiteboard": "", "mentors": [], "cc_detail": [{"email": "bgrinstead@mozilla.com", "id": 476442, "name": "bgrinstead@mozilla.com", "real_name": "Brian Grinstead [:bgrins]"}, {"email": "cam@mcc.id.au", "id": 54040, "name": "cam@mcc.id.au", "real_name": "Cameron McCormack (:heycam) (away for the moment)"}, {"email": "mihai.boldan@softvision.ro", "id": 551058, "name": "mihai.boldan@softvision.ro", "real_name": "Mihai Boldan, QA [:mboldan]"}, {"email": "pbrosset@mozilla.com", "id": 478661, "name": "pbrosset@mozilla.com", "real_name": "Patrick Brosset <:pbro>"}], "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "cf_tracking_firefox58": "---", "cf_rank": null, "is_open": false, "resolution": "FIXED", "op_sys": "All", "cf_fx_points": "---", "history": [{"changes": [{"removed": "", "field_name": "blocks", "added": "1120900"}], "who": "pbrosset@mozilla.com", "when": "2015-01-13T11:12:57Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "cam@mcc.id.au"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(cam@mcc.id.au)"}], "who": "pbrosset@mozilla.com", "when": "2015-01-15T10:01:53Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "ASSIGNED"}, {"removed": "", "field_name": "cc", "added": "bgrinstead@mozilla.com"}, {"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "pbrosset@mozilla.com"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8555243, "added": "review?(bgrinstead@mozilla.com)"}], "who": "pbrosset@mozilla.com", "when": "2015-01-27T14:24:09Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(bgrinstead@mozilla.com)", "attachment_id": 8555243, "added": ""}], "who": "bgrinstead@mozilla.com", "when": "2015-02-02T16:39:27Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8555243, "added": "1"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8558428, "added": "review?(bgrinstead@mozilla.com)"}], "who": "pbrosset@mozilla.com", "when": "2015-02-03T09:59:33Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(bgrinstead@mozilla.com)", "attachment_id": 8558428, "added": "review+"}], "who": "bgrinstead@mozilla.com", "when": "2015-02-03T18:43:09Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8558428, "added": "1"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8559105, "added": "review+"}], "who": "pbrosset@mozilla.com", "when": "2015-02-04T13:06:25Z"}, {"changes": [{"removed": "ASSIGNED", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "Firefox 38"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2015-02-04 17:27:17"}], "who": "kwierso@gmail.com", "when": "2015-02-05T01:27:17Z"}, {"changes": [{"removed": "pbrosset@mozilla.com", "field_name": "assigned_to", "added": "jgriffin@mozilla.com"}], "who": "jgriffin@mozilla.com", "when": "2015-02-26T21:37:42Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8570130, "added": "1"}], "who": "jgriffin@mozilla.com", "when": "2015-02-26T21:38:22Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "mihai.boldan@softvision.ro, pbrosset@mozilla.com"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(pbrosset@mozilla.com)"}], "who": "mihai.boldan@softvision.ro", "when": "2015-10-27T15:11:26Z"}, {"changes": [{"removed": "needinfo?(pbrosset@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "pbrosset@mozilla.com", "when": "2015-10-29T10:13:00Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(pbrosset@mozilla.com)"}], "who": "mihai.boldan@softvision.ro", "when": "2015-10-29T15:58:51Z"}, {"changes": [{"removed": "needinfo?(cam@mcc.id.au), needinfo?(pbrosset@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "pbrosset@mozilla.com", "when": "2015-11-03T10:03:32Z"}, {"changes": [{"removed": "RESOLVED", "field_name": "status", "added": "VERIFIED"}, {"removed": "---", "field_name": "cf_status_firefox44", "added": "verified"}], "who": "mihai.boldan@softvision.ro", "when": "2015-11-03T13:55:53Z"}, {"changes": [{"removed": "Developer Tools: Inspector", "field_name": "component", "added": "Developer Tools: Animation Inspector"}], "who": "pbrosset@mozilla.com", "when": "2015-12-15T15:55:12Z"}]}