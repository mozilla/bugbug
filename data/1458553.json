{"cf_tracking_thunderbird_esr52": "---", "status": "RESOLVED", "cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "cf_tracking_firefox62": "---", "creator": "mattsmeltz@gmail.com", "mentors_detail": [], "depends_on": [], "cf_status_firefox_esr60": "fixed", "cf_user_story": "", "cf_tracking_firefox_relnote": "60+", "platform": "Unspecified", "cf_status_firefox59": "unaffected", "keywords": ["regression"], "cc_detail": [{"email": "agaynor@mozilla.com", "id": 537703, "name": "agaynor@mozilla.com", "real_name": "Alex Gaynor [:Alex_Gaynor]"}, {"email": "haftandilian@mozilla.com", "id": 558190, "name": "haftandilian@mozilla.com", "real_name": "Haik Aftandilian [:haik]"}, {"email": "jcristau@mozilla.com", "id": 580382, "name": "jcristau@mozilla.com", "real_name": "Julien Cristau [:jcristau]"}, {"email": "mcastelluccio@mozilla.com", "id": 420453, "name": "mcastelluccio@mozilla.com", "real_name": "Marco Castelluccio [:marco]"}, {"email": "rkothari@mozilla.com", "id": 538805, "name": "rkothari@mozilla.com", "real_name": "Ritu Kothari (:ritu)"}, {"email": "robbyt@robbyt.net", "id": 146775, "name": "robbyt@robbyt.net", "real_name": "rob terhaar"}, {"email": "ryanvm@gmail.com", "id": 75935, "name": "ryanvm@gmail.com", "real_name": "Ryan VanderMeulen [:RyanVM]"}], "cf_last_resolved": "2018-05-03T21:58:42Z", "attachments": [{"creator": "haftandilian@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-05-03T13:13:42Z", "type_id": 4, "creation_date": "2018-05-02T21:26:09Z", "id": 1751942, "setter": "agaynor@mozilla.com"}, {"status": "+", "name": "approval-mozilla-release", "modification_date": "2018-05-14T09:53:05Z", "type_id": 737, "creation_date": "2018-05-04T18:45:22Z", "id": 1752889, "setter": "jcristau@mozilla.com"}, {"status": "+", "name": "approval-mozilla-esr60", "modification_date": "2018-05-14T09:53:05Z", "type_id": 929, "creation_date": "2018-05-04T18:45:22Z", "id": 1752890, "setter": "jcristau@mozilla.com"}], "content_type": "text/x-review-board-request", "id": 8972716}], "votes": 0, "classification": "Components", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 25, "comments": [{"text": "User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.13; rv:60.0) Gecko/20100101 Firefox/60.0\nBuild ID: 20180426170554\n\nSteps to reproduce:\n\nThis issue is very similar to bug 1422027\n\nI have a Macbook Pro 11,3 with Intel Iris Pro 5200 and Nvidia GeForce GT 750M and am using the updated Nvidia Web Driver.\n\nWith the Nvidia Web Driver installed, navigate to Google Maps.\n\n\n\nActual results:\n\nWhen I go to Google Maps, the map navigation is very slow and the map is occasionally all black or blinks black especially while trying to zoom in or out.  It is unusable.\n\n\nExpected results:\n\nGoogle Maps should work normally.\n\n\nmozregression:\n\nhttps://hg.mozilla.org/integration/autoland/pushloghtml?fromchange=4536fd333b16bfa86eb1fdf94616d2d067bfc41f&tochange=a678eec13c6e6bf1662cc4db5719bbb413c63f65", "author": "mattsmeltz@gmail.com", "id": 13248733, "time": "2018-05-02T14:20:41Z"}, {"text": "Thanks for reporting the problem and running mozregression.\n\nGiven what was reported about the Nvidia Web driver on https://bugzilla.mozilla.org/show_bug.cgi?id=1421262#c8 we probably need to add \"/Library/GPU Bundles\" to the file-map-executable allow list in the sandbox policy.\n\nI'll try to confirm that.", "author": "haftandilian@mozilla.com", "id": 13249346, "time": "2018-05-02T16:06:48Z"}, {"text": "mws, does the problem also occur for you with Nightly?\n\nIf so, would you be willing to test a build of Nightly with a potential fix? The build linked below is a build of Nightly with a change to the sandbox policy which I suspect will solve the problem. I don't have access to a machine that supports the Nvidia Web driver yet to confirm it myself.\n\nhttps://queue.taskcluster.net/v1/task/Rv-PzqmWSYmdHL5p7sTpCg/runs/0/artifacts/public/build/target.dmg", "author": "haftandilian@mozilla.com", "id": 13250337, "time": "2018-05-02T20:03:26Z"}, {"text": "Yes the problem is in Nightly too.\n\nThe fix in the test build does solve the problem. Thanks!", "author": "mattsmeltz@gmail.com", "id": 13250490, "time": "2018-05-02T20:50:18Z"}, {"text": "Created attachment 8972716\nBug 1458553 - Return of Google Maps all black map with updated Nvidia web driver on Mac\n\nAllow file-map-executable for /Library/GPUBundles, a directory used by the Nvidia Web driver.\n\nReview commit: https://reviewboard.mozilla.org/r/241246/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/241246/", "author": "haftandilian@mozilla.com", "id": 13250625, "time": "2018-05-02T21:26:09Z"}, {"text": "(In reply to mws from comment #3)\n> Yes the problem is in Nightly too.\n> \n> The fix in the test build does solve the problem. Thanks!\n\nGreat. Thanks for testing. The only change was in the content process sandbox to allow mapping in executable code read from /Library/GPUBundles. Which makes sense because the Web driver installs files there. This should make Beta 60 and we might be able to expedite the fix into Release on account of the fix being very low risk.", "author": "haftandilian@mozilla.com", "id": 13250967, "time": "2018-05-03T00:55:34Z"}, {"text": "I forgot to mention in the description of this bug, but I think I should just for completeness, that the workaround from bug 1421262 of changing security.sandbox.content.level did not work this time.\n\n(In reply to Haik Aftandilian [:haik] from comment #5)\n> (In reply to mws from comment #3)\n> > Yes the problem is in Nightly too.\n> > \n> > The fix in the test build does solve the problem. Thanks!\n> \n> Great. Thanks for testing. The only change was in the content process\n> sandbox to allow mapping in executable code read from /Library/GPUBundles.\n> Which makes sense because the Web driver installs files there. This should\n> make Beta 60 and we might be able to expedite the fix into Release on\n> account of the fix being very low risk.\n\nThanks, I'll look out for it in Nightly and Beta 60. The problem is not in 59.", "author": "mattsmeltz@gmail.com", "id": 13251165, "time": "2018-05-03T03:50:41Z"}, {"text": "(In reply to mws from comment #6)\n> I forgot to mention in the description of this bug, but I think I should\n> just for completeness, that the workaround from bug 1421262 of changing\n> security.sandbox.content.level did not work this time.\n\nSorry for not mentioning that, but it is expected given that the file-map-executable use in the sandbox is not affected by the level pref. If there's a dire need for a workaround, you can completely disable the content sandbox using an environment variable, but it's better to avoid that due to the reduced security.\n\n> Thanks, I'll look out for it in Nightly and Beta 60. The problem is not in 59.\n\nBug 1428055 (which introduced this) didn't make it into 59, but it is in 60 which will soon become Release.", "author": "haftandilian@mozilla.com", "id": 13251214, "time": "2018-05-03T05:10:12Z"}, {"text": "Comment on attachment 8972716\nBug 1458553 - Return of Google Maps all black map with updated Nvidia web driver on Mac\n\nhttps://reviewboard.mozilla.org/r/241246/#review247238\n\nCan you change the first line of the commit message to be clearer for people not already familiar with this issue?", "author": "agaynor@mozilla.com", "id": 13251919, "time": "2018-05-03T13:13:42Z"}, {"text": "Comment on attachment 8972716\nBug 1458553 - Return of Google Maps all black map with updated Nvidia web driver on Mac\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/241246/diff/1-2/", "author": "haftandilian@mozilla.com", "id": 13252221, "time": "2018-05-03T14:49:00Z"}, {"text": "Comment on attachment 8972716\nBug 1458553 - Return of Google Maps all black map with updated Nvidia web driver on Mac\n\nhttps://reviewboard.mozilla.org/r/241246/#review247238\n\nThanks. Updated commit message to be 'Update Mac sandbox rules to allow executable mappings from /Library/GPUBundles which is\nused by the Nvidia downloadable \"Web\" driver.'", "author": "haftandilian@mozilla.com", "id": 13252251, "time": "2018-05-03T14:57:45Z"}, {"text": "Pushed by haftandilian@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/d67ad5505bc5\nReturn of Google Maps all black map with updated Nvidia web driver on Mac r=Alex_Gaynor", "author": "pulsebot@bots.tld", "id": 13252269, "time": "2018-05-03T15:00:36Z"}, {"text": "Comment on attachment 8972716\nBug 1458553 - Return of Google Maps all black map with updated Nvidia web driver on Mac\n\nApproval Request Comment\n[Feature/Bug causing the regression]:\nBug 1428055 - \"Deny access to some properties from the mac sandbox which are included in the default permissions\" which is in build 60 about to hit Release.\n\n[User impact if declined]:\nOn some Macs running the downloadable Nvidia graphics drivers (aka Web Drivers), Firefox is unusable on certain sites like Google Maps. If we decline the uplift to Beta at this time, we could uplift to Release. Uplifting now prevents a regression in Release.\n\n[Is this code covered by automated tests?]:\nThe changed code is executed every time content processes startup, but validating that the downloadable drivers work is not done.\n\n[Has the fix been verified in Nightly?]:\nThe fix is on Autoland at this time.\n\n[Needs manual test from QE? If yes, steps to reproduce]: \nSee description. Requires a Mac that is supported by the downloadable Web drivers.\n\n[List of other uplifts needed for the feature/fix]:\nNone\n\n[Is the change risky?]:\nNo\n\n[Why is the change risky/not risky?]:\nThe change is small and results in the content process sandbox being slightly more permissive which is very unlikely to introduce problems.\n\n[String changes made/needed]:\nNone", "author": "haftandilian@mozilla.com", "id": 13252386, "time": "2018-05-03T15:34:49Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/d67ad5505bc5", "author": "aciure@mozilla.com", "id": 13253448, "time": "2018-05-03T21:58:42Z"}, {"text": "Confirmed. Google Maps works in the latest Nightly on my machine.", "author": "mattsmeltz@gmail.com", "id": 13253742, "time": "2018-05-04T01:30:39Z"}, {"text": "(In reply to Haik Aftandilian [:haik] from comment #12)\n> [User impact if declined]:\n> On some Macs running the downloadable Nvidia graphics drivers (aka Web\n> Drivers), Firefox is unusable on certain sites like Google Maps. If we\n> decline the uplift to Beta at this time, we could uplift to Release.\n> Uplifting now prevents a regression in Release.\n> \nbeta is 61 at this point, and 60 is in mozilla-release.  We've built two release candidates, and I'm not planning on a third unless something really really bad comes up.  I'm not sure this fits the bill.", "author": "jcristau@mozilla.com", "id": 13254033, "time": "2018-05-04T07:52:33Z"}, {"text": "Comment on attachment 8972716\nBug 1458553 - Return of Google Maps all black map with updated Nvidia web driver on Mac\n\nMoving the request to the appropriate branches, regardless.", "author": "ryanvm@gmail.com", "id": 13255450, "time": "2018-05-04T18:45:22Z"}, {"text": "Do we know how many people this might affect?", "author": "jcristau@mozilla.com", "id": 13258867, "time": "2018-05-07T08:37:13Z"}, {"text": "(In reply to Julien Cristau [:jcristau] from comment #17)\n> Do we know how many people this might affect?\n\nNo. I tried to get an answer using telemetry, but haven't found a good approximation yet.\n\nIt's the percentage of Mac users on Macs with Nvidia graphics who go out of the way to install the Nvidia driver. The last released Mac with an Nvidia card was the 2014 MacBook Pro which still is supported by Apple to run macOS High Sierra 10.13. \nFirefox supports systems running on Mac OS 10.9+ so that would include many of the older Macs running Nvidia cards.\n\nIf this doesn't make the 60 release, I think it should be fixed in the first update. The fix is low risk.", "author": "haftandilian@mozilla.com", "id": 13263213, "time": "2018-05-08T18:10:24Z"}, {"text": "Yep, it's on my list for 60.0.1, thanks.", "author": "jcristau@mozilla.com", "id": 13264662, "time": "2018-05-09T08:17:08Z"}, {"text": "Comment on attachment 8972716\nBug 1458553 - Return of Google Maps all black map with updated Nvidia web driver on Mac\n\nfix an issue with some nvidia drivers on mac, approved for 60.0.1 and corresponding esr.", "author": "jcristau@mozilla.com", "id": 13275219, "time": "2018-05-14T09:53:05Z"}, {"text": "https://hg.mozilla.org/releases/mozilla-release/rev/75bb42aac094", "author": "ryanvm@gmail.com", "id": 13275488, "time": "2018-05-14T12:31:26Z"}, {"text": "https://hg.mozilla.org/releases/mozilla-esr60/rev/b20c5c5180a7", "author": "ryanvm@gmail.com", "id": 13275534, "time": "2018-05-14T12:50:45Z"}, {"text": "Added this to Firefox and ESR 60.0.1 release notes", "author": "rkothari@mozilla.com", "id": 13279486, "time": "2018-05-15T18:43:51Z"}, {"text": "*** Bug 1448420 has been marked as a duplicate of this bug. ***", "author": "robbyt@robbyt.net", "id": 13286017, "time": "2018-05-17T23:39:02Z"}], "id": 1458553, "priority": "P1", "cc": ["agaynor@mozilla.com", "haftandilian@mozilla.com", "jcristau@mozilla.com", "mcastelluccio@mozilla.com", "rkothari@mozilla.com", "robbyt@robbyt.net", "ryanvm@gmail.com"], "cf_crash_signature": "", "version": "60 Branch", "is_cc_accessible": true, "cf_tracking_firefox_esr52": "---", "see_also": [], "cf_tracking_thunderbird_esr60": "---", "cf_platform_rel": "---", "product": "Core", "cf_fx_iteration": "---", "blocks": [1428055], "qa_contact": "", "creation_time": "2018-05-02T14:20:41Z", "cf_status_firefox_esr52": "unaffected", "component": "Security: Process Sandboxing", "assigned_to_detail": {"email": "haftandilian@mozilla.com", "id": 558190, "name": "haftandilian@mozilla.com", "real_name": "Haik Aftandilian [:haik]"}, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "---", "cf_status_firefox61": "fixed", "cf_status_firefox60": "fixed", "target_milestone": "mozilla61", "cf_rank": null, "cf_qa_whiteboard": "", "severity": "normal", "groups": [], "cf_status_thunderbird_esr52": "---", "url": "", "cf_status_thunderbird_esr60": "---", "creator_detail": {"email": "mattsmeltz@gmail.com", "id": 8476, "name": "mattsmeltz@gmail.com", "real_name": "mws"}, "whiteboard": "", "mentors": [], "summary": "Return of Google Maps all black map with updated Nvidia web driver on Mac", "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "last_change_time": "2018-05-17T23:39:02Z", "assigned_to": "haftandilian@mozilla.com", "is_open": false, "history": [{"changes": [{"removed": "", "field_name": "cc", "added": "agaynor@mozilla.com, haftandilian@mozilla.com"}, {"removed": "Untriaged", "field_name": "component", "added": "Security: Process Sandboxing"}, {"removed": "", "field_name": "blocks", "added": "1428055"}, {"removed": "Firefox", "field_name": "product", "added": "Core"}], "who": "haftandilian@mozilla.com", "when": "2018-05-02T15:53:03Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(mattsmeltz@gmail.com)"}], "who": "haftandilian@mozilla.com", "when": "2018-05-02T20:03:44Z"}, {"changes": [{"removed": "needinfo?(mattsmeltz@gmail.com)", "field_name": "flagtypes.name", "added": ""}], "who": "mattsmeltz@gmail.com", "when": "2018-05-02T20:50:18Z"}, {"changes": [{"removed": "--", "field_name": "priority", "added": "P1"}, {"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "haftandilian@mozilla.com"}], "who": "haftandilian@mozilla.com", "when": "2018-05-02T21:18:20Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8972716, "added": "review?(agaynor@mozilla.com)"}], "who": "haftandilian@mozilla.com", "when": "2018-05-02T21:26:09Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(agaynor@mozilla.com)", "attachment_id": 8972716, "added": "review+"}], "who": "agaynor@mozilla.com", "when": "2018-05-03T13:13:42Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "regression"}, {"removed": "UNCONFIRMED", "field_name": "status", "added": "ASSIGNED"}, {"removed": "", "field_name": "cc", "added": "mcastelluccio@mozilla.com"}, {"removed": "0", "field_name": "is_confirmed", "added": "1"}], "who": "mcastelluccio@mozilla.com", "when": "2018-05-03T13:53:07Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8972716, "added": "approval-mozilla-beta?"}], "who": "haftandilian@mozilla.com", "when": "2018-05-03T15:34:49Z"}, {"changes": [{"removed": "ASSIGNED", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla61"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2018-05-03 21:58:42"}, {"removed": "---", "field_name": "cf_status_firefox61", "added": "fixed"}], "who": "aciure@mozilla.com", "when": "2018-05-03T21:58:42Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "jcristau@mozilla.com"}, {"removed": "---", "field_name": "cf_status_firefox_esr52", "added": "unaffected"}, {"removed": "---", "field_name": "cf_status_firefox_esr60", "added": "affected"}, {"removed": "---", "field_name": "cf_status_firefox59", "added": "unaffected"}, {"removed": "---", "field_name": "cf_status_firefox60", "added": "affected"}], "who": "jcristau@mozilla.com", "when": "2018-05-04T07:52:33Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "approval-mozilla-beta?", "attachment_id": 8972716, "added": "approval-mozilla-release?, approval-mozilla-esr60?"}], "who": "ryanvm@gmail.com", "when": "2018-05-04T18:45:22Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(haftandilian@mozilla.com)"}], "who": "jcristau@mozilla.com", "when": "2018-05-07T08:37:13Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "ryanvm@gmail.com"}], "who": "ryanvm@gmail.com", "when": "2018-05-07T14:24:31Z"}, {"changes": [{"removed": "needinfo?(haftandilian@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "haftandilian@mozilla.com", "when": "2018-05-08T18:10:24Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "approval-mozilla-release?, approval-mozilla-esr60?", "attachment_id": 8972716, "added": "approval-mozilla-release+, approval-mozilla-esr60+"}], "who": "jcristau@mozilla.com", "when": "2018-05-14T09:53:05Z"}, {"changes": [{"removed": "affected", "field_name": "cf_status_firefox60", "added": "fixed"}], "who": "ryanvm@gmail.com", "when": "2018-05-14T12:31:26Z"}, {"changes": [{"removed": "affected", "field_name": "cf_status_firefox_esr60", "added": "fixed"}], "who": "ryanvm@gmail.com", "when": "2018-05-14T12:50:45Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "rkothari@mozilla.com"}, {"removed": "---", "field_name": "cf_tracking_firefox_relnote", "added": "60+"}], "who": "rkothari@mozilla.com", "when": "2018-05-15T18:43:51Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "robbyt@robbyt.net"}], "who": "robbyt@robbyt.net", "when": "2018-05-17T23:39:02Z"}], "resolution": "FIXED", "op_sys": "Unspecified", "cf_fx_points": "---", "cf_blocking_fennec": "---"}