{"status": "NEW", "cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "classification": "Client Software", "creator": "mehmet.sahin@gmx.net", "cc": ["andrei.br92@gmail.com", "dao+bmo@mozilla.com", "dmose@mozilla.org", "edilee@mozilla.com", "florian@queze.net", "mconley@mozilla.com", "tspurway@mozilla.com"], "depends_on": [], "creation_time": "2018-04-07T10:50:57Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "keywords": [], "summary": "Regression: The background of the New Tab Page flickers during opening", "cf_last_resolved": null, "attachments": [{"creator": "mehmet.sahin@gmx.net", "is_obsolete": 0, "is_patch": 0, "flags": [], "content_type": "video/quicktime", "id": 8965944}], "assigned_to_detail": {"email": "nobody@mozilla.org", "id": 1, "name": "nobody@mozilla.org", "real_name": "Nobody; OK to take it and work on it"}, "severity": "normal", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 8, "comments": [{"text": "macOS 10.12.6 (but probably OS=All)\nNightly 61.0a1 (2018-04-06) (64-Bit)\n\n1.) Open a new Tab with CMD-T or a new Window with CMD-N\n\n\nActual: The background of the New Tab Page flickers during opening.\n\nExpected: With the Default-light NTP should be always light-grey without any white-flicker. (New: With Dark-Theme should be always dark without any white-flicker.)\n\nThis is a recent regression in Nightly. It works fine with the Default-Light NTP in Latest FF Beta 10.", "author": "mehmet.sahin@gmx.net", "id": 13188269, "time": "2018-04-07T10:50:57Z"}, {"text": "Created attachment 8965944\nNTP_White_Flicker.mov\n\n+ Screencast", "author": "mehmet.sahin@gmx.net", "id": 13188271, "time": "2018-04-07T10:55:30Z"}, {"text": "I checked manually the regression range:\n\nGood: 2018-03-29-22-28-32-mozilla-central\n\n Bad: 2018-03-30-10-01-23-mozilla-central\n\nMaybe caused by https://hg.mozilla.org/mozilla-central/rev/5dc20e8d5f71 ?\n\nEd Lee: Can you please take a look? Thanks in advance.", "author": "mehmet.sahin@gmx.net", "id": 13204697, "time": "2018-04-13T18:24:00Z"}, {"text": "This happens when the page isn't preloaded, so the first tab of a new window and the first new tab.", "author": "edilee@mozilla.com", "id": 13204711, "time": "2018-04-13T18:29:39Z"}, {"text": ":mconley do you have some thoughts on default canvas colour in dark theme?", "author": "tspurway@mozilla.com", "id": 13210444, "time": "2018-04-16T18:21:58Z"}, {"text": "So this has the chance of being mitigated by bug 1353013, since that has a shot of making sure the preloaded browser exists even for the first tab load.\n\nBut it's not perfect. It'll still be very possible to get the flash if a tab is opened before we get a chance to preload.\n\nWhat I think we might want to do is make it possible to set the colour of \"blank\", since that's what I think we're seeing here. I think it's first important to understand where this blank colour is coming from - is it something in the parent? Perhaps the area behind the <xul:browser> or the <xul:browser> itself before the content takes over?\n\nOr is this the blank page of the content?\n\nI think we need to answer that first before we can get a clear sense of how to proceed. If it's something in the parent, then I think we might need to extend the dark theme to that element / rule. If it's in content, or is some fallback colour that the compositor is using for a tab that hasn't fully set up yet, it might be more complicated.", "author": "mconley@mozilla.com", "id": 13218879, "time": "2018-04-19T15:51:53Z"}, {"text": "Conversation with Florian\n\n> I can explain what I did in 57 to fix the white flash we had at the time, but I'm not sure how much that'll help for the dark theme case.\n> we have 2 things that used to flash white:\n> 1. the background of the XUL <tabbrowser> element before we had any <browser> displayed in it. I solved that by setting the background color explicitly in the CSS. \n> 2. The background of the <browser> showing about:blank instead of the actual page (typically about:home or about:privatebrowsing). I solved that by making the browser transparent until something that is _not_ about:blank has been painted in it.\n\nChanging the background color of the tabbrowser does seem to fix it. The problem I ran into with this solution is how to target the CSS rule. There is a -moz-bool-pref that could be used to check the theme but this does not update dynamically. Private browsing fixes it by setting an attribute on the document [1].\n\n[0] https://bugzilla.mozilla.org/attachment.cgi?id=8905843&action=diff#a/browser/themes/shared/tabs.inc.css_sec1\n[1] https://searchfox.org/mozilla-central/rev/11a2ae294f50049e12515b5821f5a396d951aacb/browser/base/content/browser.js#8554", "author": "andrei.br92@gmail.com", "id": 13220878, "time": "2018-04-20T09:15:53Z"}, {"text": "A note for the previous comment, about:home and about:newtab have a dynamic URL[0] unlike the private browsing page so changing the background color to fix the flashing would also affect system pages like preferences.\n\n[0] https://searchfox.org/mozilla-central/rev/fcd5cb3515d0e06592bba42e378f1b9518497e3d/browser/components/about/AboutRedirector.cpp#91", "author": "andrei.br92@gmail.com", "id": 13225993, "time": "2018-04-23T08:48:48Z"}], "id": 1452364, "priority": "P3", "mentors_detail": [], "cf_crash_signature": "", "version": "unspecified", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox62": "---", "cf_platform_rel": "---", "product": "Firefox", "cf_status_firefox_esr52": "---", "blocks": [], "qa_contact": "", "see_also": [], "cf_fx_iteration": "---", "component": "Activity Streams: Newtab", "votes": 1, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "---", "cf_status_firefox61": "wontfix", "cf_status_firefox60": "unaffected", "target_milestone": "---", "is_cc_accessible": true, "cf_rank": null, "groups": [], "url": "", "creator_detail": {"email": "mehmet.sahin@gmx.net", "id": 310609, "name": "mehmet.sahin@gmx.net", "real_name": "Mehmet"}, "whiteboard": "", "mentors": [], "cc_detail": [{"email": "andrei.br92@gmail.com", "id": 476157, "name": "andrei.br92@gmail.com", "real_name": "Andrei Oprea [:andreio]"}, {"email": "dao+bmo@mozilla.com", "id": 219124, "name": "dao+bmo@mozilla.com", "real_name": "D\u00e3o Gottwald [::dao]"}, {"email": "dmose@mozilla.org", "id": 1537, "name": "dmose@mozilla.org", "real_name": "Dan Mosedale (:dmose)"}, {"email": "edilee@mozilla.com", "id": 125983, "name": "edilee@mozilla.com", "real_name": "Ed Lee :Mardak"}, {"email": "florian@queze.net", "id": 149052, "name": "florian@queze.net", "real_name": "Florian Qu\u00e8ze [:florian]"}, {"email": "mconley@mozilla.com", "id": 403756, "name": "mconley@mozilla.com", "real_name": "Mike Conley (:mconley) (:\u2699\ufe0f) (Catching up on needinfos / reviews)"}, {"email": "tspurway@mozilla.com", "id": 507686, "name": "tspurway@mozilla.com", "real_name": "Tim Spurway [:tspurway]"}], "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "last_change_time": "2018-05-29T18:25:39Z", "cf_status_firefox_esr60": "---", "assigned_to": "nobody@mozilla.org", "is_open": true, "resolution": "", "op_sys": "Unspecified", "cf_fx_points": "---", "history": [{"changes": [{"removed": "", "field_name": "cc", "added": "edilee@mozilla.com"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(edilee@mozilla.com)"}], "who": "mehmet.sahin@gmx.net", "when": "2018-04-13T18:24:00Z"}, {"changes": [{"removed": "New Tab Page", "field_name": "component", "added": "Activity Streams: Newtab"}, {"removed": "needinfo?(edilee@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "edilee@mozilla.com", "when": "2018-04-13T18:29:39Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "mconley@mozilla.com, tspurway@mozilla.com"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(mconley@mozilla.com)"}, {"removed": "---", "field_name": "cf_status_firefox60", "added": "unaffected"}, {"removed": "---", "field_name": "cf_status_firefox61", "added": "affected"}], "who": "tspurway@mozilla.com", "when": "2018-04-16T18:21:58Z"}, {"changes": [{"removed": "needinfo?(mconley@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "mconley@mozilla.com", "when": "2018-04-19T15:51:53Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "florian@queze.net"}], "who": "florian@queze.net", "when": "2018-04-19T16:20:09Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "andrei.br92@gmail.com"}], "who": "andrei.br92@gmail.com", "when": "2018-04-20T09:09:26Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "dao+bmo@mozilla.com"}], "who": "dao+bmo@mozilla.com", "when": "2018-04-21T09:29:03Z"}, {"changes": [{"removed": "--", "field_name": "priority", "added": "P2"}, {"removed": "", "field_name": "cc", "added": "dmose@mozilla.org"}, {"removed": "---", "field_name": "cf_fx_iteration", "added": "62.1 - May 21"}, {"removed": "affected", "field_name": "cf_status_firefox61", "added": "wontfix"}], "who": "tspurway@mozilla.com", "when": "2018-04-23T15:10:53Z"}, {"changes": [{"removed": "P2", "field_name": "priority", "added": "P3"}], "who": "edilee@mozilla.com", "when": "2018-04-23T18:44:51Z"}, {"changes": [{"removed": "62.1 - May 21", "field_name": "cf_fx_iteration", "added": "62.2 - Jun 4"}], "who": "jchaulk@mozilla.com", "when": "2018-05-08T17:01:57Z"}, {"changes": [{"removed": "62.2 - Jun 4", "field_name": "cf_fx_iteration", "added": "---"}], "who": "tspurway@mozilla.com", "when": "2018-05-29T18:25:39Z"}]}