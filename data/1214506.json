{"cf_tracking_thunderbird_esr52": "---", "status": "RESOLVED", "cf_tracking_firefox60": "---", "attachments": [{"creator": "mantaroh@gmail.com", "is_obsolete": 0, "is_patch": 0, "flags": [], "content_type": "text/x-log", "id": 8674639}, {"creator": "roc@ocallahan.org", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2015-10-30T12:10:26Z", "type_id": 4, "creation_date": "2015-10-30T12:06:07Z", "id": 1283402, "setter": "jyavenard@mozilla.com"}, {"status": "+", "name": "approval-mozilla-aurora", "modification_date": "2015-11-09T22:17:15Z", "type_id": 720, "creation_date": "2015-11-05T22:56:06Z", "id": 1287475, "setter": "rkothari@mozilla.com"}], "content_type": "text/x-review-board-request", "id": 8681038}, {"creator": "roc@ocallahan.org", "is_obsolete": 1, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2015-10-30T10:02:08Z", "type_id": 4, "creation_date": "2015-10-30T03:46:43Z", "id": 1283181, "setter": "jyavenard@mozilla.com"}], "content_type": "text/x-review-board-request", "id": 8681039}], "classification": "Components", "creator": "mantaroh@gmail.com", "mentors_detail": [], "depends_on": [], "cf_has_str": "---", "cf_user_story": "", "cf_backlog": "---", "cf_tracking_firefox_relnote": "---", "platform": "x86", "cf_status_firefox58": "---", "cf_status_firefox59": "---", "keywords": ["crash"], "summary": "crash in mozilla::AudioChunk::SliceTo(__int64, __int64)", "cf_last_resolved": "2015-10-30T23:39:50Z", "votes": 0, "severity": "critical", "is_confirmed": true, "is_creator_accessible": true, "cf_status_firefox45": "fixed", "cf_has_regression_range": "---", "comment_count": 28, "comments": [{"text": "This bug was filed from the Socorro interface and is \nreport bp-e3c64afb-843a-4170-a9e5-59a152151014.\n=============================================================\nReproduce step:\n 1) access the testpage[1].\n 2) select ogv file.\n\nActually Result:\n Crash (non e10s)", "author": "mantaroh@gmail.com", "id": 10836306, "time": "2015-10-14T06:47:02Z"}, {"text": "Sorry, I have filed an unfinished bug.\n\nReproduce Step:\n 1) access the testpage[1]\n 2) select ogv file.\n\nActually Result:\n - Crashed the firefox.(none e10s)\n - Crashed the tab.(e10s)\n\nExpected Result:\n we can play the video without crash.\n\n[1] http://mantaroh.github.io/crash-audio-chunk/", "author": "mantaroh@gmail.com", "id": 10836323, "time": "2015-10-14T06:54:25Z"}, {"text": "Hi cpearce,\n\nI tried to play ogg video using blob and mozCaptureStream.\nHowever current nightly was crashed.\n(It was success using video's src attribute.)\n\nSome ogg video was success.\n\nI have a question about ogg file format.\nDoes support ogg video using blob in current Firefox?\n\nAdditional Info:\nIn fact current B2G Simulator for TV is using similar implementation,\nAnd this simulator have similar crash bug.(bug 1214115)", "author": "mantaroh@gmail.com", "id": 10836430, "time": "2015-10-14T07:45:50Z"}, {"text": "(In reply to Mantaroh Yoshinaga[:mantaroh] from comment #2)\n> Does support ogg video using blob in current Firefox?\n\nShould do. Looks like this is a crash in MSG code, not in Ogg specific code.", "author": "cpearce@mozilla.com", "id": 10839989, "time": "2015-10-15T00:24:30Z"}, {"text": "Created attachment 8674639\nbug1214506_20151016_ASSERTION_in_TrackUnionStream.log\n\nThanks Chris.\n\nI tested nightly with debug symbols. It seems MediaStreamGraphImpl::UpdateCurrentTimeForStreams() accessed the released stream object.[1] I don't know why we are accessing a released object.\n\nI also tried testing with a debug build. The assertion at TrackUnionStream:CopyTrackData[2] failed. I have attached a console log.\n\nI'm not familiar with MediaStreamGraph. Can you suggest someone who can help?\n\n[1] https://dxr.mozilla.org/mozilla-central/rev/e193b4da0a8c1025aa76a403c64663ff1cd41709/dom/media/MediaStreamGraph.cpp#245\n[2] https://dxr.mozilla.org/mozilla-central/rev/e193b4da0a8c1025aa76a403c64663ff1cd41709/dom/media/TrackUnionStream.cpp#270", "author": "mantaroh@gmail.com", "id": 10843954, "time": "2015-10-16T00:55:27Z"}, {"text": "Roc or JW know more about the MSG and may be able to help.", "author": "cpearce@mozilla.com", "id": 10844030, "time": "2015-10-16T01:37:33Z"}, {"text": "Haven't touch MSG for a while. Paul should know better.", "author": "suro001@gmail.com", "id": 10844086, "time": "2015-10-16T02:09:19Z"}, {"text": "Andreas, this is asserting like crazy in tracks code, care to have a look? This is easy to repro here. You open the URL, save the two files locally, and load them using the button, alternating between the two (sometimes it works, and I find sometimes shift reloading helps repro-ing).", "author": "padenot@mozilla.com", "id": 10844690, "time": "2015-10-16T08:18:47Z"}, {"text": "I'm a bit swamped with MediaStream stuff at the moment, but I'll put it on my list of things to do while waiting for reviews.", "author": "apehrson@mozilla.com", "id": 10849934, "time": "2015-10-19T05:45:21Z"}, {"text": "I'm looking into it.", "author": "roc@ocallahan.org", "id": 10884083, "time": "2015-10-29T05:28:37Z"}, {"text": "We get into DecodedStream::SendVideo with mInfo.mAudio.mTrackId == mInfo.mVideo.mTrackId == -1.\n\nThis actually comes from OggReader. In OggReader::ReadMetadata mInfo ends up with those two mTrackIds both being -1. They definitely shouldn't have the same track ID, and I guess they shouldn't be TRACK_INVALID.", "author": "roc@ocallahan.org", "id": 10884620, "time": "2015-10-29T10:08:19Z"}, {"text": "Yeah, so OggReader simply doesn't assign track IDs. So duplicate TRACK_INVALID track IDs get put into the MediaStream and things go downhill from there.", "author": "roc@ocallahan.org", "id": 10884654, "time": "2015-10-29T10:18:32Z"}, {"text": "Created attachment 8681038\nMozReview Request: Bug 1214506. Ensure OggReader sets proper IDs for its tracks. r=jya\n\nBug 1214506. Ensure OggReader sets proper IDs for its tracks. r=jya", "author": "roc@ocallahan.org", "id": 10888078, "time": "2015-10-30T03:46:41Z"}, {"text": "Created attachment 8681039\nMozReview Request: Bug 1214506. Eliminate default values for track IDs. r=jya\n\nBug 1214506. Eliminate default values for track IDs. r=jya", "author": "roc@ocallahan.org", "id": 10888079, "time": "2015-10-30T03:46:43Z"}, {"text": "Comment on attachment 8681038\nMozReview Request: Bug 1214506. Ensure OggReader sets proper IDs for its tracks. r=jya\n\nhttps://reviewboard.mozilla.org/r/23721/#review21245\n\n::: dom/media/ogg/OggReader.cpp:126\n(Diff revision 1)\n> -              aEnable);\n> +              aEnable, (TrackID)aTrackType);\n\nThis is a bit ugly IMHO. What does casting a TrackType into a TrackID means? And a C-cast at that :)\n\nIf we want to set the track id for audio to 1 and video track id to 2 ; It would be better to have this set explicitly.\neg.\naTrackType == TrackType::kAudioTrack ? ...\n\n  enum TrackType {\n    kUndefinedTrack,\n    kAudioTrack,\n    kVideoTrack,\n    kTextTrack\n  };\n\nthe value of kAudioTrack and kVideoTrack should be valueless.\nIf anyone add a constant before kAudioTrack, the OggReader will then be broken.\n\nI think it would be safer to have a pure virtual TrackInfo::Init that doesn't take a TrackType.\nIt seems wrong to me to be able to run Init on an existing VideoTrack and be able to change its type.\nThis would cause havoc in the MediaCode as we typically pass a const TrackInfo& and rely on the TrackType value to cast this into either a VideoInfo& or an AudioInfo&.\nWe would then likely perform an out of bound read", "author": "jyavenard@mozilla.com", "id": 10888664, "time": "2015-10-30T10:01:10Z"}, {"text": "Comment on attachment 8681039\nMozReview Request: Bug 1214506. Eliminate default values for track IDs. r=jya\n\nhttps://reviewboard.mozilla.org/r/23723/#review21249", "author": "jyavenard@mozilla.com", "id": 10888666, "time": "2015-10-30T10:02:08Z"}, {"text": "(In reply to Jean-Yves Avenard [:jya] from comment #14)\n> ::: dom/media/ogg/OggReader.cpp:126\n> (Diff revision 1)\n> > -              aEnable);\n> > +              aEnable, (TrackID)aTrackType);\n> \n> This is a bit ugly IMHO. What does casting a TrackType into a TrackID means?\n> And a C-cast at that :)\n\nIt doesn't matter as long as it gives us unique values.\n\n> If we want to set the track id for audio to 1 and video track id to 2 ; It\n> would be better to have this set explicitly.\n> eg.\n> aTrackType == TrackType::kAudioTrack ? ...\n> \n>   enum TrackType {\n>     kUndefinedTrack,\n>     kAudioTrack,\n>     kVideoTrack,\n>     kTextTrack\n>   };\n> \n> the value of kAudioTrack and kVideoTrack should be valueless.\n\nI don't know what this means.\n\n> If anyone add a constant before kAudioTrack, the OggReader will then be\n> broken.\n\nI don't know what this means either.\n\n> I think it would be safer to have a pure virtual TrackInfo::Init that\n> doesn't take a TrackType.\n> It seems wrong to me to be able to run Init on an existing VideoTrack and be\n> able to change its type.\n\nI can just remove the aTrackType parameter from Init.", "author": "roc@ocallahan.org", "id": 10888963, "time": "2015-10-30T11:38:24Z"}, {"text": "(In reply to Robert O'Callahan (:roc) (Mozilla Corporation) from comment #16)\n> > This is a bit ugly IMHO. What does casting a TrackType into a TrackID means?\n> > And a C-cast at that :)\n> \n> It doesn't matter as long as it gives us unique values.\n\nI thought you wanted them to be of a specific value (here: audio=1 and video=2) which made sense as it's the default values given by AudioInfo and VideoInfo constructor respectively.\n\n> > If anyone add a constant before kAudioTrack, the OggReader will then be\n> > broken.\n> \n> I don't know what this means either.\n\nIf it's the value 1 and 2 that we need; adding an enum in that declaration would change it to 2 and 3 etc.\n\n> \n> > I think it would be safer to have a pure virtual TrackInfo::Init that\n> > doesn't take a TrackType.\n> > It seems wrong to me to be able to run Init on an existing VideoTrack and be\n> > able to change its type.\n> \n> I can just remove the aTrackType parameter from Init.\n\nthat would work. It appears this is only used by OggReader however. so maybe it doesn't matter.", "author": "jyavenard@mozilla.com", "id": 10888982, "time": "2015-10-30T11:55:04Z"}, {"text": "Comment on attachment 8681038\nMozReview Request: Bug 1214506. Ensure OggReader sets proper IDs for its tracks. r=jya\n\nBug 1214506. Ensure OggReader sets proper IDs for its tracks. r=jya", "author": "roc@ocallahan.org", "id": 10888999, "time": "2015-10-30T12:06:07Z"}, {"text": "Comment on attachment 8681038\nMozReview Request: Bug 1214506. Ensure OggReader sets proper IDs for its tracks. r=jya\n\nhttps://reviewboard.mozilla.org/r/23721/#review21257", "author": "jyavenard@mozilla.com", "id": 10889005, "time": "2015-10-30T12:10:26Z"}, {"text": "https://hg.mozilla.org/integration/mozilla-inbound/rev/485a23bbf84793dd05268420c61642f3856de5a3\nBug 1214506. Ensure OggReader sets proper IDs for its tracks. r=jya", "author": "roc@ocallahan.org", "id": 10889147, "time": "2015-10-30T13:20:33Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/485a23bbf847", "author": "kwierso@gmail.com", "id": 10891124, "time": "2015-10-30T23:39:50Z"}, {"text": "(clearing NI)", "author": "padenot@mozilla.com", "id": 10897616, "time": "2015-11-03T11:03:44Z"}, {"text": "https://hg.mozilla.org/releases/mozilla-b2g44_v2_5/rev/485a23bbf847", "author": "cbook@mozilla.com", "id": 10902322, "time": "2015-11-04T15:00:29Z"}, {"text": "Comment on attachment 8681038\nMozReview Request: Bug 1214506. Ensure OggReader sets proper IDs for its tracks. r=jya\n\nApproval Request Comment\n[Feature/regressing bug #]: none\n[User impact if declined]: possible crashes mixing Ogg files with new stream APIs\n[Describe test coverage new/current, TreeHerder]: automated tests catch this (with asserts added in this patch)\n[Risks and why]: very low risk, simple change.\n[String/UUID change made/needed]: none.", "author": "roc@ocallahan.org", "id": 10908615, "time": "2015-11-05T22:56:06Z"}, {"text": "Comment on attachment 8681038\nMozReview Request: Bug 1214506. Ensure OggReader sets proper IDs for its tracks. r=jya\n\nThis has been on Nightly for over a week, seems safe to uplift to Aurora44.", "author": "rkothari@mozilla.com", "id": 10917294, "time": "2015-11-09T22:17:15Z"}, {"text": "https://hg.mozilla.org/releases/mozilla-aurora/rev/d7ab2f17e377", "author": "cbook@mozilla.com", "id": 10919595, "time": "2015-11-10T16:00:32Z"}, {"text": "https://hg.mozilla.org/releases/mozilla-b2g44_v2_5/rev/d7ab2f17e377", "author": "cbook@mozilla.com", "id": 10922343, "time": "2015-11-11T08:22:15Z"}], "id": 1214506, "priority": "--", "cc": ["apehrson@mozilla.com", "cpearce@mozilla.com", "jyavenard@mozilla.com", "padenot@mozilla.com", "rjesup@jesup.org", "rkothari@mozilla.com", "roc@ocallahan.org", "suro001@gmail.com"], "cf_crash_signature": "[@ mozilla::AudioChunk::SliceTo(__int64, __int64)]", "version": "43 Branch", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "see_also": [], "cf_tracking_firefox59": "---", "last_change_time": "2015-11-11T08:22:15Z", "cf_platform_rel": "---", "product": "Core", "cf_fx_iteration": "---", "blocks": [1214513, 1214520], "qa_contact": "", "creation_time": "2015-10-14T06:47:02Z", "cf_status_firefox_esr52": "---", "component": "Audio/Video", "assigned_to_detail": {"email": "roc@ocallahan.org", "id": 5038, "name": "roc@ocallahan.org", "real_name": "Robert O'Callahan (:roc) (email my personal email if necessary)"}, "alias": null, "groups": [], "cf_status_firefox60": "---", "target_milestone": "mozilla45", "cf_status_firefox44": "fixed", "is_cc_accessible": true, "cf_rank": null, "cf_status_thunderbird_esr52": "---", "url": "http://mantaroh.github.io/crash-audio-chunk/", "creator_detail": {"email": "mantaroh@gmail.com", "id": 529846, "name": "mantaroh@gmail.com", "real_name": "Mantaroh Yoshinaga[:mantaroh]"}, "whiteboard": "", "mentors": [], "cc_detail": [{"email": "apehrson@mozilla.com", "id": 489889, "name": "apehrson@mozilla.com", "real_name": "Andreas Pehrson [:pehrsons]"}, {"email": "cpearce@mozilla.com", "id": 287422, "name": "cpearce@mozilla.com", "real_name": "Chris Pearce (:cpearce)"}, {"email": "jyavenard@mozilla.com", "id": 512198, "name": "jyavenard@mozilla.com", "real_name": "Jean-Yves Avenard [:jya]"}, {"email": "padenot@mozilla.com", "id": 404637, "name": "padenot@mozilla.com", "real_name": "Paul Adenot (:padenot)"}, {"email": "rjesup@jesup.org", "id": 11539, "name": "rjesup@jesup.org", "real_name": "Randell Jesup [:jesup]"}, {"email": "rkothari@mozilla.com", "id": 538805, "name": "rkothari@mozilla.com", "real_name": "Ritu Kothari (:ritu)"}, {"email": "roc@ocallahan.org", "id": 5038, "name": "roc@ocallahan.org", "real_name": "Robert O'Callahan (:roc) (email my personal email if necessary)"}, {"email": "suro001@gmail.com", "id": 469171, "name": "suro001@gmail.com", "real_name": "JW Wang [:jwwang] [:jw_wang]"}], "cf_status_b2g_2_5": "fixed", "dupe_of": null, "flags": [], "cf_tracking_firefox58": "---", "assigned_to": "roc@ocallahan.org", "is_open": false, "history": [{"changes": [{"removed": "", "field_name": "cc", "added": "cpearce@mozilla.com"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(cpearce@mozilla.com)"}], "who": "mantaroh@gmail.com", "when": "2015-10-14T07:45:50Z"}, {"changes": [{"removed": "", "field_name": "blocks", "added": "1214513"}], "who": "mantaroh@gmail.com", "when": "2015-10-14T07:48:15Z"}, {"changes": [{"removed": "", "field_name": "blocks", "added": "1214520"}], "who": "mantaroh@gmail.com", "when": "2015-10-14T23:14:27Z"}, {"changes": [{"removed": "needinfo?(cpearce@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "cpearce@mozilla.com", "when": "2015-10-15T00:24:30Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8674639, "added": "review?(cpearce@mozilla.com)"}], "who": "mantaroh@gmail.com", "when": "2015-10-16T00:55:27Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(cpearce@mozilla.com)", "attachment_id": 8674639, "added": ""}], "who": "mantaroh@gmail.com", "when": "2015-10-16T00:55:57Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(cpearce@mozilla.com)"}], "who": "mantaroh@gmail.com", "when": "2015-10-16T00:56:14Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "jwwang@mozilla.com, roc@ocallahan.org"}, {"removed": "needinfo?(cpearce@mozilla.com)", "field_name": "flagtypes.name", "added": "needinfo?(jwwang@mozilla.com), needinfo?(roc@ocallahan.org)"}], "who": "cpearce@mozilla.com", "when": "2015-10-16T01:37:33Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "padenot@mozilla.com"}, {"removed": "needinfo?(jwwang@mozilla.com)", "field_name": "flagtypes.name", "added": "needinfo?(padenot@mozilla.com)"}], "who": "suro001@gmail.com", "when": "2015-10-16T02:09:19Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "pehrsons@gmail.com"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(pehrsons@gmail.com)"}], "who": "padenot@mozilla.com", "when": "2015-10-16T08:18:47Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "rjesup@jesup.org"}], "who": "rjesup@jesup.org", "when": "2015-10-16T14:11:07Z"}, {"changes": [{"removed": "needinfo?(pehrsons@gmail.com)", "field_name": "flagtypes.name", "added": ""}], "who": "apehrson@mozilla.com", "when": "2015-10-19T05:45:21Z"}, {"changes": [{"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "roc@ocallahan.org"}, {"removed": "needinfo?(roc@ocallahan.org)", "field_name": "flagtypes.name", "added": ""}], "who": "roc@ocallahan.org", "when": "2015-10-29T05:28:37Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8681038, "added": "review?(jyavenard@mozilla.com)"}, {"removed": "", "field_name": "cc", "added": "jyavenard@mozilla.com"}], "who": "roc@ocallahan.org", "when": "2015-10-30T03:46:41Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8681039, "added": "review?(jyavenard@mozilla.com)"}], "who": "roc@ocallahan.org", "when": "2015-10-30T03:46:43Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(jyavenard@mozilla.com)", "attachment_id": 8681038, "added": ""}], "who": "jyavenard@mozilla.com", "when": "2015-10-30T10:01:10Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(jyavenard@mozilla.com)", "attachment_id": 8681039, "added": "review+"}], "who": "jyavenard@mozilla.com", "when": "2015-10-30T10:02:08Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8681038, "added": "review?(jyavenard@mozilla.com)"}], "who": "roc@ocallahan.org", "when": "2015-10-30T12:06:07Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8681039, "added": "1"}], "who": "roc@ocallahan.org", "when": "2015-10-30T12:06:10Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(jyavenard@mozilla.com)", "attachment_id": 8681038, "added": "review+"}], "who": "jyavenard@mozilla.com", "when": "2015-10-30T12:10:26Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla45"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2015-10-30 16:39:50"}, {"removed": "---", "field_name": "cf_status_firefox45", "added": "fixed"}], "who": "kwierso@gmail.com", "when": "2015-10-30T23:39:50Z"}, {"changes": [{"removed": "needinfo?(padenot@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "padenot@mozilla.com", "when": "2015-11-03T11:03:44Z"}, {"changes": [{"removed": "---", "field_name": "cf_status_b2g_2_5", "added": "fixed"}], "who": "cbook@mozilla.com", "when": "2015-11-04T15:00:29Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8681038, "added": "approval-mozilla-aurora?"}], "who": "roc@ocallahan.org", "when": "2015-11-05T22:56:06Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "rkothari@mozilla.com"}, {"removed": "---", "field_name": "cf_status_firefox44", "added": "affected"}], "who": "rkothari@mozilla.com", "when": "2015-11-09T22:05:35Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "approval-mozilla-aurora?", "attachment_id": 8681038, "added": "approval-mozilla-aurora+"}], "who": "rkothari@mozilla.com", "when": "2015-11-09T22:17:15Z"}, {"changes": [{"removed": "affected", "field_name": "cf_status_firefox44", "added": "fixed"}], "who": "cbook@mozilla.com", "when": "2015-11-10T16:00:32Z"}], "resolution": "FIXED", "op_sys": "Windows NT", "cf_fx_points": "---", "cf_blocking_fennec": "---"}