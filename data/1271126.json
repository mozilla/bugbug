{"cf_tracking_thunderbird_esr52": "---", "status": "RESOLVED", "cf_tracking_firefox60": "---", "attachments": [{"creator": "gordonsu14@gmail.com", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "-", "name": "review", "modification_date": "2016-05-26T17:50:32Z", "type_id": 4, "creation_date": "2016-05-26T14:07:49Z", "id": 1401039, "setter": "bugs@pettay.fi"}], "content_type": "text/plain", "id": 8756516}, {"creator": "gordonsu14@gmail.com", "is_obsolete": 1, "is_patch": 1, "flags": [], "content_type": "text/plain", "id": 8757532}, {"creator": "bzbarsky@mit.edu", "is_obsolete": 0, "is_patch": 1, "flags": [], "content_type": "text/plain", "id": 8757561}, {"creator": "gordonsu14@gmail.com", "is_obsolete": 1, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2016-06-06T19:53:37Z", "type_id": 4, "creation_date": "2016-06-06T19:42:03Z", "id": 1406728, "setter": "bugs@pettay.fi"}], "content_type": "text/plain", "id": 8760027}, {"creator": "gordonsu14@gmail.com", "is_obsolete": 0, "is_patch": 1, "flags": [], "content_type": "text/plain", "id": 8762425}], "classification": "Components", "creator": "ayg@aryeh.name", "cc": ["bugs@pettay.fi", "bzbarsky@mit.edu", "gordonsu14@gmail.com"], "depends_on": [1315238], "creation_time": "2016-05-08T15:26:32Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "cf_status_firefox58": "---", "cf_status_firefox59": "---", "keywords": [], "summary": "Integer reflected attributes on elements cannot store INT32_MIN", "id": 1271126, "assigned_to_detail": {"email": "gordonsu14@gmail.com", "id": 552578, "name": "gordonsu14@gmail.com", "real_name": "Gordon Su"}, "severity": "normal", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "assigned_to": "gordonsu14@gmail.com", "comment_count": 23, "comments": [{"text": "Test-case:\n\ndata:text/html,<!DOCTYPE html>\n<script>\nvar el = document.createElement(\"ol\");\nel.setAttribute(\"start\", -2147483648);\ndocument.documentElement.textContent = el.start;\n</script>\n\nWe output \"1\", but should output \"-2147483648\".  IE 11 and Chrome pass.  I didn't figure out why we fail from cursory code inspection.  I imagine INT32_MIN is being used for some sort of sentinel value and it might not be worth the resources to fix, given that it's an extremely marginal case.  The only reason to fix it would be to pass more tests, but nobody looks at test results anyway.  I'm mostly filing just to have on record to annotate wpt test failure reasons.", "author": "ayg@aryeh.name", "id": 11391297, "time": "2016-05-08T15:26:32Z"}, {"text": "Boris, WDYT?", "author": "overholt@mozilla.com", "id": 11397965, "time": "2016-05-10T20:38:57Z"}, {"text": "> I imagine INT32_MIN is being used for some sort of sentinel value\n\nIt's not.  What's happening is that nsContentUtils::ParseHTMLInteger faithfully implements the HTML spec for https://html.spec.whatwg.org/multipage/infrastructure.html#signed-integers in the sense that it checks for starting '-', then parses digits, then if a '-' was seen negates.  It uses a CheckedInt32 accumulator.  Since \"2147483648\" doesn't fit in int32_t, we fail to parse the string as a valid integer.\n\nWe could probably change this code to have a variable that's either 1 or -1 depending on whether 'negate' is true, then multiply (*iter - char16_t('0')) by that variable when accumulating.  And remove the |value = -value| bit in the negate case.\n\nThis is a pretty good first bug kind of thing; I'm happy to mentor.", "author": "bzbarsky@mit.edu", "id": 11398965, "time": "2016-05-11T03:10:08Z"}, {"text": "Created attachment 8756516\nFixed the ParseHTMLInteger\n\nChanged the ParseHTMLInteger function. Thanks!", "author": "gordonsu14@gmail.com", "id": 11438619, "time": "2016-05-25T20:30:39Z"}, {"text": "Gordon, you probably want to request review if you think the patch is ready to go.  I'm not a great reviewer for this because I suggested the approach; maybe try :smaug?", "author": "bzbarsky@mit.edu", "id": 11438799, "time": "2016-05-25T21:22:57Z"}, {"text": "Comment on attachment 8756516\nFixed the ParseHTMLInteger\n\n \n>-  bool negate = false;\n>+  int negate = 1;\nI would call the variable sign or some such.\n\n>   while (iter != end) {\n>     if (*iter >= char16_t('0') && *iter <= char16_t('9')) {\n>-      value = (value * 10) + (*iter - char16_t('0'));\n>+      value = (value * 10) + (*iter - char16_t('0'))*negate;\nstyling nit, there should be space before and after *\n\n\n>-  if (value.isValid() && negate) {\n>-    value = -value;\n>-    // Checking the special case of -0.\n>-    if (value == 0) {\n>-      result |= eParseHTMLInteger_NonStandard;\n>-    }\n>-  }\n>-\n>   if (value.isValid() &&\n>-      (leadingZeros > 1 || (leadingZeros == 1 && !(value == 0)))) {\n>+       ((leadingZeros > 1 || (leadingZeros == 1 && !(value == 0))) ||\n>+       (negate == -1 && value == 0))) {\n>     result |= eParseHTMLInteger_NonStandard;\n>   }\nThis seems to be a bit unrelated change but fine.\n\nCould we please get some testcase for this? Or update some existing web-platform-test or mochitest?\n\nr- because we need some tests here.", "author": "bugs@pettay.fi", "id": 11441644, "time": "2016-05-26T17:50:32Z"}, {"text": "There are existing web platform tests that probably need annotations updated.  \"fgrep -r -- -2147483648 testing/web-platform/meta/\" shows 246 hits.  \n\nThere's also a workaround for this bug in ayout/reftests/counters/counter-ua-limits-list-01-ref.html (it's not testing the -2147483648 value), some todo_is along similar lines in dom/html/test/reflect.js, and maybe a few other things.  I've done a try push at https://treeherder.mozilla.org/#/jobs?repo=try&revision=77bef7c5a007 to see what tests end up failing with the patch.", "author": "bzbarsky@mit.edu", "id": 11441728, "time": "2016-05-26T18:09:12Z"}, {"text": "Yep, the test run shows a bunch of unexpected passes in various web platform tests.  The corresponding testing/web-platform/meta/....../whatever.ini files need to be edited to remove the failure annotations.\n\nIt's a bit odd that the reftests and whatever is using dom/html/test/reflect.js did not fail...", "author": "bzbarsky@mit.edu", "id": 11443039, "time": "2016-05-27T02:08:23Z"}, {"text": "Created attachment 8757532\nUpdated the tests to fix the unexpected passes\n\nI couldn't push it to the try server, but nothing unexpected came up with I ran the tests.\nLet me know if I need to change anything else.", "author": "gordonsu14@gmail.com", "id": 11445763, "time": "2016-05-27T23:47:59Z"}, {"text": "Try push with the updated patch: https://treeherder.mozilla.org/#/jobs?repo=try&revision=db33c825a883", "author": "bzbarsky@mit.edu", "id": 11445797, "time": "2016-05-28T00:15:54Z"}, {"text": "> It's a bit odd that the reftests and whatever is using dom/html/test/reflect.js did not fail...\n\nIt's because those workarounds were written such that they work with the bug fixed too.  I'll attach a patch that removes the workarounds...", "author": "bzbarsky@mit.edu", "id": 11445897, "time": "2016-05-28T01:23:17Z"}, {"text": "Created attachment 8757561\nThis should probably be included in the fix", "author": "bzbarsky@mit.edu", "id": 11445898, "time": "2016-05-28T01:24:07Z"}, {"text": "Created attachment 8760027\nUpdated the tests to fix unexpected passes, change reflect.js", "author": "gordonsu14@gmail.com", "id": 11463930, "time": "2016-06-05T01:46:09Z"}, {"text": "Comment on attachment 8760027\nUpdated the tests to fix unexpected passes, change reflect.js\n\nThere were some failure on the try server I couldn't replicate locally. Let me know if I forgot anything. Thanks!", "author": "gordonsu14@gmail.com", "id": 11463932, "time": "2016-06-05T01:48:04Z"}, {"text": "Comment on attachment 8760027\nUpdated the tests to fix unexpected passes, change reflect.js\n\nThe failures outside web platform test reflection tests were all known intermittents.\n\nI did a try push with this updated patch: <https://treeherder.mozilla.org/#/jobs?repo=try&revision=b7532abbe458>. But at first glance it fixes the unexpected passes seen in the previous push.", "author": "bzbarsky@mit.edu", "id": 11466985, "time": "2016-06-06T19:42:03Z"}, {"text": "Comment on attachment 8760027\nUpdated the tests to fix unexpected passes, change reflect.js\n\nsurprisingly lots of tests for attribute values.", "author": "bugs@pettay.fi", "id": 11467030, "time": "2016-06-06T19:53:37Z"}, {"text": "That last try push shows several unexpected failures in the html/dom/reflection-obsolete.html web-platform test (see W(2) on opt and W(4) on debug).  Probably because we don't implement the relevant attributes on <marquee> directly.  Also, the commit message for this patch should probably describe the overall change being made, not the last fixup commit.", "author": "bzbarsky@mit.edu", "id": 11467423, "time": "2016-06-06T22:03:01Z"}, {"text": "Created attachment 8762425\nFixed the ParseHTMLInteger function to handle INT32_MIN\n\nFixed the marquee tests", "author": "gordonsu14@gmail.com", "id": 11480949, "time": "2016-06-12T20:22:29Z"}, {"text": "Try run at https://treeherder.mozilla.org/#/jobs?repo=try&revision=f66e316b94e9&selectedJob=22406801 looks good.  Going to push that patch; I don't think it needs more review from Olli.  I did review the interdiff against the last bits Olli reviewed.", "author": "bzbarsky@mit.edu", "id": 11483025, "time": "2016-06-14T13:06:45Z"}, {"text": "Pushed by bzbarsky@mozilla.com:\nhttps://hg.mozilla.org/integration/mozilla-inbound/rev/085bacd46edf\nFixed the ParseHTMLInteger function to handle INT32_MIN.  r=smaug", "author": "pulsebot@bots.tld", "id": 11483027, "time": "2016-06-14T13:07:54Z"}, {"text": "Gordon, thank you for working on this!", "author": "bzbarsky@mit.edu", "id": 11483047, "time": "2016-06-14T13:16:59Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/085bacd46edf", "author": "cbook@mozilla.com", "id": 11483964, "time": "2016-06-15T05:31:55Z"}, {"text": "*** Bug 586761 has been marked as a duplicate of this bug. ***", "author": "ayg@aryeh.name", "id": 11655045, "time": "2016-08-25T15:21:14Z"}], "cf_last_resolved": "2016-06-15T05:31:55Z", "priority": "--", "mentors_detail": [{"email": "bzbarsky@mit.edu", "id": 20209, "name": "bzbarsky@mit.edu", "real_name": "Boris Zbarsky [:bz] (no decent commit message means r-)"}], "cf_crash_signature": "", "version": "unspecified", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox59": "---", "last_change_time": "2016-11-04T15:24:07Z", "cf_platform_rel": "---", "product": "Core", "cf_status_firefox_esr52": "---", "blocks": [], "qa_contact": "", "see_also": [], "cf_fx_iteration": "---", "component": "DOM", "votes": 0, "cf_status_firefox49": "---", "groups": [], "cf_status_firefox60": "---", "target_milestone": "mozilla50", "is_cc_accessible": true, "cf_status_thunderbird_esr52": "---", "url": "", "creator_detail": {"email": "ayg@aryeh.name", "id": 236958, "name": "ayg@aryeh.name", "real_name": "Aryeh Gregor (:ayg) (no longer with Mozilla)"}, "whiteboard": "btpp-backlog", "mentors": ["bzbarsky@mit.edu"], "cc_detail": [{"email": "bugs@pettay.fi", "id": 39966, "name": "bugs@pettay.fi", "real_name": "Olli Pettay [:smaug]"}, {"email": "bzbarsky@mit.edu", "id": 20209, "name": "bzbarsky@mit.edu", "real_name": "Boris Zbarsky [:bz] (no decent commit message means r-)"}, {"email": "gordonsu14@gmail.com", "id": 552578, "name": "gordonsu14@gmail.com", "real_name": "Gordon Su"}], "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "cf_tracking_firefox58": "---", "cf_rank": null, "is_open": false, "history": [{"changes": [{"removed": "", "field_name": "cc", "added": "bzbarsky@mit.edu"}, {"removed": "", "field_name": "whiteboard", "added": "btpp-backlog"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(bzbarsky@mit.edu)"}], "who": "overholt@mozilla.com", "when": "2016-05-10T20:38:57Z"}, {"changes": [{"removed": "needinfo?(bzbarsky@mit.edu)", "field_name": "flagtypes.name", "added": ""}, {"removed": "", "field_name": "bug_mentor", "added": "bzbarsky@mit.edu"}], "who": "bzbarsky@mit.edu", "when": "2016-05-11T03:10:08Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "gordonsu14@gmail.com"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(gordonsu14@gmail.com)"}], "who": "bzbarsky@mit.edu", "when": "2016-05-25T21:24:09Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "bugs@pettay.fi"}, {"removed": "needinfo?(gordonsu14@gmail.com)", "field_name": "flagtypes.name", "added": ""}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8756516, "added": "review?(bugs@pettay.fi)"}], "who": "gordonsu14@gmail.com", "when": "2016-05-26T14:07:49Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(bugs@pettay.fi)", "attachment_id": 8756516, "added": "review-"}], "who": "bugs@pettay.fi", "when": "2016-05-26T17:50:32Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8757532, "added": "review?(bugs@pettay.fi)"}], "who": "gordonsu14@gmail.com", "when": "2016-05-27T23:47:59Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(bugs@pettay.fi)", "attachment_id": 8757532, "added": ""}], "who": "gordonsu14@gmail.com", "when": "2016-05-28T03:30:10Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8757532, "added": "1"}], "who": "gordonsu14@gmail.com", "when": "2016-06-05T01:46:11Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8760027, "added": "review?(bugs@pettay.fi)"}], "who": "bzbarsky@mit.edu", "when": "2016-06-06T19:42:03Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(bugs@pettay.fi)", "attachment_id": 8760027, "added": "review+"}], "who": "bugs@pettay.fi", "when": "2016-06-06T19:53:37Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(gordonsu14@gmail.com)"}], "who": "bzbarsky@mit.edu", "when": "2016-06-06T22:03:01Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8762425, "added": "review?(bugs@pettay.fi)"}], "who": "gordonsu14@gmail.com", "when": "2016-06-12T20:22:29Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8760027, "added": "1"}], "who": "gordonsu14@gmail.com", "when": "2016-06-12T20:22:31Z"}, {"changes": [{"removed": "needinfo?(gordonsu14@gmail.com)", "field_name": "flagtypes.name", "added": ""}], "who": "bzbarsky@mit.edu", "when": "2016-06-14T13:06:45Z"}, {"changes": [{"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "gordonsu14@gmail.com"}], "who": "bzbarsky@mit.edu", "when": "2016-06-14T13:07:14Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(bugs@pettay.fi)", "attachment_id": 8762425, "added": ""}], "who": "bzbarsky@mit.edu", "when": "2016-06-14T13:07:31Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla50"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2016-06-15 05:31:55"}, {"removed": "---", "field_name": "cf_status_firefox50", "added": "fixed"}], "who": "cbook@mozilla.com", "when": "2016-06-15T05:31:55Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1315238"}], "who": "yfdyh000@gmail.com", "when": "2016-11-04T15:24:07Z"}], "resolution": "FIXED", "op_sys": "Unspecified", "cf_fx_points": "---", "cf_blocking_fennec": "---"}