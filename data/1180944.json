{"status": "VERIFIED", "cf_tracking_firefox60": "---", "attachments": [{"creator": "adw@mozilla.com", "is_obsolete": 1, "is_patch": 0, "flags": [], "content_type": "text/x-review-board-request", "id": 8762257}, {"creator": "adw@mozilla.com", "is_obsolete": 1, "is_patch": 0, "flags": [], "content_type": "text/x-review-board-request", "id": 8763297}, {"creator": "adw@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2016-07-27T14:39:28Z", "type_id": 748, "creation_date": "2016-07-27T01:28:18Z", "id": 1429759, "setter": "florian@queze.net"}, {"status": "+", "name": "review", "modification_date": "2016-08-02T15:16:36Z", "type_id": 748, "creation_date": "2016-07-27T01:28:47Z", "id": 1429760, "setter": "mak77@bonardo.net"}], "content_type": "text/x-review-board-request", "id": 8767056}, {"creator": "shorlander@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [], "content_type": "image/png", "id": 8769329}, {"creator": "florian@queze.net", "is_obsolete": 1, "is_patch": 1, "flags": [], "content_type": "text/plain", "id": 8774303}], "classification": "Client Software", "creator": "ntim.bugs@gmail.com", "cc": ["6lobe@unseen.is", "adw@mozilla.com", "akashnawaf@gmail.com", "apollo2k4@narod.ru", "dao+bmo@mozilla.com", "dolske@mozilla.com", "elbart@gmx.de", "florian@queze.net", "jhirsch@mozilla.com", "mak77@bonardo.net", "mcastelluccio@mozilla.com", "mchang@mozilla.com", "mhoye@mozilla.com", "milan@mozilla.com", "past@mozilla.com", "quicksaver@gmail.com", "rtanglao@mozilla.com", "shorlander@mozilla.com", "simona.marcu@softvision.ro"], "depends_on": [1297382, 1306270, 1311292, 1358677, 1360227, 1366872, 1369016, 1370000, 1373990, 1292174, 1292321, 1292511, 1292519, 1292630, 1292640, 1293300, 1294110, 1294733, 1294887, 1295253, 1295458, 1295460, 1295463, 1296366, 1297374, 1297395, 1297627, 1297976, 1298047, 1299458, 1300053, 1300649, 1303259, 1303462, 1303781, 1303811, 1306308, 1306639, 1311640, 1311654, 1311998, 1313843, 1313969, 1314643, 1316566, 1327963, 1335992, 1339457, 1343507, 1353831, 1357458, 1358136, 1358676, 1363355, 1363381, 1363407, 1363692, 1369688, 1372528], "creation_time": "2015-07-06T22:42:27Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "cf_status_firefox58": "---", "cf_status_firefox59": "---", "keywords": [], "summary": "Implement one-off searches from Awesomebar", "id": 1180944, "cf_status_firefox51": "verified", "assigned_to_detail": {"email": "adw@mozilla.com", "id": 334927, "name": "adw@mozilla.com", "real_name": "Drew Willcoxon :adw"}, "severity": "normal", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "assigned_to": "adw@mozilla.com", "comment_count": 128, "comments": [{"text": "Prototype add-on : http://t.co/DIaaSE9QrJ", "author": "ntim.bugs@gmail.com", "id": 10461674, "time": "2015-07-06T22:42:27Z"}, {"text": "Are there plans to implement this ? I'd love to do this. The only mockup I've seen so far is this one : http://people.mozilla.org/~shorlander/Flare/Flare-Search-Unification-%28OSX%29-03.png", "author": "ntim.bugs@gmail.com", "id": 10461688, "time": "2015-07-06T22:45:09Z"}, {"text": "I don't know, but Dave (currently in vacations) or Stephen should know :).", "author": "florian@queze.net", "id": 10461776, "time": "2015-07-06T23:01:59Z"}, {"text": "yes, it's planned, see http://people.mozilla.org/~shorlander/mockups/AwesomeResults/AwesomeResults-01.html", "author": "mak77@bonardo.net", "id": 10463171, "time": "2015-07-07T08:48:47Z"}, {"text": "the footer has been hidden in bug 1191520 until this bug is done.", "author": "mak77@bonardo.net", "id": 10594657, "time": "2015-08-08T08:52:32Z"}, {"text": "*** Bug 1194898 has been marked as a duplicate of this bug. ***", "author": "mak77@bonardo.net", "id": 10623019, "time": "2015-08-16T08:08:14Z"}, {"text": "Please enter the search icon on the gray bar. Like in searchbox.\nhttp://zapodaj.net/images/ec579dbcd2f86.png", "author": "dev.lukaszpolowczyk@gmail.com", "id": 10761107, "time": "2015-09-22T15:59:17Z"}, {"text": "https://bugzilla.mozilla.org/show_bug.cgi?id=1206749", "author": "dev.lukaszpolowczyk@gmail.com", "id": 10761113, "time": "2015-09-22T16:00:01Z"}, {"text": "I think this shoulk be re-prioritized based on the fact we stated consistency is a priority", "author": "mak77@bonardo.net", "id": 10902113, "time": "2015-11-04T14:50:14Z"}, {"text": "to avoid complications - moving forward with experiment... and then implement as soon as done - or limit experiment to specific version number and implement in other.", "author": "sescalante@mozilla.com", "id": 10943904, "time": "2015-11-18T17:10:57Z"}, {"text": "*** Bug 1206749 has been marked as a duplicate of this bug. ***", "author": "ntim.bugs@gmail.com", "id": 10943996, "time": "2015-11-18T17:35:21Z"}, {"text": "Created attachment 8762257\nBug 1180944 - Implement one-off searches from Awesomebar\n\nWork in progress.  This factors out the one-off code from the browser-search-autocomplete-result-popup binding in search.xml into its own binding and uses it in both the searchbar and awesomebar.\n\nThe major things left to do are:\n\n* Seamless key handling in the awesomebar\n\n* Change the one-off UI design to match Stephen's spec?  Although I think I'd like to leave that for a follow-up, after we have a single implementation that's used in both places.\n\n* Make sure current searchbar one-off tests still work, write new tests for the awesomebar\n\nReview commit: https://reviewboard.mozilla.org/r/59074/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/59074/", "author": "adw@mozilla.com", "id": 11479775, "time": "2016-06-11T05:56:20Z"}, {"text": "Comment on attachment 8762257\nBug 1180944 - Implement one-off searches from Awesomebar\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/59074/diff/1-2/", "author": "adw@mozilla.com", "id": 11485531, "time": "2016-06-16T01:43:09Z"}, {"text": "That commit:\n\n* Integrates the new binding in the searchbar binding (in addition to integrating it in the urlbar, which the previous commit did)\n\n* Implements key handling that works in both the urlbar and searchbar\n\n* Fixes existing urlbar and searchbar tests, which all pass locally for me\n\nStill need to do:\n\n* Write/update tests for one-offs in the urlbar, probably\n\n* Figure out telemetry: either move it to the new binding so it's in one place, or update the urlbar binding so that it logs telemetry in the new places like the searchbar already does\n\n* Update the one-off UI to match the spec, but I still think it would be a good idea to do that in a follow-up bug or at least a follow-up patch, to lessen the review burden", "author": "adw@mozilla.com", "id": 11485534, "time": "2016-06-16T01:49:51Z"}, {"text": "Try with latest commit (fixes existing tests, no new tests):\n\nhttps://treeherder.mozilla.org/#/jobs?repo=try&revision=c655e11c2678", "author": "adw@mozilla.com", "id": 11485535, "time": "2016-06-16T01:50:04Z"}, {"text": "Oh one other thing the latest commit does is in the urlbar, when the currently selected item is \"foo -- Search with Search Engine\" and you select a one-off (by mouse over for example), the item changes to show the selected engine to show you what will happen when you press Return or click the mouse on the one-off.  That's something that the searchbar doesn't have to worry about.\n\nFor example, if the item is \"foo -- Search with Google\" and you mouse over the Yahoo one-off, then the item changes to \"foo -- Search with Yahoo\".", "author": "adw@mozilla.com", "id": 11485536, "time": "2016-06-16T01:56:42Z"}, {"text": "Comment on attachment 8762257\nBug 1180944 - Implement one-off searches from Awesomebar\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/59074/diff/2-3/", "author": "adw@mozilla.com", "id": 11486018, "time": "2016-06-16T09:53:44Z"}, {"text": "Comment on attachment 8762257\nBug 1180944 - Implement one-off searches from Awesomebar\n\nFlorian, since everything I'm factoring out is code you wrote, would you mind reviewing the browser/components/search/ parts of this?  Feel free to look at the other parts too of course, but I'll ask Marco to look at those since they deal with the urlbar and we've been tag-teaming that recently.\n\nThe only thing left to do is to change the UI so it matches Stephen's spec.  As I say, I'd like to leave that for a follow-up patch, after this initial implementation is r+'ed, since this patch is big enough already.\n\nSummary of changes: I factored out the one-offs into a one-offs binding in search.xml.  I tried to make it generic enough that it could be used in both the urlbar and searchbar.  You can see the main API points at the top of the binding.  Consumers set popup, textbox, and telemetryID properties, and the binding takes it from there.  It adds event listeners to the popup and textbox to update itself properly.\n\nOne hairy part is the handleKeyPress method.  Both the urlbar and searchbar use the one-offs in conjunction with a list, and basically they behave the same, so I wanted a single method that both could call given a key event to update the selection in both the popup list and the one-offs.  They have slightly different needs though because most of the time the urlbar wants there to always be a selection.  One consequence of that is that I added an allowEmptySelection param.", "author": "adw@mozilla.com", "id": 11486020, "time": "2016-06-16T09:54:31Z"}, {"text": "Comment on attachment 8762257\nBug 1180944 - Implement one-off searches from Awesomebar\n\nMarco, would you mind reviewing the non-search parts of this?\n\nbrowser/base/content/\ntoolkit/components/places/\ntoolkit/content/widgets/autocomplete.xml\n\nFeel free to look at the other parts too of course.\n\nI added a vbox to the urlbar panel that's bound to the one-offs binding.\n\nI'm not totally sure how we want to handle telemetry.  This patch still records a search engine action (BrowserSearch.recordSearchInTelemetry()) when you click a searchengine item or when you press Return while a search engine item is selected.  In addition, (a) it records a search engine action when you click a one-off and when you select \"search in new tab\" from the one-off context menu, and (b) if a searchengine item's URL is loaded and a one-off is selected, then one-off telemetry is also recorded (BrowserSearch.recordOneoffSearchInTelemetry()).\n\nI factored out the URL-loading code into _loadURL so that there's one place where the one-off telemetry could be recorded.\n\nI update all the params.engineName values when the selected one-off changes.  I factored out the moz-action creation code into PlacesUtils so I could call it (instead of duplicating it yet again) when doing this.  I also had to change the initial \"type\" attribute on richlistitems to \"originalType\", since we modify the \"type\" attribute.", "author": "adw@mozilla.com", "id": 11486022, "time": "2016-06-16T09:55:20Z"}, {"text": "(In reply to Drew Willcoxon :adw from comment #17)\n\n> The only thing left to do is to change the UI so it matches Stephen's spec.\n\nWhich spec is this?\n\n> As I say, I'd like to leave that for a follow-up patch, after this initial\n> implementation is r+'ed, since this patch is big enough already.\n\nSure, the smaller the patches, the better.", "author": "florian@queze.net", "id": 11486130, "time": "2016-06-16T10:56:37Z"}, {"text": "(In reply to Florian Qu\u00e8ze [:florian] [:flo] from comment #19)\n> Which spec is this?\n\nhttp://people.mozilla.org/~shorlander/mockups/AwesomeResults/AwesomeResults-01.html from comment 3.\n\n> Sure, the smaller the patches, the better.\n\nYeah, I probably should have split this one up into a search part and a urlbar part. :-/", "author": "adw@mozilla.com", "id": 11486661, "time": "2016-06-16T15:44:51Z"}, {"text": "Are we removing the search engine icons colors? Apart from the fact it makes harder to recognize engines quickly, can we actually change how we show their TM-ed logos?", "author": "mak77@bonardo.net", "id": 11487367, "time": "2016-06-17T09:12:06Z"}, {"text": "Created attachment 8763297\nBug 1180944 - Implement one-off searches from Awesomebar.\n\nMore big changes for you Marco, sorry...\n\nThe previous commit didn't handle engine changes completely right.  For example, if you typed something, hit Tab to select a one-off, typed some more, and hit Return, the search would happen with the current engine, not the selected one-off.\n\nThe bottom line is that one-offs make the engineName included in the moz-action URI by UnifiedComplete pretty meaningless.  It can't be a static thing anymore.  So when a new one-off is selected, should we change the value of all searchengine results in the autocomplete controller, or the front end?  (If we don't change them at all, that's kind of basically the same as changing them in the front end since ultimately the URL that's loaded had better match the selected one-off.)\n\nThis commit does it in the front end.  The autocomplete popup now has an overrideSearchEngineName property that _adjustAcItem checks.  If the property is non-null, then _adjustAcItem changes its item's url attribute and the engine name in its label.\n\nhandleCommand in urlbar now uses the url attribute of the selected popup item when loading URLs.  If there's no selection, then it uses the input value as before.  At first I tried keeping input.value (or _value) up to date for the selected item, but that was a pain.  I think it's simpler to keep the url attributes of items updated and then use those.\n\nBut since handleCommand can be called when the popup is already closed, I modified the relevant idl to pass a selected popup index to it.\n\nThis commit also funnels all URL loads in urlbar through handleCommand.  And it splits out the continueOperation nested function into its own method called _loadURL.\n\nSince handleEnter ends up calling handleCommand, and handle command needs an event to determine where to open the URL, I modified handleEnter to take an event.\n\nI think these two idl changes make sense in general, not only for this bug.\n\nFor the value -> textValue changes in the tests, I made those changes when I was trying to keep input.value up to date.  I'm not sure they're necessary anymore, but they seem like good changes anyway?  Since textValue will always be what the user sees, but value may be a moz-action URI.\n\nReview commit: https://reviewboard.mozilla.org/r/59540/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/59540/", "author": "adw@mozilla.com", "id": 11488418, "time": "2016-06-18T04:56:23Z"}, {"text": "Comment on attachment 8762257\nBug 1180944 - Implement one-off searches from Awesomebar\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/59074/diff/3-4/", "author": "adw@mozilla.com", "id": 11488419, "time": "2016-06-18T04:56:23Z"}, {"text": "Well I switched from mq to bookmarks and of course I screwed up the review push.  I hate computers.  If you started reviewing the previous commit let me know and I'll try to untangle it from the new commit on Review Board.", "author": "adw@mozilla.com", "id": 11488420, "time": "2016-06-18T05:01:58Z"}, {"text": "Review Board is the worst.  The worst Jerry.  This is the URL that shows the diff slider thing with all the review commits: https://reviewboard.mozilla.org/r/59072/diff/5#index_header\n\nI have no idea how to ask for review for that series of commits as a whole.  Which is what I want to do.", "author": "adw@mozilla.com", "id": 11488423, "time": "2016-06-18T05:20:56Z"}, {"text": "(In reply to Drew Willcoxon :adw from comment #25)\n> I have no idea how to ask for review for that series of commits as a whole. \n> Which is what I want to do.\n\nwhat I do usually is just having a series of commits with r=reviewer (even if it warns cause it can rewrite the reviewer on push, I just ignore it, it's dumb) and I just push the range of commits to mozreview (hg push -r c1:cN review). To update patches better to use the evolve extension. I never had a problem with that.\nI don't use bookmarks, unless you use bookmarkbinder extension using bookmarks is not useful. I just use heads, one head per feature, use hg wip to check status and rebase when needed.", "author": "mak77@bonardo.net", "id": 11488490, "time": "2016-06-18T09:43:11Z"}, {"text": "my workflow is not particularly advanced, but if you still have issues we can setup a vidyo session and go through it.", "author": "mak77@bonardo.net", "id": 11488493, "time": "2016-06-18T09:45:37Z"}, {"text": "Comment on attachment 8762257\nBug 1180944 - Implement one-off searches from Awesomebar\n\nClearing review for one of these, didn't mean to ask for both.  The second revision is just an iteration on the first one.\n\nAlso according to try it looks like I missed some native callers for the idl I changed, so I need to fix that.", "author": "adw@mozilla.com", "id": 11490606, "time": "2016-06-20T16:36:03Z"}, {"text": "Try with the native implementor (not caller) fixed:\n\nhttps://treeherder.mozilla.org/#/jobs?repo=try&revision=b258c0a59476", "author": "adw@mozilla.com", "id": 11490630, "time": "2016-06-20T16:45:36Z"}, {"text": "https://treeherder.mozilla.org/#/jobs?repo=try&revision=32e7e99ed196", "author": "adw@mozilla.com", "id": 11491123, "time": "2016-06-20T21:12:17Z"}, {"text": "https://reviewboard.mozilla.org/r/59074/#review57042\n\nit's huge, may take some review passes. So far I have doubts regarding some behaviors that would probably be better to clarify.\n\n::: browser/base/content/test/urlbar/browser_autocomplete_autoselect.js:11\n(Diff revision 4)\n>  \n>  function is_selected(index) {\n>    is(gURLBar.popup.richlistbox.selectedIndex, index, `Item ${index + 1} should be selected`);\n> +\n> +  // This is true because although both the listbox and the one-offs can have\n> +  // selections, the test doesn't check that.\n\nI *think* I disagree about the fact both the listbox and one-off can have a selection... Why should be like that? it's bogus enough in the search bar where the treebody selection is completely ignored (so why it exists at all?)\n\n::: browser/base/content/urlbarBindings.xml:448\n(Diff revision 4)\n> +        <parameter name=\"triggeringEvent\"/>\n> +        <parameter name=\"url\"/>\n> +        <parameter name=\"where\"/>\n> +        <parameter name=\"overrideParams\"/>\n> +        <body><![CDATA[\n> +          let current = where == \"current\";\n\nnit: I'm not sure I see the usefulness of this caching, it just seems to hide code for very small benefit. I'd just use where (!=)= \"current\" in the 3 conditions\n\n::: browser/base/content/urlbarBindings.xml:461\n(Diff revision 4)\n> +              allowPinnedTabHostChange: true,\n> +              allowPopups: url.startsWith(\"javascript:\"),\n> +            };\n> +          } else {\n> +            params = {\n> +              allowThirdPartyFixup: true,\n\nnit: since allowThirdPartyFixup is the same, you could compact the code a little bit:\nlet params = { allowThird... }\nif (where == \"current\") {\n  params.indicateError... = true;\n  ...\n} else {\n  params.initiatingDoc = ...;\n}\n\n::: browser/base/content/urlbarBindings.xml:472\n(Diff revision 4)\n> +            for (let key in overrideParams) {\n> +              params[key] = overrideParams[key];\n> +            }\n> +          }\n> +\n> +          let action = this._parseActionUrl(this.value);\n\nI suppose you want to parse the action before an eventual handleRevert call, and that handleRevert is cause we are opening elsewhere...\nBut it would be nice if all of this would be in a comment\n\n::: browser/base/content/urlbarBindings.xml:489\n(Diff revision 4)\n> +              this.handleRevert();\n> +            }\n> +          }\n> +\n> +          if (current) {\n> +            // Ensure the start of the URL is visible for UX reasons:\n\nnit: s/UX/usability/ and s/:/./\n\n::: browser/base/content/urlbarBindings.xml:495\n(Diff revision 4)\n> +            this.selectionStart = this.selectionEnd = 0;\n> +          }\n> +\n> +          // Record one-off search telemetry if appropriate.\n> +          if (action && action.type == \"searchengine\") {\n> +            this.popup.oneOffSearchButtons.recordTelemetry(triggeringEvent,\n\nDoes this work differently from the search bar?\nCause in the searchbar the default engine doesn't have a one-off button.\nAnd \"searchengine\" actions are often coming from the default engine.\nMoreover, \"searchengine\" action is also used by search suggestions, restyled searches (currently disabled), aliases, so looks like this ends up counting as oneoff some stuff that is not.\n\nIf the filtering happens later, I'd rather rename to maybeRecordTelemetry, but off-hand I'd prefer some filtering code to be here cause as-is it sounds error-prone.\n\n::: browser/base/content/urlbarBindings.xml:1392\n(Diff revision 4)\n>            this.mInput = aInput;\n>            this.selectedIndex = this._isFirstResultHeuristic ? 0 : -1;\n>            this.view = aInput.controller.QueryInterface(Components.interfaces.nsITreeView);\n> +          this.oneOffSearchButtons.popup = this;\n> +          this.oneOffSearchButtons.textbox = this.input;\n> +          this.oneOffSearchButtons.telemetryID = \"urlbar\";\n\nnit: s/telemetryID/telemetryOrigin/\n\n::: browser/base/content/urlbarBindings.xml:1619\n(Diff revision 4)\n> +              break;\n> +            }\n> +            let url = item.getAttribute(\"url\");\n> +            if (url) {\n> +              let action = item._parseActionUrl(url);\n> +              if (action && action.type == \"searchengine\") {\n\nHm, this means we may get search suggestions from google, but then pass them to another engine.\nWe never thought about it honestly, and I don't know if there are agreements regarding suggestions in the awesomebar.\nOn the other side, the search bar works differently, one-off buttons only act on the typed value, so off-hand looks like here at a maximum we'd need to update the currently selected row.\nEven if I select an entry with the mouse, and directly move to a oneoff, I expect the oneoff to execute a search for the original text in the input field, not what I selected.\n\n::: browser/base/content/urlbarBindings.xml:1635\n(Diff revision 4)\n> +          }\n> +\n> +          // The urlbar uses its _value property (via value) to determine where\n> +          // to go when you press Return, so update it too.\n> +          if (selectedNewURL) {\n> +            this.input._value = selectedNewURL;\n\nIf I have a mouse selection and click on a one-off (with mouse acrobatics), I don't expect to go to the selected value... On the other side if I selected with the keyboard the value to search is already in the input field.\n\n::: browser/base/content/urlbarBindings.xml:1646\n(Diff revision 4)\n> +           search buttons and between the one-offs and the listbox.  It returns\n> +           true if the keypress was consumed and false if not. -->\n> +      <method name=\"handleKeyPress\">\n> +        <parameter name=\"aEvent\"/>\n> +        <body><![CDATA[\n> +          this.oneOffSearchButtons.handleKeyPress(aEvent, this._matchCount,\n\ndoes this also cover the search settings gear? it should be reachable by keyboard.\n\n::: toolkit/content/widgets/autocomplete.xml:1276\n(Diff revision 4)\n>              // so that we can use them from the constructor\n>              let iconURI = controller.getImageAt(this._currentIndex);\n>              item.setAttribute(\"image\", iconURI);\n>              item.setAttribute(\"url\", url);\n>              item.setAttribute(\"title\", controller.getCommentAt(this._currentIndex));\n> -            item.setAttribute(\"type\", controller.getStyleAt(this._currentIndex));\n> +            item.setAttribute(\"originaltype\", controller.getStyleAt(this._currentIndex));\n\nwhat's this change about?", "author": "mak77@bonardo.net", "id": 11494734, "time": "2016-06-22T11:40:04Z"}, {"text": "Thanks Marco!\n\n(In reply to Marco Bonardo [::mak] from comment #31)\n> ::: browser/base/content/test/urlbar/browser_autocomplete_autoselect.js:11\n> (Diff revision 4)\n> >  \n> >  function is_selected(index) {\n> >    is(gURLBar.popup.richlistbox.selectedIndex, index, `Item ${index + 1} should be selected`);\n> > +\n> > +  // This is true because although both the listbox and the one-offs can have\n> > +  // selections, the test doesn't check that.\n> \n> I *think* I disagree about the fact both the listbox and one-off can have a\n> selection... Why should be like that? it's bogus enough in the search bar\n> where the treebody selection is completely ignored (so why it exists at all?)\n\nA couple points:\n\n(1) It's useful for keyboard users.  You can have a selection the main list and then hit Tab or Alt+Up/Down to cycle through the one-offs.  And then you can hit Up/Down to change the main selection.\n\n(2) In this bug I'd prefer to simply factor out the search.xml one-off code and use it in the awesomebar.  I'm completely fine with questioning how one-offs work but I think we should do that in follow-ups -- unless we want different behavior in the searchbar and awesomebar.  In that case then sure, let's decide what the differences for the awesomebar are here in this bug.  But I haven't heard Stephen or anyone mention any differences.\n\n> > +          let current = where == \"current\";\n> \n> nit: I'm not sure I see the usefulness of this caching, it just seems to\n> hide code for very small benefit. I'd just use where (!=)= \"current\" in the\n> 3 conditions\n\nFair enough, I usually do this kind of thing whenever a string is involved just to avoid typos within the string (not necessarily for the patch in question but more for maintenance), which would result in silent logic errors.\n\n> ::: browser/base/content/urlbarBindings.xml:495\n> (Diff revision 4)\n> > +            this.selectionStart = this.selectionEnd = 0;\n> > +          }\n> > +\n> > +          // Record one-off search telemetry if appropriate.\n> > +          if (action && action.type == \"searchengine\") {\n> > +            this.popup.oneOffSearchButtons.recordTelemetry(triggeringEvent,\n> \n> Does this work differently from the search bar?\n> Cause in the searchbar the default engine doesn't have a one-off button.\n\nThat's right, and it's the same here.\n\n> And \"searchengine\" actions are often coming from the default engine.\n> Moreover, \"searchengine\" action is also used by search suggestions, restyled\n> searches (currently disabled), aliases, so looks like this ends up counting\n> as oneoff some stuff that is not.\n\nSorry, I changed this in the newer commit (https://reviewboard.mozilla.org/r/59540/diff/#index_header).  I need to completely redo the review request so you're looking at \"diff revisions\" and not commits on Review Board.\n\n> ::: browser/base/content/urlbarBindings.xml:1619\n> (Diff revision 4)\n> > +              break;\n> > +            }\n> > +            let url = item.getAttribute(\"url\");\n> > +            if (url) {\n> > +              let action = item._parseActionUrl(url);\n> > +              if (action && action.type == \"searchengine\") {\n> \n> Hm, this means we may get search suggestions from google, but then pass them\n> to another engine.\n> We never thought about it honestly, and I don't know if there are agreements\n> regarding suggestions in the awesomebar.\n\nThat's true.\n\n> On the other side, the search bar works differently, one-off buttons only\n> act on the typed value, so off-hand looks like here at a maximum we'd need\n> to update the currently selected row.\n\nI don't think this is true though.  Type something in the search bar, hit the Down key a few times.  The textbox's value is replaced with the newly selected row.  Then Tab to select a one-off, then Return.  You end up doing a search on the one-off engine but using the suggestion that came from your default engine.\n\nBut like you say, maybe there's some legal/contractual difference for the awesomebar?\n\n> Even if I select an entry with the mouse, and directly move to a oneoff, I\n> expect the oneoff to execute a search for the original text in the input\n> field, not what I selected.\n\nHmm, I need to fix that.  That behavior is different from what the searchbar does.\n\n> ::: browser/base/content/urlbarBindings.xml:1646\n> (Diff revision 4)\n> > +           search buttons and between the one-offs and the listbox.  It returns\n> > +           true if the keypress was consumed and false if not. -->\n> > +      <method name=\"handleKeyPress\">\n> > +        <parameter name=\"aEvent\"/>\n> > +        <body><![CDATA[\n> > +          this.oneOffSearchButtons.handleKeyPress(aEvent, this._matchCount,\n> \n> does this also cover the search settings gear? it should be reachable by\n> keyboard.\n\nYes.\n\n> ::: toolkit/content/widgets/autocomplete.xml:1276\n> (Diff revision 4)\n> >              // so that we can use them from the constructor\n> >              let iconURI = controller.getImageAt(this._currentIndex);\n> >              item.setAttribute(\"image\", iconURI);\n> >              item.setAttribute(\"url\", url);\n> >              item.setAttribute(\"title\", controller.getCommentAt(this._currentIndex));\n> > -            item.setAttribute(\"type\", controller.getStyleAt(this._currentIndex));\n> > +            item.setAttribute(\"originaltype\", controller.getStyleAt(this._currentIndex));\n> \n> what's this change about?\n\n_adjustAcItem is now potentially called multiple times per list item, since the item's searchengine is updated when the selected one-off changes.  But _adjustAcItem changes the item's type attribute -- it parses the attribute, removes some types, concats the remaining types, and then sets the attribute to that new value.  So every time after the first time that _adjustAcItem is called, the type attribute is missing info that's necessary to set up the item.  So this new originaltype is specifically never changed.", "author": "adw@mozilla.com", "id": 11499705, "time": "2016-06-24T01:00:54Z"}, {"text": "(In reply to Drew Willcoxon :adw from comment #32)\n> > I *think* I disagree about the fact both the listbox and one-off can have a\n> > selection... Why should be like that? it's bogus enough in the search bar\n> > where the treebody selection is completely ignored (so why it exists at all?)\n> \n> A couple points:\n> \n> (1) It's useful for keyboard users.  You can have a selection the main list\n> and then hit Tab or Alt+Up/Down to cycle through the one-offs.  And then you\n> can hit Up/Down to change the main selection.\n\nI still don't see the point of updating ALL entries  rather than just the selected one...\n\n> (2) In this bug I'd prefer to simply factor out the search.xml one-off code\n> and use it in the awesomebar.  I'm completely fine with questioning how\n> one-offs work but I think we should do that in follow-ups\n\nsure, that sounds fine. But the patch seems to add more complication than what the searchbar does by trying to keep all the search entries updated, rather than the currently selected one.\nThe bavior is definitely something that will require follow ups.\n\n> Sorry, I changed this in the newer commit\n> (https://reviewboard.mozilla.org/r/59540/diff/#index_header).  I need to\n> completely redo the review request so you're looking at \"diff revisions\" and\n> not commits on Review Board.\n\nHm, I guess I'm lost :D\n\n> > ::: browser/base/content/urlbarBindings.xml:1619\n> > On the other side, the search bar works differently, one-off buttons only\n> > act on the typed value, so off-hand looks like here at a maximum we'd need\n> > to update the currently selected row.\n> \n> I don't think this is true though.  Type something in the search bar, hit\n> the Down key a few times.  The textbox's value is replaced with the newly\n> selected row.  Then Tab to select a one-off, then Return.  You end up doing\n> a search on the one-off engine but using the suggestion that came from your\n> default engine.\n\nWith tab that works, not with the mouse. It's a mess.\n\n> > ::: toolkit/content/widgets/autocomplete.xml:1276\n> So this new originaltype is specifically never changed.\n\nFor whatever reasons I couldn't find the point where originaltype was used.. maybe a problem with the review chageset. Now I saw it.\nI wonder though if this may break other toolkit consumers, and we should rather make our own \"parsedType\". off-hand I don't think it's being used often in the wild, but if it's easy to do the opposite, maybe we should try.", "author": "mak77@bonardo.net", "id": 11500291, "time": "2016-06-24T09:59:39Z"}, {"text": "(In reply to Marco Bonardo [::mak] from comment #33)\n\n> > > ::: browser/base/content/urlbarBindings.xml:1619\n> > > On the other side, the search bar works differently, one-off buttons only\n> > > act on the typed value, so off-hand looks like here at a maximum we'd need\n> > > to update the currently selected row.\n> > \n> > I don't think this is true though.  Type something in the search bar, hit\n> > the Down key a few times.  The textbox's value is replaced with the newly\n> > selected row.  Then Tab to select a one-off, then Return.  You end up doing\n> > a search on the one-off engine but using the suggestion that came from your\n> > default engine.\n> \n> With tab that works, not with the mouse. It's a mess.\n\nIt doesn't work with the mouse because (unless you carefully avoid it) you have to hover suggestions before having the mouse above a one-off button to click it. The tab key skips the suggestions, so the only way to have a suggestion selected when using a one-off with tab is to have used both up/down and tab, ie. you are a keyboard user who knows what (s)he is doing.", "author": "florian@queze.net", "id": 11504659, "time": "2016-06-27T15:45:31Z"}, {"text": "https://reviewboard.mozilla.org/r/59072/#review57664\n\nThis is a first review pass by code inspection only, I haven't tried the patch this time. Comments are mostly about details, the approach seems reasonable, and I haven't seen anything scary.\n\n::: browser/base/content/test/urlbar/browser_urlbarOneOffs.js:206\n(Diff revision 5)\n> +\n> +  gBrowser.removeTab(gBrowser.selectedTab);\n> +});\n> +\n> +\n> +function assertState(result, oneOff, textValue=undefined) {\n\nnit: spaces around '='.\n\n::: browser/base/content/urlbarBindings.xml:402\n(Diff revision 5)\n> +          let mayInheritPrincipal = false;\n> +          let postData = null;\n> +          let lastLocationChange = gBrowser.selectedBrowser.lastLocationChange;\n>            let matchLastLocationChange = true;\n> +\n> +let action = this._parseActionUrl(url);\n\nPlease fix the indent here.\n\n::: browser/components/search/content/search.xml:376\n(Diff revision 5)\n> +        <body><![CDATA[\n> +          var textBox = this._textbox;\n> +          var textValue = textBox.value;\n> +\n>            let selection = this.telemetrySearchDetails;\n> -          this.doSearch(textValue, where, aEngine);\n> +          this.doSearch(textValue, aWhere, aEngine);\n\nDid you mean to also pass aParams here?\n\n::: browser/components/search/content/search.xml\n(Diff revision 5)\n> -              this.selectedButton = null;\n> -\n> -            if (this.selectedButton || aCycleEngines || suggestionsHidden)\n> -              return true;\n> -\n> -            // Set the selectedIndex to something that will make\n\nWhy is this code block no longer needed?\n\n::: browser/components/search/content/search.xml:840\n(Diff revision 5)\n>        })]]></field>\n>      </implementation>\n>  \n>      <handlers>\n> +      <handler event=\"input\"><![CDATA[\n> +        if (!this.value) {\n\nDo we need this test, and why is it reverted compared to the if (textbox.value) self.removeAttribute(\"showonlysettings\"); we had before?\n\n::: browser/components/search/content/search.xml:1044\n(Diff revision 5)\n> -            this.selectedButton &&\n> -            this.selectedButton.classList.contains(\"searchbar-engine-one-off-item\");\n> -          // Typing de-selects the settings or opensearch buttons at the bottom\n> -          // of the search panel, as typing shows the user intends to search.\n> -          if (this.selectedButton && !isOneOffSelected)\n> -            this.selectedButton = null;\n> +    </content>\n> +  </binding>\n> +\n> +\n> +  <binding id=\"search-one-offs\">\n> +\n\nnit: the empty line here doesn't help readability and is inconsistent with the other bindings in the file.\n\n::: browser/components/search/content/search.xml:1097\n(Diff revision 5)\n> +    </content>\n> +\n> +    <implementation implements=\"nsIDOMEventListener\">\n> +\n> +      <!-- Width in pixels of the one-off buttons. -->\n> +      <property name=\"buttonWidth\" readonly=\"true\">\n\nLooks like you can use the shorter onget=\"return 49;\" syntax here, and merge the 2 comments.\n\n::: browser/components/search/content/search.xml:1141\n(Diff revision 5)\n> +            }\n> +          }\n> +          return val;\n> +        ]]></setter>\n> +      </property>\n> +      <field name=\"_popup\"><![CDATA[\n\nYou don't need the CDATA tag here, it can fit on one line:\n<field name=\"_popup\">null</field>\nThis comment also applies to the next few fields.\n\nAlso, I tend to find it more readable when the _ prefixed field is right before the property, rather than after it, but it may just be my personal preference.\n\n::: browser/components/search/content/search.xml:1145\n(Diff revision 5)\n> +      </property>\n> +      <field name=\"_popup\"><![CDATA[\n> +        null\n> +      ]]></field>\n> +\n> +      <!-- The textbox associated with the one-offs.  May be null/undefined, and\n\nIt seems this is set for both the urlbar and the searchbar, so what's the case in which it is null?\n\n::: browser/components/search/content/search.xml:1146\n(Diff revision 5)\n> +      <field name=\"_popup\"><![CDATA[\n> +        null\n> +      ]]></field>\n> +\n> +      <!-- The textbox associated with the one-offs.  May be null/undefined, and\n> +           in that case you should update the query property manually. -->\n\n\n\n::: browser/components/search/content/search.xml:1152\n(Diff revision 5)\n> +      <property name=\"textbox\">\n> +        <getter><![CDATA[\n> +          return this._textbox;\n> +        ]]></getter>\n> +        <setter><![CDATA[\n> +          if (this._textbox != val) {\n\nnit: I would prefer an early return instead of indenting the whole content of the setter (also applies to the \"popup\" setter).\n\n::: browser/components/search/content/search.xml:1242\n(Diff revision 5)\n> +        ]]></getter>\n> +      </property>\n> +\n> +      <!-- The number of one-offs, including the add-engine button (if shown)\n> +           and the search-settings button. -->\n> +      <property name=\"numButtons\" readonly=\"true\">\n\nI don't really see the point of exposing this, when it seemed to only be used by tests, and given that getSelectableButtons is exposed.\n\n::: browser/components/search/content/search.xml:1289\n(Diff revision 5)\n> +      <!-- This handles events outside the one-off buttons, like on the popup\n> +           and textbox. -->\n> +      <method name=\"handleEvent\">\n> +        <parameter name=\"event\"/>\n> +        <body><![CDATA[\n> +        switch (event.type) {\n\nnit: I think everywhere else in the file the content of the body is indented.\n\n::: browser/components/search/content/search.xml:1522\n(Diff revision 5)\n> +          this.dispatchEvent(event);\n> +        ]]></body>\n> +      </method>\n> +\n> +      <method name=\"getSelectableButtons\">\n> +        <parameter name=\"aIncludeSettingsButton\"/>\n\nThis parameter name is misleading: the add-engine open search items aren't the \"Settings\" button.\n\n::: browser/components/search/content/search.xml:1547\n(Diff revision 5)\n> +                                                               \"search-settings\"));\n> +          return buttons;\n> +        ]]></body>\n> +      </method>\n> +\n> +      <method name=\"handleSearchCommand\">\n\nYou have this method that's an almost duplicate of the method with the same name on the other binding. Copy/paste accident?\n\n::: browser/components/search/content/search.xml:1602\n(Diff revision 5)\n> +               index will cause the last one-off to become selected and this\n> +               method to return true.  Only the aForward=false case is affected\n> +               because it is always the case that if aForward=true and there\n> +               currently is no selection, the first one-off becomes selected and\n> +               this method returns true.\n> +        @param aIncludeSettingsButton\n\nThis was called aCycleEngine, because it was really about cycling through the list of one-off engines (using alt+up/down), excluding everything else, not just the \"settings\" button.\n\n::: browser/components/search/content/search.xml:1638\n(Diff revision 5)\n> +              return true;\n> +\n> +            return false;\n> +          }\n> +\n> +          if (!selectedButton) {\n\nThis test will always pass, won't it?\n\n::: browser/components/search/content/search.xml:1721\n(Diff revision 5)\n> +                  stopEvent = this.advanceSelection(false, true, true);\n> +                  if (stopEvent) {\n> +                    this.popup.selectedIndex = -1;\n> +                  }\n> +                }\n> +              } else if (this.firstButtonSelected(true)) {\n\nThis is the only call for \"firstButtonSelected\", so maybe this should be inlined?\nIf not, it should probably be _ prefixed.\n\n::: browser/components/search/content/search.xml:1748\n(Diff revision 5)\n> +                  }\n> +                  if (!allowEmptySelection) {\n> +                    this.popup.selectedIndex = -1;\n> +                  }\n> +                }\n> +              } else if (this.lastButtonSelected(true)) {\n\nSame here.\n\n::: browser/components/search/content/search.xml:1939\n(Diff revision 5)\n>          // require manual hiding.\n> -        this.hidePopup();\n> +        this.popup.hidePopup();\n>  \n> -        let searchbar = document.getElementById(\"searchbar\");\n> -        searchbar.handleSearchCommand(event, engine);\n> +        // Make sure the clicked button is selected.  In practice this should\n> +        // always be the case since you have to mouse over the button to click\n> +        // it, and the mouseover handler selects the button.  So mostly this is\n\nIsn't the mouseover handler only changing the visible selection without changing the actual selection?\n\n::: browser/components/search/content/search.xml:1949\n(Diff revision 5)\n>        ]]></handler>\n>  \n>        <handler event=\"command\"><![CDATA[\n>          let target = event.originalTarget;\n>          if (target.classList.contains(\"addengine-item\")) {\n> -          // On success, hide and reshow the panel to show the new engine.\n> +          // On success, hide the panel and tell event listeners to reshow it to\n\nIt seems you have now figured out how to update the panel while it's already open, so can we change this to just be a call to your new _rebuild method?\n\n::: browser/components/search/content/search.xml:1955\n(Diff revision 5)\n> +          // show the new engine.\n>            let installCallback = {\n> -            onSuccess: function(engine) {\n> -              event.target.hidePopup();\n> -              BrowserSearch.searchBar.openSuggestionsPanel();\n> +            onSuccess: engine => {\n> +              this.popup.hidePopup();\n> +              let event = document.createEvent(\"Events\");\n> +              event.initEvent(\"OneOffsEngineInstalled\", true, false);\n\n\n\n::: toolkit/components/autocomplete/nsIAutoCompleteController.idl:76\n(Diff revision 5)\n> +   *        the user pressed the Return key or a click event if the user clicked\n> +   *        a popup item.\n>     * @return True if the controller wishes to prevent event propagation and default event\n>     */\n> -  boolean handleEnter(in boolean aIsPopupSelection);\n> +  boolean handleEnter(in boolean aIsPopupSelection,\n> +                      in nsIDOMEvent aEvent);\n\nWhat about tagging this as [optional] in the interface so that you don't have to pass null parameters in all existing callers?", "author": "florian@queze.net", "id": 11509501, "time": "2016-06-28T23:28:43Z"}, {"text": "Comment on attachment 8763297\nBug 1180944 - Implement one-off searches from Awesomebar.\n\n(In reply to Florian Qu\u00e8ze [:florian] [:flo] from comment #35)\n\nPlease ignore these 2 empty comments, for some reason mozreview didn't let me delete them:\n\n> ::: browser/components/search/content/search.xml:1146\n> (Diff revision 5)\n> > +      <field name=\"_popup\"><![CDATA[\n> > +        null\n> > +      ]]></field>\n> > +\n> > +      <!-- The textbox associated with the one-offs.  May be null/undefined, and\n> > +           in that case you should update the query property manually. -->\n> \n> \n> \n\n> ::: browser/components/search/content/search.xml:1955\n> (Diff revision 5)\n> > +          // show the new engine.\n> >            let installCallback = {\n> > -            onSuccess: function(engine) {\n> > -              event.target.hidePopup();\n> > -              BrowserSearch.searchBar.openSuggestionsPanel();\n> > +            onSuccess: engine => {\n> > +              this.popup.hidePopup();\n> > +              let event = document.createEvent(\"Events\");\n> > +              event.initEvent(\"OneOffsEngineInstalled\", true, false);\n> \n> \n>", "author": "florian@queze.net", "id": 11509505, "time": "2016-06-28T23:31:14Z"}, {"text": "Comment on attachment 8762257\nBug 1180944 - Implement one-off searches from Awesomebar\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/59074/diff/4-5/", "author": "adw@mozilla.com", "id": 11516253, "time": "2016-07-01T05:27:39Z"}, {"text": "Comment on attachment 8762257\nBug 1180944 - Implement one-off searches from Awesomebar\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/59074/diff/5-6/", "author": "adw@mozilla.com", "id": 11516259, "time": "2016-07-01T05:30:59Z"}, {"text": "Comment on attachment 8762257\nBug 1180944 - Implement one-off searches from Awesomebar\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/59074/diff/6-7/", "author": "adw@mozilla.com", "id": 11516260, "time": "2016-07-01T05:32:34Z"}, {"text": "Comment on attachment 8762257\nBug 1180944 - Implement one-off searches from Awesomebar\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/59074/diff/7-8/", "author": "adw@mozilla.com", "id": 11516263, "time": "2016-07-01T05:39:23Z"}, {"text": "Created attachment 8767056\nBug 1180944 - Implement one-off searches from Awesomebar.\n\nReview commit: https://reviewboard.mozilla.org/r/61768/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/61768/", "author": "adw@mozilla.com", "id": 11516271, "time": "2016-07-01T05:56:45Z"}, {"text": "Comment on attachment 8767056\nBug 1180944 - Implement one-off searches from Awesomebar.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/61768/diff/1-2/", "author": "adw@mozilla.com", "id": 11516275, "time": "2016-07-01T05:58:21Z"}, {"text": "Very sorry for the bugspam.  This review request has two diffs.  The first is the entire diff of the previous review requests/commits that I botched.  The second is the changes I made to address your comments.\n\nMarco, you probably want to look at both diffs since the part I screwed up last time was mostly code for your review.  The first diff will contain some changes you already looked at.\n\nFlorian, you should be able to look at only the second diff I think, since the part I screwed up last time had only a small amount of code for you to look at, and I think you looked at it but I'm not sure.", "author": "adw@mozilla.com", "id": 11516279, "time": "2016-07-01T06:04:32Z"}, {"text": "(In reply to Marco Bonardo [::mak] from comment #33)\n> I still don't see the point of updating ALL entries  rather than just the\n> selected one...\n\nIt makes the code simpler I think.  Otherwise we'd need to update the selected entry in two places: (1) when the selected one-off changes, and (2) when the selected entry changes.  But let me know what you think after looking at the latest patches.", "author": "adw@mozilla.com", "id": 11516281, "time": "2016-07-01T06:09:05Z"}, {"text": "(In reply to Florian Qu\u00e8ze [:florian] [:flo] from comment #35)\n> ::: browser/components/search/content/search.xml\n> (Diff revision 5)\n> > -              this.selectedButton = null;\n> > -\n> > -            if (this.selectedButton || aCycleEngines || suggestionsHidden)\n> > -              return true;\n> > -\n> > -            // Set the selectedIndex to something that will make\n> \n> Why is this code block no longer needed?\n\nI don't understand what that block is doing.  Do you think it's really necessary anymore?  Also, the urlbar and searchbar have different requirements for selected popup items: the urlbar should always have a selection (unless it's showing the history popup), so setting `popup.selectedIndex = popup.view.rowCount` isn't ever right for it.\n\n> ::: browser/components/search/content/search.xml:840\n> (Diff revision 5)\n> >        })]]></field>\n> >      </implementation>\n> >  \n> >      <handlers>\n> > +      <handler event=\"input\"><![CDATA[\n> > +        if (!this.value) {\n> \n> Do we need this test, and why is it reverted compared to the if\n> (textbox.value) self.removeAttribute(\"showonlysettings\"); we had before?\n\nHmm, that looks like an error.  I removed the test.\n\n> ::: browser/components/search/content/search.xml:1145\n> (Diff revision 5)\n> > +      </property>\n> > +      <field name=\"_popup\"><![CDATA[\n> > +        null\n> > +      ]]></field>\n> > +\n> > +      <!-- The textbox associated with the one-offs.  May be null/undefined, and\n> \n> It seems this is set for both the urlbar and the searchbar, so what's the\n> case in which it is null?\n\nIt is, the comment is just saying \"you can leave this null if you want\".  It turned out that factoring out the one-off code meant that it's no longer tightly coupled to a textbox, and hypothetically we could use it without a textbox.  That seems interesting and maybe useful down the line, but I can remove the comment altogether if you want.  I did update it to be more clear hopefully.\n\n> ::: browser/components/search/content/search.xml:1547\n> (Diff revision 5)\n> > +                                                               \"search-settings\"));\n> > +          return buttons;\n> > +        ]]></body>\n> > +      </method>\n> > +\n> > +      <method name=\"handleSearchCommand\">\n> \n> You have this method that's an almost duplicate of the method with the same\n> name on the other binding. Copy/paste accident?\n\nNot an accident, they're different.  One is on the searchbar binding.  It's called when you click the search arrow button and hit Return in the textbox.  The other is on the one-offs binding and is called when you interact with the one-offs.  Neither one depends on the other, so I don't think there's an opportunity to combine them into one method or something like that.\n\n> ::: browser/components/search/content/search.xml:1949\n> (Diff revision 5)\n> >        ]]></handler>\n> >  \n> >        <handler event=\"command\"><![CDATA[\n> >          let target = event.originalTarget;\n> >          if (target.classList.contains(\"addengine-item\")) {\n> > -          // On success, hide and reshow the panel to show the new engine.\n> > +          // On success, hide the panel and tell event listeners to reshow it to\n> \n> It seems you have now figured out how to update the panel while it's already\n> open, so can we change this to just be a call to your new _rebuild method?\n\nGreat idea.\n\n> ::: toolkit/components/autocomplete/nsIAutoCompleteController.idl:76\n> (Diff revision 5)\n> > +   *        the user pressed the Return key or a click event if the user clicked\n> > +   *        a popup item.\n> >     * @return True if the controller wishes to prevent event propagation and default event\n> >     */\n> > -  boolean handleEnter(in boolean aIsPopupSelection);\n> > +  boolean handleEnter(in boolean aIsPopupSelection,\n> > +                      in nsIDOMEvent aEvent);\n> \n> What about tagging this as [optional] in the interface so that you don't\n> have to pass null parameters in all existing callers?\n\nAh yeah, of course!", "author": "adw@mozilla.com", "id": 11516282, "time": "2016-07-01T06:09:42Z"}, {"text": "https://treeherder.mozilla.org/#/jobs?repo=try&revision=27dfcce3ae80", "author": "adw@mozilla.com", "id": 11518313, "time": "2016-07-01T21:37:17Z"}, {"text": "https://treeherder.mozilla.org/#/jobs?repo=try&revision=a4fd3b69be23", "author": "adw@mozilla.com", "id": 11518329, "time": "2016-07-01T21:43:58Z"}, {"text": "https://treeherder.mozilla.org/#/jobs?repo=try&revision=0f4eefa11d41", "author": "adw@mozilla.com", "id": 11518451, "time": "2016-07-01T23:18:55Z"}, {"text": "Comment on attachment 8767056\nBug 1180944 - Implement one-off searches from Awesomebar.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/61768/diff/2-3/", "author": "adw@mozilla.com", "id": 11518523, "time": "2016-07-02T00:43:35Z"}, {"text": "Fix for browser_urlbarSearchTelemetry.js failure on Windows 7 VM debug.", "author": "adw@mozilla.com", "id": 11518524, "time": "2016-07-02T00:43:56Z"}, {"text": "Comment on attachment 8767056\nBug 1180944 - Implement one-off searches from Awesomebar.\n\nhttps://reviewboard.mozilla.org/r/61768/#review59394\n\nIn general it seems to work quite well, good work!\n\nSome issues I found while testing:\n1. I seem to be unable to open Search settings with keyword\n2. The text when no one-off button is selecte reads as \"Search for <string> with: \".... and nothing is selected since the current engine does not appear in the list... Quite unclear to me.\n3. related to 1. when change search settings is selected, the string still reads as \"search for with:\"... and indeed it's what happens, but it should open search settings instead\n4. This needs Stephen's feedback, and could also happen later ina follow-up. I honestly think the \"Change search settings\" button should be an icon and not take so much space. It would look infinitely better.\n5. If I select with the keyboard a switch to tab entry and then click on an engine, nothing happens. Though looks like if later I select an url and click on an engine, we load the switch entry, or something like that\n6. If I select an uri entry and click on a one off, we load the url. Could even make sense to not search for a url, but it's strange to confirm the url by clicking on a search engine icon... Maybe the click should be ignored completely? if the entry is not something we can search?\n\n::: browser/base/content/test/urlbar/browser_bug1070778.js:46\n(Diff revision 3)\n>    is_selected(0);\n>  \n>    EventUtils.synthesizeKey(\"b\", {});\n>    yield promiseSearchComplete();\n>  \n> -  is(gURLBar.value, \"keyword ab\", \"urlbar should have expected input\");\n> +  is(gURLBar.textValue, \"keyword ab\", \"urlbar should have expected input\");\n\nCould you please explain the reason for this change (I'm not saying it's wrong, just trying to understand since we have far too many \"value\" fields)\n\n::: browser/base/content/urlbarBindings.xml:375\n(Diff revision 3)\n> +                         event.altKey &&\n> +                         !isTabEmpty(gBrowser.selectedTab);\n> +          if (isMouseEvent || altEnter) {\n> +            // Use the standard UI link behaviors for clicks or Alt+Enter\n> +            where = isMouseEvent ? whereToOpenLink(event, false, false) : \"tab\";\n> +          }\n\nit may be readable as:\n\nif (isMouseEvent) {\n  where = whereToOpenL...\n} else if (altEnter) {\n  where = \"tab\";\n}\n\n::: browser/base/content/urlbarBindings.xml:543\n(Diff revision 3)\n> +        <parameter name=\"openUILinkParams\"/>\n>          <body><![CDATA[\n>            let engine =\n> -            Services.search.getEngineByName(action.params.engineName);\n> +            typeof(engineOrEngineName) == \"string\" ?\n> +            Services.search.getEngineByName(engineOrEngineName) :\n> +            engineOrEngineName;\n\nnit: please indent more the options\n\n::: toolkit/components/autocomplete/nsIAutoCompleteController.idl:10\n(Diff revision 3)\n>  #include \"nsISupports.idl\"\n>  \n>  interface nsIAutoCompleteInput;\n> +interface nsIDOMEvent;\n>  \n> -[scriptable, uuid(ff9f8465-204a-47a6-b3c9-0628b3856684)]\n> +[scriptable, uuid(c6dcd364-99a8-48a9-9611-77e6a18ac9f3)]\n\nnit: it's no more needed to rev the uuid.\n\n::: toolkit/components/autocomplete/nsIAutoCompleteInput.idl:131\n(Diff revision 3)\n>     *\n> +   * @param aEvent\n> +   *        The event that triggered the enter.  Will be null if it's unknown.\n>     * @return True if the user wishes to prevent the enter\n>     */\n> -  boolean onTextEntered();\n> +  boolean onTextEntered(in nsIDOMEvent aEvent);\n\nwhy not [optional]?", "author": "mak77@bonardo.net", "id": 11530846, "time": "2016-07-07T14:47:17Z"}, {"text": "Comment on attachment 8767056\nBug 1180944 - Implement one-off searches from Awesomebar.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/61768/diff/3-4/", "author": "adw@mozilla.com", "id": 11532815, "time": "2016-07-08T01:09:56Z"}, {"text": "(In reply to Marco Bonardo [::mak] from comment #51)\n> 1. I seem to be unable to open Search settings with keyword\n\nThat's fixed with the latest patch.\n\n> 2. The text when no one-off button is selecte reads as \"Search for <string>\n> with: \".... and nothing is selected since the current engine does not appear\n> in the list... Quite unclear to me.\n\nI kind of agree, but that's the current behavior in the searchbar.  This seems more like a question for UX that we should follow up on later.\n\n> 3. related to 1. when change search settings is selected, the string still\n> reads as \"search for with:\"...\n\nThat's also the current behavior in the searchbar.  The \"search for with:\" text is telling you that you can search for your query in one of the following engines.  So it's not wrong, even in this case where the settings button is selected, but as I said I kind of agree that it might be confusing.\n\n> 4. This needs Stephen's feedback, and could also happen later ina follow-up.\n> I honestly think the \"Change search settings\" button should be an icon and\n> not take so much space. It would look infinitely better.\n\nYes, that's what his spec calls for in the urlbar.  I need to ask him whether we should change that in the searchbar too.  I hope so.  I agree that it can happen in a follow-up.\n\n> 5. If I select with the keyboard a switch to tab entry and then click on an\n> engine, nothing happens. Though looks like if later I select an url and\n> click on an engine, we load the switch entry, or something like that\n\nHmm, I think maybe the one-offs should be disabled when you select a switch-to-tab entry.  Another question for UX.\n\nBut, I can't reproduce this.  Maybe something in the latest patch fixed it?  When I click a one-off after selecting a switch-to-tab with the keyboard, the switch-to-tab tab is selected.  Which seems like the right behavior if we're not disabling one-offs.\n\n> 6. If I select an uri entry and click on a one off, we load the url. Could\n> even make sense to not search for a url, but it's strange to confirm the url\n> by clicking on a search engine icon... Maybe the click should be ignored\n> completely? if the entry is not something we can search?\n\nYeah, this is a similar question to the switch-to-tab case.  Maybe the one-offs should just be disabled for all non-searchengine results.\n\n> ::: browser/base/content/test/urlbar/browser_bug1070778.js:46\n> (Diff revision 3)\n> >    is_selected(0);\n> >  \n> >    EventUtils.synthesizeKey(\"b\", {});\n> >    yield promiseSearchComplete();\n> >  \n> > -  is(gURLBar.value, \"keyword ab\", \"urlbar should have expected input\");\n> > +  is(gURLBar.textValue, \"keyword ab\", \"urlbar should have expected input\");\n> \n> Could you please explain the reason for this change (I'm not saying it's\n> wrong, just trying to understand since we have far too many \"value\" fields)\n\nAt one point I was overriding urlbar.value with an action URI containing the selected one-off, so that when you press Return, the one-off engine is used.  Which broke all these tests that assumed that the visual value (textValue) is a simple string, not an action URI.  I'm not doing that anymore, so I think maybe I can revert all these changes.\n\nI can do a try run with those changes reverted, but IMO these tests should be checking textValue, not value.  In the future we may want value to always be an action URI for example.  What do you think?\n\n> ::: toolkit/components/autocomplete/nsIAutoCompleteInput.idl:131\n> (Diff revision 3)\n> >     *\n> > +   * @param aEvent\n> > +   *        The event that triggered the enter.  Will be null if it's unknown.\n> >     * @return True if the user wishes to prevent the enter\n> >     */\n> > -  boolean onTextEntered();\n> > +  boolean onTextEntered(in nsIDOMEvent aEvent);\n> \n> why not [optional]?\n\nIt seems like it shouldn't be optional to me, even though in some cases it might not be known.  I think ideally it would always be known, if we were to go back and look at all the callers and modify them (and their callers) so that the triggering event is always passed around.\n\nBut it's OK with me if you want to make it optional, let me know.", "author": "adw@mozilla.com", "id": 11532818, "time": "2016-07-08T01:10:26Z"}, {"text": "Stephen, some questions for you:\n\nWhen no one-off is selected, the label above the one-offs reads, \"Search for <string> with:\".  Marco thinks that's unclear since nothing is selected and the current engine doesn't appear in the list.  What do you think?\n\nWhen the search settings button is selected, the label still reads \"Search for <string> with:\", which Marco thinks is also confusing.\n\nYour spec shows a gear icon for the search settings button in the urlbar.  Should that be used in the searchbar too?  http://people.mozilla.org/~shorlander/mockups/AwesomeResults/AwesomeResults-01.html\n\nYour spec also shows the one-off icons in grayscale.  Is that meaningful?  What should we do?\n\nI'm thinking that when a non-search-engine/non-search-suggestion result is selected in the urlbar, like a URL or switch to tab, the one-offs should all be disabled since it doesn't make sense to use them in that case.  It's different from the searchbar where only search suggestions are shown, so the one-offs always make sense.   What do you think?", "author": "adw@mozilla.com", "id": 11532829, "time": "2016-07-08T01:18:24Z"}, {"text": "(In reply to Drew Willcoxon :adw (Away 7/11\u20137/15) from comment #53)\n> I can do a try run with those changes reverted, but IMO these tests should\n> be checking textValue, not value.  In the future we may want value to always\n> be an action URI for example.  What do you think?\n\nOk, I guess.\n\n> > ::: toolkit/components/autocomplete/nsIAutoCompleteInput.idl:131\n> > (Diff revision 3)\n> > >     *\n> > > +   * @param aEvent\n> > > +   *        The event that triggered the enter.  Will be null if it's unknown.\n> > >     * @return True if the user wishes to prevent the enter\n> > >     */\n> > > -  boolean onTextEntered();\n> > > +  boolean onTextEntered(in nsIDOMEvent aEvent);\n> > \n> > why not [optional]?\n> \n> It seems like it shouldn't be optional to me, even though in some cases it\n> might not be known.  I think ideally it would always be known, if we were to\n> go back and look at all the callers and modify them (and their callers) so\n> that the triggering event is always passed around.\n\nIt just seems uncoherent with handleEnter, where it's optional, while this is not. I think those should be coherent, either we need it or we don't.", "author": "mak77@bonardo.net", "id": 11533414, "time": "2016-07-08T08:44:56Z"}, {"text": "Comment on attachment 8767056\nBug 1180944 - Implement one-off searches from Awesomebar.\n\nhttps://reviewboard.mozilla.org/r/61768/#review59982\n\nIt looks better. The issues I found don't really break the experience, so we can probably land sooner for testing purposes. Most of those UX problems are also things we can work separately.\nThat said, I certainly don't want to ship with the Change Search Settings button taking so much space, so that should take some priority, imo.", "author": "mak77@bonardo.net", "id": 11533501, "time": "2016-07-08T09:41:12Z"}, {"text": "To be clear, I didn't look at the search.xml changes, since I don't want to overlap with Florian's review.", "author": "mak77@bonardo.net", "id": 11533505, "time": "2016-07-08T09:42:24Z"}, {"text": "Comment on attachment 8767056\nBug 1180944 - Implement one-off searches from Awesomebar.\n\nhttps://reviewboard.mozilla.org/r/61768/#review59986\n\nI didn't do a full review of the code this time, I looked mostly at the interdiff, and tested the patch. Interacting with it is nice, great job! :-)\n\nThings I noticed while testing the patch:\n\n- if I type 'blah' in the urlbar and a completion to 'blah.com/' (with '.com/' selected) appears in the text field, at the bottom of the panel I see \"Search for blah.com/ with:\" and if I click a one-off button, Firefox loads blah.com instead of querying the engine I clicked. We should search for what the user typed and ignore the completion suggested in the textfield.\n\n- The 'Change Search Settings' button is taking way too much space in the awesomebar panel (which typically has a much larger width than the searchbar panel). Additionally, the sizing of the one-off button has never been perfect and there's an empty area on the right side, of at most (n-1)px (where n is the number of buttons we could fit on the line). On the searchbar panel it's barely visible, but on the awesomebar panel that is much larger, the empty area at the end of the row can be quite noticeable, and in most cases there'll be only one row of one-off buttons. So I think for the awesomebar panel it would make sense to put a settings icon at the end of the last row of one-off engines, and make that button use up all the space we couldn't allocate to normal-sized buttons. For the searchbar panel, where searching, and so search settings, is much more important, I think we should keep the whole button text ('Change Search Settings') visible.\n\n- Should we show opensearch items in the awesomebar panel? It's taking a lot of space for not much value I think, as the green (+) badge is only displayed on the searchbox anyway. When a webpage offers lots of search plugins (try http://de.pons.com/), the layout of the panel explodes (known bug 1113747). It's ugly for the searchbar but not too bad. A website breaking/hiding the urlbar seem a much more serious problem to me, possibly a release blocker.\n\n- Rebuilding the panel immediately when installing a search plugin is nice :-). An unfortunate detail is that we seem to fire the notification that an engine has been added a bit too early, before the icon is available, and we end up showing a generic placeholder icon instead of the new engine's icon. (this can be addressed in a follow-up, that I'm willing to take, as it's likely a search service bug).\n\nr+ as I could be convinced most if not all of the above points can be follow-ups, as long as we get to them before shipping.\n\n::: browser/components/search/content/search.xml:1097\n(Diff revision 4)\n> +      <property name=\"popup\">\n> +        <getter><![CDATA[\n> +          return this._popup;\n> +        ]]></getter>\n> +        <setter><![CDATA[\n> +          if (this._popup != val) {\n\nI see you changed the textbox setter with an early return like I suggested; it seems you missed the popup setter.", "author": "florian@queze.net", "id": 11533842, "time": "2016-07-08T12:23:24Z"}, {"text": "(In reply to Drew Willcoxon :adw (Away 7/11\u20137/15) from comment #54)\n> When no one-off is selected, the label above the one-offs reads, \"Search for\n> <string> with:\".  Marco thinks that's unclear since nothing is selected and\n> the current engine doesn't appear in the list.  What do you think?\n\nThe intent is for that label to be a hint that you can search for your current search string with one of the one-off buttons.\n\nI agree it could be confusing in the context of all of the other things that can happen in the awesome bar results. Can we land it as it currently is and reevaluate after we have had a chance to use it for a while?\n\n\n> When the search settings button is selected, the label still reads \"Search\n> for <string> with:\", which Marco thinks is also confusing.\n\nCan we append the sting with the name of the search engine when it is selected? E.g.\n\n\"Search for <sting> with: Wikipedia\"?\n\n\n> Your spec shows a gear icon for the search settings button in the urlbar. \n> Should that be used in the searchbar too? \n> http://people.mozilla.org/~shorlander/mockups/AwesomeResults/AwesomeResults-\n> 01.html\n\nI don't think so. We could evaluate whether or not the footer in the searchbar could be revised. But probably not in this bug.\n\n\n> Your spec also shows the one-off icons in grayscale.  Is that meaningful? \n> What should we do?\n\nThat was mostly as a means to de-emphasize them. But it's probably not necessary. We can use the full color versions.\n\n\n> I'm thinking that when a non-search-engine/non-search-suggestion result is\n> selected in the urlbar, like a URL or switch to tab, the one-offs should all\n> be disabled since it doesn't make sense to use them in that case.  It's\n> different from the searchbar where only search suggestions are shown, so the\n> one-offs always make sense.   What do you think?\n\nI don't think I am clear about what you are proposing.  The one-off buttons always search the string you type, when would the type of result be a factor?", "author": "shorlander@mozilla.com", "id": 11534989, "time": "2016-07-08T19:32:11Z"}, {"text": "Created attachment 8769329\nOne-Off Search Display Problem - 01\n\n(In reply to Stephen Horlander [:shorlander] from comment #59)\n> (In reply to Drew Willcoxon :adw (Away 7/11\u20137/15) from comment #54)\n> > I'm thinking that when a non-search-engine/non-search-suggestion result is\n> > selected in the urlbar, like a URL or switch to tab, the one-offs should all\n> > be disabled since it doesn't make sense to use them in that case.  It's\n> > different from the searchbar where only search suggestions are shown, so the\n> > one-offs always make sense.   What do you think?\n> \n> I don't think I am clear about what you are proposing.  The one-off buttons\n> always search the string you type, when would the type of result be a factor?\n\nI think I figured out my confusion. Right, I agree the one-off buttons should be disabled with switch-to-tab items or direct navigation items (URLs).\n\nBut back to my confusion :)\n\nThere is a display problem when you are using this with your mouse instead of your keyboard. The problem, and this is also a problem in the SearchBar, is that if you are using your mouse to select things it's possible to have more than one selection. Or that's the way it appears.\n\nIn that screenshot what it looks like it is going to do, and in fact if you scrub the tiles what it says it will do, is search that selection with the hovered search engine. But that is not what actually happens. It instead searches what you have selected with the keyboard.\n\nActually I think this is really a result of bug 1231393. We need a separate selected state and a hover state. The selected state attributes (e.g. \u2013 Search on <Engine>) should not move with mouse hover.", "author": "shorlander@mozilla.com", "id": 11535056, "time": "2016-07-08T20:05:21Z"}, {"text": "Marco, Florian, I'm off next week so I think it would be wise to land this when I get back so I can jump on any follow-up problems.  But if you want to land it ASAP to have more time to test it, that's OK with me.  Although I'm also still working on incorporating the latest round of comments, including Stephen's.", "author": "adw@mozilla.com", "id": 11535908, "time": "2016-07-09T06:14:05Z"}, {"text": "(In reply to Stephen Horlander [:shorlander] from comment #59)\n\n> > When the search settings button is selected, the label still reads \"Search\n> > for <string> with:\", which Marco thinks is also confusing.\n> \n> Can we append the sting with the name of the search engine when it is\n> selected? E.g.\n> \n> \"Search for <sting> with: Wikipedia\"?\n\nWhen a one-off button is selected, we show \"Search <engine name>\". Of course, this string was chosen for the searchbar where we have less space. In the awesomebar there would be enough space for a full \"Search for <string> with <engine>\", but unless it's actually confusing, preserving a consistent behavior seems easier.", "author": "florian@queze.net", "id": 11536022, "time": "2016-07-09T07:51:14Z"}, {"text": "What confused me is that this text is used:\n1. as a label hinting to the user what he could do, when no one-off is selected\n2. as a status text saying what is about to happen, when one-off is selected\n\nI was always interpreting it as a status, and as such \"Search for <string> with:\", followed by no selection, didn't make any sense. Now that I figured it's trying to be 2 things at once, I understand what's up.\nI still think it's confusing both here and in the searchbar, but likely not a blocker since it's already there.", "author": "mak77@bonardo.net", "id": 11538331, "time": "2016-07-11T13:27:18Z"}, {"text": "Comment on attachment 8767056\nBug 1180944 - Implement one-off searches from Awesomebar.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/61768/diff/4-5/", "author": "adw@mozilla.com", "id": 11564315, "time": "2016-07-21T06:55:52Z"}, {"text": "Comment on attachment 8767056\nBug 1180944 - Implement one-off searches from Awesomebar.\n\nMarco, could you please look at this small urlbarBindings change?  It's to address one of Florian's comments that I'll comment on soon.\n\nFlorian, could you please look at the other changes?", "author": "adw@mozilla.com", "id": 11564326, "time": "2016-07-21T07:00:52Z"}, {"text": "(In reply to Marco Bonardo [::mak] from comment #55)\n> It just seems uncoherent with handleEnter, where it's optional, while this\n> is not. I think those should be coherent, either we need it or we don't.\n\nI made this one [optional] too.", "author": "adw@mozilla.com", "id": 11564327, "time": "2016-07-21T07:01:46Z"}, {"text": "(In reply to Florian Qu\u00e8ze [:florian] [:flo] from comment #58)\n> - if I type 'blah' in the urlbar and a completion to 'blah.com/' (with\n> '.com/' selected) appears in the text field, at the bottom of the panel I\n> see \"Search for blah.com/ with:\" and if I click a one-off button, Firefox\n> loads blah.com instead of querying the engine I clicked. We should search\n> for what the user typed and ignore the completion suggested in the textfield.\n\nShould be fixed now, by the urlbarBindings.xml change.\n\n> - The 'Change Search Settings' button is taking way too much space\n\nLatest patch uses a gear icon for the settings button in the urlbar panel, as is shown in Stephen's spec, so this is fixed.\n\nI added a new attribute/property to the one-offs binding called \"compact\" that controls this.  It also changes some other visual design slightly, to match Stephen's spec, by removing the vertical lines on the right edge of dummy one-offs.\n\n> - Should we show opensearch items in the awesomebar panel?\n\nOK, I skip the addengine-items entirely when compact=true.  I think maybe we should ask Stephen for a redesign for these buttons in the urlbar and come back to it in a follow-up.\n\n> - Rebuilding the panel immediately when installing a search plugin is nice\n> :-). An unfortunate detail is that we seem to fire the notification that an\n> engine has been added a bit too early, before the icon is available, and we\n> end up showing a generic placeholder icon instead of the new engine's icon.\n> (this can be addressed in a follow-up, that I'm willing to take, as it's\n> likely a search service bug).\n\nLeft for a follow-up.\n\n> ::: browser/components/search/content/search.xml:1097\n> (Diff revision 4)\n> > +      <property name=\"popup\">\n> > +        <getter><![CDATA[\n> > +          return this._popup;\n> > +        ]]></getter>\n> > +        <setter><![CDATA[\n> > +          if (this._popup != val) {\n> \n> I see you changed the textbox setter with an early return like I suggested;\n> it seems you missed the popup setter.\n\nFixed.", "author": "adw@mozilla.com", "id": 11564328, "time": "2016-07-21T07:01:58Z"}, {"text": "(In reply to Stephen Horlander [:shorlander] from comment #60)\n> I think I figured out my confusion. Right, I agree the one-off buttons\n> should be disabled with switch-to-tab items or direct navigation items\n> (URLs).\n> \n> But back to my confusion :)\n> \n> There is a display problem when you are using this with your mouse instead\n> of your keyboard.\n\nI left these two issues for follow-ups.", "author": "adw@mozilla.com", "id": 11564329, "time": "2016-07-21T07:02:06Z"}, {"text": "we should be evaluating delaying the landing until the next merge. There are a couple reason:\n1. not enough time for handling regressions/follow-ups\n2. give more time to the shield study extension using the old approach", "author": "mak77@bonardo.net", "id": 11564412, "time": "2016-07-21T08:07:54Z"}, {"text": "Comment on attachment 8767056\nBug 1180944 - Implement one-off searches from Awesomebar.\n\nhttps://reviewboard.mozilla.org/r/61768/#review63226\n\nr- because the layout breaks with a small window and a long-ish list of engines, see http://i.imgur.com/cJWAgE9.png\n\nWhen hovering/selecting the settings button from the awesomebar panel, it's odd that it doesn't have the same color as when hovering/selecting other one-off buttons.\n\nIf I was implementing this, the first idea I would try would be to make the settings button a one-off button (I would try just moving the DOM node of the existing settings button, so that we don't have to hide it).\n\nMy comment below on the linux searchbar.css file applies to all the 3 versions of this file.\n\n::: browser/components/search/content/search.xml:1438\n(Diff revisions 4 - 5)\n>            let rowCount = Math.ceil(engines.length / enginesPerRow);\n>            let height = rowCount * 33; // 32px per row, 1px border.\n> -          list.setAttribute(\"height\", height + \"px\");\n> +          height += \"px\";\n> +          list.style.height = height;\n> +          list.style.minHeight = height;\n> +          list.parentNode.style.height = height;\n\nThis deserves a comment to explain why we need to set this on both the list and its parent... if we can't find a cleaner solution.\n\n::: browser/themes/linux/searchbar.css\n(Diff revision 5)\n>    height: 32px;\n>    margin: 0 0;\n>    padding: 0 0;\n>    background: none;\n> -  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAWCAYAAAABxvaqAAAABmJLR0QA/wD/AP+gvaeTAAAAFElEQVQI12NgYGAwZmJgYGCgBwEAHpIAXs+dj/cAAAAASUVORK5CYII=');\n> -  background-repeat: no-repeat;\n\nI don't undersatnd why you are moving this to a new rule with identical selectors.", "author": "florian@queze.net", "id": 11569150, "time": "2016-07-22T18:13:36Z"}, {"text": "Comment on attachment 8767056\nBug 1180944 - Implement one-off searches from Awesomebar.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/61768/diff/5-6/", "author": "adw@mozilla.com", "id": 11569950, "time": "2016-07-23T00:58:02Z"}, {"text": "(In reply to Florian Qu\u00e8ze [:florian] [:flo] from comment #70)\n> When hovering/selecting the settings button from the awesomebar panel, it's\n> odd that it doesn't have the same color as when hovering/selecting other\n> one-off buttons.\n\nMade the same\n\n> If I was implementing this, the first idea I would try would be to make the\n> settings button a one-off button\n\nDone\n\n> (I would try just moving the DOM node of the existing settings button, so\n> that we don't have to hide it).\n\nThat was the first thing I tried, but the code inside the binding couldn't remove() or insertBefore() on `this` -- there are \"node not found\" errors.  Maybe because of the way the binding is bound via a class selector to vboxes and it's not an element type itself.  I don't know.  At this point I'm really tired of this bug.\n\n> This deserves a comment to explain why we need to set this on both the list\n> and its parent... if we can't find a cleaner solution.\n\nI couldn't find a better solution and I don't know why it's necessary and I don't think it's important and I added a comment to that effect.", "author": "adw@mozilla.com", "id": 11569951, "time": "2016-07-23T00:59:07Z"}, {"text": "Created attachment 8774303\nProposed change\n\n(In reply to Drew Willcoxon :adw from comment #71)\n> Comment on attachment 8767056\n> Bug 1180944 - Implement one-off searches from Awesomebar.\n> \n> Review request updated; see interdiff:\n> https://reviewboard.mozilla.org/r/61768/diff/5-6/\n\nThis still doesn't look great with multiple rows of one-off buttons: http://i.imgur.com/5a9BmaT.png\n\nWhen I suggested making the settings button a one-off button, I really meant have the button be inside the description tag so that the layout would work the same as for other one-off buttons. I know you are tired of iterating on this, so rather than review comments with suggestions, I'm attaching the proposed changes, which you can review and integrate in your patch.", "author": "florian@queze.net", "id": 11572212, "time": "2016-07-25T12:29:43Z"}, {"text": "That was actually intentional though.  I think having the settings button set apart looks better than having it flow into the one-offs.\n\nSince this is a visual design question, let's ask Stephen.  Stephen, when there are multiple rows of one-offs, the settings button looks like this currently: http://i.imgur.com/5a9BmaT.png  Is that OK?", "author": "adw@mozilla.com", "id": 11573024, "time": "2016-07-25T17:14:54Z"}, {"text": "Oh wait, I think I see.  The one-offs should take up the entire width of the panel except possibly for the final row.  The final row should have the settings button in it, and it should hug the right edge of the panel.  I haven't tried the patch but it looks like that's what it's doing?\n\nHmm, but what if each row of one-offs is entirely filled?  Where should the settings button be then?  It looks like the patch will place it on the left edge of the panel on a new row?  But shouldn't it be on the right edge always?", "author": "adw@mozilla.com", "id": 11573047, "time": "2016-07-25T17:27:31Z"}, {"text": "(In reply to Drew Willcoxon :adw from comment #75)\n\n> Hmm, but what if each row of one-offs is entirely filled?  Where should the\n> settings button be then?  It looks like the patch will place it on the left\n> edge of the panel on a new row?  But shouldn't it be on the right edge\n> always?\n\nThere'll be dummy items added to push it to the right edge. That's why I had to replace engines.length with oneOffCount in a few places, so that the settings button is taken into account for the calculations.", "author": "florian@queze.net", "id": 11573111, "time": "2016-07-25T17:46:16Z"}, {"text": "(In reply to Florian Qu\u00e8ze [:florian] [:flo] from comment #76)\n> (In reply to Drew Willcoxon :adw from comment #75)\n> \n> > Hmm, but what if each row of one-offs is entirely filled?  Where should the\n> > settings button be then?  It looks like the patch will place it on the left\n> > edge of the panel on a new row?  But shouldn't it be on the right edge\n> > always?\n> \n> There'll be dummy items added to push it to the right edge. That's why I had\n> to replace engines.length with oneOffCount in a few places, so that the\n> settings button is taken into account for the calculations.\n\nIt'll look like this: http://i.imgur.com/Ec4yJAY.png\nHopefully that's a pretty rare edge case...\n\nAnd this screenshot made me realize that the left border of the settings button is 1px off :(.", "author": "florian@queze.net", "id": 11573137, "time": "2016-07-25T17:53:15Z"}, {"text": "OK, you're right, that does look better.  I'll post a new patch.  I'll leave the needinfo on Stephen since his feedback would be valuable still.", "author": "adw@mozilla.com", "id": 11573194, "time": "2016-07-25T18:09:10Z"}, {"text": "When there's only one row, there's a gap between the settings button and the right edge of the panel, which doesn't look great...", "author": "adw@mozilla.com", "id": 11573567, "time": "2016-07-25T20:20:37Z"}, {"text": "(In reply to Drew Willcoxon :adw from comment #79)\n> When there's only one row, there's a gap between the settings button and the\n> right edge of the panel, which doesn't look great...\n\nIt's not when there's only one row, but just depends on how well or poorly we can divide the available pixels by the number of items we put on each row. It's actually even more visible when there are multiple rows, because you can see the horizontal lines don't touch the right edge of the panel. This bug has existed in the searchbar for as long as we've had one-off buttons. It's more visible in the awesomebar because the panel is typically wider there. I think we could mitigate it by forcing the last item of each row to take all of the remaining space. Seems to me like something that could be done in a follow-up by the way.", "author": "florian@queze.net", "id": 11573618, "time": "2016-07-25T20:42:20Z"}, {"text": "Comment on attachment 8767056\nBug 1180944 - Implement one-off searches from Awesomebar.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/61768/diff/6-7/", "author": "adw@mozilla.com", "id": 11573626, "time": "2016-07-25T20:45:29Z"}, {"text": "That incorporates your patch (thanks), fixes the off-by-one border problem on the compact settings button, and increases the width of the last dummy item when there's only one row so that the settings button hugs the panel's edge.\n\nI did notice that there's a gap too when there are multiple rows, like you say.  But I think it's not nearly as big a \"problem\" then because all the buttons line up vertically, so the settings button doesn't look out of place by having a gap between it and the panel edge.  The rowCount==1 case does look bad IMO.", "author": "adw@mozilla.com", "id": 11573634, "time": "2016-07-25T20:48:33Z"}, {"text": "Comment on attachment 8767056\nBug 1180944 - Implement one-off searches from Awesomebar.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/61768/diff/7-8/", "author": "adw@mozilla.com", "id": 11573652, "time": "2016-07-25T20:52:45Z"}, {"text": "Sorry, forgot to update all css files.", "author": "adw@mozilla.com", "id": 11573653, "time": "2016-07-25T20:52:59Z"}, {"text": "Comment on attachment 8774303\nProposed change\n\nf+ and marking obsolete since I incorporated this into the main patch.", "author": "adw@mozilla.com", "id": 11573659, "time": "2016-07-25T20:54:50Z"}, {"text": "Comment on attachment 8767056\nBug 1180944 - Implement one-off searches from Awesomebar.\n\nhttps://reviewboard.mozilla.org/r/61768/#review63978", "author": "mak77@bonardo.net", "id": 11575269, "time": "2016-07-26T12:40:46Z"}, {"text": "(In reply to Drew Willcoxon :adw from comment #67)\n> (In reply to Florian Qu\u00e8ze [:florian] [:flo] from comment #58)\n> > - if I type 'blah' in the urlbar and a completion to 'blah.com/' (with\n> > '.com/' selected) appears in the text field, at the bottom of the panel I\n> > see \"Search for blah.com/ with:\" and if I click a one-off button, Firefox\n> > loads blah.com instead of querying the engine I clicked. We should search\n> > for what the user typed and ignore the completion suggested in the textfield.\n> \n> Should be fixed now, by the urlbarBindings.xml change.\n\nIt's fixed when clicking the one-off button, but when selecting the one-off button using the tab key and then pressing enter, we still load blah.com instead of searching for blah.\n\nNew issues I've noticed:\n- when opening a one-off button's context menu, and clicking \"Search in New Tab\", we search in the current tab (only from the awesomebar; works fine in the searchbar).\n- super edge-case-y issue, steps to reproduce:\n1. Type something in the awesomebar\n2. Hover the Google one-off button.\n3. Press <tab> until another one-off button (eg. wikipedia) is selected.\n4. Right click the context menu of the Google one-off button.\n5. Activate the \"Search in New Tab\" item.\nExpected result: we should search with Google. (works fine on the searchbar)\nActual result: we search with wikipedia. (only happens from the awesomebar)", "author": "florian@queze.net", "id": 11575547, "time": "2016-07-26T14:34:08Z"}, {"text": "Comment on attachment 8767056\nBug 1180944 - Implement one-off searches from Awesomebar.\n\nhttps://reviewboard.mozilla.org/r/61768/#review64018\n\nr=me as the code looks good, but see comment 87. Not sure how much of that should be fixed here before landing, and how much is for follow-ups.", "author": "florian@queze.net", "id": 11575557, "time": "2016-07-26T14:36:59Z"}, {"text": "Comment on attachment 8767056\nBug 1180944 - Implement one-off searches from Awesomebar.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/61768/diff/8-9/", "author": "adw@mozilla.com", "id": 11577499, "time": "2016-07-27T01:17:44Z"}, {"text": "Comment on attachment 8767056\nBug 1180944 - Implement one-off searches from Awesomebar.\n\nThanks Florian, sorry for not noticing those problems myself.  This new patch fixes them.  Changes are small but not exactly trivial, so could you please look at them?", "author": "adw@mozilla.com", "id": 11577513, "time": "2016-07-27T01:28:18Z"}, {"text": "Comment on attachment 8767056\nBug 1180944 - Implement one-off searches from Awesomebar.\n\nMarco, sorry for asking for review again but I had to make a non-trivial change to urlbarBindings.  It's a change To fix this problem that Florian noticed:\n\n(In reply to Florian Qu\u00e8ze [:florian] [:flo] from comment #87)\n> (In reply to Drew Willcoxon :adw from comment #67)\n> > (In reply to Florian Qu\u00e8ze [:florian] [:flo] from comment #58)\n> > > - if I type 'blah' in the urlbar and a completion to 'blah.com/' (with\n> > > '.com/' selected) appears in the text field, at the bottom of the panel I\n> > > see \"Search for blah.com/ with:\" and if I click a one-off button, Firefox\n> > > loads blah.com instead of querying the engine I clicked. We should search\n> > > for what the user typed and ignore the completion suggested in the textfield.\n> > \n> > Should be fixed now, by the urlbarBindings.xml change.\n> \n> It's fixed when clicking the one-off button, but when selecting the one-off\n> button using the tab key and then pressing enter, we still load blah.com\n> instead of searching for blah.\n\nThe problem is that in this case, handleEnter on the urlbar is called, which calls handleEnter on the controller, which sets the controller's mSearchString to be the autofilled string.  So we lose the portion that the user typed.  It's only after that that the urlbar's handleCommand is called, so by that point, we don't know what the user typed.  So I used this new _searchStringOnHandleEnter value.", "author": "adw@mozilla.com", "id": 11577514, "time": "2016-07-27T01:28:47Z"}, {"text": "(Re-requesting review through Bugzilla.  I can't figure out how to do it via Review Board.)", "author": "adw@mozilla.com", "id": 11577516, "time": "2016-07-27T01:29:50Z"}, {"text": "Comment on attachment 8767056\nBug 1180944 - Implement one-off searches from Awesomebar.\n\nhttps://reviewboard.mozilla.org/r/61768/#review64464\n\nReady for another blah.com issue? (sorry!) It's now fixed when clicking the one-off buttons and when pressing enter, but we still load blah.com instead of searching for blah when clicking the \"Search in New Tab\" context menu item.\n\nAlso, the main reason for adding this context menu item was to give users an easy way to search with several one off buttons in a row, so the panel wasn't supposed to close (for the searchbar we didn't manage to keep the panel open, so we reopen it automatically immediately after opening the new tab). On the awesomebar with the current patch clicking the context menu item closes the panel and doesn't reopen it. (Can be a follow-up IMHO, as I don't think this context menu item is very discoverable anyway.)\n\n::: browser/base/content/urlbarBindings.xml:438\n(Diff revisions 8 - 9)\n> -          let visuallySelectedOneOff =\n> +          if (selectedOneOff && selectedOneOff.engine) {\n> -            this.popup.oneOffSearchButtons.visuallySelectedButton;\n> -          if (visuallySelectedOneOff && visuallySelectedOneOff.engine) {\n>              // `url` (which is this.value) may be an autofilled string.  Search\n>              // only with the portion that the user typed, if any, by preferring\n>              // the autocomplete controller's searchString.\n\nDo you need to update this comment?\n\n::: browser/components/search/content/search.xml:1506\n(Diff revisions 8 - 9)\n>        </method>\n>  \n> +      <method name=\"_buttonIDForEngine\">\n> +        <parameter name=\"engine\"/>\n> +        <body><![CDATA[\n> +          return \"searchbar-add-engine-\" + engine.name.replace(/ /g, '-');\n\nWith this change you are replacing all the searchbar-engine-one-off-item- prefixes with searchbar-add-engine-, it doesn't seem to be an intentional change.\n\n::: browser/components/search/content/search.xml:2001\n(Diff revisions 8 - 9)\n>          if (anonid == \"search-one-offs-context-set-default\") {\n>            let currentEngine = Services.search.currentEngine;\n>  \n>            // Make the target button of the context menu reflect the current\n>            // search engine first. Doing this as opposed to rebuilding all the\n>            // one-off buttons avoids flicker.\n\nThis whole code path doesn't seem to be working/doing anything in the awesomebar panel.\n\nTbh, I'm not sure I care. I only discovered this because I was wondering if in a follow-up we could remove this code and replace it with a call to your new rebuild method.", "author": "florian@queze.net", "id": 11578880, "time": "2016-07-27T14:39:28Z"}, {"text": "(In reply to Florian Qu\u00e8ze [:florian] [:flo] from comment #93)\n> Comment on attachment 8767056\n> Bug 1180944 - Implement one-off searches from Awesomebar.\n> \n> https://reviewboard.mozilla.org/r/61768/#review64464\n> \n> Ready for another blah.com issue? (sorry!) It's now fixed when clicking the\n> one-off buttons and when pressing enter, but we still load blah.com instead\n> of searching for blah when clicking the \"Search in New Tab\" context menu\n> item.\n\nAfter popping the patches, and reapplying them, I can't reproduce this anymore, so let's forget about it for now.", "author": "florian@queze.net", "id": 11579345, "time": "2016-07-27T16:57:26Z"}, {"text": "Comment on attachment 8767056\nBug 1180944 - Implement one-off searches from Awesomebar.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/61768/diff/9-10/", "author": "adw@mozilla.com", "id": 11579475, "time": "2016-07-27T17:38:39Z"}, {"text": "(In reply to Florian Qu\u00e8ze [:florian] [:flo] from comment #93)\n> Also, the main reason for adding this context menu item was to give users an\n> easy way to search with several one off buttons in a row, so the panel\n> wasn't supposed to close (for the searchbar we didn't manage to keep the\n> panel open, so we reopen it automatically immediately after opening the new\n> tab). On the awesomebar with the current patch clicking the context menu\n> item closes the panel and doesn't reopen it. (Can be a follow-up IMHO, as I\n> don't think this context menu item is very discoverable anyway.)\n\nHmm, interesting.  The urlbar panel is always closed when you navigate somewhere, so we'd need to set a flag or something specifically in this case to not close it.  I'll leave it for a follow-up.  Marco might have thoughts about that too.\n\n> ::: browser/base/content/urlbarBindings.xml:438\n> (Diff revisions 8 - 9)\n> > -          let visuallySelectedOneOff =\n> > +          if (selectedOneOff && selectedOneOff.engine) {\n> > -            this.popup.oneOffSearchButtons.visuallySelectedButton;\n> > -          if (visuallySelectedOneOff && visuallySelectedOneOff.engine) {\n> >              // `url` (which is this.value) may be an autofilled string.  Search\n> >              // only with the portion that the user typed, if any, by preferring\n> >              // the autocomplete controller's searchString.\n> \n> Do you need to update this comment?\n\nI think it's still accurate since the new _searchStringOnHandleEnter is the autocomplete controller's searchString, even if it's slightly out of date.  I did add a comment where _searchStringOnHandleEnter is set though, which should help I think.\n\n> ::: browser/components/search/content/search.xml:1506\n> (Diff revisions 8 - 9)\n> >        </method>\n> >  \n> > +      <method name=\"_buttonIDForEngine\">\n> > +        <parameter name=\"engine\"/>\n> > +        <body><![CDATA[\n> > +          return \"searchbar-add-engine-\" + engine.name.replace(/ /g, '-');\n> \n> With this change you are replacing all the searchbar-engine-one-off-item-\n> prefixes with searchbar-add-engine-, it doesn't seem to be an intentional\n> change.\n\nWhoops, thanks!\n\n> ::: browser/components/search/content/search.xml:2001\n> (Diff revisions 8 - 9)\n> >          if (anonid == \"search-one-offs-context-set-default\") {\n> >            let currentEngine = Services.search.currentEngine;\n> >  \n> >            // Make the target button of the context menu reflect the current\n> >            // search engine first. Doing this as opposed to rebuilding all the\n> >            // one-off buttons avoids flicker.\n> \n> This whole code path doesn't seem to be working/doing anything in the\n> awesomebar panel.\n\nIt's weird... the first time I tested this, I swear that I also saw that it didn't work or do anything.  Then I restarted and tried again, and it worked: the icon in the button was replaced with the icon of the previous engine.  Maybe I didn't actually rebuild or something the first time.\n\n> Tbh, I'm not sure I care. I only discovered this because I was wondering if\n> in a follow-up we could remove this code and replace it with a call to your\n> new rebuild method.\n\nI tried calling the rebuild method here, and I don't think it looks good actually.  The buttons rearrange themselves, which is confusing IMO.  Simply replacing the icon is much less disrupting.  (Plus, it didn't actually work 100% right.  When I opened the context menu again, the make-default menu item was disabled.  So that would need some investigation.)", "author": "adw@mozilla.com", "id": 11579476, "time": "2016-07-27T17:39:05Z"}, {"text": "https://treeherder.mozilla.org/#/jobs?repo=try&revision=990def9b7a89", "author": "adw@mozilla.com", "id": 11580719, "time": "2016-07-28T01:18:15Z"}, {"text": "Some tests failed because when getSelectableButtons iterates over the one-offs list, there's a text node at the beginning, so the node doesn't have a classList.  _rebuild removes text nodes, but the problem is that getSelectableButtons is being called before _rebuild is, because it's being called before the popup opens.  This is now a potential problem because we added the compact settings button directly to the description in a recent patch.\n\nSo that try push should fix that.  I'll push to Review Board if/when it comes back green.", "author": "adw@mozilla.com", "id": 11580721, "time": "2016-07-28T01:19:44Z"}, {"text": "https://treeherder.mozilla.org/#/jobs?repo=try&revision=85195b821bfe", "author": "adw@mozilla.com", "id": 11583050, "time": "2016-07-28T19:38:27Z"}, {"text": "Fixes for several searchbar tests that get the one-off buttons that are tripped up by the same change described in comment 98 (adding the compact settings button to the one-offs xul:description).", "author": "adw@mozilla.com", "id": 11583052, "time": "2016-07-28T19:38:39Z"}, {"text": "Latest try looks OK.", "author": "adw@mozilla.com", "id": 11585896, "time": "2016-07-29T18:43:41Z"}, {"text": "Comment on attachment 8767056\nBug 1180944 - Implement one-off searches from Awesomebar.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/61768/diff/10-11/", "author": "adw@mozilla.com", "id": 11585912, "time": "2016-07-29T18:47:28Z"}, {"text": "Comment on attachment 8767056\nBug 1180944 - Implement one-off searches from Awesomebar.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/61768/diff/11-12/", "author": "adw@mozilla.com", "id": 11590754, "time": "2016-08-02T01:28:06Z"}, {"text": "Marco, could you please review this pref change in addition to this change I flagged you on in comment 91: https://reviewboard.mozilla.org/r/61768/diff/8-9/\n\nThe urlbar binding tells the urlbar-rich-result-popup binding to enable/disable one-offs instead of urlbar-rich-result-popup just doing it itself, which is a little roundabout.  The reason is that urlbar already has a pref observer.", "author": "adw@mozilla.com", "id": 11590762, "time": "2016-08-02T01:35:43Z"}, {"text": "Oh, this also means that we've removed the footer and its \"change search settings\" button when the one-offs are disabled -- i.e., on non-Nightly.  Does anyone really think we should keep it?  I sure don't.", "author": "adw@mozilla.com", "id": 11590780, "time": "2016-08-02T01:43:19Z"}, {"text": "Er, but that was Nightly-only, so there's actually no change there.  Nevermind! :-)", "author": "adw@mozilla.com", "id": 11590781, "time": "2016-08-02T01:44:33Z"}, {"text": "(In reply to Drew Willcoxon :adw from comment #105)\n> Oh, this also means that we've removed the footer and its \"change search\n> settings\" button when the one-offs are disabled\n\nThis is a positive thing :D\n\nBtw, I disabled review requests to avoid piling up stuff I couldn't review in the next weeks, but needinfo is open, so if you need any review just needinfo me this week. I'll look at this today.", "author": "mak77@bonardo.net", "id": 11591382, "time": "2016-08-02T08:21:37Z"}, {"text": "Comment on attachment 8767056\nBug 1180944 - Implement one-off searches from Awesomebar.\n\nhttps://reviewboard.mozilla.org/r/61768/#review65662\n\n::: browser/base/content/urlbarBindings.xml:1337\n(Diff revisions 5 - 12)\n> +          } else {\n> +            this.oneOffSearchButtons.style.display = \"none\";\n> +            this.oneOffSearchButtons.popup = null;\n> +            this.oneOffSearchButtons.textbox = null;\n> +            this.oneOffSearchButtons.telemetryOrigin = null;\n> +          }\n\nI didn't test it, but please ensure that when disabled the selection looping behavior in the awesomebar is correct.", "author": "mak77@bonardo.net", "id": 11592276, "time": "2016-08-02T15:16:36Z"}, {"text": "https://treeherder.mozilla.org/#/jobs?repo=try&revision=f842dc6b5001", "author": "adw@mozilla.com", "id": 11593498, "time": "2016-08-02T21:34:47Z"}, {"text": "One last try push rebased on the current tree...", "author": "adw@mozilla.com", "id": 11593500, "time": "2016-08-02T21:35:29Z"}, {"text": "https://hg.mozilla.org/integration/fx-team/rev/474f38fc48be9f97b49b084ebf0b59293b81cf16\nBug 1180944 - Implement one-off searches from Awesomebar. r=mak,florian", "author": "adw@mozilla.com", "id": 11593940, "time": "2016-08-03T01:00:36Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/474f38fc48be", "author": "cbook@mozilla.com", "id": 11595568, "time": "2016-08-03T15:05:40Z"}, {"text": "Pushed by archaeopteryx@coole-files.de:\nhttps://hg.mozilla.org/mozilla-central/rev/451e84cd0ff9\nImplement one-off searches from Awesomebar: Fix eslint warning about inconsistent return usage. r=eslint-fix a=eslint-fix", "author": "pulsebot@bots.tld", "id": 11595787, "time": "2016-08-03T15:45:52Z"}, {"text": "Just tried it in latest central x86. Neither of the buttons function. I get invalid address, nothing at all, or if there's a match a website loading.\nClicking the buttons is no different than pressing enter, it seems.", "author": "dqeswn@gmail.com", "id": 11602019, "time": "2016-08-05T12:42:00Z"}, {"text": "I am used to the behaviour that I can select the last suggested entries by pressing the up-arrow-key. Now that selects the new search things that are useless for me.\n\nGoing to take a bit of learning to stop instinctively doing that.", "author": "6lobe@unseen.is", "id": 11604214, "time": "2016-08-06T12:38:52Z"}, {"text": "I have reproduced this bug with nightly 42.0a1 (2015-07-06) on windows 10, 32 bit.\n\nThe bug\u2019s fix is now verified on Latest Nightly 51.0a1.\n\nBuild ID:20160805030444.\nUser Agent:Mozilla/5.0 (Windows NT 10.0; rv:51.0) Gecko/20100101 Firefox/51.0.", "author": "akashnawaf@gmail.com", "id": 11604303, "time": "2016-08-06T15:14:39Z"}, {"text": "Err, wrong flag", "author": "ntim.bugs@gmail.com", "id": 11604391, "time": "2016-08-06T18:34:24Z"}, {"text": "This is a pretty serious bug in bug 1292767 as I can no longer go to any URL. I confirmed that backing out revision 474f38fc48be fixed it for me.", "author": "mchang@mozilla.com", "id": 11607774, "time": "2016-08-08T18:11:50Z"}, {"text": "(In reply to Mason Chang [:mchang] from comment #118)\n> This is a pretty serious bug in bug 1292767 as I can no longer go to any\n> URL. I confirmed that backing out revision 474f38fc48be fixed it for me.\n\nUniversal Search is not part of Firefox. It's an experimental add-on.\n\nThere's no reason to assume it will always work against the latest Nightly.\n\nIf you have problems with it, the problem isn't Nightly, it's the add-on :-)", "author": "jhirsch@mozilla.com", "id": 11612800, "time": "2016-08-10T00:26:45Z"}, {"text": "I tried to search, but my Bugzilla search foo is not what it used to be in my youth.  Is there an open issue for the tab key behavior not working like before?  I have removed all search engines so that the Awesomebar looks like the old search.  But when I type something and press Tab, focus moves to an invisible Search Options button instead of cycling through the entries in the dropdown list.  This is contrary the behavior in the other major Windows browsers.", "author": "dean_tessman@hotmail.com", "id": 11614377, "time": "2016-08-10T14:46:17Z"}, {"text": "(In reply to Dean Tessman from comment #120)\n> Is there an open issue for the tab key behavior not working like\n> before?\n\nYes, bug 1292321. See the \"depends on\" list at the top of this bug.", "author": "dolske@mozilla.com", "id": 11616125, "time": "2016-08-10T23:19:39Z"}, {"text": "I'm assuming this is not getting backed out due to regressions, and those regressions are handled instead?  Do we have a timeline?  It'd be good if they don't make it to Aurora.", "author": "milan@mozilla.com", "id": 11668119, "time": "2016-08-30T22:04:10Z"}, {"text": "Which regressions?  It's preffed on only on Nightly right now.", "author": "adw@mozilla.com", "id": 11668240, "time": "2016-08-30T22:47:25Z"}, {"text": "Yes, this feature won't ride the trains yet so we have time to fix any followups.", "author": "past@mozilla.com", "id": 11669699, "time": "2016-08-31T13:42:15Z"}, {"text": "(In reply to Drew Willcoxon :adw from comment #123)\n> Which regressions?  It's preffed on only on Nightly right now.\n\n(In reply to Panos Astithas [:past] from comment #124)\n> Yes, this feature won't ride the trains yet so we have time to fix any\n> followups.\n\nThese two comments are contradicting. It *is* riding the trains, the pref exists and is usable in DevEdition (Aurora). Is this expected? Will it keep riding the trains (pref'd off)?\n\nCan you please confirm this is expected? I need to write compatibility code that relies on it existing or not into my add-on. ;)", "author": "quicksaver@gmail.com", "id": 11850188, "time": "2016-11-10T12:11:01Z"}, {"text": "The feature won't be enabled by default (will be preffed off), but the code will ride the train and the pref can be flipped manually.", "author": "mak77@bonardo.net", "id": 11850197, "time": "2016-11-10T12:17:13Z"}, {"text": "Ok, for anyone coming from a search engine and wondering how to disable this latest, unneeded, confusing piece of mental wank from the Clumzilla people:\n\nDrop into about:config and set browser.urlbar.oneOffSearches to false.\n\n(yes I know, \"this is not a support forum, yada yada\". If you hadn't broken it nobody would be out there searching how to fix it, so fuck off)", "author": "novaconta@yopmail.fr", "id": 12849200, "time": "2017-11-16T16:30:15Z"}], "cf_last_resolved": "2016-08-03T15:05:40Z", "priority": "P2", "mentors_detail": [], "cf_crash_signature": "", "version": "unspecified", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox59": "---", "last_change_time": "2017-11-16T18:12:38Z", "cf_platform_rel": "---", "product": "Firefox", "cf_status_firefox_esr52": "---", "blocks": [1175646, 1212397, 1191520, 1292767, 1369012], "qa_contact": "", "see_also": [], "cf_fx_iteration": "---", "component": "Search", "votes": 1, "groups": [], "cf_status_firefox60": "---", "target_milestone": "Firefox 51", "is_cc_accessible": true, "url": "", "creator_detail": {"email": "ntim.bugs@gmail.com", "id": 445472, "name": "ntim.bugs@gmail.com", "real_name": "Tim Nguyen :ntim"}, "whiteboard": "[fxsearch][consistency]", "mentors": [], "cc_detail": [{"email": "6lobe@unseen.is", "id": 516695, "name": "6lobe@unseen.is", "real_name": ""}, {"email": "adw@mozilla.com", "id": 334927, "name": "adw@mozilla.com", "real_name": "Drew Willcoxon :adw"}, {"email": "akashnawaf@gmail.com", "id": 557633, "name": "akashnawaf@gmail.com", "real_name": "Nawaf Chowdhury Akash"}, {"email": "apollo2k4@narod.ru", "id": 506986, "name": "apollo2k4@narod.ru", "real_name": ""}, {"email": "dao+bmo@mozilla.com", "id": 219124, "name": "dao+bmo@mozilla.com", "real_name": "D\u00e3o Gottwald [::dao]"}, {"email": "dolske@mozilla.com", "id": 27780, "name": "dolske@mozilla.com", "real_name": "Justin Dolske [:Dolske]"}, {"email": "elbart@gmx.de", "id": 470123, "name": "elbart@gmx.de", "real_name": "Elbart"}, {"email": "florian@queze.net", "id": 149052, "name": "florian@queze.net", "real_name": "Florian Qu\u00e8ze [:florian]"}, {"email": "jhirsch@mozilla.com", "id": 446735, "name": "jhirsch@mozilla.com", "real_name": "Jared Hirsch [:_6a68] [:jhirsch]"}, {"email": "mak77@bonardo.net", "id": 240353, "name": "mak77@bonardo.net", "real_name": "Marco Bonardo [::mak]"}, {"email": "mcastelluccio@mozilla.com", "id": 420453, "name": "mcastelluccio@mozilla.com", "real_name": "Marco Castelluccio [:marco]"}, {"email": "mchang@mozilla.com", "id": 482523, "name": "mchang@mozilla.com", "real_name": "Mason Chang [Inactive]  [:mchang]"}, {"email": "mhoye@mozilla.com", "id": 461850, "name": "mhoye@mozilla.com", "real_name": "Mike Hoye [:mhoye]"}, {"email": "milan@mozilla.com", "id": 456486, "name": "milan@mozilla.com", "real_name": "Milan Sreckovic [:milan]"}, {"email": "past@mozilla.com", "id": 363318, "name": "past@mozilla.com", "real_name": "Panos Astithas [:past] (please ni?)"}, {"email": "quicksaver@gmail.com", "id": 420205, "name": "quicksaver@gmail.com", "real_name": "Lu\u00eds Miguel [:quicksaver] (not reading bugmail)"}, {"email": "rtanglao@mozilla.com", "id": 352356, "name": "rtanglao@mozilla.com", "real_name": "Roland Tanglao needinfo please :rolandtanglao, :mohnkuchen, :adobo, :sinigang, :roland"}, {"email": "shorlander@mozilla.com", "id": 136536, "name": "shorlander@mozilla.com", "real_name": "Stephen Horlander [:shorlander]"}, {"email": "simona.marcu@softvision.ro", "id": 409434, "name": "simona.marcu@softvision.ro", "real_name": "Simona Badau [Away. Please needinfo? Alin Deac [:alindeac]]"}], "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [{"status": "+", "name": "firefox-backlog", "modification_date": "2015-07-07T08:49:52Z", "type_id": 846, "creation_date": "2015-07-07T08:49:52Z", "id": 1203173, "setter": "mak77@bonardo.net"}], "cf_tracking_firefox58": "---", "cf_rank": "22", "is_open": false, "resolution": "FIXED", "op_sys": "Unspecified", "cf_fx_points": "---", "history": [{"changes": [{"removed": "", "field_name": "cc", "added": "dolske@mozilla.com, florian@queze.net"}, {"removed": "General", "field_name": "component", "added": "Search"}, {"removed": "", "field_name": "whiteboard", "added": "[fxsearch]"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(dolske@mozilla.com), needinfo?(florian@queze.net)"}], "who": "ntim.bugs@gmail.com", "when": "2015-07-06T22:45:09Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "shorlander@mozilla.com"}, {"removed": "needinfo?(florian@queze.net)", "field_name": "flagtypes.name", "added": "needinfo?(shorlander@mozilla.com)"}], "who": "florian@queze.net", "when": "2015-07-06T23:01:59Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "mak77@bonardo.net"}], "who": "mak77@bonardo.net", "when": "2015-07-07T08:48:47Z"}, {"changes": [{"removed": "--", "field_name": "priority", "added": "P3"}, {"removed": "needinfo?(dolske@mozilla.com)", "field_name": "flagtypes.name", "added": "firefox-backlog+"}], "who": "mak77@bonardo.net", "when": "2015-07-07T08:49:52Z"}, {"changes": [{"removed": "needinfo?(shorlander@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "shorlander@mozilla.com", "when": "2015-07-10T21:32:46Z"}, {"changes": [{"removed": "", "field_name": "cf_rank", "added": "35"}], "who": "sescalante@mozilla.com", "when": "2015-08-05T15:46:23Z"}, {"changes": [{"removed": "ASSIGNED", "field_name": "status", "added": "NEW"}, {"removed": "ntim.bugs@gmail.com", "field_name": "assigned_to", "added": "nobody@mozilla.org"}], "who": "ntim.bugs@gmail.com", "when": "2015-08-05T16:17:46Z"}, {"changes": [{"removed": "", "field_name": "blocks", "added": "1191520"}], "who": "dtownsend@mozilla.com", "when": "2015-08-05T21:30:43Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "aleth@instantbird.org"}], "who": "mak77@bonardo.net", "when": "2015-08-16T08:08:14Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "dao@mozilla.com"}], "who": "dao+bmo@mozilla.com", "when": "2015-08-22T17:46:04Z"}, {"changes": [{"removed": "", "field_name": "blocks", "added": "1175646"}], "who": "mak77@bonardo.net", "when": "2015-09-09T15:37:29Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "dev.lukaszpolowczyk@gmail.com"}], "who": "dev.lukaszpolowczyk@gmail.com", "when": "2015-09-22T15:59:17Z"}, {"changes": [{"removed": "", "field_name": "blocks", "added": "1212397"}], "who": "mak77@bonardo.net", "when": "2015-11-04T14:49:12Z"}, {"changes": [{"removed": "35", "field_name": "cf_rank", "added": ""}, {"removed": "P3", "field_name": "priority", "added": "P2"}], "who": "mak77@bonardo.net", "when": "2015-11-04T14:50:14Z"}, {"changes": [{"removed": "[fxsearch]", "field_name": "whiteboard", "added": "[fxsearch][consistency]"}], "who": "mak77@bonardo.net", "when": "2015-11-04T14:50:32Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "mar.castelluccio@studenti.unina.it"}], "who": "mcastelluccio@mozilla.com", "when": "2015-11-04T15:26:31Z"}, {"changes": [{"removed": "", "field_name": "cf_rank", "added": "22"}], "who": "sescalante@mozilla.com", "when": "2015-11-18T17:10:57Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "quicksaver@gmail.com"}], "who": "quicksaver@gmail.com", "when": "2016-01-26T10:14:32Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "dqeswn@gmail.com"}], "who": "dqeswn@gmail.com", "when": "2016-02-14T16:32:15Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "ASSIGNED"}, {"removed": "", "field_name": "cc", "added": "adw@mozilla.com"}, {"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "adw@mozilla.com"}], "who": "adw@mozilla.com", "when": "2016-06-11T05:48:58Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "ge3k0s@gmail.com"}], "who": "ge3k0s@gmail.com", "when": "2016-06-11T12:30:32Z"}, {"changes": [{"field_name": "attachments.description", "removed": "Bug 1180944 - Implement one-off searches from Awesomebar", "attachment_id": 8762257, "added": "Bug 1180944 - Implement one-off searches from Awesomebar. r="}], "who": "adw@mozilla.com", "when": "2016-06-16T09:53:44Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8762257, "added": "review?(florian@queze.net)"}], "who": "adw@mozilla.com", "when": "2016-06-16T09:54:31Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8762257, "added": "review?(mak77@bonardo.net)"}], "who": "adw@mozilla.com", "when": "2016-06-16T09:55:20Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "past@mozilla.com"}], "who": "past@mozilla.com", "when": "2016-06-17T14:43:53Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8763297, "added": "review?(mak77@bonardo.net)"}, {"field_name": "flagtypes.name", "removed": "review?(florian@queze.net), review?(mak77@bonardo.net)", "attachment_id": 8762257, "added": ""}], "who": "adw@mozilla.com", "when": "2016-06-18T04:56:23Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8763297, "added": "review?(florian@queze.net)"}], "who": "adw@mozilla.com", "when": "2016-06-18T05:02:40Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8762257, "added": "1"}], "who": "adw@mozilla.com", "when": "2016-06-18T05:03:00Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(mak77@bonardo.net), review?(florian@queze.net)", "attachment_id": 8763297, "added": ""}], "who": "adw@mozilla.com", "when": "2016-06-18T05:07:36Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "1", "attachment_id": 8762257, "added": "0"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8762257, "added": "review?(florian@queze.net), review?(mak77@bonardo.net)"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8763297, "added": "review?(florian@queze.net), review?(mak77@bonardo.net)"}], "who": "adw@mozilla.com", "when": "2016-06-18T05:13:25Z"}, {"changes": [{"removed": "dev.lukaszpolowczyk@gmail.com", "field_name": "cc", "added": ""}], "who": "dev.lukaszpolowczyk@gmail.com", "when": "2016-06-18T10:49:34Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(florian@queze.net), review?(mak77@bonardo.net)", "attachment_id": 8762257, "added": ""}], "who": "adw@mozilla.com", "when": "2016-06-20T16:36:03Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(mak77@bonardo.net)", "attachment_id": 8763297, "added": ""}], "who": "mak77@bonardo.net", "when": "2016-06-22T11:44:56Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(florian@queze.net)", "attachment_id": 8763297, "added": ""}], "who": "florian@queze.net", "when": "2016-06-28T23:31:14Z"}, {"changes": [{"field_name": "attachments.description", "removed": "Bug 1180944 - Implement one-off searches from Awesomebar. r=", "attachment_id": 8762257, "added": "Bug 1180944 - Implement one-off searches from Awesomebar"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8762257, "added": "review?(florian@queze.net), review?(mak77@bonardo.net)"}], "who": "adw@mozilla.com", "when": "2016-07-01T05:27:39Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8763297, "added": "1"}], "who": "adw@mozilla.com", "when": "2016-07-01T05:27:42Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8762257, "added": "1"}, {"field_name": "flagtypes.name", "removed": "review?(florian@queze.net), review?(mak77@bonardo.net)", "attachment_id": 8762257, "added": ""}], "who": "adw@mozilla.com", "when": "2016-07-01T05:31:31Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "1", "attachment_id": 8762257, "added": "0"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8762257, "added": "review?(florian@queze.net), review?(mak77@bonardo.net)"}], "who": "adw@mozilla.com", "when": "2016-07-01T05:32:34Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8762257, "added": "1"}, {"field_name": "flagtypes.name", "removed": "review?(florian@queze.net), review?(mak77@bonardo.net)", "attachment_id": 8762257, "added": ""}], "who": "adw@mozilla.com", "when": "2016-07-01T05:32:55Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "1", "attachment_id": 8762257, "added": "0"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8762257, "added": "review?(florian@queze.net), review?(mak77@bonardo.net)"}], "who": "adw@mozilla.com", "when": "2016-07-01T05:39:23Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8762257, "added": "1"}, {"field_name": "flagtypes.name", "removed": "review?(florian@queze.net), review?(mak77@bonardo.net)", "attachment_id": 8762257, "added": ""}], "who": "adw@mozilla.com", "when": "2016-07-01T05:40:07Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8767056, "added": "review?(florian@queze.net), review?(mak77@bonardo.net)"}], "who": "adw@mozilla.com", "when": "2016-07-01T06:00:18Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(mak77@bonardo.net)", "attachment_id": 8767056, "added": ""}], "who": "mak77@bonardo.net", "when": "2016-07-07T14:47:16Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8767056, "added": "review?(mak77@bonardo.net)"}], "who": "adw@mozilla.com", "when": "2016-07-08T01:09:56Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(shorlander@mozilla.com)"}], "who": "adw@mozilla.com", "when": "2016-07-08T01:18:24Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(mak77@bonardo.net)", "attachment_id": 8767056, "added": "review+"}], "who": "mak77@bonardo.net", "when": "2016-07-08T09:41:11Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(florian@queze.net)", "attachment_id": 8767056, "added": "review+"}], "who": "florian@queze.net", "when": "2016-07-08T12:23:24Z"}, {"changes": [{"removed": "needinfo?(shorlander@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "shorlander@mozilla.com", "when": "2016-07-08T19:32:11Z"}, {"changes": [{"field_name": "attachments.description", "removed": "Bug 1180944 - Implement one-off searches from Awesomebar", "attachment_id": 8767056, "added": "Bug 1180944 - Implement one-off searches from Awesomebar."}], "who": "adw@mozilla.com", "when": "2016-07-21T06:55:52Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review+, review+", "attachment_id": 8767056, "added": "review?(florian@queze.net), review?(mak77@bonardo.net)"}], "who": "adw@mozilla.com", "when": "2016-07-21T07:00:52Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(florian@queze.net)", "attachment_id": 8767056, "added": "review-"}], "who": "florian@queze.net", "when": "2016-07-22T18:13:36Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review-", "attachment_id": 8767056, "added": "review?(florian@queze.net)"}], "who": "adw@mozilla.com", "when": "2016-07-23T00:58:02Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8774303, "added": "feedback?(adw@mozilla.com)"}], "who": "florian@queze.net", "when": "2016-07-25T12:29:43Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(shorlander@mozilla.com)"}], "who": "adw@mozilla.com", "when": "2016-07-25T17:14:54Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8774303, "added": "1"}, {"field_name": "flagtypes.name", "removed": "feedback?(adw@mozilla.com)", "attachment_id": 8774303, "added": ""}], "who": "adw@mozilla.com", "when": "2016-07-25T20:54:50Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(mak77@bonardo.net)", "attachment_id": 8767056, "added": "review+"}], "who": "mak77@bonardo.net", "when": "2016-07-26T12:40:45Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(florian@queze.net)", "attachment_id": 8767056, "added": "review+"}], "who": "florian@queze.net", "when": "2016-07-26T14:36:59Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review+, review+", "attachment_id": 8767056, "added": ""}], "who": "adw@mozilla.com", "when": "2016-07-27T01:23:07Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8767056, "added": "review?(florian@queze.net)"}], "who": "adw@mozilla.com", "when": "2016-07-27T01:28:18Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8767056, "added": "review?(mak77@bonardo.net)"}], "who": "adw@mozilla.com", "when": "2016-07-27T01:28:47Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(florian@queze.net)", "attachment_id": 8767056, "added": "review+"}], "who": "florian@queze.net", "when": "2016-07-27T14:39:28Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(mak77@bonardo.net)", "attachment_id": 8767056, "added": "review+"}], "who": "mak77@bonardo.net", "when": "2016-08-02T15:16:36Z"}, {"changes": [{"removed": "ASSIGNED", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "Firefox 51"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2016-08-03 15:05:40"}, {"removed": "---", "field_name": "cf_status_firefox51", "added": "fixed"}], "who": "cbook@mozilla.com", "when": "2016-08-03T15:05:40Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1292174"}], "who": "shorlander@mozilla.com", "when": "2016-08-04T15:14:37Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1292321"}], "who": "cpeterson@mozilla.com", "when": "2016-08-04T20:03:54Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1292511"}], "who": "mozilla@metasieben.org", "when": "2016-08-05T11:33:00Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1292519"}], "who": "dao+bmo@mozilla.com", "when": "2016-08-05T11:56:18Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1292520"}], "who": "dao+bmo@mozilla.com", "when": "2016-08-05T12:02:05Z"}, {"changes": [{"removed": "1292520", "field_name": "depends_on", "added": ""}], "who": "adw@mozilla.com", "when": "2016-08-05T17:28:23Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1292630"}], "who": "mconley@mozilla.com", "when": "2016-08-05T17:41:55Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1292640"}], "who": "cpeterson@mozilla.com", "when": "2016-08-05T18:21:45Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "6lobe@unseen.is"}], "who": "6lobe@unseen.is", "when": "2016-08-06T12:38:52Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "akashnawaf@gmail.com"}], "who": "akashnawaf@gmail.com", "when": "2016-08-06T15:14:39Z"}, {"changes": [{"removed": "RESOLVED", "field_name": "status", "added": "VERIFIED"}, {"removed": "fixed", "field_name": "cf_status_firefox51", "added": "affected"}], "who": "ntim.bugs@gmail.com", "when": "2016-08-06T18:33:54Z"}, {"changes": [{"removed": "affected", "field_name": "cf_status_firefox51", "added": "verified"}], "who": "ntim.bugs@gmail.com", "when": "2016-08-06T18:34:24Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1293300"}], "who": "edilee@mozilla.com", "when": "2016-08-08T15:42:16Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "rtanglao@mozilla.com"}], "who": "rtanglao@mozilla.com", "when": "2016-08-08T16:50:08Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "mchang@mozilla.com"}, {"removed": "", "field_name": "blocks", "added": "1292767"}], "who": "mchang@mozilla.com", "when": "2016-08-08T18:11:50Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "6a68@mozilla.com"}], "who": "jhirsch@mozilla.com", "when": "2016-08-10T00:26:45Z"}, {"changes": [{"removed": "needinfo?(shorlander@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "adw@mozilla.com", "when": "2016-08-11T20:18:37Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1294110"}], "who": "alice0775@yahoo.co.jp", "when": "2016-08-11T20:31:46Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1294733"}], "who": "alex_mayorga@yahoo.com", "when": "2016-08-12T15:49:58Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1295253"}], "who": "adw@mozilla.com", "when": "2016-08-15T19:55:34Z"}, {"changes": [{"removed": "aleth@instantbird.org", "field_name": "cc", "added": ""}], "who": "aleth@instantbird.org", "when": "2016-08-15T21:12:00Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1295458"}], "who": "adw@mozilla.com", "when": "2016-08-16T05:06:38Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1295460"}], "who": "adw@mozilla.com", "when": "2016-08-16T05:07:34Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1295463"}], "who": "adw@mozilla.com", "when": "2016-08-16T05:08:47Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1296366"}], "who": "oriol-bugzilla@hotmail.com", "when": "2016-08-18T17:44:09Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1297374"}], "who": "cirdeiliviu@gmail.com", "when": "2016-08-23T13:06:26Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1297382"}], "who": "cirdeiliviu@gmail.com", "when": "2016-08-23T13:40:13Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1297395"}], "who": "roxana.leitan@softvision.ro", "when": "2016-08-23T14:19:02Z"}, {"changes": [{"removed": "dqeswn@gmail.com", "field_name": "cc", "added": ""}], "who": "dqeswn@gmail.com", "when": "2016-08-23T20:39:50Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1297627"}], "who": "cirdeiliviu@gmail.com", "when": "2016-08-24T08:05:11Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1297976"}], "who": "roxana.leitan@softvision.ro", "when": "2016-08-25T08:09:51Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1298047"}], "who": "roxana.leitan@softvision.ro", "when": "2016-08-25T14:44:22Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "milan@mozilla.com"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(adw@mozilla.com)"}], "who": "milan@mozilla.com", "when": "2016-08-30T22:04:10Z"}, {"changes": [{"removed": "needinfo?(adw@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "adw@mozilla.com", "when": "2016-08-30T22:47:25Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "apollo2k4@narod.ru"}], "who": "apollo2k4@narod.ru", "when": "2016-08-31T08:18:38Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1294887"}], "who": "cirdeiliviu@gmail.com", "when": "2016-08-31T14:52:53Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1300053"}], "who": "dao+bmo@mozilla.com", "when": "2016-09-02T07:34:04Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1300649"}], "who": "magicp.jp@gmail.com", "when": "2016-09-06T01:26:23Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1299458"}], "who": "adw@mozilla.com", "when": "2016-09-12T23:37:48Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1303259"}], "who": "dao+bmo@mozilla.com", "when": "2016-09-16T05:39:40Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1303462"}], "who": "adw@mozilla.com", "when": "2016-09-17T03:16:08Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1303811"}], "who": "philringnalda@gmail.com", "when": "2016-09-20T01:24:42Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1306270"}], "who": "cirdeiliviu@gmail.com", "when": "2016-09-29T12:26:22Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1306308"}], "who": "cirdeiliviu@gmail.com", "when": "2016-09-29T14:26:55Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1303781"}], "who": "mcastelluccio@mozilla.com", "when": "2016-10-02T17:39:07Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1306639"}], "who": "mak77@bonardo.net", "when": "2016-10-04T16:54:29Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1311292"}], "who": "cirdeiliviu@gmail.com", "when": "2016-10-19T09:40:11Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1311640"}], "who": "cirdeiliviu@gmail.com", "when": "2016-10-20T09:48:33Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1311654"}], "who": "cirdeiliviu@gmail.com", "when": "2016-10-20T11:09:32Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1311998"}], "who": "cirdeiliviu@gmail.com", "when": "2016-10-21T13:54:45Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1313843"}], "who": "dqeswn@gmail.com", "when": "2016-10-29T10:06:11Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1313969"}], "who": "adw@mozilla.com", "when": "2016-10-31T04:42:01Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1314643"}], "who": "cirdeiliviu@gmail.com", "when": "2016-11-02T16:20:23Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(adw@mozilla.com)"}], "who": "quicksaver@gmail.com", "when": "2016-11-10T12:11:01Z"}, {"changes": [{"removed": "needinfo?(adw@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "mak77@bonardo.net", "when": "2016-11-10T12:17:13Z"}, {"changes": [{"removed": "ge3k0s@gmail.com", "field_name": "cc", "added": ""}], "who": "ge3k0s@gmail.com", "when": "2016-11-10T12:20:27Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1316566"}], "who": "quicksaver@gmail.com", "when": "2016-11-10T12:26:33Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "elbart@gmx.de"}], "who": "elbart@gmx.de", "when": "2016-11-11T10:14:59Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "simona.marcu@softvision.ro"}], "who": "simona.marcu@softvision.ro", "when": "2016-11-15T14:52:23Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1327963"}], "who": "yfdyh000@gmail.com", "when": "2017-01-13T19:19:42Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1335992"}], "who": "alice0775@yahoo.co.jp", "when": "2017-02-02T04:47:26Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1339457"}], "who": "VYV03354@nifty.ne.jp", "when": "2017-02-14T15:46:26Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1343507"}], "who": "adw@mozilla.com", "when": "2017-03-01T12:13:44Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1353831"}], "who": "yfdyh000@gmail.com", "when": "2017-04-07T05:41:16Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1357458"}], "who": "simona.marcu@softvision.ro", "when": "2017-04-18T16:01:27Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1357800"}], "who": "simona.marcu@softvision.ro", "when": "2017-04-19T16:08:24Z"}, {"changes": [{"removed": "1357800", "field_name": "depends_on", "added": ""}], "who": "adw@mozilla.com", "when": "2017-04-19T16:20:39Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1358676"}], "who": "adw@mozilla.com", "when": "2017-04-21T23:57:50Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1358677"}], "who": "adw@mozilla.com", "when": "2017-04-21T23:58:23Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1358136"}], "who": "simona.marcu@softvision.ro", "when": "2017-04-26T08:05:28Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1360227"}], "who": "simona.marcu@softvision.ro", "when": "2017-04-27T14:57:19Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1363355"}], "who": "roxana.leitan@softvision.ro", "when": "2017-05-09T12:58:32Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1363381"}], "who": "roxana.leitan@softvision.ro", "when": "2017-05-09T14:05:11Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1363407"}], "who": "simona.marcu@softvision.ro", "when": "2017-05-09T15:04:42Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1363692"}], "who": "simona.marcu@softvision.ro", "when": "2017-05-10T11:43:52Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1366872"}], "who": "simona.marcu@softvision.ro", "when": "2017-05-23T06:43:00Z"}, {"changes": [{"removed": "", "field_name": "blocks", "added": "1369012"}], "who": "mak77@bonardo.net", "when": "2017-05-31T12:37:22Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1369016"}], "who": "mcastelluccio@mozilla.com", "when": "2017-05-31T12:50:06Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1369688"}], "who": "simona.marcu@softvision.ro", "when": "2017-06-02T10:12:47Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1370000"}], "who": "past@mozilla.com", "when": "2017-06-03T13:12:13Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1372528"}], "who": "petruta.rasa@softvision.ro", "when": "2017-06-13T09:47:07Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1373990"}], "who": "itiel_yn8@walla.com", "when": "2017-06-17T21:39:20Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1380538"}], "who": "alice0775@yahoo.co.jp", "when": "2017-07-13T04:58:27Z"}, {"changes": [{"removed": "1380538", "field_name": "depends_on", "added": ""}], "who": "past@mozilla.com", "when": "2017-07-13T09:35:12Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "mhoye@mozilla.com"}], "who": "mhoye@mozilla.com", "when": "2017-11-16T18:12:38Z"}]}