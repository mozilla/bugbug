{"cf_tracking_thunderbird_esr52": "---", "status": "RESOLVED", "cf_tracking_firefox60": "---", "attachments": [{"creator": "terrence.d.cole@gmail.com", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2015-02-12T18:22:43Z", "type_id": 4, "creation_date": "2015-02-12T18:22:43Z", "id": 1098976, "setter": "sphink@gmail.com"}], "content_type": "text/plain", "id": 8563129}], "classification": "Components", "creator": "terrence.d.cole@gmail.com", "cc": ["jcoppeard@mozilla.com", "sphink@gmail.com", "terrence.d.cole@gmail.com"], "depends_on": [1131789, 1131877, 1132149, 1132282], "creation_time": "2015-02-12T00:19:55Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "All", "cf_status_firefox58": "---", "cf_status_firefox59": "---", "keywords": [], "summary": "Simplify new object cache allocation", "id": 1132286, "assigned_to_detail": {"email": "terrence.d.cole@gmail.com", "id": 231770, "name": "terrence.d.cole@gmail.com", "real_name": "Terrence Cole [:terrence]"}, "severity": "normal", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "assigned_to": "terrence.d.cole@gmail.com", "comment_count": 7, "comments": [{"text": "Created attachment 8563129\n3.1_simplify_noc_lookups-v0.diff\n\nThis pushes the retry down one level, now that we don't need to do the rooting dance in the callers. I think we can probably push down another level, but it's going to require some care, so one layer at a time.", "author": "terrence.d.cole@gmail.com", "id": 9910477, "time": "2015-02-12T00:19:55Z"}, {"text": "Try run with the stack looks green --  \nhttps://treeherder.mozilla.org/#/jobs?repo=try&revision=d8328b81b7de\n\nThis is hot code and even has some some specific tests exercising it, so I'm pretty confident that this patch works as expected.", "author": "terrence.d.cole@gmail.com", "id": 9913324, "time": "2015-02-12T17:31:28Z"}, {"text": "Comment on attachment 8563129\n3.1_simplify_noc_lookups-v0.diff\n\nReview of attachment 8563129:\n-----------------------------------------------------------------\n\n::: js/src/jsobj.cpp\n@@ +1541,2 @@\n>          cache.fillGroup(entry, group, allocKind, &obj->as<NativeObject>());\n> +    }\n\nI don't follow the gcNumber logic. I can't figure out what it's protecting against.\n\nIf the cache lookup fails, then entry will be -1, and gcNumber will never matter. So why bother recording it? And in what path would a GC make it invalid to populate the cache anyway? I don't see pointers here that could be moved.", "author": "sphink@gmail.com", "id": 9913492, "time": "2015-02-12T18:06:42Z"}, {"text": "Comment on attachment 8563129\n3.1_simplify_noc_lookups-v0.diff\n\nReview of attachment 8563129:\n-----------------------------------------------------------------\n\n::: js/src/jsobj.cpp\n@@ +1541,2 @@\n>          cache.fillGroup(entry, group, allocKind, &obj->as<NativeObject>());\n> +    }\n\nOk, I get it now. Then this needs comments. It's way too subtle.\n\nExcept it sounds like you may be doing something different. If not, then at least comment that EntryIndex is invalidated across a GC. And there's probably something worth saying about how it always populates the cache, but I'm not sure what.", "author": "sphink@gmail.com", "id": 9913559, "time": "2015-02-12T18:22:43Z"}, {"text": "I just added a comment to my new patch that would be very helpful. I'll backport some form of that to this patch.", "author": "terrence.d.cole@gmail.com", "id": 9914179, "time": "2015-02-12T20:41:55Z"}, {"text": "https://treeherder.mozilla.org/#/jobs?repo=try&revision=d8328b81b7de\nhttps://hg.mozilla.org/integration/mozilla-inbound/rev/4638a1552904", "author": "terrence.d.cole@gmail.com", "id": 9927628, "time": "2015-02-17T19:19:28Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/4638a1552904", "author": "ryanvm@gmail.com", "id": 9929675, "time": "2015-02-18T02:40:38Z"}], "cf_last_resolved": "2015-02-18T02:40:38Z", "priority": "--", "mentors_detail": [], "cf_crash_signature": "", "version": "Trunk", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox59": "---", "last_change_time": "2015-02-18T02:40:38Z", "cf_platform_rel": "---", "product": "Core", "cf_status_firefox_esr52": "---", "blocks": [1130211, 1132706], "qa_contact": "", "see_also": [], "cf_fx_iteration": "---", "component": "JavaScript: GC", "votes": 0, "groups": [], "cf_status_firefox60": "---", "target_milestone": "mozilla38", "is_cc_accessible": true, "cf_status_thunderbird_esr52": "---", "url": "", "creator_detail": {"email": "terrence.d.cole@gmail.com", "id": 231770, "name": "terrence.d.cole@gmail.com", "real_name": "Terrence Cole [:terrence]"}, "whiteboard": "", "mentors": [], "cc_detail": [{"email": "jcoppeard@mozilla.com", "id": 443194, "name": "jcoppeard@mozilla.com", "real_name": "Jon Coppeard (:jonco) (PTO until 13th March)"}, {"email": "sphink@gmail.com", "id": 359004, "name": "sphink@gmail.com", "real_name": "Steve Fink [:sfink] [:s:]"}, {"email": "terrence.d.cole@gmail.com", "id": 231770, "name": "terrence.d.cole@gmail.com", "real_name": "Terrence Cole [:terrence]"}], "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "cf_tracking_firefox58": "---", "cf_rank": null, "is_open": false, "history": [{"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8563129, "added": "review?(sphink@gmail.com)"}], "who": "terrence.d.cole@gmail.com", "when": "2015-02-12T00:19:55Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "terrence@mozilla.com"}], "who": "terrence.d.cole@gmail.com", "when": "2015-02-12T17:31:28Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(sphink@gmail.com)", "attachment_id": 8563129, "added": ""}], "who": "sphink@gmail.com", "when": "2015-02-12T18:06:42Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8563129, "added": "review+"}], "who": "sphink@gmail.com", "when": "2015-02-12T18:22:43Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1132706"}], "who": "terrence.d.cole@gmail.com", "when": "2015-02-12T22:56:38Z"}, {"changes": [{"removed": "", "field_name": "blocks", "added": "1132706"}, {"removed": "1132706", "field_name": "depends_on", "added": ""}], "who": "terrence.d.cole@gmail.com", "when": "2015-02-12T22:57:17Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "terrence@mozilla.com"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla38"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2015-02-17 18:40:38"}, {"removed": "---", "field_name": "cf_status_firefox38", "added": "fixed"}], "who": "ryanvm@gmail.com", "when": "2015-02-18T02:40:38Z"}], "resolution": "FIXED", "op_sys": "All", "cf_fx_points": "---", "cf_blocking_fennec": "---"}