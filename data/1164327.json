{"status": "RESOLVED", "cf_tracking_firefox60": "---", "attachments": [{"creator": "bgrinstead@mozilla.com", "is_obsolete": 1, "is_patch": 1, "flags": [], "content_type": "text/plain", "id": 8609056}, {"creator": "bgrinstead@mozilla.com", "is_obsolete": 1, "is_patch": 1, "flags": [], "content_type": "text/plain", "id": 8609080}, {"creator": "bgrinstead@mozilla.com", "is_obsolete": 1, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2015-05-22T16:56:36Z", "type_id": 748, "creation_date": "2015-05-22T16:50:32Z", "id": 1173275, "setter": "vporof@mozilla.com"}], "content_type": "text/plain", "id": 8609477}, {"creator": "bgrinstead@mozilla.com", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2015-05-25T00:38:19Z", "type_id": 748, "creation_date": "2015-05-25T00:38:19Z", "id": 1173902, "setter": "bgrinstead@mozilla.com"}], "content_type": "text/plain", "id": 8609915}], "classification": "Client Software", "creator": "jordan@jsantell.com", "cc": ["bgrinstead@mozilla.com", "vporof@mozilla.com"], "depends_on": [], "creation_time": "2015-05-13T04:03:14Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "cf_status_firefox58": "---", "cf_status_firefox59": "---", "keywords": [], "summary": "Resizing performance tool doesn't not maintain selection accurately", "cf_last_resolved": "2015-05-26T23:00:49Z", "assigned_to_detail": {"email": "bgrinstead@mozilla.com", "id": 476442, "name": "bgrinstead@mozilla.com", "real_name": "Brian Grinstead [:bgrins]"}, "severity": "normal", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "assigned_to": "bgrinstead@mozilla.com", "comment_count": 18, "comments": [{"text": "If I have a selection in the overview graph, say 500px selection, somewhere in the middle of a 1000px graph of a 1000ms recording, 250px from the left, so I have the 250ms-750ms selected, right?\n\nStretch out the window so it's 2000px now. My selection should have the some proportions, and still have 250ms-750ms selected. Instead, it's still a 500px selection, 250px from the left.", "author": "jordan@jsantell.com", "id": 10262175, "time": "2015-05-13T04:03:14Z"}, {"text": "Another weird thing is that once the window is stretched out, the timeline size never shrinks even if the window size is restored.  So if you make window really big and then small again, it seems like the timeline is being clipped", "author": "bgrinstead@mozilla.com", "id": 10285824, "time": "2015-05-19T17:50:31Z"}, {"text": "Yeah, bug 1122662. I'm having a hard time understanding what the heck is going on. I suspect it's because of the canvases inside the iframes not being able to shrink down, but some quick css massaging didn't help.", "author": "vporof@mozilla.com", "id": 10287027, "time": "2015-05-19T21:42:05Z"}, {"text": "(In reply to Victor Porof [:vporof][:vp] from comment #2)\n> Yeah, bug 1122662. I'm having a hard time understanding what the heck is\n> going on. I suspect it's because of the canvases inside the iframes not\n> being able to shrink down, but some quick css massaging didn't help.\n\nI can take a look at this bug, let me know if you want me to look into that one also", "author": "bgrinstead@mozilla.com", "id": 10287085, "time": "2015-05-19T21:52:55Z"}, {"text": "Feel free to take a glance at bug 1122662 if you want to. I've haven't been very successful with it.", "author": "vporof@mozilla.com", "id": 10287145, "time": "2015-05-19T22:08:54Z"}, {"text": "Created attachment 8609056\nselection-resize.patch\n\nI think this does the trick.  Still needs test", "author": "bgrinstead@mozilla.com", "id": 10298195, "time": "2015-05-21T22:38:38Z"}, {"text": "Created attachment 8609080\ncanvas-redraw-WIP.patch\n\nsome ideas on how to improve perceived perf on canvas redraws\n\n1) Use deferredtask so it gets redrawn while resizing (up to once per N ms)\n2) Don't reset the canvas width until the redraw actually happens to get rid of white flicker\n3) Set the canvas's CSS width from code instead of relying on 100% from CSS - this gets rid of the font zooming thing that happens during resizing", "author": "bgrinstead@mozilla.com", "id": 10298339, "time": "2015-05-21T23:11:19Z"}, {"text": "Comment on attachment 8609080\ncanvas-redraw-WIP.patch\n\nReview of attachment 8609080:\n-----------------------------------------------------------------\n\n::: browser/devtools/shared/widgets/Graphs.jsm\n@@ +29,5 @@\n>  const L10N = new ViewHelpers.L10N();\n>  \n>  // Generic constants.\n>  \n> +const GRAPH_RESIZE_EVENTS_DRAIN = 10; // ms\n\nIs this change necessary? For heavy heavy graphs this might result in choppy resizes.\n\n@@ +780,5 @@\n> +    let bounds = this.bounds;\n> +    this._iframe.setAttribute(\"width\", bounds.width);\n> +    this._iframe.setAttribute(\"height\", bounds.height);\n> +    this._canvas.style.width = bounds.width + \"px\";\n> +    this._canvas.style.height =  bounds.height + \"px\";\n\nI'd like us to avoid doing this when not necessary or when sizes didn't change. Currently this can be called whenever hovering, for example, or moving the mouse. Sounds a bit extreme to me.\n\nWhy not keep this in `refresh`? It will cause the widget to redraw anyway, by setting `_shouldRedraw` to true.", "author": "vporof@mozilla.com", "id": 10298390, "time": "2015-05-21T23:27:25Z"}, {"text": "(In reply to Victor Porof [:vporof][:vp] from comment #7)\n> @@ +780,5 @@\n> > +    let bounds = this.bounds;\n> > +    this._iframe.setAttribute(\"width\", bounds.width);\n> > +    this._iframe.setAttribute(\"height\", bounds.height);\n> > +    this._canvas.style.width = bounds.width + \"px\";\n> > +    this._canvas.style.height =  bounds.height + \"px\";\n> \n> I'd like us to avoid doing this when not necessary or when sizes didn't\n> change. Currently this can be called whenever hovering, for example, or\n> moving the mouse. Sounds a bit extreme to me.\n> \n> Why not keep this in `refresh`? It will cause the widget to redraw anyway,\n> by setting `_shouldRedraw` to true.\n\nYeah, I'm not even sure if I will request review on that patch, just stashing some work there.  I moved it there to avoid the 'flicker' that's caused if we allow refreshing during resize (the delay between clearing the canvas by setting width and when the redraw happens.  Likewise, for the CSS width on the frame and canvas if we have a delay between setting it and redrawing then the canvas will sort of zoom itself and cause some weirdness with the text sizing.\n\nI'll have to do some measurements and see if it's even worth proceeding with that.", "author": "bgrinstead@mozilla.com", "id": 10298418, "time": "2015-05-21T23:34:47Z"}, {"text": "Created attachment 8609477\nselection-resize.patch\n\nThis seems to do the trick.  What do you think?\n\nhttps://treeherder.mozilla.org/#/jobs?repo=try&revision=23bfd1e9a95c", "author": "bgrinstead@mozilla.com", "id": 10301058, "time": "2015-05-22T16:50:32Z"}, {"text": "Comment on attachment 8609477\nselection-resize.patch\n\nReview of attachment 8609477:\n-----------------------------------------------------------------\n\nNice and simple", "author": "vporof@mozilla.com", "id": 10301090, "time": "2015-05-22T16:56:36Z"}, {"text": "Ah, need some rounding on the test for Windows: TEST-UNEXPECTED-FAIL | browser/devtools/shared/test/browser_graphs-10c.js | The current selection start value is correct (2). - Got 49.1869918699187, expected 50", "author": "bgrinstead@mozilla.com", "id": 10302227, "time": "2015-05-22T20:17:45Z"}, {"text": "Actually, that's further off than I thought.  Maybe it's because of the window chrome size being different and the graph width is not quite changing to 50%.  Checking on a local build", "author": "bgrinstead@mozilla.com", "id": 10302240, "time": "2015-05-22T20:20:00Z"}, {"text": "Created attachment 8609915\nselection-resize.patch\n\nHad to do a bit of math in the test to account for different a different window size in Windows.", "author": "bgrinstead@mozilla.com", "id": 10305264, "time": "2015-05-25T00:38:19Z"}, {"text": "https://treeherder.mozilla.org/#/jobs?repo=try&revision=9121e785778e", "author": "bgrinstead@mozilla.com", "id": 10305266, "time": "2015-05-25T00:39:39Z"}, {"text": "https://hg.mozilla.org/integration/fx-team/rev/08eb0e8fcbbc", "author": "pulsebot@bots.tld", "id": 10308733, "time": "2015-05-26T08:54:32Z"}, {"text": "https://hg.mozilla.org/integration/fx-team/rev/08eb0e8fcbbc", "author": "cbook@mozilla.com", "id": 10308862, "time": "2015-05-26T09:45:25Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/08eb0e8fcbbc", "author": "kwierso@gmail.com", "id": 10312634, "time": "2015-05-26T23:00:49Z"}], "id": 1164327, "priority": "--", "mentors_detail": [], "cf_crash_signature": "", "version": "41 Branch", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox59": "---", "last_change_time": "2015-05-26T23:00:49Z", "cf_platform_rel": "---", "product": "Firefox", "cf_status_firefox_esr52": "---", "blocks": [1147941], "qa_contact": "", "see_also": ["https://bugzilla.mozilla.org/show_bug.cgi?id=1122662"], "cf_fx_iteration": "---", "component": "Developer Tools: Performance Tools (Profiler/Timeline)", "votes": 0, "groups": [], "cf_status_firefox60": "---", "cf_status_firefox40": "---", "target_milestone": "Firefox 41", "is_cc_accessible": true, "url": "", "creator_detail": {"email": "jordan@jsantell.com", "id": 464691, "name": "jordan@jsantell.com", "real_name": "Jordan Santell [:jsantell] [@jsantell]"}, "whiteboard": "", "mentors": [], "cc_detail": [{"email": "bgrinstead@mozilla.com", "id": 476442, "name": "bgrinstead@mozilla.com", "real_name": "Brian Grinstead [:bgrins]"}, {"email": "vporof@mozilla.com", "id": 414813, "name": "vporof@mozilla.com", "real_name": "Victor Porof [:vporof][:vp]"}], "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "cf_tracking_firefox58": "---", "cf_rank": null, "is_open": false, "resolution": "FIXED", "op_sys": "Unspecified", "cf_fx_points": "---", "history": [{"changes": [{"removed": "", "field_name": "blocks", "added": "1147941"}], "who": "jordan@jsantell.com", "when": "2015-05-13T04:03:30Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "bgrinstead@mozilla.com"}], "who": "bgrinstead@mozilla.com", "when": "2015-05-19T17:50:31Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "vporof@mozilla.com"}], "who": "vporof@mozilla.com", "when": "2015-05-19T21:42:05Z"}, {"changes": [{"removed": "", "field_name": "see_also", "added": "https://bugzilla.mozilla.org/show_bug.cgi?id=1122662"}], "who": "bgrinstead@mozilla.com", "when": "2015-05-19T21:52:12Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "ASSIGNED"}, {"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "bgrinstead@mozilla.com"}], "who": "bgrinstead@mozilla.com", "when": "2015-05-19T21:53:06Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8609477, "added": "review?(vporof@mozilla.com)"}], "who": "bgrinstead@mozilla.com", "when": "2015-05-22T16:50:32Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8609056, "added": "1"}], "who": "bgrinstead@mozilla.com", "when": "2015-05-22T16:50:44Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8609080, "added": "1"}], "who": "bgrinstead@mozilla.com", "when": "2015-05-22T16:51:13Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(vporof@mozilla.com)", "attachment_id": 8609477, "added": "review+"}], "who": "vporof@mozilla.com", "when": "2015-05-22T16:56:36Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8609477, "added": "1"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8609915, "added": "review+"}], "who": "bgrinstead@mozilla.com", "when": "2015-05-25T00:38:19Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "checkin-needed"}], "who": "bgrinstead@mozilla.com", "when": "2015-05-25T00:39:39Z"}, {"changes": [{"removed": "checkin-needed", "field_name": "keywords", "added": ""}], "who": "pulsebot@bots.tld", "when": "2015-05-26T08:54:32Z"}, {"changes": [{"removed": "", "field_name": "whiteboard", "added": "[fixed-in-fx-team]"}], "who": "cbook@mozilla.com", "when": "2015-05-26T09:45:25Z"}, {"changes": [{"removed": "ASSIGNED", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "Firefox 41"}, {"removed": "[fixed-in-fx-team]", "field_name": "whiteboard", "added": ""}, {"removed": "", "field_name": "cf_last_resolved", "added": "2015-05-26 16:00:49"}, {"removed": "affected", "field_name": "cf_status_firefox41", "added": "fixed"}], "who": "kwierso@gmail.com", "when": "2015-05-26T23:00:49Z"}]}