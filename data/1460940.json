{"cf_tracking_thunderbird_esr52": "---", "status": "RESOLVED", "cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "cf_tracking_firefox62": "---", "creator": "adrian.wielgosik@gmail.com", "mentors_detail": [], "depends_on": [], "cf_status_firefox_esr60": "---", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "keywords": [], "cc_detail": [{"email": "bzbarsky@mit.edu", "id": 20209, "name": "bzbarsky@mit.edu", "real_name": "Boris Zbarsky [:bz] (Vacation Jun 16-24) (no decent commit message means r-)"}, {"email": "continuation@gmail.com", "id": 406194, "name": "continuation@gmail.com", "real_name": "Andrew McCreight [:mccr8]"}, {"email": "kernp25@yahoo.com", "id": 436361, "name": "kernp25@yahoo.com", "real_name": ""}], "cf_last_resolved": "2018-05-14T21:44:31Z", "attachments": [{"creator": "adrian.wielgosik@gmail.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-05-11T23:08:40Z", "type_id": 4, "creation_date": "2018-05-11T20:58:14Z", "id": 1755914, "setter": "bzbarsky@mit.edu"}], "content_type": "text/x-review-board-request", "id": 8975150}, {"creator": "adrian.wielgosik@gmail.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-05-12T03:51:20Z", "type_id": 4, "creation_date": "2018-05-11T20:58:14Z", "id": 1755915, "setter": "bzbarsky@mit.edu"}], "content_type": "text/x-review-board-request", "id": 8975151}, {"creator": "adrian.wielgosik@gmail.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-05-12T03:56:29Z", "type_id": 4, "creation_date": "2018-05-11T20:58:14Z", "id": 1755916, "setter": "bzbarsky@mit.edu"}], "content_type": "text/x-review-board-request", "id": 8975152}, {"creator": "adrian.wielgosik@gmail.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-05-12T03:59:30Z", "type_id": 4, "creation_date": "2018-05-11T20:58:14Z", "id": 1755917, "setter": "bzbarsky@mit.edu"}], "content_type": "text/x-review-board-request", "id": 8975153}, {"creator": "adrian.wielgosik@gmail.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-05-12T05:39:08Z", "type_id": 4, "creation_date": "2018-05-11T20:58:14Z", "id": 1755918, "setter": "bzbarsky@mit.edu"}], "content_type": "text/x-review-board-request", "id": 8975154}, {"creator": "adrian.wielgosik@gmail.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-05-12T05:40:04Z", "type_id": 4, "creation_date": "2018-05-11T20:58:14Z", "id": 1755919, "setter": "bzbarsky@mit.edu"}], "content_type": "text/x-review-board-request", "id": 8975155}, {"creator": "adrian.wielgosik@gmail.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-05-12T05:41:55Z", "type_id": 4, "creation_date": "2018-05-11T20:58:14Z", "id": 1755920, "setter": "bzbarsky@mit.edu"}], "content_type": "text/x-review-board-request", "id": 8975156}, {"creator": "adrian.wielgosik@gmail.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-05-12T05:46:55Z", "type_id": 4, "creation_date": "2018-05-11T20:58:14Z", "id": 1755921, "setter": "bzbarsky@mit.edu"}], "content_type": "text/x-review-board-request", "id": 8975157}, {"creator": "adrian.wielgosik@gmail.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-05-12T05:50:25Z", "type_id": 4, "creation_date": "2018-05-11T20:58:14Z", "id": 1755922, "setter": "bzbarsky@mit.edu"}], "content_type": "text/x-review-board-request", "id": 8975158}, {"creator": "adrian.wielgosik@gmail.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-05-12T05:58:55Z", "type_id": 4, "creation_date": "2018-05-11T20:58:14Z", "id": 1755923, "setter": "bzbarsky@mit.edu"}], "content_type": "text/x-review-board-request", "id": 8975159}, {"creator": "adrian.wielgosik@gmail.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-05-12T06:00:31Z", "type_id": 4, "creation_date": "2018-05-11T20:58:14Z", "id": 1755924, "setter": "bzbarsky@mit.edu"}], "content_type": "text/x-review-board-request", "id": 8975160}, {"creator": "adrian.wielgosik@gmail.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-05-12T06:02:04Z", "type_id": 4, "creation_date": "2018-05-11T20:58:14Z", "id": 1755925, "setter": "bzbarsky@mit.edu"}], "content_type": "text/x-review-board-request", "id": 8975161}, {"creator": "adrian.wielgosik@gmail.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-05-12T06:05:14Z", "type_id": 4, "creation_date": "2018-05-11T20:58:14Z", "id": 1755926, "setter": "bzbarsky@mit.edu"}], "content_type": "text/x-review-board-request", "id": 8975162}, {"creator": "adrian.wielgosik@gmail.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-05-12T06:25:50Z", "type_id": 4, "creation_date": "2018-05-11T20:58:14Z", "id": 1755927, "setter": "bzbarsky@mit.edu"}], "content_type": "text/x-review-board-request", "id": 8975163}], "votes": 0, "classification": "Components", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 51, "comments": [{"text": "", "author": "adrian.wielgosik@gmail.com", "id": 13271432, "time": "2018-05-11T18:12:43Z"}, {"text": "Created attachment 8975150\nBug 1460940 - Convert NS_NewDOMDocument to use nsIDocument.\n\nReview commit: https://reviewboard.mozilla.org/r/243448/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/243448/", "author": "adrian.wielgosik@gmail.com", "id": 13271759, "time": "2018-05-11T20:58:14Z"}, {"text": "Created attachment 8975151\nBug 1460940 - Convert nsSyncLoadService::LoadDocument to use nsIDocument.\n\nReview commit: https://reviewboard.mozilla.org/r/243450/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/243450/", "author": "adrian.wielgosik@gmail.com", "id": 13271760, "time": "2018-05-11T20:58:14Z"}, {"text": "Created attachment 8975152\nBug 1460940 - Convert nsIPrincipal to use nsIDocument.\n\nReview commit: https://reviewboard.mozilla.org/r/243452/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/243452/", "author": "adrian.wielgosik@gmail.com", "id": 13271761, "time": "2018-05-11T20:58:14Z"}, {"text": "Created attachment 8975153\nBug 1460940 - Convert nsIDocumentEncoder to use nsIDocument.\n\nReview commit: https://reviewboard.mozilla.org/r/243454/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/243454/", "author": "adrian.wielgosik@gmail.com", "id": 13271762, "time": "2018-05-11T20:58:14Z"}, {"text": "Created attachment 8975154\nBug 1460940 - Remove nsIDOMDocument uses in image/.\n\nReview commit: https://reviewboard.mozilla.org/r/243456/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/243456/", "author": "adrian.wielgosik@gmail.com", "id": 13271763, "time": "2018-05-11T20:58:14Z"}, {"text": "Created attachment 8975155\nBug 1460940 - Remove nsIDOMDocument uses in accessible/.\n\nReview commit: https://reviewboard.mozilla.org/r/243458/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/243458/", "author": "adrian.wielgosik@gmail.com", "id": 13271764, "time": "2018-05-11T20:58:14Z"}, {"text": "Created attachment 8975156\nBug 1460940 - Remove nsIDOMDocument uses in dom/xslt/.\n\nReview commit: https://reviewboard.mozilla.org/r/243460/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/243460/", "author": "adrian.wielgosik@gmail.com", "id": 13271765, "time": "2018-05-11T20:58:14Z"}, {"text": "Created attachment 8975157\nBug 1460940 - Remove nsIDOMDocument uses in layout/.\n\nReview commit: https://reviewboard.mozilla.org/r/243462/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/243462/", "author": "adrian.wielgosik@gmail.com", "id": 13271766, "time": "2018-05-11T20:58:14Z"}, {"text": "Created attachment 8975158\nBug 1460940 - Remove nsIDOMDocument uses in widget/.\n\nReview commit: https://reviewboard.mozilla.org/r/243464/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/243464/", "author": "adrian.wielgosik@gmail.com", "id": 13271767, "time": "2018-05-11T20:58:14Z"}, {"text": "Created attachment 8975159\nBug 1460940 - Remove nsIDOMDocument uses in netwerk/.\n\nReview commit: https://reviewboard.mozilla.org/r/243466/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/243466/", "author": "adrian.wielgosik@gmail.com", "id": 13271768, "time": "2018-05-11T20:58:14Z"}, {"text": "Created attachment 8975160\nBug 1460940 - Remove nsIDOMDocument uses in editor/.\n\nReview commit: https://reviewboard.mozilla.org/r/243468/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/243468/", "author": "adrian.wielgosik@gmail.com", "id": 13271769, "time": "2018-05-11T20:58:14Z"}, {"text": "Created attachment 8975161\nBug 1460940 - Remove nsIDOMDocument uses in toolkit/.\n\nReview commit: https://reviewboard.mozilla.org/r/243470/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/243470/", "author": "adrian.wielgosik@gmail.com", "id": 13271770, "time": "2018-05-11T20:58:14Z"}, {"text": "Created attachment 8975162\nBug 1460940 - Remove nsIDOMDocument uses in uriloader/.\n\nReview commit: https://reviewboard.mozilla.org/r/243472/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/243472/", "author": "adrian.wielgosik@gmail.com", "id": 13271771, "time": "2018-05-11T20:58:14Z"}, {"text": "Created attachment 8975163\nBug 1460940 - Clean up most remaining C++-side uses of nsIDOMDocument.\n\nReview commit: https://reviewboard.mozilla.org/r/243474/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/243474/", "author": "adrian.wielgosik@gmail.com", "id": 13271772, "time": "2018-05-11T20:58:14Z"}, {"text": "Try:\nhttps://treeherder.mozilla.org/#/jobs?repo=try&revision=bfb158c0a201e1af98ecff8ad22f16555481d33f", "author": "adrian.wielgosik@gmail.com", "id": 13271783, "time": "2018-05-11T21:03:00Z"}, {"text": "Comment on attachment 8975150\nBug 1460940 - Convert NS_NewDOMDocument to use nsIDocument.\n\nhttps://reviewboard.mozilla.org/r/243448/#review249400\n\n::: dom/xhr/XMLHttpRequestMainThread.cpp:2011\n(Diff revision 1)\n>      nsCOMPtr<nsIPrincipal> requestingPrincipal;\n>      rv = nsContentUtils::GetSecurityManager()->\n>         GetChannelResultPrincipal(channel, getter_AddRefs(requestingPrincipal));\n>      NS_ENSURE_SUCCESS(rv, rv);\n>  \n> +    nsCOMPtr<nsIDocument> responseDoc;\n\nWhy do you need the responseDoc temporary at all?  Why not just NS_NewDOMDocument into mResponseXML directly?\n\n::: dom/xml/XMLDocument.cpp:61\n(Diff revision 1)\n>  // =\n>  // ==================================================================\n>  \n>  \n>  nsresult\n> -NS_NewDOMDocument(nsIDOMDocument** aInstancePtrResult,\n> +NS_NewDOMDocument(nsIDocument** aInstancePtrResult,\n\nYou could change this bit near the end of this function:\n\n    *aInstancePtrResult = doc;\n    NS_ADDREF(*aInstancePtrResult);\n    \nto:\n\n    d.forget(aInstancePtrResult);\n\nright?\n\n::: dom/xml/XMLDocument.cpp:226\n(Diff revision 1)\n>                                    NS_LITERAL_STRING(\"bindings\"), nullptr,\n>                                    aDocumentURI, aBaseURI, aPrincipal, false,\n>                                    nullptr, DocumentFlavorLegacyGuess);\n>    NS_ENSURE_SUCCESS(rv, rv);\n>  \n> -  nsCOMPtr<nsIDocument> idoc = do_QueryInterface(*aInstancePtrResult);\n> +  nsCOMPtr<nsIDocument> idoc = *aInstancePtrResult;\n\nThis could just be nsIDocument*; no need for the nsCOMPtr.", "author": "bzbarsky@mit.edu", "id": 13272036, "time": "2018-05-11T23:08:40Z"}, {"text": "Comment on attachment 8975151\nBug 1460940 - Convert nsSyncLoadService::LoadDocument to use nsIDocument.\n\nhttps://reviewboard.mozilla.org/r/243450/#review249420\n\n::: dom/xslt/xml/txXMLParser.cpp:38\n(Diff revision 1)\n>      // For the system principal loaderUri will be null here, which is good\n>      // since that means that chrome documents can load any uri.\n>  \n>      // Raw pointer, we want the resulting txXPathNode to hold a reference to\n>      // the document.\n> -    nsIDOMDocument* theDocument = nullptr;\n> +    nsIDocument* theDocument = nullptr;\n\nPlease change the nsIDOMDocument signature of txXPathNativeNode::createXPathNode (of which this is the only caller) to take nsIDocument.  Otherwise you're changing to call the nsINode overload, which I _think_ ends up doing the same thing in the end but is less efficient about it.\n\nIn fact, it would be best if the nsIDocument overload of createXPathNode took already_AddRefed<nsIDocument> and did an explicit take() to store it in mNode, so it's clear the ref is being transferred.  Then you could have this code do the normal \"get into an nsCOMPtr\" thing and .forget() when calling createXPathNode() and it would all be self-documenting instead of relying on comments about the ownership model.", "author": "bzbarsky@mit.edu", "id": 13272260, "time": "2018-05-12T03:51:20Z"}, {"text": "Comment on attachment 8975152\nBug 1460940 - Convert nsIPrincipal to use nsIDocument.\n\nhttps://reviewboard.mozilla.org/r/243452/#review249422", "author": "bzbarsky@mit.edu", "id": 13272262, "time": "2018-05-12T03:56:29Z"}, {"text": "Comment on attachment 8975153\nBug 1460940 - Convert nsIDocumentEncoder to use nsIDocument.\n\nhttps://reviewboard.mozilla.org/r/243454/#review249424\n\nr=me.  This particular interface been bothering me for a while; thank you!", "author": "bzbarsky@mit.edu", "id": 13272263, "time": "2018-05-12T03:59:30Z"}, {"text": "Comment on attachment 8975154\nBug 1460940 - Remove nsIDOMDocument uses in image/.\n\nhttps://reviewboard.mozilla.org/r/243456/#review249426", "author": "bzbarsky@mit.edu", "id": 13272289, "time": "2018-05-12T05:39:08Z"}, {"text": "Comment on attachment 8975155\nBug 1460940 - Remove nsIDOMDocument uses in accessible/.\n\nhttps://reviewboard.mozilla.org/r/243458/#review249428", "author": "bzbarsky@mit.edu", "id": 13272290, "time": "2018-05-12T05:40:04Z"}, {"text": "Comment on attachment 8975156\nBug 1460940 - Remove nsIDOMDocument uses in dom/xslt/.\n\nhttps://reviewboard.mozilla.org/r/243460/#review249430\n\n::: dom/xslt/xpath/txMozillaXPathTreeWalker.cpp:684\n(Diff revision 1)\n>      return new txXPathNode(aNode, index, root);\n>  }\n>  \n>  /* static */\n>  txXPathNode*\n> -txXPathNativeNode::createXPathNode(nsIDOMDocument* aDocument)\n> +txXPathNativeNode::createXPathNode(nsIDocument* aDocument)\n\nAh, now this change is happening.  It should move to the nsSyncLoadService patch.", "author": "bzbarsky@mit.edu", "id": 13272293, "time": "2018-05-12T05:41:55Z"}, {"text": "Comment on attachment 8975157\nBug 1460940 - Remove nsIDOMDocument uses in layout/.\n\nhttps://reviewboard.mozilla.org/r/243462/#review249432", "author": "bzbarsky@mit.edu", "id": 13272295, "time": "2018-05-12T05:46:55Z"}, {"text": "Comment on attachment 8975158\nBug 1460940 - Remove nsIDOMDocument uses in widget/.\n\nhttps://reviewboard.mozilla.org/r/243464/#review249434", "author": "bzbarsky@mit.edu", "id": 13272299, "time": "2018-05-12T05:50:25Z"}, {"text": "Comment on attachment 8975159\nBug 1460940 - Remove nsIDOMDocument uses in netwerk/.\n\nhttps://reviewboard.mozilla.org/r/243466/#review249436", "author": "bzbarsky@mit.edu", "id": 13272306, "time": "2018-05-12T05:58:55Z"}, {"text": "Comment on attachment 8975160\nBug 1460940 - Remove nsIDOMDocument uses in editor/.\n\nhttps://reviewboard.mozilla.org/r/243468/#review249438\n\nFor an editor decomtamination patch, surprisingly simple!", "author": "bzbarsky@mit.edu", "id": 13272308, "time": "2018-05-12T06:00:31Z"}, {"text": "Comment on attachment 8975161\nBug 1460940 - Remove nsIDOMDocument uses in toolkit/.\n\nhttps://reviewboard.mozilla.org/r/243470/#review249440", "author": "bzbarsky@mit.edu", "id": 13272310, "time": "2018-05-12T06:02:04Z"}, {"text": "Comment on attachment 8975162\nBug 1460940 - Remove nsIDOMDocument uses in uriloader/.\n\nhttps://reviewboard.mozilla.org/r/243472/#review249442", "author": "bzbarsky@mit.edu", "id": 13272313, "time": "2018-05-12T06:05:14Z"}, {"text": "Comment on attachment 8975163\nBug 1460940 - Clean up most remaining C++-side uses of nsIDOMDocument.\n\nhttps://reviewboard.mozilla.org/r/243474/#review249444\n\n::: docshell/base/nsDocShell.cpp:5115\n(Diff revision 1)\n>    nsIDocument* doc = mContentViewer->GetDocument();\n>    if (!doc) {\n>      return NS_ERROR_NOT_AVAILABLE;\n>    }\n>  \n> -  return CallQueryInterface(doc, aDocument);\n> +  NS_ADDREF(*aDocument = doc);\n\nI'd prefer it if we just made doc an nsCOMPtr and did doc.forget(aDocument) here.\n\n::: docshell/base/nsIContentViewer.idl:132\n(Diff revision 1)\n>  \n>    /**\n>     * Returns the same thing as getDocument(), but for use from script\n>     * only.  C++ consumers should use getDocument().\n>     */\n>    readonly attribute nsISupports DOMDocument;\n\nWe could probably change this one to returning Document, fwiw.\n\n::: dom/html/nsGenericHTMLFrameElement.cpp:84\n(Diff revision 1)\n>      mFrameLoader->Destroy();\n>    }\n>  }\n>  \n>  nsresult\n> -nsGenericHTMLFrameElement::GetContentDocument(nsIDOMDocument** aContentDocument)\n> +nsGenericHTMLFrameElement::GetContentDocument(nsIDocument** aContentDocument)\n\nIs this function actually used?  I suspect not, and that we should just remove it altogether.\n\n::: dom/html/nsHTMLDocument.h:81\n(Diff revision 1)\n>    using nsDocument::CreateElement;\n>    using nsDocument::CreateElementNS;\n\nWe may not need those anymore.\n\n::: dom/html/nsHTMLDocument.h:85\n(Diff revision 1)\n>    using nsDocument::GetImplementation;\n>    using nsDocument::GetTitle;\n>    using nsDocument::SetTitle;\n>    using nsDocument::GetLastStyleSheetSet;\n>    using nsDocument::MozSetImageElement;\n\nOr these, since we're no shadowing them anymore...\n\n::: dom/html/nsHTMLDocument.cpp:1182\n(Diff revision 1)\n>                       const nsAString& aName,\n>                       const nsAString& aFeatures,\n>                       bool aReplace,\n>                       ErrorResult& rv)\n>  {\n> -  MOZ_ASSERT(nsContentUtils::CanCallerAccess(static_cast<nsIDOMDocument*>(this)),\n> +  MOZ_ASSERT(nsContentUtils::CanCallerAccess(static_cast<nsIDocument*>(this)),\n\nI would almost rather you cast to nsIDOMNode here, so we remember to remove the cast when the nsIDOMNode overload of CanCallerAccess goes away.\n\n::: dom/html/nsHTMLDocument.cpp:1212\n(Diff revision 1)\n>                       ErrorResult& aError)\n>  {\n>    // Implements the \"When called with two arguments (or fewer)\" steps here:\n>    // https://html.spec.whatwg.org/multipage/webappapis.html#opening-the-input-stream\n>  \n> -  MOZ_ASSERT(nsContentUtils::CanCallerAccess(static_cast<nsIDOMDocument*>(this)),\n> +  MOZ_ASSERT(nsContentUtils::CanCallerAccess(static_cast<nsIDocument*>(this)),\n\nAgain, cast to nsIDOMNode.\n\n::: dom/xul/XULDocument.h:119\n(Diff revision 1)\n>      using nsDocument::CreateElement;\n>      using nsDocument::CreateElementNS;\n\nAgain, may be able to drop these using decls.\n\n::: dom/xul/XULDocument.h:121\n(Diff revision 1)\n>      // And explicitly import the things from nsDocument that we just shadowed\n>      using mozilla::dom::DocumentOrShadowRoot::GetElementById;\n>      using nsDocument::GetImplementation;\n>      using nsDocument::GetTitle;\n>      using nsDocument::SetTitle;\n>      using nsDocument::GetLastStyleSheetSet;\n>      using nsDocument::MozSetImageElement;\n>      using nsIDocument::GetLocation;\n\nAnd these, since we're not shadowing those anymore.", "author": "bzbarsky@mit.edu", "id": 13272321, "time": "2018-05-12T06:25:50Z"}, {"text": "Comment on attachment 8975151\nBug 1460940 - Convert nsSyncLoadService::LoadDocument to use nsIDocument.\n\nhttps://reviewboard.mozilla.org/r/243450/#review249420\n\n> Please change the nsIDOMDocument signature of txXPathNativeNode::createXPathNode (of which this is the only caller) to take nsIDocument.  Otherwise you're changing to call the nsINode overload, which I _think_ ends up doing the same thing in the end but is less efficient about it.\n> \n> In fact, it would be best if the nsIDocument overload of createXPathNode took already_AddRefed<nsIDocument> and did an explicit take() to store it in mNode, so it's clear the ref is being transferred.  Then you could have this code do the normal \"get into an nsCOMPtr\" thing and .forget() when calling createXPathNode() and it would all be self-documenting instead of relying on comments about the ownership model.\n\nHow about I make it like this in this patch, and remove it later in dom/xslt/ patch? I think this should keep the correct behavior, and not require mixing/merging patches.\n\n```\nnsCOMPtr<nsIDOMDocument> document = do_QueryInterface(theDocument);\n*aResult = txXPathNativeNode::createXPathNode(document);\n```\n\nAbout the second part, I don't feel too confident about how ownership works there, so I'd rather make it a followup bug.\n\n(PS I meant to respond two days ago, but apparently missed publishing the comment.)", "author": "adrian.wielgosik@gmail.com", "id": 13276399, "time": "2018-05-14T17:40:09Z"}, {"text": "Comment on attachment 8975156\nBug 1460940 - Remove nsIDOMDocument uses in dom/xslt/.\n\nhttps://reviewboard.mozilla.org/r/243460/#review249430\n\n> Ah, now this change is happening.  It should move to the nsSyncLoadService patch.\n\nSee the comment in previous patch - I tried to do this without mixing patches instead.", "author": "adrian.wielgosik@gmail.com", "id": 13276412, "time": "2018-05-14T17:43:24Z"}, {"text": "Comment on attachment 8975150\nBug 1460940 - Convert NS_NewDOMDocument to use nsIDocument.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/243448/diff/1-2/", "author": "adrian.wielgosik@gmail.com", "id": 13276417, "time": "2018-05-14T17:44:12Z"}, {"text": "Comment on attachment 8975151\nBug 1460940 - Convert nsSyncLoadService::LoadDocument to use nsIDocument.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/243450/diff/1-2/", "author": "adrian.wielgosik@gmail.com", "id": 13276418, "time": "2018-05-14T17:44:12Z"}, {"text": "Comment on attachment 8975152\nBug 1460940 - Convert nsIPrincipal to use nsIDocument.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/243452/diff/1-2/", "author": "adrian.wielgosik@gmail.com", "id": 13276419, "time": "2018-05-14T17:44:12Z"}, {"text": "Comment on attachment 8975153\nBug 1460940 - Convert nsIDocumentEncoder to use nsIDocument.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/243454/diff/1-2/", "author": "adrian.wielgosik@gmail.com", "id": 13276420, "time": "2018-05-14T17:44:12Z"}, {"text": "Comment on attachment 8975154\nBug 1460940 - Remove nsIDOMDocument uses in image/.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/243456/diff/1-2/", "author": "adrian.wielgosik@gmail.com", "id": 13276421, "time": "2018-05-14T17:44:12Z"}, {"text": "Comment on attachment 8975155\nBug 1460940 - Remove nsIDOMDocument uses in accessible/.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/243458/diff/1-2/", "author": "adrian.wielgosik@gmail.com", "id": 13276422, "time": "2018-05-14T17:44:12Z"}, {"text": "Comment on attachment 8975156\nBug 1460940 - Remove nsIDOMDocument uses in dom/xslt/.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/243460/diff/1-2/", "author": "adrian.wielgosik@gmail.com", "id": 13276423, "time": "2018-05-14T17:44:12Z"}, {"text": "Comment on attachment 8975157\nBug 1460940 - Remove nsIDOMDocument uses in layout/.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/243462/diff/1-2/", "author": "adrian.wielgosik@gmail.com", "id": 13276424, "time": "2018-05-14T17:44:12Z"}, {"text": "Comment on attachment 8975158\nBug 1460940 - Remove nsIDOMDocument uses in widget/.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/243464/diff/1-2/", "author": "adrian.wielgosik@gmail.com", "id": 13276425, "time": "2018-05-14T17:44:12Z"}, {"text": "Comment on attachment 8975159\nBug 1460940 - Remove nsIDOMDocument uses in netwerk/.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/243466/diff/1-2/", "author": "adrian.wielgosik@gmail.com", "id": 13276426, "time": "2018-05-14T17:44:12Z"}, {"text": "Comment on attachment 8975160\nBug 1460940 - Remove nsIDOMDocument uses in editor/.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/243468/diff/1-2/", "author": "adrian.wielgosik@gmail.com", "id": 13276427, "time": "2018-05-14T17:44:12Z"}, {"text": "Comment on attachment 8975161\nBug 1460940 - Remove nsIDOMDocument uses in toolkit/.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/243470/diff/1-2/", "author": "adrian.wielgosik@gmail.com", "id": 13276428, "time": "2018-05-14T17:44:12Z"}, {"text": "Comment on attachment 8975162\nBug 1460940 - Remove nsIDOMDocument uses in uriloader/.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/243472/diff/1-2/", "author": "adrian.wielgosik@gmail.com", "id": 13276429, "time": "2018-05-14T17:44:12Z"}, {"text": "Comment on attachment 8975163\nBug 1460940 - Clean up most remaining C++-side uses of nsIDOMDocument.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/243474/diff/1-2/", "author": "adrian.wielgosik@gmail.com", "id": 13276430, "time": "2018-05-14T17:44:12Z"}, {"text": "Comment on attachment 8975151\nBug 1460940 - Convert nsSyncLoadService::LoadDocument to use nsIDocument.\n\nhttps://reviewboard.mozilla.org/r/243450/#review249420\n\n> How about I make it like this in this patch, and remove it later in dom/xslt/ patch? I think this should keep the correct behavior, and not require mixing/merging patches.\n> \n> ```\n> nsCOMPtr<nsIDOMDocument> document = do_QueryInterface(theDocument);\n> *aResult = txXPathNativeNode::createXPathNode(document);\n> ```\n> \n> About the second part, I don't feel too confident about how ownership works there, so I'd rather make it a followup bug.\n> \n> (PS I meant to respond two days ago, but apparently missed publishing the comment.)\n\n> I don't feel too confident about how ownership works there, so I'd rather make it a followup bug\n\nThat would be fine.  Please make sure to get that filed.", "author": "bzbarsky@mit.edu", "id": 13276589, "time": "2018-05-14T18:28:48Z"}, {"text": "Comment on attachment 8975151\nBug 1460940 - Convert nsSyncLoadService::LoadDocument to use nsIDocument.\n\nhttps://reviewboard.mozilla.org/r/243450/#review249692", "author": "bzbarsky@mit.edu", "id": 13276598, "time": "2018-05-14T18:29:44Z"}, {"text": "Comment on attachment 8975163\nBug 1460940 - Clean up most remaining C++-side uses of nsIDOMDocument.\n\nhttps://reviewboard.mozilla.org/r/243474/#review249696", "author": "bzbarsky@mit.edu", "id": 13276611, "time": "2018-05-14T18:35:38Z"}, {"text": "Pushed by bzbarsky@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/bdefa8e9f852\nConvert NS_NewDOMDocument to use nsIDocument. r=bz\nhttps://hg.mozilla.org/integration/autoland/rev/acd552a27880\nConvert nsSyncLoadService::LoadDocument to use nsIDocument. r=bz\nhttps://hg.mozilla.org/integration/autoland/rev/3fdd267726d3\nConvert nsIPrincipal to use nsIDocument. r=bz\nhttps://hg.mozilla.org/integration/autoland/rev/00d56afaac1b\nConvert nsIDocumentEncoder to use nsIDocument. r=bz\nhttps://hg.mozilla.org/integration/autoland/rev/85d61067345b\nRemove nsIDOMDocument uses in image/. r=bz\nhttps://hg.mozilla.org/integration/autoland/rev/1b5864045088\nRemove nsIDOMDocument uses in accessible/. r=bz\nhttps://hg.mozilla.org/integration/autoland/rev/eb2845258fb5\nRemove nsIDOMDocument uses in dom/xslt/. r=bz\nhttps://hg.mozilla.org/integration/autoland/rev/ea6301dd947a\nRemove nsIDOMDocument uses in layout/. r=bz\nhttps://hg.mozilla.org/integration/autoland/rev/72c6733416e0\nRemove nsIDOMDocument uses in widget/. r=bz\nhttps://hg.mozilla.org/integration/autoland/rev/3c934aabc02f\nRemove nsIDOMDocument uses in netwerk/. r=bz\nhttps://hg.mozilla.org/integration/autoland/rev/2a96e7e30948\nRemove nsIDOMDocument uses in editor/. r=bz\nhttps://hg.mozilla.org/integration/autoland/rev/34afaf053d6d\nRemove nsIDOMDocument uses in toolkit/. r=bz\nhttps://hg.mozilla.org/integration/autoland/rev/21d3723efe57\nRemove nsIDOMDocument uses in uriloader/. r=bz\nhttps://hg.mozilla.org/integration/autoland/rev/237b7b5faa03\nClean up most remaining C++-side uses of nsIDOMDocument. r=bz", "author": "pulsebot@bots.tld", "id": 13276685, "time": "2018-05-14T18:55:10Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/bdefa8e9f852\nhttps://hg.mozilla.org/mozilla-central/rev/acd552a27880\nhttps://hg.mozilla.org/mozilla-central/rev/3fdd267726d3\nhttps://hg.mozilla.org/mozilla-central/rev/00d56afaac1b\nhttps://hg.mozilla.org/mozilla-central/rev/85d61067345b\nhttps://hg.mozilla.org/mozilla-central/rev/1b5864045088\nhttps://hg.mozilla.org/mozilla-central/rev/eb2845258fb5\nhttps://hg.mozilla.org/mozilla-central/rev/ea6301dd947a\nhttps://hg.mozilla.org/mozilla-central/rev/72c6733416e0\nhttps://hg.mozilla.org/mozilla-central/rev/3c934aabc02f\nhttps://hg.mozilla.org/mozilla-central/rev/2a96e7e30948\nhttps://hg.mozilla.org/mozilla-central/rev/34afaf053d6d\nhttps://hg.mozilla.org/mozilla-central/rev/21d3723efe57\nhttps://hg.mozilla.org/mozilla-central/rev/237b7b5faa03", "author": "csabou@mozilla.com", "id": 13277191, "time": "2018-05-14T21:44:31Z"}], "id": 1460940, "priority": "P2", "cc": ["bzbarsky@mit.edu", "continuation@gmail.com", "kernp25@yahoo.com"], "cf_crash_signature": "", "version": "unspecified", "is_cc_accessible": true, "cf_tracking_firefox_esr52": "---", "see_also": [], "cf_tracking_thunderbird_esr60": "---", "cf_platform_rel": "---", "product": "Core", "cf_fx_iteration": "---", "blocks": [1460735], "qa_contact": "", "creation_time": "2018-05-11T18:12:43Z", "cf_status_firefox_esr52": "---", "component": "DOM: Core & HTML", "assigned_to_detail": {"email": "adrian.wielgosik@gmail.com", "id": 597303, "name": "adrian.wielgosik@gmail.com", "real_name": "Adrian Wielgosik [:adrian17]"}, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "fixed", "cf_status_firefox61": "---", "cf_status_firefox60": "---", "target_milestone": "mozilla62", "cf_rank": null, "cf_qa_whiteboard": "", "severity": "normal", "groups": [], "cf_status_thunderbird_esr52": "---", "url": "", "cf_status_thunderbird_esr60": "---", "creator_detail": {"email": "adrian.wielgosik@gmail.com", "id": 597303, "name": "adrian.wielgosik@gmail.com", "real_name": "Adrian Wielgosik [:adrian17]"}, "whiteboard": "", "mentors": [], "summary": "Clean up C++ users of nsIDOMDocument", "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "last_change_time": "2018-05-14T21:44:31Z", "assigned_to": "adrian.wielgosik@gmail.com", "is_open": false, "history": [{"changes": [{"removed": "", "field_name": "blocks", "added": "1460735"}], "who": "adrian.wielgosik@gmail.com", "when": "2018-05-11T18:12:56Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "ASSIGNED"}, {"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "adrian.wielgosik@gmail.com"}], "who": "adrian.wielgosik@gmail.com", "when": "2018-05-11T18:13:06Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "kernp25@yahoo.com"}], "who": "kernp25@yahoo.com", "when": "2018-05-11T18:36:08Z"}, {"changes": [{"removed": "--", "field_name": "priority", "added": "P2"}, {"removed": "", "field_name": "cc", "added": "continuation@gmail.com"}], "who": "continuation@gmail.com", "when": "2018-05-11T19:31:29Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8975156, "added": "review?(bzbarsky@mit.edu)"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8975157, "added": "review?(bzbarsky@mit.edu)"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8975158, "added": "review?(bzbarsky@mit.edu)"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8975159, "added": "review?(bzbarsky@mit.edu)"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8975160, "added": "review?(bzbarsky@mit.edu)"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8975161, "added": "review?(bzbarsky@mit.edu)"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8975162, "added": "review?(bzbarsky@mit.edu)"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8975163, "added": "review?(bzbarsky@mit.edu)"}, {"removed": "", "field_name": "cc", "added": "bzbarsky@mit.edu"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8975150, "added": "review?(bzbarsky@mit.edu)"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8975151, "added": "review?(bzbarsky@mit.edu)"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8975152, "added": "review?(bzbarsky@mit.edu)"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8975153, "added": "review?(bzbarsky@mit.edu)"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8975154, "added": "review?(bzbarsky@mit.edu)"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8975155, "added": "review?(bzbarsky@mit.edu)"}], "who": "adrian.wielgosik@gmail.com", "when": "2018-05-11T20:58:14Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(bzbarsky@mit.edu)", "attachment_id": 8975150, "added": "review+"}], "who": "bzbarsky@mit.edu", "when": "2018-05-11T23:08:40Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(bzbarsky@mit.edu)", "attachment_id": 8975151, "added": "review+"}], "who": "bzbarsky@mit.edu", "when": "2018-05-12T03:51:20Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(bzbarsky@mit.edu)", "attachment_id": 8975152, "added": "review+"}], "who": "bzbarsky@mit.edu", "when": "2018-05-12T03:56:29Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(bzbarsky@mit.edu)", "attachment_id": 8975153, "added": "review+"}], "who": "bzbarsky@mit.edu", "when": "2018-05-12T03:59:30Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(bzbarsky@mit.edu)", "attachment_id": 8975154, "added": "review+"}], "who": "bzbarsky@mit.edu", "when": "2018-05-12T05:39:08Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(bzbarsky@mit.edu)", "attachment_id": 8975155, "added": "review+"}], "who": "bzbarsky@mit.edu", "when": "2018-05-12T05:40:04Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(bzbarsky@mit.edu)", "attachment_id": 8975156, "added": "review+"}], "who": "bzbarsky@mit.edu", "when": "2018-05-12T05:41:55Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(bzbarsky@mit.edu)", "attachment_id": 8975157, "added": "review+"}], "who": "bzbarsky@mit.edu", "when": "2018-05-12T05:46:55Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(bzbarsky@mit.edu)", "attachment_id": 8975158, "added": "review+"}], "who": "bzbarsky@mit.edu", "when": "2018-05-12T05:50:25Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(bzbarsky@mit.edu)", "attachment_id": 8975159, "added": "review+"}], "who": "bzbarsky@mit.edu", "when": "2018-05-12T05:58:55Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(bzbarsky@mit.edu)", "attachment_id": 8975160, "added": "review+"}], "who": "bzbarsky@mit.edu", "when": "2018-05-12T06:00:31Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(bzbarsky@mit.edu)", "attachment_id": 8975161, "added": "review+"}], "who": "bzbarsky@mit.edu", "when": "2018-05-12T06:02:04Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(bzbarsky@mit.edu)", "attachment_id": 8975162, "added": "review+"}], "who": "bzbarsky@mit.edu", "when": "2018-05-12T06:05:14Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(bzbarsky@mit.edu)", "attachment_id": 8975163, "added": "review+"}], "who": "bzbarsky@mit.edu", "when": "2018-05-12T06:25:50Z"}, {"changes": [{"removed": "ASSIGNED", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla62"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2018-05-14 21:44:31"}, {"removed": "---", "field_name": "cf_status_firefox62", "added": "fixed"}], "who": "csabou@mozilla.com", "when": "2018-05-14T21:44:31Z"}], "resolution": "FIXED", "op_sys": "Unspecified", "cf_fx_points": "---", "cf_blocking_fennec": "---"}