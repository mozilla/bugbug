{"cf_tracking_thunderbird_esr52": "---", "status": "RESOLVED", "cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "cf_tracking_firefox62": "---", "creator": "jkratzer@mozilla.com", "mentors_detail": [], "depends_on": [], "cf_status_firefox_esr60": "wontfix", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "keywords": ["crash", "testcase"], "cc_detail": [{"email": "agaynor@mozilla.com", "id": 537703, "name": "agaynor@mozilla.com", "real_name": "Alex Gaynor [:Alex_Gaynor]"}, {"email": "fuzzing@mozilla.com", "id": 469204, "name": "fuzzing@mozilla.com", "real_name": "Fuzzing Team"}, {"email": "jgilbert@mozilla.com", "id": 419431, "name": "jgilbert@mozilla.com", "real_name": "Jeff Gilbert [:jgilbert]"}, {"email": "kgilbert@mozilla.com", "id": 499338, "name": "kgilbert@mozilla.com", "real_name": ":kip (Kearwood Gilbert)"}, {"email": "ryanvm@gmail.com", "id": 75935, "name": "ryanvm@gmail.com", "real_name": "Ryan VanderMeulen [:RyanVM]"}], "cf_last_resolved": "2018-05-26T04:12:50Z", "attachments": [{"creator": "jkratzer@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [], "content_type": "text/html", "id": 8977053}, {"creator": "kgilbert@mozilla.com", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2018-05-25T21:21:43Z", "type_id": 4, "creation_date": "2018-05-25T21:19:39Z", "id": 1761987, "setter": "jgilbert@mozilla.com"}, {"status": "+", "name": "approval-mozilla-beta", "modification_date": "2018-06-01T13:00:08Z", "type_id": 721, "creation_date": "2018-05-31T22:43:39Z", "id": 1764394, "setter": "ryanvm@gmail.com"}], "content_type": "text/plain", "id": 8980774}], "votes": 0, "classification": "Components", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 15, "comments": [{"text": "Created attachment 8977053\ntrigger.html\n\nTestcase found while fuzzing mozilla-central rev 11ee70f24ea5.\n\nMarking SS just in case.\n\n==12124==ERROR: AddressSanitizer: SEGV on unknown address 0x000000000a18 (pc 0x7fa20c7fbe09 bp 0x7ffd26bff710 sp 0x7ffd26bff700 T0)\n==12124==The signal is caused by a READ memory access.\n==12124==Hint: address points to the zero page.\n    #0 0x7fa20c7fbe08 in get /builds/worker/workspace/build/src/gfx/gl/../../mfbt/UniquePtr.h:326:32\n    #1 0x7fa20c7fbe08 in Screen /builds/worker/workspace/build/src/gfx/gl/GLContext.h:3578\n    #2 0x7fa20c7fbe08 in mozilla::WebGLContext::GetVRFrame() /builds/worker/workspace/build/src/dom/canvas/WebGLContext.cpp:2387\n    #3 0x7fa209a47762 in mozilla::gfx::VRLayerChild::SubmitFrame(unsigned long) /builds/worker/workspace/build/src/gfx/vr/ipc/VRLayerChild.cpp:67:39\n    #4 0x7fa20e5eee01 in mozilla::dom::VRDisplay::SubmitFrame() /builds/worker/workspace/build/src/dom/vr/VRDisplay.cpp:667:20\n    #5 0x7fa20b714887 in mozilla::dom::VRDisplayBinding::submitFrame(JSContext*, JS::Handle<JSObject*>, mozilla::dom::VRDisplay*, JSJitMethodCallArgs const&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/VRDisplayBinding.cpp:1238:9\n    #6 0x7fa20c606261 in bool mozilla::dom::binding_detail::GenericMethod<mozilla::dom::binding_detail::NormalThisPolicy, mozilla::dom::binding_detail::ThrowExceptions>(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:3279:13\n    #7 0x7fa212ecec87 in CallJSNative /builds/worker/workspace/build/src/js/src/vm/JSContext-inl.h:280:15\n    #8 0x7fa212ecec87 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:467\n    #9 0x7fa212eb9483 in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:522:12\n    #10 0x7fa212eb9483 in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3086\n    #11 0x7fa212e9fc43 in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:417:12\n    #12 0x7fa212ecea05 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:489:15\n    #13 0x7fa212ecfc82 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:535:10\n    #14 0x7fa213030558 in PromiseReactionJob(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/js/src/builtin/Promise.cpp:1237:14\n    #15 0x7fa212ecec87 in CallJSNative /builds/worker/workspace/build/src/js/src/vm/JSContext-inl.h:280:15\n    #16 0x7fa212ecec87 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:467\n    #17 0x7fa212ecfc82 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:535:10\n    #18 0x7fa213a1291a in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/jsapi.cpp:2981:12\n    #19 0x7fa20ac893f2 in mozilla::dom::PromiseJobCallback::Call(JSContext*, JS::Handle<JS::Value>, mozilla::ErrorResult&) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/PromiseBinding.cpp:25:8\n    #20 0x7fa206da3665 in Call /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/PromiseBinding.h:91:12\n    #21 0x7fa206da3665 in Call /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/PromiseBinding.h:104\n    #22 0x7fa206da3665 in mozilla::PromiseJobRunnable::Run(mozilla::AutoSlowOperation&) /builds/worker/workspace/build/src/xpcom/base/CycleCollectedJSContext.cpp:205\n    #23 0x7fa206d867d1 in mozilla::CycleCollectedJSContext::PerformMicroTaskCheckPoint() /builds/worker/workspace/build/src/xpcom/base/CycleCollectedJSContext.cpp:543:17\n    #24 0x7fa206d8701d in mozilla::CycleCollectedJSContext::AfterProcessTask(unsigned int) /builds/worker/workspace/build/src/xpcom/base/CycleCollectedJSContext.cpp:374:3\n    #25 0x7fa20881b1bd in XPCJSContext::AfterProcessTask(unsigned int) /builds/worker/workspace/build/src/js/xpconnect/src/XPCJSContext.cpp:1258:30\n    #26 0x7fa206f2c19d in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1125:24\n    #27 0x7fa206f47850 in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:519:10\n    #28 0x7fa207e27fca in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /builds/worker/workspace/build/src/ipc/glue/MessagePump.cpp:97:21\n    #29 0x7fa207d7b669 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10\n    #30 0x7fa207d7b669 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319\n    #31 0x7fa207d7b669 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299\n    #32 0x7fa20e99292a in nsBaseAppShell::Run() /builds/worker/workspace/build/src/widget/nsBaseAppShell.cpp:157:27\n    #33 0x7fa212be696b in XRE_RunAppShell() /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:893:22\n    #34 0x7fa207d7b669 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10\n    #35 0x7fa207d7b669 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319\n    #36 0x7fa207d7b669 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299\n    #37 0x7fa212be6330 in XRE_InitChildProcess(int, char**, XREChildData const*) /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:719:34\n    #38 0x4f50dc in content_process_main /builds/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:50:30\n    #39 0x4f50dc in main /builds/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:282\n    #40 0x7fa226cab82f in __libc_start_main /build/glibc-Cl5G7W/glibc-2.23/csu/../csu/libc-start.c:291", "author": "jkratzer@mozilla.com", "id": 13287694, "time": "2018-05-18T16:18:09Z"}, {"text": "It seems that we aren't handling GL context loss well.  WebVR will only work with discrete GPU's, which don't often lose context with DX11, but can still occur due to GPU driver restarts and other bugs.\n\nI'm attempting to reproduce, and expect to make a patch to at least not crash, even if the VR session is interrupted by the context loss.", "author": "kgilbert@mozilla.com", "id": 13362418, "time": "2018-05-24T23:04:21Z"}, {"text": "I have reproduced.  Now WIP on patch", "author": "kgilbert@mozilla.com", "id": 13365039, "time": "2018-05-25T20:24:17Z"}, {"text": "Created attachment 8980774\nbug1462695.patch\n\nBug 1462695 - Prevent crashing when context lost during WebVR presentation", "author": "kgilbert@mozilla.com", "id": 13365163, "time": "2018-05-25T21:13:30Z"}, {"text": "+CC jgilbert for patch review", "author": "kgilbert@mozilla.com", "id": 13365185, "time": "2018-05-25T21:18:43Z"}, {"text": "Comment on attachment 8980774\nbug1462695.patch\n\nEarly exit WebGLContext::GetVRFrame() to avoid crashing when GL context is lost.  Avoids de-referencing \"gl\" when it is null after lost context.  Callers to function already have error handling when nullptr is returned from function.", "author": "kgilbert@mozilla.com", "id": 13365187, "time": "2018-05-25T21:19:39Z"}, {"text": "Comment on attachment 8980774\nbug1462695.patch\n\nReview of attachment 8980774:\n-----------------------------------------------------------------\n\n::: dom/canvas/WebGLContext.cpp\n@@ +2384,5 @@\n>    BeginComposition();\n>    EndComposition();\n>  \n> +  if (IsContextLost()) {\n> +    return nullptr;\n\n4-space, no {}", "author": "jgilbert@mozilla.com", "id": 13365190, "time": "2018-05-25T21:21:43Z"}, {"text": "Can you clear the sec bit here? This is a clean null-deref, sec:DoS at worst.", "author": "jgilbert@mozilla.com", "id": 13365346, "time": "2018-05-25T22:08:47Z"}, {"text": " https://hg.mozilla.org/integration/mozilla-inbound/rev/4fab7126c17f", "author": "jgilbert@mozilla.com", "id": 13365348, "time": "2018-05-25T22:09:18Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/4fab7126c17f", "author": "dluca@mozilla.com", "id": 13365727, "time": "2018-05-26T04:12:50Z"}, {"text": "Please request Beta approval on this when you get a chance. Also, is it possible to land the attached testcase as a crashtest?", "author": "ryanvm@gmail.com", "id": 13366690, "time": "2018-05-27T17:14:32Z"}, {"text": "Comment on attachment 8980774\nbug1462695.patch\n\nApproval Request Comment\n[Feature/Bug causing the regression]:\nBug 1250244 - WebVR 1.0 API\n\n[User impact if declined]:\nThe content process may crash if there is a GL context loss while the user is in an immersive VR presentation on a WebVR site.  This may happen due to GPU driver bugs, background updates of GPU drivers, or power management forcing GPU device changes.  The user will see an error message and need to refresh the browser tab.\n[Is this code covered by automated tests?]:\nAutomated tests cover this code, but do not simulate GL context loss.  A crashtest will be created and landed separately based on the test case attached to the bug.\n[Has the fix been verified in Nightly?]:\nI have verified on local builds, have NI'ed for additional confirmation.\n[Needs manual test from QE? If yes, steps to reproduce]: \nN/A - Repro may be difficult without relying on test harness to simulate context loss with precise timing.\n[List of other uplifts needed for the feature/fix]:\nN/A\n[Is the change risky?]:\n- Low risk.\n[Why is the change risky/not risky?]:\nIt is a simple early-exit of a function, whose callers already include checks for the nullptr returned in this case.\n[String changes made/needed]:\nNone", "author": "kgilbert@mozilla.com", "id": 13379050, "time": "2018-05-31T22:43:39Z"}, {"text": "I'll leave the NI open on myself as a reminder to implement a crashtest", "author": "kgilbert@mozilla.com", "id": 13379052, "time": "2018-05-31T22:44:14Z"}, {"text": "Comment on attachment 8980774\nbug1462695.patch\n\nFixes a WebVR crash. Approved for 61.0b11.", "author": "ryanvm@gmail.com", "id": 13380137, "time": "2018-06-01T13:00:08Z"}, {"text": "https://hg.mozilla.org/releases/mozilla-beta/rev/a448bc195414", "author": "ryanvm@gmail.com", "id": 13380168, "time": "2018-06-01T13:15:16Z"}], "id": 1462695, "priority": "--", "cc": ["agaynor@mozilla.com", "fuzzing@mozilla.com", "jgilbert@mozilla.com", "kgilbert@mozilla.com", "ryanvm@gmail.com"], "cf_crash_signature": "", "version": "59 Branch", "is_cc_accessible": true, "cf_tracking_firefox_esr52": "---", "see_also": [], "cf_tracking_thunderbird_esr60": "---", "cf_platform_rel": "---", "product": "Core", "cf_fx_iteration": "---", "blocks": [1340565], "qa_contact": "", "creation_time": "2018-05-18T16:18:09Z", "cf_status_firefox_esr52": "unaffected", "component": "WebVR", "assigned_to_detail": {"email": "kgilbert@mozilla.com", "id": 499338, "name": "kgilbert@mozilla.com", "real_name": ":kip (Kearwood Gilbert)"}, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "fixed", "cf_status_firefox61": "fixed", "cf_status_firefox60": "wontfix", "target_milestone": "mozilla62", "cf_rank": null, "cf_qa_whiteboard": "", "severity": "critical", "groups": [], "cf_status_thunderbird_esr52": "---", "url": "", "cf_status_thunderbird_esr60": "---", "creator_detail": {"email": "jkratzer@mozilla.com", "id": 586683, "name": "jkratzer@mozilla.com", "real_name": "Jason Kratzer [:jkratzer]"}, "whiteboard": "", "mentors": [], "summary": "AddressSanitizer: SEGV /builds/worker/workspace/build/src/gfx/gl/../../mfbt/UniquePtr.h:326:32 in get", "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [{"requestee": "kgilbert@mozilla.com", "status": "?", "name": "needinfo", "modification_date": "2018-05-27T17:14:32Z", "type_id": 800, "creation_date": "2018-05-27T17:14:32Z", "id": 1762250, "setter": "ryanvm@gmail.com"}, {"status": "?", "name": "in-testsuite", "modification_date": "2018-05-18T16:18:09Z", "type_id": 37, "creation_date": "2018-05-18T16:18:09Z", "id": 1758898, "setter": "jkratzer@mozilla.com"}], "last_change_time": "2018-06-01T13:15:16Z", "assigned_to": "kgilbert@mozilla.com", "is_open": false, "history": [{"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "in-testsuite?"}], "who": "jkratzer@mozilla.com", "when": "2018-05-18T16:18:09Z"}, {"changes": [{"removed": "core-security", "field_name": "groups", "added": "gfx-core-security"}, {"removed": "", "field_name": "cc", "added": "kgilbert@mozilla.com, ryanvm@gmail.com"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(kgilbert@mozilla.com)"}], "who": "ryanvm@gmail.com", "when": "2018-05-19T21:24:21Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "agaynor@mozilla.com"}], "who": "continuation@gmail.com", "when": "2018-05-24T16:59:20Z"}, {"changes": [{"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "kgilbert@mozilla.com"}, {"removed": "needinfo?(kgilbert@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "kgilbert@mozilla.com", "when": "2018-05-24T23:04:21Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "jgilbert@mozilla.com"}], "who": "kgilbert@mozilla.com", "when": "2018-05-25T21:18:43Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8980774, "added": "review?(jgilbert@mozilla.com)"}], "who": "kgilbert@mozilla.com", "when": "2018-05-25T21:19:39Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(jgilbert@mozilla.com)", "attachment_id": 8980774, "added": "review+"}], "who": "jgilbert@mozilla.com", "when": "2018-05-25T21:21:43Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(ryanvm@gmail.com)"}], "who": "jgilbert@mozilla.com", "when": "2018-05-25T22:08:47Z"}, {"changes": [{"removed": "gfx-core-security", "field_name": "groups", "added": ""}, {"removed": "needinfo?(ryanvm@gmail.com)", "field_name": "flagtypes.name", "added": ""}], "who": "ryanvm@gmail.com", "when": "2018-05-25T22:14:11Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla62"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2018-05-26 04:12:50"}, {"removed": "---", "field_name": "cf_status_firefox62", "added": "fixed"}], "who": "dluca@mozilla.com", "when": "2018-05-26T04:12:50Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(kgilbert@mozilla.com)"}, {"removed": "---", "field_name": "cf_status_firefox_esr52", "added": "unaffected"}, {"removed": "---", "field_name": "cf_status_firefox_esr60", "added": "wontfix"}, {"removed": "---", "field_name": "cf_status_firefox60", "added": "wontfix"}, {"removed": "---", "field_name": "cf_status_firefox61", "added": "affected"}], "who": "ryanvm@gmail.com", "when": "2018-05-27T17:14:32Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8980774, "added": "approval-mozilla-beta?"}], "who": "kgilbert@mozilla.com", "when": "2018-05-31T22:43:39Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "approval-mozilla-beta?", "attachment_id": 8980774, "added": "approval-mozilla-beta+"}], "who": "ryanvm@gmail.com", "when": "2018-06-01T13:00:08Z"}, {"changes": [{"removed": "affected", "field_name": "cf_status_firefox61", "added": "fixed"}], "who": "ryanvm@gmail.com", "when": "2018-06-01T13:15:16Z"}], "resolution": "FIXED", "op_sys": "Unspecified", "cf_fx_points": "---", "cf_blocking_fennec": "---"}