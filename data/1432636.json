{"cf_tracking_thunderbird_esr52": "---", "status": "RESOLVED", "cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "cf_tracking_firefox62": "---", "creator": "bgrinstead@mozilla.com", "mentors_detail": [], "depends_on": [], "cf_status_firefox_esr60": "---", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "keywords": [], "cc_detail": [{"email": "afarre@mozilla.com", "id": 566192, "name": "afarre@mozilla.com", "real_name": "Andreas Farre [:farre]"}, {"email": "bobbyholley@gmail.com", "id": 313730, "name": "bobbyholley@gmail.com", "real_name": "Bobby Holley (On Leave Until June 11th)"}, {"email": "bzbarsky@mit.edu", "id": 20209, "name": "bzbarsky@mit.edu", "real_name": "Boris Zbarsky [:bz] (Vacation Jun 16-24) (no decent commit message means r-)"}, {"email": "e7358d9c@opayq.com", "id": 590837, "name": "e7358d9c@opayq.com", "real_name": "ExE Boss"}, {"email": "gandalf@aviary.pl", "id": 41270, "name": "gandalf@aviary.pl", "real_name": "Zibi Braniecki [:gandalf][:zibi]"}, {"email": "gijskruitbosch+bugs@gmail.com", "id": 159069, "name": "gijskruitbosch+bugs@gmail.com", "real_name": ":Gijs (he/him)"}, {"email": "moz-ian@perix.co.uk", "id": 237483, "name": "moz-ian@perix.co.uk", "real_name": "Ian Moody [:Kwan] (UTC+0)"}, {"email": "myk@mykzilla.org", "id": 27300, "name": "myk@mykzilla.org", "real_name": "Myk Melez [:myk] [@mykmelez]"}, {"email": "ntim.bugs@gmail.com", "id": 445472, "name": "ntim.bugs@gmail.com", "real_name": "Tim Nguyen :ntim"}, {"email": "paolo.mozmail@amadzone.org", "id": 332229, "name": "paolo.mozmail@amadzone.org", "real_name": ":Paolo Amadini"}, {"email": "peterv@propagandism.org", "id": 24295, "name": "peterv@propagandism.org", "real_name": "Peter Van der Beken [:peterv]"}, {"email": "VYV03354@nifty.ne.jp", "id": 5842, "name": "VYV03354@nifty.ne.jp", "real_name": "Masatoshi Kimura [:emk]"}], "cf_last_resolved": "2018-03-12T23:15:24Z", "attachments": [{"creator": "bgrinstead@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [], "content_type": "text/html", "id": 8944891}, {"creator": "moz-ian@perix.co.uk", "is_obsolete": 1, "is_patch": 1, "flags": [], "content_type": "text/plain", "id": 8949554}, {"creator": "moz-ian@perix.co.uk", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "feedback", "modification_date": "2018-02-12T18:26:51Z", "type_id": 607, "creation_date": "2018-02-12T18:26:51Z", "id": 1715625, "setter": "bgrinstead@mozilla.com"}, {"status": "+", "name": "feedback", "modification_date": "2018-02-13T19:44:41Z", "type_id": 607, "creation_date": "2018-02-13T19:44:41Z", "id": 1716224, "setter": "ntim.bugs@gmail.com"}], "content_type": "text/plain", "id": 8949709}, {"creator": "moz-ian@perix.co.uk", "is_obsolete": 1, "is_patch": 0, "flags": [], "content_type": "text/xml", "id": 8949712}, {"creator": "moz-ian@perix.co.uk", "is_obsolete": 0, "is_patch": 0, "flags": [], "content_type": "text/xml", "id": 8949717}, {"creator": "moz-ian@perix.co.uk", "is_obsolete": 0, "is_patch": 0, "flags": [], "content_type": "image/png", "id": 8950910}, {"creator": "moz-ian@perix.co.uk", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-02-14T15:54:17Z", "type_id": 4, "creation_date": "2018-02-14T14:04:13Z", "id": 1716574, "setter": "ntim.bugs@gmail.com"}, {"status": "+", "name": "review", "modification_date": "2018-02-21T16:51:39Z", "type_id": 4, "creation_date": "2018-02-15T14:54:36Z", "id": 1717162, "setter": "peterv@propagandism.org"}], "content_type": "text/x-review-board-request", "id": 8950913}], "votes": 1, "classification": "Components", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 42, "comments": [{"text": "What currently happens when you pretty print some XML (`data:text/xml,<foo><bar><baz>wat</baz>asdf</bar></foo>`) is we apply xslt to the source xml and then we put it in the DOM via XBL:\n\n- https://searchfox.org/mozilla-central/rev/e3cba77cee3ff1be38313abe9c804d13c51bd95b/dom/xml/nsXMLPrettyPrinter.cpp#99-186\n- https://searchfox.org/mozilla-central/source/dom/xml/resources/XMLPrettyPrint.xsl\n- https://searchfox.org/mozilla-central/source/dom/xml/resources/XMLPrettyPrint.xml#36\n\nWhat we could do instead:\n\n1) I think we can turn the XML pretty printing into HTML with no JS by modifying the existing XSLT to render out appropriate <details> / <summary> tags.\n2) Then we need a way to place to put that DOM - I was thinking this could be in a UA shadow root (see Bug 1431255), although I believe we also discussed somehow using the existing native anon content / CanvasFrame similar to how the devtools highlighters work.\n\nIt may be easiest to start by doing just (1) and continuing to use XBL to mount the content (but without any <handlers> since the HTML tags handle expand/collapse).", "author": "bgrinstead@mozilla.com", "id": 12990159, "time": "2018-01-23T22:16:42Z"}, {"text": "Created attachment 8944891\nprettyprint.html\n\nHere's a simple HTML page outlining the sort of markup that may work for (1)", "author": "bgrinstead@mozilla.com", "id": 12990165, "time": "2018-01-23T22:17:26Z"}, {"text": "We could also look at what the FeedWriter does - it used to use XBL to render the content on top of RSS feeds but that was removed in Bug 1432851. I'm not sure exactly all the plumbing required for this and if it would be appropriate here - it appears to be using an AboutRedirector to load subscribe.xhtml in content.", "author": "bgrinstead@mozilla.com", "id": 12996212, "time": "2018-01-25T23:59:24Z"}, {"text": "Also note that we have a better \"jsonview\" for rendering JSON (`data:application/json,{\"test\":[0,1,2]}`).\n\nhttps://dxr.mozilla.org/mozilla-central/source/devtools/client/jsonview\n\nIf we think that XML pretty printing is a useful feature for developers, eventually we might want to re-implement it with the better user experience that the \"jsonview\" provides.", "author": "paolo.mozmail@amadzone.org", "id": 13007931, "time": "2018-01-31T11:34:35Z"}, {"text": "The jsonview approach is not spec-compliant, fwiw, and could cause web compat issues too.  Just so people are aware before going with it...", "author": "bzbarsky@mit.edu", "id": 13008137, "time": "2018-01-31T13:26:24Z"}, {"text": "Can you elaborate on the difference between the two approaches that make one of them not spec-compliant? Is this related to how we choose to use the devtools view rather than downloading the file, or something else?", "author": "paolo.mozmail@amadzone.org", "id": 13008178, "time": "2018-01-31T13:33:48Z"}, {"text": "The relevant entry point is https://html.spec.whatwg.org/#process-a-navigate-response\n\nFor the JSON case, it says \"Follow the steps given in the plain text file section, and then, once they have completed, return.\"  That links to https://html.spec.whatwg.org/#read-text which specifies what the DOM of the resulting page is allowed to look like.  The DOM we produce for an application/json response looks nothing like that.  That said, there is weasel-wording in the spec about how an \"explicitly supported JSON type\" as defined in https://html.spec.whatwg.org/#explicitly-supported-json-type can be handled in other ways.  Maybe.\n\nSimilar for XML; unless it's an https://html.spec.whatwg.org/#explicitly-supported-xml-type you have to create a DOM per the rules of https://html.spec.whatwg.org/#read-xml\n\nPoint being, the current XML viewer preserves the actual DOM the XML parses into (and uses anonymous content for all its fancy viewer machinery).  The JSON viewer just munges the DOM from the thing the spec defines to something totally different.", "author": "bzbarsky@mit.edu", "id": 13008572, "time": "2018-01-31T15:54:07Z"}, {"text": "If we could generate a preview that doesn't rely on JS at all (like using <details> and <summary> HTML tags) then maybe we could attach that as native anonymous content to preserve the actual DOM without requiring some kind of UA shadow DOM support.  I think that could be done by modifying the existing XSL at https://searchfox.org/mozilla-central/source/dom/xml/resources/XMLPrettyPrint.xsl to generate the new HTML and then create the NAC instead of attaching the binding at https://searchfox.org/mozilla-central/source/dom/xml/nsXMLPrettyPrinter.cpp#127-186.", "author": "bgrinstead@mozilla.com", "id": 13008744, "time": "2018-01-31T16:51:14Z"}, {"text": "Created attachment 8949554\nMake XMLPrettyPrint use html:details instead of click handler (based on bgrins' prototype)\n\n(In reply to Brian Grinstead [:bgrins] from comment #7)\n> If we could generate a preview that doesn't rely on JS at all (like using\n> <details> and <summary> HTML tags)\n\nSo basing off your prototype from comment 1 this is very doable.  <details> and <summary> are pretty neat.\nUnfortunately the NAC creation is beyond me, but hopefully this patch will save someone some work (Hmm, I suppose it could even land now).\n\nA few adjustments needed:\n- swapped to the actual minus symbol\n- list-style-position needs to be outside, otherwise lining up expandable and non-expandable elements is not-fun.\n- The <details> and partner <span> need to be wrapped in a containing element else two consecutive collapsed elements end up on the same line due to the display: inline-block, though there are already containing divs in the existing XSLT, so that's not much of an adjustment, just a difference to the prototype.\n\nOther notes:\n- Slight behaviour change in that clicking the opening tag now toggles expanding, instead of just the +/\u2212.  However it's still possible to select text in said tag without triggering toggling, so that doesn't seem too bad.\n- Monospace style seems to have had an error for a while (probably since bug 379683) where collapsed & non-collapsible top-level elements aren't monospaced. This seem most simply fixable by wrapping all the transformed elements in one element (I went for <main>).  The other possibility would be something like #top > :not(#header), but grouping the output seemed neater.\n- Expandable XML PIs currently have a space between them and their control that nothing else does, so I removed that since I see no reason for it.\n- The original bug actually wanted to use twisties instead of +/\u2212: bug 64945 comment 210\n- Do we actually want the current behaviour of top-level non-expandables not lining up with expandables?  It seems kind of ugly.  Actually I think that might be another bug 379683 regression.\n\nAs an aside ::-moz-list-bullet not being selectable in the inspector (/not accessible by DeepTreeWalker?) is slightly inconvenient.", "author": "moz-ian@perix.co.uk", "id": 13029013, "time": "2018-02-08T21:54:53Z"}, {"text": "Created attachment 8949709\nMake XMLPrettyPrint use html:details instead of click handler (based on bgrins' prototype)\n\n(In reply to Ian Moody [:Kwan] (UTC+0) from comment #8)\n> - Expandable XML PIs currently have a space between them and their control\n> that nothing else does, so I removed that since I see no reason for it.\n\nThat might have been another bug 379683 regression.\n\n> - Do we actually want the current behaviour of top-level non-expandables not\n> lining up with expandables?  It seems kind of ugly.  Actually I think that\n> might be another bug 379683 regression.\n\nOn the basis that I'm pretty sure that that's true I've made them line up.  Simplifies the styling too (modulo fussing over margin vs. padding).  I'm not sure if there's still any point in giving expandable tags their own class now that it isn't used for styling anymore.\n\nAs another bonus, <details> gets us keyboard accessibility of the expander controls for free.\n\nBrian, do you think it's worth checking this in now (assuming it gets r+ of course) and leave-open until the NAC gen. is done? (or splitting this off into a separate bug, whichever)", "author": "moz-ian@perix.co.uk", "id": 13030266, "time": "2018-02-09T13:13:31Z"}, {"text": "Created attachment 8949712\nTest XML document\n\nThis is a stripped down version of the file I've been using to test this, since I needed something with multiple PIs and comments, with and without expanders, including consecutive expandables.\n(hopefully giving it a text/xml Content Type, like loading it from file://, stops the feed view triggering)", "author": "moz-ian@perix.co.uk", "id": 13030279, "time": "2018-02-09T13:18:25Z"}, {"text": "Comment on attachment 8949712\nTest XML document\n\n><?xml version=\"1.0\" encoding=\"UTF-8\"?>\n><?xml-bogus bogus=\"true\"?>\n><?xml-long reallyLong=\"A really long processing instruction to trip the expander\"?>\n><?xml-long reallyLong=\"A second really long processing instruction to trip the expander\"?>\n><!-- a test comment -->\n><!-- a really really long winded and rambling test comment to trip the expander -->\n><!-- a second really really long winded and rambling test comment to trip the expander -->\n><feed\n>  xmlns=\"http://www.w3.org/2005/not-Atom\"\n>  xml:lang=\"en\">\n>  <!-- a test comment -->\n>  <!-- a really really long winded and rambling test comment to trip the expander -->\n>  <!-- a second really really long winded and rambling test comment to trip the expander -->\n>  <title>Title of feed's website</title>\n>  <subtitle>The latest info on some really important stuff.</subtitle>\n>  <link rel=\"self\" type=\"application/atom+xml\" href=\"http://example.com/feed/atom/\" />\n>  <link rel=\"alternate\" type=\"text/html\" href=\"http://example.com/\" />\n>  <link rel=\"alternate\" type=\"application/rss+xml\" href=\"http://example.com/feed/rss2/\" />\n>  <link rel=\"alternate\" type=\"text/xml\" href=\"http://example.com/feed/rss/\" />\n>  <id>http://example.com</id>\n>  <updated>2017-07-21T11:31:46Z</updated>\n>  <rights>Copyright 2018 Example.com, some rights reserved</rights>\n>  <generator uri=\"http://example.com/\" version=\"60.0\">Example</generator>\n>  <icon>http://example.com/favicon.ico</icon>\n>\n>  <entry>\n>    <title type=\"html\"><![CDATA[Shocking news title]]></title>\n>    <link rel=\"alternate\" type=\"text/html\" href=\"http://example.com/2/\" />\n>    <id>tag:example.com,2017-07-21:/2/</id>\n>    <author>\n>      <name>Admin</name>\n>    </author>\n>    <published>2017-07-21T11:31:46Z</published>\n>    <updated>2017-07-21T11:31:46Z</updated>\n>    <category term=\"news\" />\n>    <summary type=\"html\"><![CDATA[Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nam imperdiet finibus ligula non facilisis. Cras rhoncus, eros a tempor pellentesque, elit mauris aliquet magna, sit amet venenatis nulla quam at nunc. Fusce mi magna, mollis et imperdiet sit amet, euismod in est. Mauris sollicitudin varius elit, ut consequat sem facilisis id. Duis dapibus porta[...]]]></summary>\n>    <content type=\"html\" xml:base=\"http://example.com/2/\"><![CDATA[<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nam imperdiet finibus ligula non facilisis. Cras rhoncus, eros a tempor pellentesque, elit mauris aliquet magna, sit amet venenatis nulla quam at nunc. Fusce mi magna, mollis et imperdiet sit amet, euismod in est. Mauris sollicitudin varius elit, ut consequat sem facilisis id. Duis dapibus porta magna. Pellentesque et euismod urna. Sed purus augue, dapibus id nisl at, auctor gravida arcu. Duis pellentesque molestie lacus in faucibus. Sed venenatis ac odio ac imperdiet. Aenean tristique elit at dolor fermentum, in ullamcorper elit tempor. Donec in ligula quis sapien consequat mattis. Pellentesque et feugiat justo, id feugiat nisi. Mauris mattis euismod sodales. Pellentesque viverra tempor nunc, nec hendrerit quam sodales vitae. Donec dapibus auctor odio, quis semper nulla. Praesent tincidunt nunc dolor, in sodales turpis suscipit non.</p>\n>\n><p>Mauris dui nulla, condimentum vitae enim sit amet, fringilla scelerisque erat. In at tempus orci. Pellentesque rutrum erat sit amet velit tincidunt ultricies. Duis sollicitudin dolor ut lobortis hendrerit. Phasellus id bibendum mauris, eget maximus massa. Sed convallis efficitur tellus vel molestie. Maecenas ut iaculis dolor. Mauris rutrum enim est, ac aliquam dui vulputate vel. Vestibulum efficitur tristique urna, in ultricies urna lobortis in. Vestibulum in vehicula lacus. Aliquam lacinia aliquam augue, eget dapibus eros ultricies non. </p>\n>]]></content>\n>  </entry>\n>\n>  <entry>\n>    <title type=\"html\"><![CDATA[First test post]]></title>\n>    <link rel=\"alternate\" type=\"text/html\" href=\"http://example.com/1/\" />\n>    <id>tag:example.com,2017-04-01:/1/</id>\n>    <author>\n>      <name>Admin</name>\n>    </author>\n>    <published>2017-04-01T17:20:12Z</published>\n>    <updated>2017-04-01T17:20:12Z</updated>\n>    <category term=\"testing\" />\n>    <summary type=\"html\"><![CDATA[Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nam imperdiet finibus ligula non facilisis. Cras rhoncus, eros a tempor pellentesque, elit mauris aliquet magna, sit amet venenatis nulla quam at nunc. Fusce mi magna, mollis et imperdiet sit amet, euismod in est. Mauris sollicitudin varius elit, ut consequat sem facilisis id. Duis dapibus porta[...]]]></summary>\n>    <content type=\"html\" xml:base=\"http://example.com/1/\"><![CDATA[<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nam imperdiet finibus ligula non facilisis. Cras rhoncus, eros a tempor pellentesque, elit mauris aliquet magna, sit amet venenatis nulla quam at nunc. Fusce mi magna, mollis et imperdiet sit amet, euismod in est. Mauris sollicitudin varius elit, ut consequat sem facilisis id. Duis dapibus porta magna. Pellentesque et euismod urna. Sed purus augue, dapibus id nisl at, auctor gravida arcu. Duis pellentesque molestie lacus in faucibus. Sed venenatis ac odio ac imperdiet. Aenean tristique elit at dolor fermentum, in ullamcorper elit tempor. Donec in ligula quis sapien consequat mattis. Pellentesque et feugiat justo, id feugiat nisi. Mauris mattis euismod sodales. Pellentesque viverra tempor nunc, nec hendrerit quam sodales vitae. Donec dapibus auctor odio, quis semper nulla. Praesent tincidunt nunc dolor, in sodales turpis suscipit non.</p>\n>\n><p>Mauris dui nulla, condimentum vitae enim sit amet, fringilla scelerisque erat. In at tempus orci. Pellentesque rutrum erat sit amet velit tincidunt ultricies. Duis sollicitudin dolor ut lobortis hendrerit. Phasellus id bibendum mauris, eget maximus massa. Sed convallis efficitur tellus vel molestie. Maecenas ut iaculis dolor. Mauris rutrum enim est, ac aliquam dui vulputate vel. Vestibulum efficitur tristique urna, in ultricies urna lobortis in. Vestibulum in vehicula lacus. Aliquam lacinia aliquam augue, eget dapibus eros ultricies non. </p>\n>]]></content>\n>  </entry>\n></feed>", "author": "moz-ian@perix.co.uk", "id": 13030283, "time": "2018-02-09T13:20:26Z"}, {"text": "Created attachment 8949717\nTest XML document\n\nBah, okay that doesn't work.  But testing via actually hosting it, breaking the namespace does seem to.", "author": "moz-ian@perix.co.uk", "id": 13030305, "time": "2018-02-09T13:25:58Z"}, {"text": "Comment on attachment 8949709\nMake XMLPrettyPrint use html:details instead of click handler (based on bgrins' prototype)\n\nReview of attachment 8949709:\n-----------------------------------------------------------------\n\nThanks for taking this on! And sure I'd be happy to split this up into multiple bugs - removing the click handler from XBL is a good start and it sounds like there are some UI improvements here (although I haven't tested locally or reviewed the xslt changes).\n\nMaybe :bz has an idea on how to put resultFragment into NAC instead of attaching it via XBL here: https://searchfox.org/mozilla-central/source/dom/xml/nsXMLPrettyPrinter.cpp#127-186.\n\n::: dom/xml/resources/XMLMonoPrint.css\n@@ -2,5 @@\n>  /* This Source Code Form is subject to the terms of the Mozilla Public\n>   * License, v. 2.0. If a copy of the MPL was not distributed with this\n>   * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n>  \n>  @import url(\"chrome://global/content/xml/XMLPrettyPrint.css\");\n\nCan we merge together XMLMonoPrint.css and XMLPrettyPrint.css into a single file? This feature seems to the only place either is used. And we currently double-import XMLPrettyPrint - once here and once as a <link> in the xsl", "author": "bgrinstead@mozilla.com", "id": 13036679, "time": "2018-02-12T18:26:51Z"}, {"text": "ni? for Comment 13", "author": "bgrinstead@mozilla.com", "id": 13036681, "time": "2018-02-12T18:27:14Z"}, {"text": "(In reply to Brian Grinstead [:bgrins] from comment #13)\n> ::: dom/xml/resources/XMLMonoPrint.css\n> @@ -2,5 @@\n> >  /* This Source Code Form is subject to the terms of the Mozilla Public\n> >   * License, v. 2.0. If a copy of the MPL was not distributed with this\n> >   * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n> >  \n> >  @import url(\"chrome://global/content/xml/XMLPrettyPrint.css\");\n> \n> Can we merge together XMLMonoPrint.css and XMLPrettyPrint.css into a single\n> file? This feature seems to the only place either is used. And we currently\n> double-import XMLPrettyPrint - once here and once as a <link> in the xsl\nI don't think we can merge because then there'd be no way to switch to Monospace, we'd have to create a new UI, ie. a checkbox in the header that adds a class or something.\nLet me check about removing the import though.  It might be needed if it's unapplied when switching to the alternate, but vaguely remembering how alternate styles are used/work on my own site, I think that's only the case for named default styles, I think unnamed defaults stay, so it should be okay.\n\nYeah seems to work fine without it since XMLPrettyPrint stays applied (and at the moment, both XMLPrettyPrint and viewsource get double applied when switching to Monospace, as can be observed in the DevTools style editor).", "author": "moz-ian@perix.co.uk", "id": 13036744, "time": "2018-02-12T18:46:02Z"}, {"text": "We could have something like nsIDocument::InsertAnonymousContent but only callable from C++ that just takes the given node as-is instead of cloning.  We'd need to fix nsXMLPrettyPrinter::Unhook to work too, of course.", "author": "bzbarsky@mit.edu", "id": 13036832, "time": "2018-02-12T19:09:40Z"}, {"text": "Comment on attachment 8949709\nMake XMLPrettyPrint use html:details instead of click handler (based on bgrins' prototype)\n\nReview of attachment 8949709:\n-----------------------------------------------------------------\n\nTim, would you be able to review the changes here?", "author": "bgrinstead@mozilla.com", "id": 13039345, "time": "2018-02-13T17:25:41Z"}, {"text": "Comment on attachment 8949709\nMake XMLPrettyPrint use html:details instead of click handler (based on bgrins' prototype)\n\nReview of attachment 8949709:\n-----------------------------------------------------------------\n\nWorks nicely and fixes some bugs.\n\nI have a few comments:\n- I noticed there is no longer spacing between the +/- and the opening tag\n- The markup is not super explicit now, it also makes the CSS a bit mysterious. Can you add some class names ? For example, \"details\" could have the class \"expander\", \"summary\" could have the class \"expander-opening-tag\" and the \"span\" could have \"expanding-closing-tag\" (feel free to find better names). It would make the CSS/markup easier to read IMO.\n\nThis should probably get reviewed by a dom peer as well.", "author": "ntim.bugs@gmail.com", "id": 13039763, "time": "2018-02-13T19:44:41Z"}, {"text": "Created attachment 8950910\nexpander spacing comparison\n\n(In reply to Tim Nguyen :ntim from comment #18)\n> Comment on attachment 8949709\n> Make XMLPrettyPrint use html:details instead of click handler (based on\n> bgrins' prototype)\n> \n> Review of attachment 8949709:\n> -----------------------------------------------------------------\n> \n> Works nicely and fixes some bugs.\n> \n> I have a few comments:\n> - I noticed there is no longer spacing between the +/- and the opening tag\n\nHmm I don't really see any difference on mine, but I'm guessing it's a font issue.\nThere's no existing explicit spacing, but the current expander is given a 1em width box, and then the text is centered, so maybe your minus isn't as wide as the one on my system, and has a bigger gap between it and the edge of the box (mine also appears to be slightly to the right of center at default font-size).  Measuring the distance on mine I only find a 1px smaller gap (3px vs 2px with my patch).  Maybe you just have keener eyes :) (Although the difference is more pronounced in Monospace style, definitely too close there).\nI don't think it'll be perfectly re-creatable without switching from list-style to a ::before for the +/\u2212, so that it can be sized like the old expander, but that seems of dubious worth for the amount of code, and to get platform/font-dependant behaviour. If it's definite spacing between the symbol and tag you're after I think it'd make more sense to do it explicitly with a px or two of padding (or margin) on the summary marker/bullet.\n\n(The difference in vertical space of the comments is because of moving the comment class from component elements to the containing div, which means the div ends up with a smaller line-height than the original due to comments specifically getting font-family: monospace; This didn't seem worth preserving when the only apparent reason for .comment not being on the div was so that its font effects didn't have to be overridden for the expander, but this patch makes the expander a pseudo element and so it needs overridding anyway)\n\n> - The markup is not super explicit now, it also makes the CSS a bit\n> mysterious. Can you add some class names ? For example, \"details\" could have\n> the class \"expander\", \"summary\" could have the class \"expander-opening-tag\"\n> and the \"span\" could have \"expanding-closing-tag\" (feel free to find better\n> names). It would make the CSS/markup easier to read IMO.\n\nAh, this is a good idea, although I don't think expander works for the details, it seems like that'd be more suited for the summary, since that's the actual controlling element, and expander used to be just for the +/\u2212.\n(Ideally the closing tag wouldn't need to be outside the details, then wouldn't even need the enclosing div)\nAfter fiddling for a while I've gone with\n\ndiv.expandable\n- details.expandable-body\n- - summary.expandable-opening\n- - div.expandable-children\n- span.expandable-closing\n\nI'm not 100% happy with -body but can't think of something better for everything-but-closing.\nI also gave main the id tree, since the header says it's showing the document tree.\n\n\nAs Brian has split the rest of the work out into a new bug I'll upload the next version to mozreview, to save the sheriff effort on checkin.", "author": "moz-ian@perix.co.uk", "id": 13041460, "time": "2018-02-14T13:45:52Z"}, {"text": "Created attachment 8950913\nBug 1432636 - Switch XMLPrettyPrint to use HTML <details> instead of click handlers for expandables.\n\nAlso fix some regressions from bug 379683:\n* top-level collapsed and uncollapsible elements weren't monospaced in monospace\n  style.\n* top-level uncollapsible elements weren't indented.\n* there was an extra space between PIs and their expander control.\n\nBased on prototype by bgrins.\n\nReview commit: https://reviewboard.mozilla.org/r/220166/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/220166/", "author": "moz-ian@perix.co.uk", "id": 13041485, "time": "2018-02-14T14:01:28Z"}, {"text": "Comment on attachment 8950913\nBug 1432636 - Switch XMLPrettyPrint to use HTML <details> instead of click handlers for expandables.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/220166/diff/1-2/", "author": "moz-ian@perix.co.uk", "id": 13041490, "time": "2018-02-14T14:04:13Z"}, {"text": "Comment on attachment 8950913\nBug 1432636 - Switch XMLPrettyPrint to use HTML <details> instead of click handlers for expandables.\n\nhttps://reviewboard.mozilla.org/r/220166/#review226072\n\nLooks good to me, but please do get a review from a DOM peer.", "author": "ntim.bugs@gmail.com", "id": 13041778, "time": "2018-02-14T15:54:17Z"}, {"text": "Comment on attachment 8950913\nBug 1432636 - Switch XMLPrettyPrint to use HTML <details> instead of click handlers for expandables.\n\nhttps://reviewboard.mozilla.org/r/220166/#review226076\n\n::: dom/xml/resources/XMLPrettyPrint.css:41\n(Diff revision 2)\n> +  font-family: initial;\n> +  font-size: initial;\n> +  font-style: initial;\n\nJust `font: initial;` should work", "author": "ntim.bugs@gmail.com", "id": 13041786, "time": "2018-02-14T15:56:21Z"}, {"text": "Comment on attachment 8950913\nBug 1432636 - Switch XMLPrettyPrint to use HTML <details> instead of click handlers for expandables.\n\nhttps://reviewboard.mozilla.org/r/220166/#review226084", "author": "moz-ian@perix.co.uk", "id": 13041822, "time": "2018-02-14T16:07:26Z"}, {"text": "Comment on attachment 8950913\nBug 1432636 - Switch XMLPrettyPrint to use HTML <details> instead of click handlers for expandables.\n\nhttps://reviewboard.mozilla.org/r/220166/#review226072\n\nThanks!  Will do.", "author": "moz-ian@perix.co.uk", "id": 13041825, "time": "2018-02-14T16:07:40Z"}, {"text": "Comment on attachment 8950913\nBug 1432636 - Switch XMLPrettyPrint to use HTML <details> instead of click handlers for expandables.\n\nhttps://reviewboard.mozilla.org/r/220166/#review226076\n\n> Just `font: initial;` should work\n\nIt does. I tried it earlier but decided to stick with being conservative in only setting properties I know needed doing, unless review asked me to change it :)", "author": "moz-ian@perix.co.uk", "id": 13041826, "time": "2018-02-14T16:08:24Z"}, {"text": "Comment on attachment 8950913\nBug 1432636 - Switch XMLPrettyPrint to use HTML <details> instead of click handlers for expandables.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/220166/diff/2-3/", "author": "moz-ian@perix.co.uk", "id": 13041908, "time": "2018-02-14T16:41:48Z"}, {"text": "Comment on attachment 8950913\nBug 1432636 - Switch XMLPrettyPrint to use HTML <details> instead of click handlers for expandables.\n\nhttps://reviewboard.mozilla.org/r/220166/#review227862\n\nNice!\n\n::: dom/xml/resources/XMLPrettyPrint.xsl:57\n(Diff revision 3)\n>        <xsl:text>&gt;</xsl:text>\n>      </div>\n>    </xsl:template>\n>  \n>    <xsl:template match=\"*[* or processing-instruction() or comment() or string-length(.) &gt; 50]\">\n> -    <div class=\"expander-open\">\n> +    <div class=\"expandable\">\n\nexpandable class seems unused, so maybe remove it?", "author": "peterv@propagandism.org", "id": 13058243, "time": "2018-02-21T16:51:39Z"}, {"text": "Hi Ian, is this ready to land, besides the nit in comment #28?", "author": "gijskruitbosch+bugs@gmail.com", "id": 13078846, "time": "2018-03-01T09:27:59Z"}, {"text": "Comment on attachment 8950913\nBug 1432636 - Switch XMLPrettyPrint to use HTML <details> instead of click handlers for expandables.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/220166/diff/3-4/", "author": "moz-ian@perix.co.uk", "id": 13119569, "time": "2018-03-11T16:02:08Z"}, {"text": "Sorry for the lag, this is good to land now.\n\nThanks for the reviews Peter and Tim!", "author": "moz-ian@perix.co.uk", "id": 13119573, "time": "2018-03-11T16:03:55Z"}, {"text": "Comment on attachment 8950913\nBug 1432636 - Switch XMLPrettyPrint to use HTML <details> instead of click handlers for expandables.\n\nhttps://reviewboard.mozilla.org/r/220166/#review232620\n\n::: dom/xml/resources/XMLPrettyPrint.css\n(Diff revision 4)\n>  \n>  .comment {\n>    font-family: monospace;\n>    white-space: pre;\n>  }\n> -\n\nI\u2019m pretty sure that the last empty line (`\\n`) should not be removed, since no other file does this.", "author": "e7358d9c@opayq.com", "id": 13119732, "time": "2018-03-11T19:45:24Z"}, {"text": "(In reply to ExE Boss from comment #32)\n> ::: dom/xml/resources/XMLPrettyPrint.css\n> (Diff revision 4)\n> >  \n> >  .comment {\n> >    font-family: monospace;\n> >    white-space: pre;\n> >  }\n> > -\n> \n> I\u2019m pretty sure that the last empty line (`\\n`) should not be removed, since\n> no other file does this.\n\nThis just removes 1 of the 2 trailing lines at the end of the file, which is change I'm personally fine with.", "author": "ntim.bugs@gmail.com", "id": 13119807, "time": "2018-03-11T21:44:42Z"}, {"text": "Usually it shows \"\\No newline at the end of this file\" when there's no trailing line left.", "author": "ntim.bugs@gmail.com", "id": 13119808, "time": "2018-03-11T21:46:28Z"}, {"text": "Pushed by ntim.bugs@gmail.com:\nhttps://hg.mozilla.org/integration/autoland/rev/48c4d99016ec\nSwitch XMLPrettyPrint to use HTML <details> instead of click handlers for expandables. r=ntim,peterv", "author": "pulsebot@bots.tld", "id": 13119809, "time": "2018-03-11T21:48:17Z"}, {"text": "Backed out changeset 48c4d99016ec (bug 1432636) for failing mochitests at dom/base/test/test_bug590812.html\n\nFailure push: https://treeherder.mozilla.org/#/jobs?repo=autoland&revision=48c4d99016ec84efa9298321ae1e692a9b4f3f8d&selectedJob=167313622\n\nFailure log: https://treeherder.mozilla.org/logviewer.html#?job_id=167313622&repo=autoland&lineNumber=5104\n\nBackout: https://hg.mozilla.org/integration/autoland/rev/5290391d0f6a955eec8ff27cd5bd1ab8e766bd54", "author": "ccoroiu@mozilla.com", "id": 13119853, "time": "2018-03-11T23:01:21Z"}, {"text": "Looks like file_bug590812.xhtml needs to be regenerated with your new markup.", "author": "ntim.bugs@gmail.com", "id": 13119855, "time": "2018-03-11T23:05:22Z"}, {"text": "Comment on attachment 8950913\nBug 1432636 - Switch XMLPrettyPrint to use HTML <details> instead of click handlers for expandables.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/220166/diff/4-5/", "author": "moz-ian@perix.co.uk", "id": 13121637, "time": "2018-03-12T10:17:20Z"}, {"text": "Bah, sorry about that, not sure why I was convinced I'd already checked tests for this.\nUpdated the ref file.", "author": "moz-ian@perix.co.uk", "id": 13121643, "time": "2018-03-12T10:20:41Z"}, {"text": "Pushed by csabou@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/863272a3efcc\nSwitch XMLPrettyPrint to use HTML <details> instead of click handlers for expandables. r=ntim,peterv", "author": "pulsebot@bots.tld", "id": 13121737, "time": "2018-03-12T11:22:46Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/863272a3efcc", "author": "ebalazs@mozilla.com", "id": 13123669, "time": "2018-03-12T23:15:24Z"}], "id": 1432636, "priority": "P2", "cc": ["afarre@mozilla.com", "bobbyholley@gmail.com", "bzbarsky@mit.edu", "e7358d9c@opayq.com", "gandalf@aviary.pl", "gijskruitbosch+bugs@gmail.com", "moz-ian@perix.co.uk", "myk@mykzilla.org", "ntim.bugs@gmail.com", "paolo.mozmail@amadzone.org", "peterv@propagandism.org", "VYV03354@nifty.ne.jp"], "cf_crash_signature": "", "version": "unspecified", "is_cc_accessible": true, "cf_tracking_firefox_esr52": "---", "see_also": ["https://bugzilla.mozilla.org/show_bug.cgi?id=1431255"], "cf_tracking_thunderbird_esr60": "---", "cf_platform_rel": "---", "product": "Core", "cf_fx_iteration": "---", "blocks": [1397874, 1437956], "qa_contact": "", "creation_time": "2018-01-23T22:16:42Z", "cf_status_firefox_esr52": "---", "component": "XML", "assigned_to_detail": {"email": "moz-ian@perix.co.uk", "id": 237483, "name": "moz-ian@perix.co.uk", "real_name": "Ian Moody [:Kwan] (UTC+0)"}, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "---", "cf_status_firefox61": "fixed", "cf_status_firefox60": "---", "target_milestone": "mozilla61", "cf_rank": null, "cf_qa_whiteboard": "", "severity": "normal", "groups": [], "cf_status_thunderbird_esr52": "---", "url": "", "cf_status_thunderbird_esr60": "---", "creator_detail": {"email": "bgrinstead@mozilla.com", "id": 476442, "name": "bgrinstead@mozilla.com", "real_name": "Brian Grinstead [:bgrins]"}, "whiteboard": "[xbl-in-content]", "mentors": [], "summary": "Implement XML pretty printing without requiring <handler> JS in XBL", "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "last_change_time": "2018-03-12T23:15:24Z", "assigned_to": "moz-ian@perix.co.uk", "is_open": false, "history": [{"changes": [{"removed": "", "field_name": "cc", "added": "VYV03354@nifty.ne.jp"}], "who": "VYV03354@nifty.ne.jp", "when": "2018-01-24T07:49:15Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "paolo.mozmail@amadzone.org"}], "who": "paolo.mozmail@amadzone.org", "when": "2018-01-31T11:34:35Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(bzbarsky@mit.edu)"}], "who": "paolo.mozmail@amadzone.org", "when": "2018-01-31T13:33:48Z"}, {"changes": [{"removed": "needinfo?(bzbarsky@mit.edu)", "field_name": "flagtypes.name", "added": ""}], "who": "bzbarsky@mit.edu", "when": "2018-01-31T15:54:07Z"}, {"changes": [{"removed": "", "field_name": "whiteboard", "added": "[xbl-in-content]"}], "who": "bgrinstead@mozilla.com", "when": "2018-01-31T21:53:09Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "gandalf@aviary.pl"}], "who": "gandalf@aviary.pl", "when": "2018-02-02T23:55:18Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "myk@mykzilla.org"}], "who": "myk@mykzilla.org", "when": "2018-02-03T00:14:46Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8949554, "added": "1"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(bgrinstead@mozilla.com)"}], "who": "moz-ian@perix.co.uk", "when": "2018-02-09T13:13:31Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8949712, "added": "1"}], "who": "moz-ian@perix.co.uk", "when": "2018-02-09T13:25:58Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8949709, "added": "feedback+"}], "who": "bgrinstead@mozilla.com", "when": "2018-02-12T18:26:51Z"}, {"changes": [{"removed": "needinfo?(bgrinstead@mozilla.com)", "field_name": "flagtypes.name", "added": "needinfo?(bzbarsky@mit.edu)"}], "who": "bgrinstead@mozilla.com", "when": "2018-02-12T18:27:14Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "moz-ian@perix.co.uk"}], "who": "moz-ian@perix.co.uk", "when": "2018-02-12T18:46:02Z"}, {"changes": [{"removed": "needinfo?(bzbarsky@mit.edu)", "field_name": "flagtypes.name", "added": ""}], "who": "bzbarsky@mit.edu", "when": "2018-02-12T19:09:40Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8949709, "added": "review?(ntim.bugs@gmail.com)"}], "who": "bgrinstead@mozilla.com", "when": "2018-02-13T17:25:41Z"}, {"changes": [{"removed": "", "field_name": "blocks", "added": "1437956"}], "who": "bgrinstead@mozilla.com", "when": "2018-02-13T18:05:35Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(ntim.bugs@gmail.com)", "attachment_id": 8949709, "added": "feedback+"}], "who": "ntim.bugs@gmail.com", "when": "2018-02-13T19:44:41Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "ASSIGNED"}, {"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "moz-ian@perix.co.uk"}], "who": "moz-ian@perix.co.uk", "when": "2018-02-14T13:45:52Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8950913, "added": "review?(ntim.bugs@gmail.com)"}], "who": "moz-ian@perix.co.uk", "when": "2018-02-14T14:04:13Z"}, {"changes": [{"removed": "--", "field_name": "priority", "added": "P2"}, {"removed": "", "field_name": "cc", "added": "afarre@mozilla.com"}], "who": "afarre@mozilla.com", "when": "2018-02-14T15:14:56Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(ntim.bugs@gmail.com)", "attachment_id": 8950913, "added": "review+"}], "who": "ntim.bugs@gmail.com", "when": "2018-02-14T15:54:17Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8950913, "added": "review?(peterv@propagandism.org)"}, {"removed": "", "field_name": "cc", "added": "peterv@propagandism.org"}], "who": "moz-ian@perix.co.uk", "when": "2018-02-15T14:54:36Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(peterv@propagandism.org)", "attachment_id": 8950913, "added": "review+"}], "who": "peterv@propagandism.org", "when": "2018-02-21T16:51:39Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(moz-ian@perix.co.uk)"}], "who": "gijskruitbosch+bugs@gmail.com", "when": "2018-03-01T09:27:59Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "checkin-needed"}, {"removed": "needinfo?(moz-ian@perix.co.uk)", "field_name": "flagtypes.name", "added": ""}], "who": "moz-ian@perix.co.uk", "when": "2018-03-11T16:03:55Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "e7358d9c@opayq.com"}], "who": "e7358d9c@opayq.com", "when": "2018-03-11T19:46:46Z"}, {"changes": [{"removed": "checkin-needed", "field_name": "keywords", "added": ""}], "who": "pulsebot@bots.tld", "when": "2018-03-11T21:48:17Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(moz-ian@perix.co.uk)"}], "who": "ccoroiu@mozilla.com", "when": "2018-03-11T23:01:21Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "checkin-needed"}, {"removed": "needinfo?(moz-ian@perix.co.uk)", "field_name": "flagtypes.name", "added": ""}], "who": "moz-ian@perix.co.uk", "when": "2018-03-12T10:20:41Z"}, {"changes": [{"removed": "checkin-needed", "field_name": "keywords", "added": ""}], "who": "pulsebot@bots.tld", "when": "2018-03-12T11:22:46Z"}, {"changes": [{"removed": "ASSIGNED", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla61"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2018-03-12 23:15:24"}, {"removed": "---", "field_name": "cf_status_firefox61", "added": "fixed"}], "who": "ebalazs@mozilla.com", "when": "2018-03-12T23:15:24Z"}], "resolution": "FIXED", "op_sys": "Unspecified", "cf_fx_points": "---", "cf_blocking_fennec": "---"}