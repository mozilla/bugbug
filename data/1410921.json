{"cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "classification": "Components", "creator": "poirot.alex@gmail.com", "mentors_detail": [], "depends_on": [], "creation_time": "2017-10-23T15:15:17Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "keywords": ["regression"], "summary": "All BrowserLoader instances in panels should be given a commonLibRequire argument", "cf_last_resolved": null, "attachments": [{"creator": "poirot.alex@gmail.com", "is_obsolete": 0, "is_patch": 0, "flags": [], "content_type": "text/x-review-board-request", "id": 8921106}, {"creator": "poirot.alex@gmail.com", "is_obsolete": 0, "is_patch": 0, "flags": [], "content_type": "text/x-review-board-request", "id": 8921107}, {"creator": "poirot.alex@gmail.com", "is_obsolete": 0, "is_patch": 0, "flags": [], "content_type": "text/x-review-board-request", "id": 8921108}], "assigned_to_detail": {"email": "nobody@mozilla.org", "id": 1, "name": "nobody@mozilla.org", "real_name": "Nobody; OK to take it and work on it"}, "severity": "normal", "is_confirmed": true, "is_creator_accessible": true, "comments": [{"text": "This was regressed by bug 1350215 (netmonitor) and bug 1402262 (console).\n\nSee bug 1333131 comment 3 which highlights the cost of dupliated React instances.\n\nToolbox already need to load React and various other significant 3rd party libraries.\n\nIn order to reuse these instances, BrowserLoader supports \"commonLibRequire\" argument which allow to share some modules.\nAs of today, it is only used by old Console frontend:\nhttp://searchfox.org/mozilla-central/rev/8a6a6bef7c54425970aa4fb039cc6463a19c0b7f/devtools/client/webconsole/webconsole.js#232\nBut it should be used in every BrowserLoader instance. Except the toolbox one and code that lives outside of a toolbox like about:debugging, RDM or panels loaded in a tab.\n\nThis is missing in many places:\nhttp://searchfox.org/mozilla-central/search?q=BrowserLoader(&case=false&regexp=false&path=\n* animation inspector\n* debugger\n* dom\n* memory\n* netmonitor\n* performance\n* new webconsole frontend", "author": "poirot.alex@gmail.com", "id": 12782385, "time": "2017-10-23T15:15:17Z"}, {"text": "Created attachment 8921106\nBug 1410921 - Fix netmonitor and webconsole URLs in react-dom monkey patch. ?\n\nReview commit: https://reviewboard.mozilla.org/r/192070/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/192070/", "author": "poirot.alex@gmail.com", "id": 12782562, "time": "2017-10-23T16:07:46Z"}, {"text": "Created attachment 8921107\nBug 1410921 - Reuse toolbox modules from the new console frontend.\n\nReview commit: https://reviewboard.mozilla.org/r/192072/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/192072/", "author": "poirot.alex@gmail.com", "id": 12782563, "time": "2017-10-23T16:07:46Z"}, {"text": "Created attachment 8921108\nBug 1410921 - Reuse toolbox modules from netmonitor panel.\n\nReview commit: https://reviewboard.mozilla.org/r/192074/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/192074/", "author": "poirot.alex@gmail.com", "id": 12782564, "time": "2017-10-23T16:07:46Z"}, {"text": "Comment on attachment 8921106\nBug 1410921 - Fix netmonitor and webconsole URLs in react-dom monkey patch. ?\n\nThe URLs were outdated in react-dom patch. This reintroduces issues with DOM events. For example the filter bar doesn't toggle correctly.", "author": "poirot.alex@gmail.com", "id": 12782571, "time": "2017-10-23T16:08:56Z"}, {"text": "Let's see what DAMP says about this.\n\nJust pushed to try, so still waiting for try color:\nhttps://treeherder.mozilla.org/#/jobs?repo=try&revision=a333d65451d01212490ae3d4354a3782253de45d\nand DAMP results:\nhttps://treeherder.mozilla.org/perf.html#/comparechooser?newProject=try&newRevision=a333d65451d01212490ae3d4354a3782253de45d", "author": "poirot.alex@gmail.com", "id": 12782578, "time": "2017-10-23T16:10:12Z"}, {"text": "We may want to add a test to ensure this behavior is preserved, so we can avoid regressing it (again) in the future.", "author": "jryans@gmail.com", "id": 12782708, "time": "2017-10-23T16:37:57Z"}, {"text": "Ah. This becomes interesting.\nDAMP reports significant regression.\nI'm wondering if it is:\n* cross compartment wrappers between toolbox and panel documents?\n  We end up using toolbox's React which comes from another document and so I imagine there may be wrappers here.\n* cost of the monkey patch of ReactDOM?\n  This patch involves Proxy, if this is in a React hot codepath, it must be slow:\n  http://searchfox.org/mozilla-central/source/devtools/client/shared/vendor/REACT_UPGRADING.md#patching-buildreact-dom.js", "author": "poirot.alex@gmail.com", "id": 12785702, "time": "2017-10-24T14:56:20Z"}, {"text": "It may be interesting to revisit this as the monkey patch has been removed.\n\nAlso, Julian recently highlighted that the inspector is doing something special, that can be replaced with a dedicated BrowserLoader using `commonLibRequire`.\nInstead of that, it requires all react and component modules via toolbox's BrowserLoader instance, via toolbox.browserRequire/inspectorPanel.browserRequire:\n  https://searchfox.org/mozilla-central/search?q=browserRequire(&case=false&regexp=false&path=%2Finspector%2F\n\n(The toolbox has its own BrowserLoader instanciated here:\n https://searchfox.org/mozilla-central/rev/4114ad2cfcbc511705c7865a4a34741812f9a2a9/devtools/client/framework/toolbox.js#431)", "author": "poirot.alex@gmail.com", "id": 13200319, "time": "2018-04-12T09:34:28Z"}, {"text": "As of today, `commonLibRequire` is no longer used anywhere.\n\nIt has been removed from console without clear reason in bug 1402262.\n\nThe inspector still uses toolbox loader to share react instances as described in comment 8.", "author": "poirot.alex@gmail.com", "id": 13228767, "time": "2018-04-24T07:10:53Z"}], "id": 1410921, "priority": "P2", "platform": "Unspecified", "comment_count": 10, "version": "unspecified", "is_cc_accessible": true, "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox62": "---", "status": "NEW", "product": "DevTools", "cf_fx_iteration": "---", "blocks": [1333131, 1378418], "qa_contact": "", "see_also": [], "cf_status_firefox_esr52": "---", "component": "General", "votes": 0, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "---", "cf_status_firefox61": "---", "cf_status_firefox60": "---", "target_milestone": "---", "cc": ["jlaster@mozilla.com", "jryans@gmail.com", "mcastelluccio@mozilla.com", "nchevobbe@mozilla.com", "ntim.bugs@gmail.com", "odvarko@gmail.com", "pbrosset@mozilla.com"], "groups": [], "url": "", "creator_detail": {"email": "poirot.alex@gmail.com", "id": 283262, "name": "poirot.alex@gmail.com", "real_name": "Alexandre Poirot [:ochameau]"}, "whiteboard": "", "mentors": [], "cc_detail": [{"email": "jlaster@mozilla.com", "id": 555817, "name": "jlaster@mozilla.com", "real_name": "Jason Laster [:jlast]"}, {"email": "jryans@gmail.com", "id": 282978, "name": "jryans@gmail.com", "real_name": "J. Ryan Stinnett [:jryans] (use ni?)"}, {"email": "mcastelluccio@mozilla.com", "id": 420453, "name": "mcastelluccio@mozilla.com", "real_name": "Marco Castelluccio [:marco]"}, {"email": "nchevobbe@mozilla.com", "id": 557153, "name": "nchevobbe@mozilla.com", "real_name": "Nicolas Chevobbe [:nchevobbe]"}, {"email": "ntim.bugs@gmail.com", "id": 445472, "name": "ntim.bugs@gmail.com", "real_name": "Tim Nguyen :ntim"}, {"email": "odvarko@gmail.com", "id": 303767, "name": "odvarko@gmail.com", "real_name": "Jan Honza Odvarko [:Honza]"}, {"email": "pbrosset@mozilla.com", "id": 478661, "name": "pbrosset@mozilla.com", "real_name": "Patrick Brosset <:pbro>"}], "alias": null, "dupe_of": null, "flags": [], "last_change_time": "2018-06-13T17:21:13Z", "cf_status_firefox_esr60": "---", "assigned_to": "nobody@mozilla.org", "is_open": true, "cf_qa_whiteboard": "", "resolution": "", "op_sys": "Unspecified", "cf_fx_points": "---", "history": [{"changes": [{"removed": "", "field_name": "cc", "added": "ntim.bugs@gmail.com"}], "who": "poirot.alex@gmail.com", "when": "2017-10-23T15:26:22Z"}, {"changes": [{"removed": "", "field_name": "blocks", "added": "1333131"}], "who": "poirot.alex@gmail.com", "when": "2017-10-23T16:24:43Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "jryans@gmail.com"}], "who": "jryans@gmail.com", "when": "2017-10-23T16:37:57Z"}, {"changes": [{"removed": "--", "field_name": "priority", "added": "P2"}], "who": "pbrosset@mozilla.com", "when": "2017-11-02T16:05:50Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "regression"}, {"removed": "", "field_name": "cc", "added": "mcastelluccio@mozilla.com"}], "who": "mcastelluccio@mozilla.com", "when": "2018-04-25T23:33:35Z"}, {"changes": [{"removed": "Firefox", "field_name": "product", "added": "DevTools"}], "who": "automation@bmo.tld", "when": "2018-06-13T17:21:13Z"}]}