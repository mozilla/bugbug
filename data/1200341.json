{"cf_tracking_thunderbird_esr52": "---", "status": "RESOLVED", "cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "cf_tracking_firefox62": "---", "creator": "renthraysk@gmail.com", "mentors_detail": [], "depends_on": [1243438], "cf_status_firefox_esr60": "---", "cf_user_story": "", "cf_tracking_firefox_relnote": "46+", "platform": "All", "keywords": ["dev-doc-needed", "html5", "wsec-crypto"], "cc_detail": [{"email": "abillings@mozilla.com", "id": 280903, "name": "abillings@mozilla.com", "real_name": "Al Billings [:abillings]"}, {"email": "bugs@pettay.fi", "id": 39966, "name": "bugs@pettay.fi", "real_name": "Olli Pettay [:smaug]"}, {"email": "dholbert@mozilla.com", "id": 278074, "name": "dholbert@mozilla.com", "real_name": "Daniel Holbert [:dholbert]"}, {"email": "jypenator@gmail.com", "id": 248150, "name": "jypenator@gmail.com", "real_name": "Jean-Yves Perrier [:teoli]"}, {"email": "mfunches@softvision.com", "id": 551956, "name": "mfunches@softvision.com", "real_name": "Michelle Funches - QA"}, {"email": "rlb@ipv.sx", "id": 373085, "name": "rlb@ipv.sx", "real_name": "Richard Barnes [:rbarnes]"}, {"email": "ttaubert@mozilla.com", "id": 402526, "name": "ttaubert@mozilla.com", "real_name": "Tim Taubert [:ttaubert] (inactive)"}], "cf_last_resolved": "2016-01-27T11:10:11Z", "attachments": [{"creator": "renthraysk@gmail.com", "is_obsolete": 0, "is_patch": 0, "flags": [], "content_type": "text/html", "id": 8665674}, {"creator": "ttaubert@mozilla.com", "is_obsolete": 1, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2016-01-25T21:54:43Z", "type_id": 4, "creation_date": "2016-01-25T16:10:13Z", "id": 1329657, "setter": "rlb@ipv.sx"}], "content_type": "text/plain", "id": 8711708}, {"creator": "ttaubert@mozilla.com", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2016-01-26T15:41:50Z", "type_id": 4, "creation_date": "2016-01-26T14:42:33Z", "id": 1330418, "setter": "bugs@pettay.fi"}, {"status": "+", "name": "approval-mozilla-aurora", "modification_date": "2016-01-29T17:10:55Z", "type_id": 720, "creation_date": "2016-01-27T12:18:22Z", "id": 1331159, "setter": "lhenry@mozilla.com"}], "content_type": "text/plain", "id": 8712149}, {"creator": "ttaubert@mozilla.com", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2016-01-26T15:49:53Z", "type_id": 4, "creation_date": "2016-01-26T15:49:53Z", "id": 1330482, "setter": "ttaubert@mozilla.com"}], "content_type": "text/plain", "id": 8712179}], "votes": 0, "classification": "Components", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "is_cc_accessible": true, "comment_count": 24, "comments": [{"text": "User Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/44.0.2403.157 Safari/537.36\n\nSteps to reproduce:\n\nImplement WebCrypto HKDF and ConcatKDF. \n\nGiven that DH & ECDH have been implemented, it does seem the common practice to use a KDF to derive keys from the shared secret, and not use the shared secret directly.", "author": "renthraysk@gmail.com", "id": 10678551, "time": "2015-08-31T18:25:25Z"}, {"text": "So it seems cannot derive a PBKDF2 key from a ECDH shared secret. So there are no usable KDFs with DH/ECDH key exchanges.", "author": "renthraysk@gmail.com", "id": 10773758, "time": "2015-09-24T22:35:16Z"}, {"text": "Created attachment 8665674\nAttempt to derive a PBKDF2 key from a ECDH exchange", "author": "renthraysk@gmail.com", "id": 10773762, "time": "2015-09-24T22:37:30Z"}, {"text": "The CONCAT KDF was removed from the spec.", "author": "ttaubert@mozilla.com", "id": 11101600, "time": "2016-01-23T12:43:13Z"}, {"text": "Note: https://www.w3.org/Bugs/Public/show_bug.cgi?id=27425\n\nHKDF-CTR will be renamed to HKDF and stick to RFC 5869.", "author": "ttaubert@mozilla.com", "id": 11101920, "time": "2016-01-23T21:48:28Z"}, {"text": "Created attachment 8711708\n0001-Bug-1200341-Implement-HKDF-for-WebCrypto.patch\n\nI fixed a few things left and right but this should work and have a good test coverage.", "author": "ttaubert@mozilla.com", "id": 11104703, "time": "2016-01-25T16:10:13Z"}, {"text": "(In reply to RenThraysk from comment #2)\n> Created attachment 8665674\n> Attempt to derive a PBKDF2 key from a ECDH exchange\n\nThis isn't quite how the API is supposed to be used. You first would call deriveBits(\"ECDH\"), then import those as \"raw\" into an HKDF or PBDFK2 key. Then you can finally call deriveBits() or deriveKey() for either of the KDFs.", "author": "ttaubert@mozilla.com", "id": 11104722, "time": "2016-01-25T16:12:19Z"}, {"text": "Comment on attachment 8711708\n0001-Bug-1200341-Implement-HKDF-for-WebCrypto.patch\n\nReview of attachment 8711708:\n-----------------------------------------------------------------\n\nr=me with comments addressed.\n\n::: dom/crypto/WebCryptoTask.cpp\n@@ +1447,5 @@\n> +      mEarlyRv = NS_ERROR_DOM_NOT_SUPPORTED_ERR;\n> +      return;\n> +    }\n> +\n> +    // JWK is not supported for HKDF and PBKDF2.\n\nI realize that JWK support is not in the spec, but I don't see a good technical reason to keep it out.  Will support work if we just remove this check?\n\n::: dom/crypto/test/test_WebCrypto_HKDF.html\n@@ +64,5 @@\n> +      return crypto.subtle.deriveBits(alg, x, 4);\n> +    }\n> +\n> +    crypto.subtle.importKey(\"raw\", key, \"HKDF\", false, [\"deriveBits\"])\n> +      .then(deriveBits)\n\nFor these cases where deriveBits is one line, it would be more readable just to have \".then(k => crypto.subtle.deriveBits(alg, k, 4))\"\n\n@@ +65,5 @@\n> +    }\n> +\n> +    crypto.subtle.importKey(\"raw\", key, \"HKDF\", false, [\"deriveBits\"])\n> +      .then(deriveBits)\n> +      // The last 4 bits should be zeroes (1000 1101 => 1000 0000).\n\nWhat does the parenthetical mean?\n\n::: dom/crypto/test/test_WebCrypto_PBKDF2.html\n@@ +38,5 @@\n>  );\n>  \n>  // -----------------------------------------------------------------------------\n>  TestArray.addTest(\n> +  \"Unwrapping a PBKDF2 key in PKCS8 format should fail\",\n\nThis seems like an unrelated fix, but I'll let it slide.\n\nDo you want to test JWK (in)tolerance for HKDF?", "author": "rlb@ipv.sx", "id": 11106195, "time": "2016-01-25T21:54:43Z"}, {"text": "(In reply to Richard Barnes [:rbarnes] from comment #7)\n> ::: dom/crypto/WebCryptoTask.cpp\n> @@ +1447,5 @@\n> > +      mEarlyRv = NS_ERROR_DOM_NOT_SUPPORTED_ERR;\n> > +      return;\n> > +    }\n> > +\n> > +    // JWK is not supported for HKDF and PBKDF2.\n> \n> I realize that JWK support is not in the spec, but I don't see a good\n> technical reason to keep it out.  Will support work if we just remove this\n> check?\n\nRemoved.\n\n> ::: dom/crypto/test/test_WebCrypto_HKDF.html\n> @@ +64,5 @@\n> > +      return crypto.subtle.deriveBits(alg, x, 4);\n> > +    }\n> > +\n> > +    crypto.subtle.importKey(\"raw\", key, \"HKDF\", false, [\"deriveBits\"])\n> > +      .then(deriveBits)\n> \n> For these cases where deriveBits is one line, it would be more readable just\n> to have \".then(k => crypto.subtle.deriveBits(alg, k, 4))\"\n\nSure.\n\n> @@ +65,5 @@\n> > +    }\n> > +\n> > +    crypto.subtle.importKey(\"raw\", key, \"HKDF\", false, [\"deriveBits\"])\n> > +      .then(deriveBits)\n> > +      // The last 4 bits should be zeroes (1000 1101 => 1000 0000).\n> \n> What does the parenthetical mean?\n\nIt's supposed to describe that here PK11_Derive() derives a full byte, 0x8d. We truncate it to 0x80, i.e. set the 4 LSBs to zero.\n\n> Do you want to test JWK (in)tolerance for HKDF?\n\nYes! Added a JWK import test for HKDF and PBKDF2.", "author": "ttaubert@mozilla.com", "id": 11107888, "time": "2016-01-26T11:19:38Z"}, {"text": "Comment on attachment 8711708\n0001-Bug-1200341-Implement-HKDF-for-WebCrypto.patch\n\nOlli, can you please look at the .webidl file changes? The latest spec is here:\n\nhttps://dvcs.w3.org/hg/webcrypto-api/raw-file/tip/spec/Overview.html#hkdf-ctr-params\n\nIt has |label| and |context| parameters that will change to |salt| and |info| soon:\n\nhttps://www.w3.org/Bugs/Public/show_bug.cgi?id=27425", "author": "ttaubert@mozilla.com", "id": 11107897, "time": "2016-01-26T11:22:47Z"}, {"text": "Created attachment 8712149\n0001-Bug-1200341-Implement-HKDF-for-WebCrypto-r-rbarnes-s.patch, v2\n\nr=rbarnes\n\nForgot to rename HkdfCtrParams to HkdfParams. Chrome implemented the same IDL spec btw:\n\nhttps://chromium.googlesource.com/chromium/src/+/master/third_party/WebKit/Source/modules/crypto/NormalizeAlgorithm.cpp#810", "author": "ttaubert@mozilla.com", "id": 11108534, "time": "2016-01-26T14:42:33Z"}, {"text": "Comment on attachment 8712149\n0001-Bug-1200341-Implement-HKDF-for-WebCrypto-r-rbarnes-s.patch, v2\n\nWe should add BufferSource to some .webidl and just use it here.\nBut that can happen in a different bug.", "author": "bugs@pettay.fi", "id": 11108821, "time": "2016-01-26T15:41:50Z"}, {"text": "Created attachment 8712179\n0002-Bug-1200341-Use-BufferSource-instead-of-CryptoOperat.patch\n\ns/CryptoOperationData/BufferSource r=smaug (over IRC)", "author": "ttaubert@mozilla.com", "id": 11108859, "time": "2016-01-26T15:49:53Z"}, {"text": "https://hg.mozilla.org/integration/mozilla-inbound/rev/9e347384b8db\nhttps://hg.mozilla.org/integration/mozilla-inbound/rev/8b255b3ff8d3", "author": "pulsebot@bots.tld", "id": 11109597, "time": "2016-01-26T18:54:42Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/9e347384b8db\nhttps://hg.mozilla.org/mozilla-central/rev/8b255b3ff8d3", "author": "cbook@mozilla.com", "id": 11111824, "time": "2016-01-27T11:10:11Z"}, {"text": "Comment on attachment 8712149\n0001-Bug-1200341-Implement-HKDF-for-WebCrypto-r-rbarnes-s.patch, v2\n\nApproval Request Comment\n[Feature/regressing bug #]:\n[User impact if declined]:\n[Describe test coverage new/current, TreeHerder]: Extensive test suite.\n[Risks and why]: Low risk, new API feature.\n[String/UUID change made/needed]: None.\n\nI would like to request uplift to Aurora for both patches here. They introduce the \"HKDF\" cipher to the WebCrypto API and it would be great to ship that earlier. Both patches apply without any modifications.", "author": "ttaubert@mozilla.com", "id": 11111979, "time": "2016-01-27T12:18:22Z"}, {"text": "(We may need to sort out bug 1243438 -- a build failure in disable-eme builds -- before we uplift this to aurora.)", "author": "dholbert@mozilla.com", "id": 11113297, "time": "2016-01-27T18:49:23Z"}, {"text": "(In reply to Daniel Holbert [:dholbert] from comment #16)\n> (We may need to sort out bug 1243438 -- a build failure in disable-eme\n> builds -- before we uplift this to aurora.)\n\nThis was caused by the second changeset which we don't really need on Aurora. That was merely cleanup without any functionality changes. If we get uplift approval we should uplift only the first changeset.", "author": "ttaubert@mozilla.com", "id": 11113522, "time": "2016-01-27T19:53:39Z"}, {"text": "Comment on attachment 8712149\n0001-Bug-1200341-Implement-HKDF-for-WebCrypto-r-rbarnes-s.patch, v2\n\nImproves crypto, has test coverage, sounds good to me. Please uplift to aurora.", "author": "lhenry@mozilla.com", "id": 11120461, "time": "2016-01-29T17:10:55Z"}, {"text": "This also seems worth a release note. Tim can you suggest wording for one?", "author": "lhenry@mozilla.com", "id": 11120468, "time": "2016-01-29T17:12:31Z"}, {"text": "(In reply to Liz Henry (:lizzard) (needinfo? me) from comment #19)\n> This also seems worth a release note. Tim can you suggest wording for one?\n\nYes, thanks for the reminder!\n\nRelease Note Request (optional, but appreciated)\n[Why is this notable]: Devs probably want to know they can now use HKDF in Firefox' WebCrypto implementation.\n[Suggested wording]: WebCrypto: HKDF support\n[Links (documentation, blog post, etc)]:", "author": "ttaubert@mozilla.com", "id": 11120577, "time": "2016-01-29T17:47:35Z"}, {"text": "Added to release notes for 46 as suggested in comment 20. \n\nOnce we have developer docs I can add a link.  For now I will link to https://developer.mozilla.org/en-US/docs/Web/API/Web_Crypto_API if that sounds ok to you.", "author": "lhenry@mozilla.com", "id": 11217650, "time": "2016-03-04T04:59:35Z"}, {"text": "Wording changed slightly to: Added HKDF support for Web Crypto API", "author": "lhenry@mozilla.com", "id": 11217651, "time": "2016-03-04T05:01:39Z"}, {"text": "(In reply to Liz Henry (:lizzard) (needinfo? me) from comment #21)\n> Added to release notes for 46 as suggested in comment 20. \n> \n> Once we have developer docs I can add a link.  For now I will link to\n> https://developer.mozilla.org/en-US/docs/Web/API/Web_Crypto_API if that\n> sounds ok to you.\n\nYes, that's good. Thanks for adding!", "author": "ttaubert@mozilla.com", "id": 11218019, "time": "2016-03-04T09:43:22Z"}], "id": 1200341, "priority": "--", "cc": ["abillings@mozilla.com", "bugs@pettay.fi", "dholbert@mozilla.com", "jypenator@gmail.com", "mfunches@softvision.com", "rlb@ipv.sx", "ttaubert@mozilla.com"], "cf_crash_signature": "", "version": "44 Branch", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "see_also": [], "cf_tracking_thunderbird_esr60": "---", "cf_platform_rel": "---", "product": "Core", "cf_fx_iteration": "---", "blocks": [865789], "qa_contact": "", "creation_time": "2015-08-31T18:25:25Z", "cf_status_firefox_esr52": "---", "component": "DOM: Security", "assigned_to_detail": {"email": "ttaubert@mozilla.com", "id": 402526, "name": "ttaubert@mozilla.com", "real_name": "Tim Taubert [:ttaubert] (inactive)"}, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "---", "cf_status_firefox61": "---", "cf_status_firefox60": "---", "target_milestone": "mozilla47", "cf_rank": null, "cf_status_firefox47": "fixed", "severity": "normal", "groups": [], "cf_status_thunderbird_esr52": "---", "url": "", "cf_status_thunderbird_esr60": "---", "creator_detail": {"email": "renthraysk@gmail.com", "id": 118337, "name": "renthraysk@gmail.com", "real_name": "RenThraysk"}, "whiteboard": "[adv-main46-]", "mentors": [], "summary": "Implement HKDF for WebCrypto", "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "last_change_time": "2016-04-19T21:05:42Z", "assigned_to": "ttaubert@mozilla.com", "is_open": false, "history": [{"changes": [{"removed": "", "field_name": "keywords", "added": "html5"}, {"removed": "Unspecified", "field_name": "platform", "added": "All"}, {"removed": "Unspecified", "field_name": "op_sys", "added": "All"}], "who": "renthraysk@gmail.com", "when": "2015-08-31T18:31:39Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "wsec-crypto"}, {"removed": "43 Branch", "field_name": "version", "added": "44 Branch"}], "who": "renthraysk@gmail.com", "when": "2015-09-24T22:39:05Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "mfunches@softvision.com"}, {"removed": "Untriaged", "field_name": "component", "added": "DOM: Security"}, {"removed": "Firefox", "field_name": "product", "added": "Core"}], "who": "mfunches@softvision.com", "when": "2015-11-13T00:40:28Z"}, {"changes": [{"removed": "UNCONFIRMED", "field_name": "status", "added": "NEW"}, {"removed": "0", "field_name": "is_confirmed", "added": "1"}], "who": "mfunches@softvision.com", "when": "2015-11-13T00:40:39Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "ttaubert@mozilla.com"}], "who": "ttaubert@mozilla.com", "when": "2016-01-23T12:38:26Z"}, {"changes": [{"removed": "", "field_name": "blocks", "added": "865789"}, {"removed": "Implement the KDFs in WebCrypto spec", "field_name": "summary", "added": "Implement HKDF-CTR for WebCrypto"}], "who": "ttaubert@mozilla.com", "when": "2016-01-23T12:43:13Z"}, {"changes": [{"removed": "Implement HKDF-CTR for WebCrypto", "field_name": "summary", "added": "Implement HKDF for WebCrypto"}], "who": "ttaubert@mozilla.com", "when": "2016-01-23T21:48:28Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "ASSIGNED"}, {"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "ttaubert@mozilla.com"}], "who": "ttaubert@mozilla.com", "when": "2016-01-25T16:07:03Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "rlb@ipv.sx"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8711708, "added": "review?(rlb@ipv.sx)"}], "who": "ttaubert@mozilla.com", "when": "2016-01-25T16:10:13Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(rlb@ipv.sx)", "attachment_id": 8711708, "added": "review+"}], "who": "rlb@ipv.sx", "when": "2016-01-25T21:54:43Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "bugs@pettay.fi"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8711708, "added": "review?(bugs@pettay.fi)"}], "who": "ttaubert@mozilla.com", "when": "2016-01-26T11:22:47Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8711708, "added": "1"}, {"field_name": "flagtypes.name", "removed": "review?(bugs@pettay.fi)", "attachment_id": 8711708, "added": ""}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8712149, "added": "review?(bugs@pettay.fi)"}], "who": "ttaubert@mozilla.com", "when": "2016-01-26T14:42:33Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(bugs@pettay.fi)", "attachment_id": 8712149, "added": "review+"}], "who": "bugs@pettay.fi", "when": "2016-01-26T15:41:50Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8712179, "added": "review+"}], "who": "ttaubert@mozilla.com", "when": "2016-01-26T15:49:53Z"}, {"changes": [{"removed": "ASSIGNED", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla47"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2016-01-27 03:10:11"}, {"removed": "---", "field_name": "cf_status_firefox47", "added": "fixed"}], "who": "cbook@mozilla.com", "when": "2016-01-27T11:10:11Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8712149, "added": "approval-mozilla-aurora?"}], "who": "ttaubert@mozilla.com", "when": "2016-01-27T12:18:22Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1243438"}], "who": "dholbert@mozilla.com", "when": "2016-01-27T18:23:27Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "dholbert@mozilla.com"}], "who": "dholbert@mozilla.com", "when": "2016-01-27T18:49:23Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "approval-mozilla-aurora?", "attachment_id": 8712149, "added": "approval-mozilla-aurora+"}], "who": "lhenry@mozilla.com", "when": "2016-01-29T17:10:55Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(ttaubert@mozilla.com)"}], "who": "lhenry@mozilla.com", "when": "2016-01-29T17:12:31Z"}, {"changes": [{"removed": "needinfo?(ttaubert@mozilla.com)", "field_name": "flagtypes.name", "added": ""}, {"removed": "---", "field_name": "cf_status_firefox46", "added": "fixed"}, {"removed": "---", "field_name": "cf_tracking_firefox_relnote", "added": "?"}], "who": "ttaubert@mozilla.com", "when": "2016-01-29T17:47:35Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "dev-doc-needed"}, {"removed": "", "field_name": "cc", "added": "jypenator@gmail.com"}], "who": "jypenator@gmail.com", "when": "2016-01-29T18:04:16Z"}, {"changes": [{"removed": "?", "field_name": "cf_tracking_firefox_relnote", "added": "46+"}], "who": "lhenry@mozilla.com", "when": "2016-03-04T04:59:46Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "abillings@mozilla.com"}, {"removed": "", "field_name": "whiteboard", "added": "[adv-main46-]"}], "who": "abillings@mozilla.com", "when": "2016-04-19T21:05:42Z"}], "resolution": "FIXED", "op_sys": "All", "cf_fx_points": "---", "cf_blocking_fennec": "---"}