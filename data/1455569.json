{"cf_tracking_thunderbird_esr52": "---", "status": "RESOLVED", "cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "cf_tracking_firefox62": "---", "creator": "jfkthame@gmail.com", "mentors_detail": [], "depends_on": [], "cf_status_firefox_esr60": "---", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "cf_status_firefox59": "unaffected", "keywords": ["regression"], "cc_detail": [{"email": "lsalzman@mozilla.com", "id": 536714, "name": "lsalzman@mozilla.com", "real_name": "Lee Salzman [:lsalzman]"}, {"email": "mcastelluccio@mozilla.com", "id": 420453, "name": "mcastelluccio@mozilla.com", "real_name": "Marco Castelluccio [:marco]"}], "cf_last_resolved": "2018-04-20T23:03:17Z", "attachments": [{"creator": "jfkthame@gmail.com", "is_obsolete": 1, "is_patch": 1, "flags": [], "content_type": "text/plain", "id": 8969652}, {"creator": "jfkthame@gmail.com", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2018-04-20T15:22:52Z", "type_id": 4, "creation_date": "2018-04-20T14:41:33Z", "id": 1746948, "setter": "lsalzman@mozilla.com"}], "content_type": "text/plain", "id": 8969659}], "votes": 0, "classification": "Components", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 8, "comments": [{"text": "The patch in bug 1454094 fixed the crashiness seen on High Sierra with some (not all) downloadable variation fonts. However, it sadly seems to have broken the rendering of system-installed variation fonts (like Skia and the macOS system font) when non-default variation values are applied; they just vanish.\n\nThis is most readily seen by loading the \"Old Default\" page at axis-praxis (https://www.axis-praxis.org/specimens/__DEFAULT__OLD), where most of the Skia text is AWOL.\n\nThis is also the underlying cause of bug 1455494 and its dupes, which appeared to be a regression from bug 1454598 but that's just because the patch there hooked up font-weight to the weight variation axis in the macOS system font, exposing this issue for lots of content that didn't explicitly try to use font-variation-settings.", "author": "jfkthame@gmail.com", "id": 13220964, "time": "2018-04-20T09:42:43Z"}, {"text": "So I guess to fix this, we need to update the checks in the various CGFontCreateCopyWithVariations implementations such that we explicitly copy settings from the CGFont to the new CTFont in either of two cases: (1) we're running on 10.12, or (2) we're on 10.13+ *and* the font is a system-installed font rather than a downloaded resource.\n\nAt some of the points where we do this, I don't think we currently have any info as to whether it's an installed system font or a webfont on hand, so we'll need to figure out how to make this available.", "author": "jfkthame@gmail.com", "id": 13220973, "time": "2018-04-20T09:47:27Z"}, {"text": "Created attachment 8969652\nHandle variation settings of system-installed variation fonts when creating CTFont from CGFont on High Sierra\n\nThis is quite sad, but AFAICT it resolves the brokenness here and doesn't reintroduce the crashes from the previous bug. Note that I didn't tweak the version of CreateCTFontFromCGFontWithVariations in cairo-quartz-font.c for now, as I haven't found a case where this one is a problem; but if we do come up with a scenario where it fails, we may need to make a similar adjustment there (I've left a comment for future reference).", "author": "jfkthame@gmail.com", "id": 13221449, "time": "2018-04-20T14:14:11Z"}, {"text": "Comment on attachment 8969652\nHandle variation settings of system-installed variation fonts when creating CTFont from CGFont on High Sierra\n\nThere is already a GetUnscaledFont accessor on ScaledFont. Why do you need to add another one to ScaledFontMac?", "author": "lsalzman@mozilla.com", "id": 13221462, "time": "2018-04-20T14:18:29Z"}, {"text": "(In reply to Lee Salzman [:lsalzman] from comment #3)\n> Comment on attachment 8969652\n> Handle variation settings of system-installed variation fonts when creating\n> CTFont from CGFont on High Sierra\n> \n> There is already a GetUnscaledFont accessor on ScaledFont. Why do you need\n> to add another one to ScaledFontMac?\n\nOops, I must've overlooked that. :\\ Will remove it.", "author": "jfkthame@gmail.com", "id": 13221469, "time": "2018-04-20T14:23:46Z"}, {"text": "Created attachment 8969659\nHandle variation settings of system-installed variation fonts when creating CTFont from CGFont on High Sierra\n\nNow without the extra accessor.", "author": "jfkthame@gmail.com", "id": 13221526, "time": "2018-04-20T14:41:33Z"}, {"text": "Pushed by jkew@mozilla.com:\nhttps://hg.mozilla.org/integration/mozilla-inbound/rev/32b9dbc41590\nHandle variation settings of system-installed variation fonts when creating CTFont from CGFont on High Sierra. r=lsalzman", "author": "pulsebot@bots.tld", "id": 13221838, "time": "2018-04-20T16:22:24Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/32b9dbc41590", "author": "dluca@mozilla.com", "id": 13222855, "time": "2018-04-20T23:03:17Z"}], "id": 1455569, "priority": "--", "cc": ["lsalzman@mozilla.com", "mcastelluccio@mozilla.com"], "cf_crash_signature": "", "version": "unspecified", "is_cc_accessible": true, "cf_tracking_firefox_esr52": "---", "see_also": [], "cf_tracking_thunderbird_esr60": "---", "cf_platform_rel": "---", "product": "Core", "cf_fx_iteration": "---", "blocks": [1454094], "qa_contact": "", "creation_time": "2018-04-20T09:42:43Z", "cf_status_firefox_esr52": "unaffected", "component": "Graphics: Text", "assigned_to_detail": {"email": "jfkthame@gmail.com", "id": 329583, "name": "jfkthame@gmail.com", "real_name": "Jonathan Kew (:jfkthame)"}, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "---", "cf_status_firefox61": "fixed", "cf_status_firefox60": "unaffected", "target_milestone": "mozilla61", "cf_rank": null, "cf_qa_whiteboard": "", "severity": "normal", "groups": [], "cf_status_thunderbird_esr52": "---", "url": "", "cf_status_thunderbird_esr60": "---", "creator_detail": {"email": "jfkthame@gmail.com", "id": 329583, "name": "jfkthame@gmail.com", "real_name": "Jonathan Kew (:jfkthame)"}, "whiteboard": "", "mentors": [], "summary": "Rendering of system-installed variation fonts on macOS broken on High Sierra", "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "last_change_time": "2018-04-26T13:01:16Z", "assigned_to": "jfkthame@gmail.com", "is_open": false, "history": [{"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8969652, "added": "review?(lsalzman@mozilla.com)"}, {"removed": "", "field_name": "cc", "added": "lsalzman@mozilla.com"}], "who": "jfkthame@gmail.com", "when": "2018-04-20T14:14:11Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "ASSIGNED"}, {"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "jfkthame@gmail.com"}], "who": "jfkthame@gmail.com", "when": "2018-04-20T14:14:14Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8969659, "added": "review?(lsalzman@mozilla.com)"}], "who": "jfkthame@gmail.com", "when": "2018-04-20T14:41:33Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8969652, "added": "1"}, {"field_name": "flagtypes.name", "removed": "review?(lsalzman@mozilla.com)", "attachment_id": 8969652, "added": ""}], "who": "jfkthame@gmail.com", "when": "2018-04-20T14:41:35Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(lsalzman@mozilla.com)", "attachment_id": 8969659, "added": "review+"}], "who": "lsalzman@mozilla.com", "when": "2018-04-20T15:22:52Z"}, {"changes": [{"removed": "ASSIGNED", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla61"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2018-04-20 23:03:17"}, {"removed": "---", "field_name": "cf_status_firefox61", "added": "fixed"}], "who": "dluca@mozilla.com", "when": "2018-04-20T23:03:17Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "regression"}, {"removed": "", "field_name": "cc", "added": "mcastelluccio@mozilla.com"}], "who": "mcastelluccio@mozilla.com", "when": "2018-04-25T23:50:45Z"}, {"changes": [{"removed": "---", "field_name": "cf_status_firefox_esr52", "added": "unaffected"}, {"removed": "---", "field_name": "cf_status_firefox59", "added": "unaffected"}, {"removed": "---", "field_name": "cf_status_firefox60", "added": "unaffected"}], "who": "ryanvm@gmail.com", "when": "2018-04-26T13:01:16Z"}], "resolution": "FIXED", "op_sys": "Unspecified", "cf_fx_points": "---", "cf_blocking_fennec": "---"}