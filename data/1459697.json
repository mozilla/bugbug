{"cf_tracking_thunderbird_esr52": "---", "status": "RESOLVED", "cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "cf_tracking_firefox62": "---", "creator": "twsmith@mozilla.com", "mentors_detail": [], "depends_on": [], "cf_status_firefox_esr60": "unaffected", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "keywords": ["crash", "testcase"], "cc_detail": [{"email": "bwerth@mozilla.com", "id": 571010, "name": "bwerth@mozilla.com", "real_name": "Brad Werth [:bradwerth]"}, {"email": "ryanvm@gmail.com", "id": 75935, "name": "ryanvm@gmail.com", "real_name": "Ryan VanderMeulen [:RyanVM]"}], "cf_last_resolved": "2018-05-10T22:01:00Z", "attachments": [{"creator": "twsmith@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [], "content_type": "text/html", "id": 8973771}, {"creator": "bwerth@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-05-10T05:43:56Z", "type_id": 4, "creation_date": "2018-05-08T21:30:57Z", "id": 1754284, "setter": "dbaron@dbaron.org"}], "content_type": "text/x-review-board-request", "id": 8973827}, {"creator": "bwerth@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-05-10T05:44:51Z", "type_id": 4, "creation_date": "2018-05-08T21:30:57Z", "id": 1754285, "setter": "dbaron@dbaron.org"}], "content_type": "text/x-review-board-request", "id": 8974082}, {"creator": "bwerth@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-05-10T05:23:59Z", "type_id": 4, "creation_date": "2018-05-08T21:30:57Z", "id": 1754283, "setter": "dbaron@dbaron.org"}, {"status": "+", "name": "approval-mozilla-beta", "modification_date": "2018-05-13T19:10:53Z", "type_id": 721, "creation_date": "2018-05-11T15:47:59Z", "id": 1755782, "setter": "ryanvm@gmail.com"}], "content_type": "text/x-review-board-request", "id": 8974117}, {"creator": "bwerth@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-05-10T05:54:39Z", "type_id": 4, "creation_date": "2018-05-08T21:30:57Z", "id": 1754286, "setter": "dbaron@dbaron.org"}], "content_type": "text/x-review-board-request", "id": 8974118}], "votes": 0, "classification": "Components", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 36, "comments": [{"text": "Created attachment 8973771\ntestcase.html\n\nFound with m-c:\nBuildID=20180507140941\nSourceStamp=93443d36d4bd53dba004f7b73430879f96daa681\n\n==25250==ERROR: AddressSanitizer: SEGV on unknown address 0x000000000000 (pc 0x00000056d5d8 bp 0x7ffe1fbede30 sp 0x7ffe1fbedcc0 T0)\n==25250==The signal is caused by a WRITE memory access.\n==25250==Hint: address points to the zero page.\n    #0 0x56d5d7 in MOZ_CrashPrintf src/mfbt/Assertions.cpp:63:3\n    #1 0x7f3dbab4cc6b in InvalidArrayIndex_CRASH(unsigned long, unsigned long) src/xpcom/ds/nsTArray.cpp:26:3\n    #2 0x7f3dc2dc4b6a in ElementAt src/obj-firefox/dist/include/nsTArray.h:1041:7\n    #3 0x7f3dc2dc4b6a in operator[] src/obj-firefox/dist/include/nsTArray.h:1070\n    #4 0x7f3dc2dc4b6a in nsFloatManager::EllipseShapeInfo::LineEdge(int, int, bool) const src/layout/generic/nsFloatManager.cpp:1007\n    #5 0x7f3dc2dc2104 in LineLeft src/layout/generic/nsFloatManager.cpp:2348:43\n    #6 0x7f3dc2dc2104 in nsFloatManager::GetFlowArea(mozilla::WritingMode, int, int, nsFloatManager::BandInfoType, nsFloatManager::ShapeType, mozilla::LogicalRect, nsFloatManager::SavedState*, nsSize const&) const src/layout/generic/nsFloatManager.cpp:225\n    #7 0x7f3dc2cbef1e in GetFloatAvailableSpaceWithState src/layout/generic/BlockReflowInput.cpp:345:21\n    #8 0x7f3dc2cbef1e in GetFloatAvailableSpace src/layout/generic/BlockReflowInput.h:134\n    #9 0x7f3dc2cbef1e in mozilla::BlockReflowInput::AddFloat(nsLineLayout*, nsIFrame*, int) src/layout/generic/BlockReflowInput.cpp:636\n    #10 0x7f3dc2f1f061 in AddFloat src/layout/generic/nsLineLayout.h:182:22\n    #11 0x7f3dc2f1f061 in nsLineLayout::ReflowFrame(nsIFrame*, nsReflowStatus&, mozilla::ReflowOutput*, bool&) src/layout/generic/nsLineLayout.cpp:966\n    #12 0x7f3dc2d5073d in nsBlockFrame::ReflowInlineFrame(mozilla::BlockReflowInput&, nsLineLayout&, nsLineList_iterator, nsIFrame*, LineReflowStatus*) src/layout/generic/nsBlockFrame.cpp:4158:15\n    #13 0x7f3dc2d4f0e7 in nsBlockFrame::DoReflowInlineFrames(mozilla::BlockReflowInput&, nsLineLayout&, nsLineList_iterator, nsFlowAreaRect&, int&, nsFloatManager::SavedState*, bool*, LineReflowStatus*, bool) src/layout/generic/nsBlockFrame.cpp:3958:5\n    #14 0x7f3dc2d45e09 in nsBlockFrame::ReflowInlineFrames(mozilla::BlockReflowInput&, nsLineList_iterator, bool*) src/layout/generic/nsBlockFrame.cpp:3832:9\n    #15 0x7f3dc2d3e360 in nsBlockFrame::ReflowLine(mozilla::BlockReflowInput&, nsLineList_iterator, bool*) src/layout/generic/nsBlockFrame.cpp:2816:5\n    #16 0x7f3dc2d33be0 in nsBlockFrame::ReflowDirtyLines(mozilla::BlockReflowInput&) src/layout/generic/nsBlockFrame.cpp:2352:7\n    #17 0x7f3dc2d2b3f4 in nsBlockFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) src/layout/generic/nsBlockFrame.cpp:1225:3\n    #18 0x7f3dc2d8b8b6 in nsContainerFrame::ReflowChild(nsIFrame*, nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, mozilla::WritingMode const&, mozilla::LogicalPoint const&, nsSize const&, unsigned int, nsReflowStatus&, nsOverflowContinuationTracker*) src/layout/generic/nsContainerFrame.cpp:951:14\n    #19 0x7f3dc303f55b in nsHTMLButtonControlFrame::ReflowButtonContents(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsIFrame*) src/layout/forms/nsHTMLButtonControlFrame.cpp:252:3\n    #20 0x7f3dc303ecb0 in nsHTMLButtonControlFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) src/layout/forms/nsHTMLButtonControlFrame.cpp:204:3\n    #21 0x7f3dc2f1ec6f in nsLineLayout::ReflowFrame(nsIFrame*, nsReflowStatus&, mozilla::ReflowOutput*, bool&) src/layout/generic/nsLineLayout.cpp:924:13\n    #22 0x7f3dc2d5073d in nsBlockFrame::ReflowInlineFrame(mozilla::BlockReflowInput&, nsLineLayout&, nsLineList_iterator, nsIFrame*, LineReflowStatus*) src/layout/generic/nsBlockFrame.cpp:4158:15\n    #23 0x7f3dc2d4f0e7 in nsBlockFrame::DoReflowInlineFrames(mozilla::BlockReflowInput&, nsLineLayout&, nsLineList_iterator, nsFlowAreaRect&, int&, nsFloatManager::SavedState*, bool*, LineReflowStatus*, bool) src/layout/generic/nsBlockFrame.cpp:3958:5\n    #24 0x7f3dc2d45e09 in nsBlockFrame::ReflowInlineFrames(mozilla::BlockReflowInput&, nsLineList_iterator, bool*) src/layout/generic/nsBlockFrame.cpp:3832:9\n    #25 0x7f3dc2d3e360 in nsBlockFrame::ReflowLine(mozilla::BlockReflowInput&, nsLineList_iterator, bool*) src/layout/generic/nsBlockFrame.cpp:2816:5\n    #26 0x7f3dc2d33be0 in nsBlockFrame::ReflowDirtyLines(mozilla::BlockReflowInput&) src/layout/generic/nsBlockFrame.cpp:2352:7\n    #27 0x7f3dc2d2b3f4 in nsBlockFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) src/layout/generic/nsBlockFrame.cpp:1225:3\n    #28 0x7f3dc2d4c667 in nsBlockReflowContext::ReflowBlock(mozilla::LogicalRect const&, bool, nsCollapsingMargin&, int, bool, nsLineBox*, mozilla::ReflowInput&, nsReflowStatus&, mozilla::BlockReflowInput&) src/layout/generic/nsBlockReflowContext.cpp:306:11\n    #29 0x7f3dc2d406e3 in nsBlockFrame::ReflowBlockFrame(mozilla::BlockReflowInput&, nsLineList_iterator, bool*) src/layout/generic/nsBlockFrame.cpp:3463:11\n    #30 0x7f3dc2d3e4b5 in nsBlockFrame::ReflowLine(mozilla::BlockReflowInput&, nsLineList_iterator, bool*) src/layout/generic/nsBlockFrame.cpp:2813:5\n    #31 0x7f3dc2d33be0 in nsBlockFrame::ReflowDirtyLines(mozilla::BlockReflowInput&) src/layout/generic/nsBlockFrame.cpp:2352:7\n    #32 0x7f3dc2d2b3f4 in nsBlockFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) src/layout/generic/nsBlockFrame.cpp:1225:3\n    #33 0x7f3dc2d8b8b6 in nsContainerFrame::ReflowChild(nsIFrame*, nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, mozilla::WritingMode const&, mozilla::LogicalPoint const&, nsSize const&, unsigned int, nsReflowStatus&, nsOverflowContinuationTracker*) src/layout/generic/nsContainerFrame.cpp:951:14\n    #34 0x7f3dc2d8a102 in nsCanvasFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) src/layout/generic/nsCanvasFrame.cpp:713:5\n    #35 0x7f3dc2d8b8b6 in nsContainerFrame::ReflowChild(nsIFrame*, nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, mozilla::WritingMode const&, mozilla::LogicalPoint const&, nsSize const&, unsigned int, nsReflowStatus&, nsOverflowContinuationTracker*) src/layout/generic/nsContainerFrame.cpp:951:14\n    #36 0x7f3dc2e76658 in nsHTMLScrollFrame::ReflowScrolledFrame(mozilla::ScrollReflowInput*, bool, bool, mozilla::ReflowOutput*, bool) src/layout/generic/nsGfxScrollFrame.cpp:555:3\n    #37 0x7f3dc2e77a79 in nsHTMLScrollFrame::ReflowContents(mozilla::ScrollReflowInput*, mozilla::ReflowOutput const&) src/layout/generic/nsGfxScrollFrame.cpp:678:3\n    #38 0x7f3dc2e7ba58 in nsHTMLScrollFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) src/layout/generic/nsGfxScrollFrame.cpp:1055:3\n    #39 0x7f3dc2d0f74e in nsContainerFrame::ReflowChild(nsIFrame*, nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, int, int, unsigned int, nsReflowStatus&, nsOverflowContinuationTracker*) src/layout/generic/nsContainerFrame.cpp:995:14\n    #40 0x7f3dc2d0e2ce in mozilla::ViewportFrame::Reflow(nsPresContext*, mozilla::ReflowOutput&, mozilla::ReflowInput const&, nsReflowStatus&) src/layout/generic/ViewportFrame.cpp:335:7\n    #41 0x7f3dc2af3c10 in mozilla::PresShell::DoReflow(nsIFrame*, bool) src/layout/base/PresShell.cpp:8983:11\n    #42 0x7f3dc2b09b20 in mozilla::PresShell::ProcessReflowCommands(bool) src/layout/base/PresShell.cpp:9156:24\n    #43 0x7f3dc2b07f29 in mozilla::PresShell::DoFlushPendingNotifications(mozilla::ChangesToFlush) src/layout/base/PresShell.cpp:4366:11\n    #44 0x7f3dc2be5030 in FlushPendingNotifications src/obj-firefox/dist/include/nsIPresShell.h:583:5\n    #45 0x7f3dc2be5030 in nsDocumentViewer::LoadComplete(nsresult) src/layout/base/nsDocumentViewer.cpp:982\n    #46 0x7f3dc5d3f8a2 in nsDocShell::EndPageLoad(nsIWebProgress*, nsIChannel*, nsresult) src/docshell/base/nsDocShell.cpp:7236:21\n    #47 0x7f3dc5d3bcc9 in nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) src/docshell/base/nsDocShell.cpp:7029:7\n    #48 0x7f3dc5d434cf in non-virtual thunk to nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) src/docshell/base/nsDocShell.cpp\n    #49 0x7f3dbc9ecef7 in nsDocLoader::DoFireOnStateChange(nsIWebProgress*, nsIRequest*, int&, nsresult) src/uriloader/base/nsDocLoader.cpp:1315:3\n    #50 0x7f3dbc9ebf7a in nsDocLoader::doStopDocumentLoad(nsIRequest*, nsresult) src/uriloader/base/nsDocLoader.cpp:858:14\n    #51 0x7f3dbc9e8b55 in nsDocLoader::DocLoaderIsEmpty(bool) src/uriloader/base/nsDocLoader.cpp:747:9\n    #52 0x7f3dbc9eab1c in nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) src/uriloader/base/nsDocLoader.cpp:632:5\n    #53 0x7f3dbc9ebb3c in non-virtual thunk to nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) src/uriloader/base/nsDocLoader.cpp\n    #54 0x7f3dbae1fd1a in mozilla::net::nsLoadGroup::RemoveRequest(nsIRequest*, nsISupports*, nsresult) src/netwerk/base/nsLoadGroup.cpp:629:28\n    #55 0x7f3dbdda526a in DoUnblockOnload src/dom/base/nsDocument.cpp:8419:18\n    #56 0x7f3dbdda526a in nsDocument::UnblockOnload(bool) src/dom/base/nsDocument.cpp:8341\n    #57 0x7f3dbdd85bd4 in nsIDocument::DispatchContentLoadedEvents() src/dom/base/nsDocument.cpp:5321:3\n    #58 0x7f3dbde9cde4 in applyImpl<nsIDocument, void (nsIDocument::*)()> src/obj-firefox/dist/include/nsThreadUtils.h:1165:12\n    #59 0x7f3dbde9cde4 in apply<nsIDocument, void (nsIDocument::*)()> src/obj-firefox/dist/include/nsThreadUtils.h:1171\n    #60 0x7f3dbde9cde4 in mozilla::detail::RunnableMethodImpl<nsIDocument*, void (nsIDocument::*)(), true, (mozilla::RunnableKind)0>::Run() src/obj-firefox/dist/include/nsThreadUtils.h:1216\n    #61 0x7f3dbac180d1 in mozilla::SchedulerGroup::Runnable::Run() src/xpcom/threads/SchedulerGroup.cpp:337:32\n    #62 0x7f3dbac36ec9 in nsThread::ProcessNextEvent(bool, bool*) src/xpcom/threads/nsThread.cpp:1090:14\n    #63 0x7f3dbac52900 in NS_ProcessNextEvent(nsIThread*, bool) src/xpcom/threads/nsThreadUtils.cpp:519:10\n    #64 0x7f3dbbb306da in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) src/ipc/glue/MessagePump.cpp:97:21\n    #65 0x7f3dbba84f89 in RunInternal src/ipc/chromium/src/base/message_loop.cc:326:10\n    #66 0x7f3dbba84f89 in RunHandler src/ipc/chromium/src/base/message_loop.cc:319\n    #67 0x7f3dbba84f89 in MessageLoop::Run() src/ipc/chromium/src/base/message_loop.cc:299\n    #68 0x7f3dc253e57a in nsBaseAppShell::Run() src/widget/nsBaseAppShell.cpp:157:27\n    #69 0x7f3dc67b2f7b in XRE_RunAppShell() src/toolkit/xre/nsEmbedFunctions.cpp:893:22\n    #70 0x7f3dbba84f89 in RunInternal src/ipc/chromium/src/base/message_loop.cc:326:10\n    #71 0x7f3dbba84f89 in RunHandler src/ipc/chromium/src/base/message_loop.cc:319\n    #72 0x7f3dbba84f89 in MessageLoop::Run() src/ipc/chromium/src/base/message_loop.cc:299\n    #73 0x7f3dc67b2940 in XRE_InitChildProcess(int, char**, XREChildData const*) src/toolkit/xre/nsEmbedFunctions.cpp:719:34\n    #74 0x4f1875 in content_process_main src/browser/app/../../ipc/contentproc/plugin-container.cpp:50:30\n    #75 0x4f1875 in main src/browser/app/nsBrowserApp.cpp:280\n    #76 0x7f3dda3bc82f in __libc_start_main /build/glibc-Cl5G7W/glibc-2.23/csu/../csu/libc-start.c:291\n    #77 0x420f48 in _start (firefox+0x420f48)", "author": "twsmith@mozilla.com", "id": 13260284, "time": "2018-05-07T18:36:55Z"}, {"text": "Created attachment 8973827\nBug 1459697 Part 2: Account for the possibility that EllipseShapeInfo may not generate an interval for the entire BStart() to BEnd() range, due to rounding error in the distance field calculation.\n\nReview commit: https://reviewboard.mozilla.org/r/242186/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/242186/", "author": "bwerth@mozilla.com", "id": 13260722, "time": "2018-05-07T21:05:10Z"}, {"text": "Comment on attachment 8973827\nBug 1459697 Part 2: Account for the possibility that EllipseShapeInfo may not generate an interval for the entire BStart() to BEnd() range, due to rounding error in the distance field calculation.\n\nThe testcase doesn't crash in my testing, but this patch will prevent future crashes.", "author": "bwerth@mozilla.com", "id": 13260727, "time": "2018-05-07T21:06:28Z"}, {"text": "Could you explain how this could fix a null-dereference, given that mIntervals.IsEmpty() has already been tested earlier in the function?", "author": "dbaron@dbaron.org", "id": 13260796, "time": "2018-05-07T21:24:54Z"}, {"text": "Oh, never mind, the null-deref is a side-effects of the way MOZ_CRASH works.  Seeing the actual ASAN output would have been useful here, though.", "author": "dbaron@dbaron.org", "id": 13260813, "time": "2018-05-07T21:26:57Z"}, {"text": "The testcase hits the fatal assertion in a debug build for me, though.", "author": "dbaron@dbaron.org", "id": 13260820, "time": "2018-05-07T21:30:30Z"}, {"text": "(In reply to David Baron :dbaron: \u231a\ufe0fUTC-7 from comment #5)\n> The testcase hits the fatal assertion in a debug build for me, though.\n\nHmm... must be dependent on device pixel ratio is my guess. I'll try to artificially manipulate my dpr on my macOS build (zoom levels?) and see if I can get this to trigger.", "author": "bwerth@mozilla.com", "id": 13260924, "time": "2018-05-07T22:09:26Z"}, {"text": "Comment on attachment 8973827\nBug 1459697 Part 2: Account for the possibility that EllipseShapeInfo may not generate an interval for the entire BStart() to BEnd() range, due to rounding error in the distance field calculation.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/242186/diff/1-2/", "author": "bwerth@mozilla.com", "id": 13261173, "time": "2018-05-08T00:12:33Z"}, {"text": "With manipulation of the zoom levels, I was able to reproduce. I've uploaded a patch that solves the problem in a reasonable way. I'll add a test based on the testcase shortly.", "author": "bwerth@mozilla.com", "id": 13261176, "time": "2018-05-08T00:13:45Z"}, {"text": "Created attachment 8974082\nBug 1459697 Part 3: Add a crashtest.\n\nReview commit: https://reviewboard.mozilla.org/r/242382/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/242382/", "author": "bwerth@mozilla.com", "id": 13262900, "time": "2018-05-08T16:17:58Z"}, {"text": "Comment on attachment 8973827\nBug 1459697 Part 2: Account for the possibility that EllipseShapeInfo may not generate an interval for the entire BStart() to BEnd() range, due to rounding error in the distance field calculation.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/242186/diff/2-3/", "author": "bwerth@mozilla.com", "id": 13262901, "time": "2018-05-08T16:17:58Z"}, {"text": "https://treeherder.mozilla.org/#/jobs?repo=try&revision=af3d6fc550216ea0030bed21f8b20cd77f9b79c5", "author": "bwerth@mozilla.com", "id": 13262907, "time": "2018-05-08T16:20:09Z"}, {"text": "https://treeherder.mozilla.org/#/jobs?repo=try&revision=144d838265123b017e7226677cac18df04856b92", "author": "bwerth@mozilla.com", "id": 13263227, "time": "2018-05-08T18:16:09Z"}, {"text": "Created attachment 8974117\nBug 1459697 Part 1: In EllipseShapeInfo distance field calculation, remove a warning that might trigger due to rounding error, and shorten the iteration of each block pixel row, when possible.\n\nReview commit: https://reviewboard.mozilla.org/r/242408/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/242408/", "author": "bwerth@mozilla.com", "id": 13263281, "time": "2018-05-08T18:31:15Z"}, {"text": "Created attachment 8974118\nBug 1459697 Part 4: Change a WPT reftest to make failures visible in red.\n\nReview commit: https://reviewboard.mozilla.org/r/242410/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/242410/", "author": "bwerth@mozilla.com", "id": 13263282, "time": "2018-05-08T18:31:15Z"}, {"text": "Comment on attachment 8973827\nBug 1459697 Part 2: Account for the possibility that EllipseShapeInfo may not generate an interval for the entire BStart() to BEnd() range, due to rounding error in the distance field calculation.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/242186/diff/3-4/", "author": "bwerth@mozilla.com", "id": 13263283, "time": "2018-05-08T18:31:15Z"}, {"text": "Comment on attachment 8974082\nBug 1459697 Part 3: Add a crashtest.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/242382/diff/1-2/", "author": "bwerth@mozilla.com", "id": 13263284, "time": "2018-05-08T18:31:15Z"}, {"text": "Comment on attachment 8974118\nBug 1459697 Part 4: Change a WPT reftest to make failures visible in red.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/242410/diff/1-2/", "author": "bwerth@mozilla.com", "id": 13263759, "time": "2018-05-08T21:29:57Z"}, {"text": "Comment on attachment 8974117\nBug 1459697 Part 1: In EllipseShapeInfo distance field calculation, remove a warning that might trigger due to rounding error, and shorten the iteration of each block pixel row, when possible.\n\nhttps://reviewboard.mozilla.org/r/242408/#review248802\n\nr=dbaron, although it really seems like there should be a better way to do this whole thing than a distance field.\n\n::: layout/generic/nsFloatManager.cpp:826\n(Diff revision 1)\n>    // comparison which builds the intervals.\n>    dfType usedMargin5X = CalcUsedShapeMargin5X(aShapeMargin,\n>                                                aAppUnitsPerDevPixel);\n>  \n> +  // Calculate the bounds of one quadrant of the ellipse, in integer device\n> +  // pixels. This bounds is equal to the rectangle defined by the radii, plus\n\n\"This bounds is\" -> \"These bounds are\"", "author": "dbaron@dbaron.org", "id": 13267405, "time": "2018-05-10T05:23:59Z"}, {"text": "Comment on attachment 8973827\nBug 1459697 Part 2: Account for the possibility that EllipseShapeInfo may not generate an interval for the entire BStart() to BEnd() range, due to rounding error in the distance field calculation.\n\nhttps://reviewboard.mozilla.org/r/242186/#review248806\n\n::: layout/generic/nsFloatManager.cpp:1014\n(Diff revision 4)\n> +    DebugOnly<nscoord> onePixelPastLastInterval =\n> +      mIntervals[mIntervals.Length() - 1].YMost() +\n> +      mIntervals[mIntervals.Length() - 1].Height();\n> +    NS_WARNING_ASSERTION(bSmallestWithinIntervals < onePixelPastLastInterval,\n> +                         \"We should have found a matching interval for this \"\n> +                         \"block value.\");\n\nPut this whole thing inside an #ifdef DEBUG instead of using DebugOnly, since I don't think the compiler will optimize away everything on the right side of the =.", "author": "dbaron@dbaron.org", "id": 13267429, "time": "2018-05-10T05:43:56Z"}, {"text": "Comment on attachment 8974082\nBug 1459697 Part 3: Add a crashtest.\n\nhttps://reviewboard.mozilla.org/r/242382/#review248808\n\nI presume you tested that this asserts prior to the patches?", "author": "dbaron@dbaron.org", "id": 13267431, "time": "2018-05-10T05:44:51Z"}, {"text": "Comment on attachment 8974118\nBug 1459697 Part 4: Change a WPT reftest to make failures visible in red.\n\nhttps://reviewboard.mozilla.org/r/242410/#review248810", "author": "dbaron@dbaron.org", "id": 13267437, "time": "2018-05-10T05:54:39Z"}, {"text": "Comment on attachment 8974117\nBug 1459697 Part 1: In EllipseShapeInfo distance field calculation, remove a warning that might trigger due to rounding error, and shorten the iteration of each block pixel row, when possible.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/242408/diff/1-2/", "author": "bwerth@mozilla.com", "id": 13268599, "time": "2018-05-10T16:20:38Z"}, {"text": "Comment on attachment 8973827\nBug 1459697 Part 2: Account for the possibility that EllipseShapeInfo may not generate an interval for the entire BStart() to BEnd() range, due to rounding error in the distance field calculation.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/242186/diff/4-5/", "author": "bwerth@mozilla.com", "id": 13268600, "time": "2018-05-10T16:20:38Z"}, {"text": "Comment on attachment 8974082\nBug 1459697 Part 3: Add a crashtest.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/242382/diff/2-3/", "author": "bwerth@mozilla.com", "id": 13268601, "time": "2018-05-10T16:20:38Z"}, {"text": "Comment on attachment 8974118\nBug 1459697 Part 4: Change a WPT reftest to make failures visible in red.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/242410/diff/2-3/", "author": "bwerth@mozilla.com", "id": 13268602, "time": "2018-05-10T16:20:38Z"}, {"text": "Pushed by bwerth@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/a6e7205db0c0\nPart 1: In EllipseShapeInfo distance field calculation, remove a warning that might trigger due to rounding error, and shorten the iteration of each block pixel row, when possible. r=dbaron\nhttps://hg.mozilla.org/integration/autoland/rev/bf95429788de\nPart 2: Account for the possibility that EllipseShapeInfo may not generate an interval for the entire BStart() to BEnd() range, due to rounding error in the distance field calculation. r=dbaron\nhttps://hg.mozilla.org/integration/autoland/rev/ffff86f5db2e\nPart 3: Add a crashtest. r=dbaron\nhttps://hg.mozilla.org/integration/autoland/rev/731dfa211b38\nPart 4: Change a WPT reftest to make failures visible in red. r=dbaron", "author": "pulsebot@bots.tld", "id": 13268673, "time": "2018-05-10T16:39:08Z"}, {"text": "Created web-platform-tests PR https://github.com/w3c/web-platform-tests/pull/10952 for changes under testing/web-platform/tests", "author": "wptsync@mozilla.bugs", "id": 13268763, "time": "2018-05-10T16:53:50Z"}, {"text": "Upstream web-platform-tests status checks passed, PR will merge once commit reaches central.", "author": "wptsync@mozilla.bugs", "id": 13269268, "time": "2018-05-10T20:31:23Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/a6e7205db0c0\nhttps://hg.mozilla.org/mozilla-central/rev/bf95429788de\nhttps://hg.mozilla.org/mozilla-central/rev/ffff86f5db2e\nhttps://hg.mozilla.org/mozilla-central/rev/731dfa211b38", "author": "dluca@mozilla.com", "id": 13269481, "time": "2018-05-10T22:01:00Z"}, {"text": "Please request Beta approval on this when you get a chance.", "author": "ryanvm@gmail.com", "id": 13269823, "time": "2018-05-11T02:05:26Z"}, {"text": "Upstream PR merged", "author": "wptsync@mozilla.bugs", "id": 13269855, "time": "2018-05-11T02:30:25Z"}, {"text": "Comment on attachment 8974117\nBug 1459697 Part 1: In EllipseShapeInfo distance field calculation, remove a warning that might trigger due to rounding error, and shorten the iteration of each block pixel row, when possible.\n\nApproval Request Comment\n[Feature/Bug causing the regression]: Bug 1265342\n[User impact if declined]: Out-of-bounds memory read on sites that use shape-outside: ellipse with shape-margin.\n[Is this code covered by automated tests?]: Yes.\n[Has the fix been verified in Nightly?]: Yes.\n[Needs manual test from QE? If yes, steps to reproduce]: No.\n[List of other uplifts needed for the feature/fix]: None.\n[Is the change risky?]: No.\n[Why is the change risky/not risky?]: shape-margin is not in wide usage yet; this is our first release that enables it, and the feature is still behind a pref (except in Nightly).\n[String changes made/needed]: None.", "author": "bwerth@mozilla.com", "id": 13271046, "time": "2018-05-11T15:47:59Z"}, {"text": "(In reply to Brad Werth [:bradwerth] from comment #32)\n> Comment on attachment 8974117\n> [List of other uplifts needed for the feature/fix]: None.\n\nTo be clear, all 4 parts of the patch should be uplifted. I only filled out the uplift request on part 1.", "author": "bwerth@mozilla.com", "id": 13271049, "time": "2018-05-11T15:49:17Z"}, {"text": "Comment on attachment 8974117\nBug 1459697 Part 1: In EllipseShapeInfo distance field calculation, remove a warning that might trigger due to rounding error, and shorten the iteration of each block pixel row, when possible.\n\nAvoids shipping a new crash caused by bug 1265342. Approved for 61.0b5.", "author": "ryanvm@gmail.com", "id": 13273152, "time": "2018-05-13T19:10:53Z"}, {"text": "https://hg.mozilla.org/releases/mozilla-beta/rev/c2cc19eb1159\nhttps://hg.mozilla.org/releases/mozilla-beta/rev/b6cde02169dc\nhttps://hg.mozilla.org/releases/mozilla-beta/rev/9bbd3253d3a5\nhttps://hg.mozilla.org/releases/mozilla-beta/rev/5fcefe47c777", "author": "ryanvm@gmail.com", "id": 13273191, "time": "2018-05-13T19:57:38Z"}], "id": 1459697, "priority": "P1", "cc": ["bwerth@mozilla.com", "ryanvm@gmail.com"], "cf_crash_signature": "[@ nsFloatManager::EllipseShapeInfo::LineEdge]", "version": "unspecified", "is_cc_accessible": true, "cf_tracking_firefox_esr52": "---", "see_also": [], "cf_tracking_thunderbird_esr60": "---", "cf_platform_rel": "---", "product": "Core", "cf_fx_iteration": "---", "blocks": [1289609], "qa_contact": "", "creation_time": "2018-05-07T18:36:55Z", "cf_status_firefox_esr52": "unaffected", "component": "Layout: Floats", "assigned_to_detail": {"email": "bwerth@mozilla.com", "id": 571010, "name": "bwerth@mozilla.com", "real_name": "Brad Werth [:bradwerth]"}, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "fixed", "cf_status_firefox61": "fixed", "cf_status_firefox60": "unaffected", "target_milestone": "mozilla62", "cf_rank": null, "cf_qa_whiteboard": "", "severity": "normal", "groups": [], "cf_status_thunderbird_esr52": "---", "url": "", "cf_status_thunderbird_esr60": "---", "creator_detail": {"email": "twsmith@mozilla.com", "id": 486634, "name": "twsmith@mozilla.com", "real_name": "Tyson Smith [:tsmith]"}, "whiteboard": "", "mentors": [], "summary": "crash in [@ nsFloatManager::EllipseShapeInfo::LineEdge]", "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [{"status": "+", "name": "in-testsuite", "modification_date": "2018-05-11T02:05:26Z", "type_id": 37, "creation_date": "2018-05-07T18:36:55Z", "id": 1753603, "setter": "ryanvm@gmail.com"}], "last_change_time": "2018-05-13T19:57:38Z", "assigned_to": "bwerth@mozilla.com", "is_open": false, "history": [{"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "in-testsuite?"}], "who": "twsmith@mozilla.com", "when": "2018-05-07T18:36:55Z"}, {"changes": [{"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "bwerth@mozilla.com"}], "who": "bwerth@mozilla.com", "when": "2018-05-07T19:07:03Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8973827, "added": "review?(dbaron@dbaron.org)"}], "who": "bwerth@mozilla.com", "when": "2018-05-07T21:06:28Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(bwerth@mozilla.com)"}], "who": "dbaron@dbaron.org", "when": "2018-05-07T21:24:54Z"}, {"changes": [{"removed": "needinfo?(bwerth@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "dbaron@dbaron.org", "when": "2018-05-07T21:26:57Z"}, {"changes": [{"field_name": "attachments.description", "removed": "Bug 1459697: Change an assert into a runtime check to ensure we avoid a bad array index dereference.", "attachment_id": 8973827, "added": "Bug 1459697 Part 1: Account for the possibility that EllipseShapeInfo may not generate an interval for the entire BStart() to BEnd() range, due to rounding error in the distance field calculation."}, {"field_name": "flagtypes.name", "removed": "review?(dbaron@dbaron.org)", "attachment_id": 8973827, "added": ""}], "who": "bwerth@mozilla.com", "when": "2018-05-08T00:12:33Z"}, {"changes": [{"removed": "--", "field_name": "priority", "added": "P1"}], "who": "mreavy@mozilla.com", "when": "2018-05-08T04:43:33Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8973827, "added": "review?(dbaron@dbaron.org)"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8974082, "added": "review?(dbaron@dbaron.org)"}], "who": "bwerth@mozilla.com", "when": "2018-05-08T16:32:05Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(dbaron@dbaron.org)", "attachment_id": 8973827, "added": ""}, {"field_name": "flagtypes.name", "removed": "review?(dbaron@dbaron.org)", "attachment_id": 8974082, "added": ""}], "who": "bwerth@mozilla.com", "when": "2018-05-08T17:18:38Z"}, {"changes": [{"field_name": "attachments.description", "removed": "Bug 1459697 Part 1: Account for the possibility that EllipseShapeInfo may not generate an interval for the entire BStart() to BEnd() range, due to rounding error in the distance field calculation.", "attachment_id": 8973827, "added": "Bug 1459697 Part 2: Account for the possibility that EllipseShapeInfo may not generate an interval for the entire BStart() to BEnd() range, due to rounding error in the distance field calculation."}, {"field_name": "attachments.description", "removed": "Bug 1459697 Part 2: Add a crashtest.", "attachment_id": 8974082, "added": "Bug 1459697 Part 3: Add a crashtest."}], "who": "bwerth@mozilla.com", "when": "2018-05-08T18:31:15Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8974082, "added": "review?(dbaron@dbaron.org)"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8974118, "added": "review?(dbaron@dbaron.org)"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8974117, "added": "review?(dbaron@dbaron.org)"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8973827, "added": "review?(dbaron@dbaron.org)"}], "who": "bwerth@mozilla.com", "when": "2018-05-08T21:30:57Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(dbaron@dbaron.org)", "attachment_id": 8974117, "added": "review+"}], "who": "dbaron@dbaron.org", "when": "2018-05-10T05:23:59Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(dbaron@dbaron.org)", "attachment_id": 8973827, "added": "review+"}], "who": "dbaron@dbaron.org", "when": "2018-05-10T05:43:56Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(dbaron@dbaron.org)", "attachment_id": 8974082, "added": "review+"}], "who": "dbaron@dbaron.org", "when": "2018-05-10T05:44:51Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(dbaron@dbaron.org)", "attachment_id": 8974118, "added": "review+"}], "who": "dbaron@dbaron.org", "when": "2018-05-10T05:54:39Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla62"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2018-05-10 22:01:00"}, {"removed": "affected", "field_name": "cf_status_firefox62", "added": "fixed"}], "who": "dluca@mozilla.com", "when": "2018-05-10T22:01:00Z"}, {"changes": [{"removed": "", "field_name": "cf_crash_signature", "added": "[@ nsFloatManager::EllipseShapeInfo::LineEdge]"}, {"removed": "", "field_name": "cc", "added": "ryanvm@gmail.com"}, {"removed": "in-testsuite?", "field_name": "flagtypes.name", "added": "needinfo?(bwerth@mozilla.com), in-testsuite+"}, {"removed": "---", "field_name": "cf_status_firefox_esr52", "added": "unaffected"}, {"removed": "---", "field_name": "cf_status_firefox_esr60", "added": "unaffected"}, {"removed": "---", "field_name": "cf_status_firefox60", "added": "unaffected"}], "who": "ryanvm@gmail.com", "when": "2018-05-11T02:05:26Z"}, {"changes": [{"removed": "needinfo?(bwerth@mozilla.com)", "field_name": "flagtypes.name", "added": ""}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8974117, "added": "approval-mozilla-beta?"}], "who": "bwerth@mozilla.com", "when": "2018-05-11T15:47:59Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "approval-mozilla-beta?", "attachment_id": 8974117, "added": "approval-mozilla-beta+"}], "who": "ryanvm@gmail.com", "when": "2018-05-13T19:10:53Z"}, {"changes": [{"removed": "affected", "field_name": "cf_status_firefox61", "added": "fixed"}], "who": "ryanvm@gmail.com", "when": "2018-05-13T19:57:38Z"}], "resolution": "FIXED", "op_sys": "Unspecified", "cf_fx_points": "---", "cf_blocking_fennec": "---"}