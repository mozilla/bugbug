{"cf_tracking_thunderbird_esr52": "---", "status": "VERIFIED", "cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "cf_tracking_firefox62": "---", "creator": "r01opd9cujmm@opayq.com", "mentors_detail": [], "depends_on": [], "cf_status_firefox_esr60": "---", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "keywords": ["regression"], "cc_detail": [{"email": "cristina.badescu@softvision.ro", "id": 600030, "name": "cristina.badescu@softvision.ro", "real_name": "Cristina Badescu"}, {"email": "honzab.moz@firemni.cz", "id": 269762, "name": "honzab.moz@firemni.cz", "real_name": "Honza Bambas (:mayhemer)"}, {"email": "jan@ikenmeyer.eu", "id": 580271, "name": "jan@ikenmeyer.eu", "real_name": "Jan Andre Ikenmeyer [:darkspirit]"}, {"email": "mcastelluccio@mozilla.com", "id": 420453, "name": "mcastelluccio@mozilla.com", "real_name": "Marco Castelluccio [:marco]"}, {"email": "valentin.gosu@gmail.com", "id": 415378, "name": "valentin.gosu@gmail.com", "real_name": "Valentin Gosu [:valentin]"}], "cf_last_resolved": "2018-04-14T23:48:10Z", "attachments": [{"creator": "honzab.moz@firemni.cz", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2018-04-13T20:26:11Z", "type_id": 4, "creation_date": "2018-04-13T17:04:46Z", "id": 1743773, "setter": "valentin.gosu@gmail.com"}], "content_type": "text/plain", "id": 8967787}], "votes": 1, "classification": "Components", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 12, "comments": [{"text": "User Agent: Mozilla/5.0 (X11; Linux x86_64; rv:61.0) Gecko/20100101 Firefox/61.0\nBuild ID: 20180319220116\n\nSteps to reproduce:\n\nBackground:\nOS: Linux x86-64\nNetwork: IPv4 and IPv6 Dual Stack. NAT64/DNS64 is used. (The NAT64 server has a different IPV4 address.)\nMy location: Asia-Pacific region\n\n1. Use Firefox Nightly version 2018-04-05-22-00-26-mozilla-central. (or any newer version)\n2. Set `network.http.fast-fallback-to-IPv4` to `false`, and `network.http.fallback-connection-timeout` to a high value (such as `200`).\n3. Go to some IPv4-only websites. Preferably, choose websites that have servers close to you, such that connecting to the website via IPv4 is considerably faster than via IPv6/NAT64.\n\n\nActual results:\n\nDespite the fact that the website can be connected by IPv6 (using NAT64/DNS64), Firefox does not always connect via IPv6.\n\nIf I browse Amazon Japan, it detects my actual location (This item can be delivered to (a country in the Asia-Pacific region)). \n\nThis bug appears after https://hg.mozilla.org/integration/mozilla-inbound/rev/2f4395f5ca24 is applied.\n\n\nExpected results:\n\nAlways try IPv6 first before trying IPv4.\n\nFor example, using the NAT64/DNS64 service by Go6lab, when I browse Amazon Japan, it detects the location of the NAT64 server (This item can be delivered to Slovenia).\n\nAnother example is images that shows your IPv4 address, such as http://ip.ntrqq.net/images/misaka.png?wd=5p2l5LiA5Y%2BR6LSv56m%2F5LiA5YiH55qE6LaF55S156OB54Ku5ZCnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg5aSp5omNVjE%3D . The last good revision (mozilla-central), 48f43d2ad95ec075addce039f7fe7dcd8edbaf61 , always shows the IPv4 address of the NAT64 server, which can prove that Firefox is connecting via IPv6/NAT64. Later revisions shows my real IPv4 address.", "author": "r01opd9cujmm@opayq.com", "id": 13185628, "time": "2018-04-06T08:18:34Z"}, {"text": "I don't have the necessary expertise to debugg further this issue. I am assigning a component to this issue in order to involve the development team and get an opinion on this.", "author": "cristina.badescu@softvision.ro", "id": 13197718, "time": "2018-04-11T13:21:35Z"}, {"text": "I've recently made some changes around ipv6, will look.", "author": "honzab.moz@firemni.cz", "id": 13197744, "time": "2018-04-11T13:26:23Z"}, {"text": "(P2, is likely to be a recent regression)", "author": "honzab.moz@firemni.cz", "id": 13197760, "time": "2018-04-11T13:31:43Z"}, {"text": "Aha!  I completely broke handling of fast-fallback-to-IPv4 preference.  Valentin missed that during review completely ;)\n\n\nAn easy fix.", "author": "honzab.moz@firemni.cz", "id": 13204362, "time": "2018-04-13T16:43:33Z"}, {"text": "Created attachment 8967787\nv1\n\nThanks for the report and finding a regression range!\n\n\nValentin: note the line I have removed:\nhttps://hg.mozilla.org/integration/mozilla-inbound/rev/2f4395f5ca24#l6.39", "author": "honzab.moz@firemni.cz", "id": 13204442, "time": "2018-04-13T17:04:46Z"}, {"text": "Comment on attachment 8967787\nv1\n\nReview of attachment 8967787:\n-----------------------------------------------------------------\n\nOoops. Thanks for fixing it :)", "author": "valentin.gosu@gmail.com", "id": 13205035, "time": "2018-04-13T20:26:11Z"}, {"text": "Pushed by ryanvm@gmail.com:\nhttps://hg.mozilla.org/integration/mozilla-inbound/rev/10a300d81060\nBring back network.http.fast-fallback-to-IPv4 preference, regression from bug 1430659. r=valentin", "author": "pulsebot@bots.tld", "id": 13205837, "time": "2018-04-14T13:55:39Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/10a300d81060", "author": "csabou@mozilla.com", "id": 13206118, "time": "2018-04-14T23:48:10Z"}, {"text": "Reporter, I will kindly ask you to verify this bug, if possible.  The Nightly 2018-04-16 you can download today should contain the fix.  Thanks.", "author": "honzab.moz@firemni.cz", "id": 13212111, "time": "2018-04-17T11:27:25Z"}, {"text": "(In reply to Honza Bambas (:mayhemer) from comment #9)\n> Reporter, I will kindly ask you to verify this bug, if possible.  The\n> Nightly 2018-04-16 you can download today should contain the fix.  Thanks.\n\nOops, thanks for reminding me.", "author": "r01opd9cujmm@opayq.com", "id": 13240659, "time": "2018-04-29T23:46:43Z"}, {"text": "(In reply to r01opd9cujmm from comment #10)\n> Oops, thanks for reminding me.\n\nThank you and thank you for this report!", "author": "honzab.moz@firemni.cz", "id": 13243033, "time": "2018-04-30T13:18:43Z"}], "id": 1452028, "priority": "P2", "cc": ["cristina.badescu@softvision.ro", "honzab.moz@firemni.cz", "jan@ikenmeyer.eu", "mcastelluccio@mozilla.com", "valentin.gosu@gmail.com"], "cf_crash_signature": "", "version": "61 Branch", "is_cc_accessible": true, "cf_tracking_firefox_esr52": "---", "see_also": [], "cf_tracking_thunderbird_esr60": "---", "cf_platform_rel": "---", "product": "Core", "cf_fx_iteration": "---", "blocks": [1430659], "qa_contact": "", "creation_time": "2018-04-06T08:18:34Z", "cf_status_firefox_esr52": "---", "component": "Networking: DNS", "assigned_to_detail": {"email": "honzab.moz@firemni.cz", "id": 269762, "name": "honzab.moz@firemni.cz", "real_name": "Honza Bambas (:mayhemer)"}, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "---", "cf_status_firefox61": "fixed", "cf_status_firefox60": "---", "target_milestone": "mozilla61", "cf_rank": null, "cf_qa_whiteboard": "", "severity": "normal", "groups": [], "cf_status_thunderbird_esr52": "---", "url": "", "cf_status_thunderbird_esr60": "---", "creator_detail": {"email": "r01opd9cujmm@opayq.com", "id": 615268, "name": "r01opd9cujmm@opayq.com", "real_name": ""}, "whiteboard": "[necko-triaged]", "mentors": [], "summary": "Firefox does not always prefer IPv6, broken network.http.fast-fallback-to-IPv4 handling", "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "last_change_time": "2018-04-30T13:18:43Z", "assigned_to": "honzab.moz@firemni.cz", "is_open": false, "history": [{"changes": [{"removed": "", "field_name": "cc", "added": "cristina.badescu@softvision.ro"}, {"removed": "Untriaged", "field_name": "component", "added": "Networking: DNS"}, {"removed": "Firefox", "field_name": "product", "added": "Core"}], "who": "cristina.badescu@softvision.ro", "when": "2018-04-11T13:21:35Z"}, {"changes": [{"removed": "--", "field_name": "priority", "added": "P3"}, {"removed": "", "field_name": "cc", "added": "honzab.moz@firemni.cz"}, {"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "honzab.moz@firemni.cz"}, {"removed": "", "field_name": "whiteboard", "added": "[necko-triaged]"}], "who": "honzab.moz@firemni.cz", "when": "2018-04-11T13:26:23Z"}, {"changes": [{"removed": "P3", "field_name": "priority", "added": "P2"}], "who": "honzab.moz@firemni.cz", "when": "2018-04-11T13:31:43Z"}, {"changes": [{"removed": "", "field_name": "blocks", "added": "1430659"}], "who": "honzab.moz@firemni.cz", "when": "2018-04-13T16:36:13Z"}, {"changes": [{"removed": "UNCONFIRMED", "field_name": "status", "added": "ASSIGNED"}, {"removed": "", "field_name": "cc", "added": "valentin.gosu@gmail.com"}, {"removed": "0", "field_name": "is_confirmed", "added": "1"}], "who": "honzab.moz@firemni.cz", "when": "2018-04-13T16:43:33Z"}, {"changes": [{"removed": "Firefox does not always prefer IPv6", "field_name": "summary", "added": "Firefox does not always prefer IPv6, broken network.http.fast-fallback-to-IPv4 handling"}], "who": "honzab.moz@firemni.cz", "when": "2018-04-13T16:52:18Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8967787, "added": "review?(valentin.gosu@gmail.com)"}], "who": "honzab.moz@firemni.cz", "when": "2018-04-13T17:04:46Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "jan@ikenmeyer.eu"}], "who": "jan@ikenmeyer.eu", "when": "2018-04-13T17:07:21Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(valentin.gosu@gmail.com)", "attachment_id": 8967787, "added": "review+"}], "who": "valentin.gosu@gmail.com", "when": "2018-04-13T20:26:11Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "checkin-needed"}], "who": "honzab.moz@firemni.cz", "when": "2018-04-14T12:43:27Z"}, {"changes": [{"removed": "checkin-needed", "field_name": "keywords", "added": ""}], "who": "pulsebot@bots.tld", "when": "2018-04-14T13:55:39Z"}, {"changes": [{"removed": "ASSIGNED", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla61"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2018-04-14 23:48:10"}, {"removed": "---", "field_name": "cf_status_firefox61", "added": "fixed"}], "who": "csabou@mozilla.com", "when": "2018-04-14T23:48:10Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(r01opd9cujmm@opayq.com)"}], "who": "honzab.moz@firemni.cz", "when": "2018-04-17T11:27:25Z"}, {"changes": [{"removed": "RESOLVED", "field_name": "status", "added": "VERIFIED"}, {"removed": "needinfo?(r01opd9cujmm@opayq.com)", "field_name": "flagtypes.name", "added": ""}], "who": "r01opd9cujmm@opayq.com", "when": "2018-04-29T23:46:43Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "regression"}, {"removed": "", "field_name": "cc", "added": "mcastelluccio@mozilla.com"}], "who": "mcastelluccio@mozilla.com", "when": "2018-04-30T13:14:26Z"}], "resolution": "FIXED", "op_sys": "Unspecified", "cf_fx_points": "---", "cf_blocking_fennec": "---"}