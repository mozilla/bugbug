{"status": "RESOLVED", "cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "classification": "Client Software", "creator": "dave.hunt@gmail.com", "cc": ["irios.mozilla@gmail.com", "markh@mozilla.com", "mcastelluccio@mozilla.com", "npark@mozilla.com", "tchiovoloni@mozilla.com"], "depends_on": [], "creation_time": "2018-06-05T12:00:38Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "keywords": ["regression"], "summary": "iOS sync integration tests are failing whilst waiting for weave:service:setup-complete", "cf_last_resolved": "2018-06-06T09:40:05Z", "attachments": [{"creator": "tchiovoloni@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-06-06T00:09:25Z", "type_id": 748, "creation_date": "2018-06-05T23:22:16Z", "id": 1766315, "setter": "markh@mozilla.com"}], "content_type": "text/x-review-board-request", "id": 8983614}], "assigned_to_detail": {"email": "tchiovoloni@mozilla.com", "id": 567427, "name": "tchiovoloni@mozilla.com", "real_name": "Thom Chiovoloni [:tcsc]"}, "severity": "normal", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 6, "comments": [{"text": "The Firefox iOS sync integration tests are using TPS to sign into Firefox Accounts and perform an initial sync. Recently, the tests have started to fail whilst apparently waiting for weave:service:setup-complete.\n\nWe're expecting TPS to sign into Firefox Accounts and perform an initial sync. The signing in appears to work (we see a notification stating that sync will start shortly), however the sync does not complete and the test ultimately fails.\n\nIf you manually click to sync in the open instance of Firefox, then the test continues on. If you do nothing then eventually the Firefox instance will close and the test will fail.\n\nThe last few lines in the TPS log are:\n\n> 2018-06-05 06:10:30.067 CROSSWEAVE INFO: ----------event observed: fxaccounts:onlogin\n> 2018-06-05 06:10:30.068 CROSSWEAVE INFO: Logging into Weave.\n> 2018-06-05 06:10:30.764 CROSSWEAVE INFO: Setting up wait for weave:service:setup-complete...\n\nThis suggests that the call to waitForSetupComplete in https://searchfox.org/mozilla-central/rev/292d295d6b084b43b70de26a42e68513bb7b36a3/services/sync/tps/extensions/tps/resource/tps.jsm#1191 never completes.\n\nI used mozregression to determine a regression range, which concluded that https://hg.mozilla.org/integration/autoland/pushloghtml?fromchange=a90972d695291bea4560ee5a8da77398ca9b42b1&tochange=1c6cfeb419c3157fc3dd6ae564358f7af8ca9cd1 is the cause of the regression, which is bug 1409208 and at least related to sync, so it could potentially be related.", "author": "dave.hunt@gmail.com", "id": 13387731, "time": "2018-06-05T12:00:38Z"}, {"text": ":tcsc has this affected the TPS tests? I'm not sure where to see the results. Any ideas?", "author": "dave.hunt@gmail.com", "id": 13387734, "time": "2018-06-05T12:02:03Z"}, {"text": "Created attachment 8983614\nBug 1466814 - Remove the manual login call from TPS, since we'll log in anyway, and shouldn't be holding the sync lock\n\nReview commit: https://reviewboard.mozilla.org/r/249466/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/249466/", "author": "tchiovoloni@mozilla.com", "id": 13389664, "time": "2018-06-05T23:22:16Z"}, {"text": "Comment on attachment 8983614\nBug 1466814 - Remove the manual login call from TPS, since we'll log in anyway, and shouldn't be holding the sync lock\n\nhttps://reviewboard.mozilla.org/r/249466/#review255656\n\nThanks!", "author": "markh@mozilla.com", "id": 13389747, "time": "2018-06-06T00:09:25Z"}, {"text": "Pushed by tchiovoloni@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/4db37ec137d6\nRemove the manual login call from TPS, since we'll log in anyway, and shouldn't be holding the sync lock r=markh", "author": "pulsebot@bots.tld", "id": 13389812, "time": "2018-06-06T00:53:52Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/4db37ec137d6", "author": "nbeleuzu@mozilla.com", "id": 13390428, "time": "2018-06-06T09:40:05Z"}], "id": 1466814, "priority": "--", "mentors_detail": [], "cf_crash_signature": "", "version": "unspecified", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox62": "---", "cf_platform_rel": "---", "product": "Firefox", "cf_status_firefox_esr52": "unaffected", "blocks": [1463102, 1409208], "qa_contact": "", "see_also": [], "cf_fx_iteration": "---", "component": "Sync", "votes": 0, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "fixed", "cf_status_firefox61": "unaffected", "cf_status_firefox60": "unaffected", "target_milestone": "Firefox 62", "is_cc_accessible": true, "cf_rank": null, "groups": [], "url": "", "creator_detail": {"email": "dave.hunt@gmail.com", "id": 396948, "name": "dave.hunt@gmail.com", "real_name": "Dave Hunt [:davehunt] \u231a\ufe0fUTC+0"}, "whiteboard": "", "mentors": [], "cc_detail": [{"email": "irios.mozilla@gmail.com", "id": 552724, "name": "irios.mozilla@gmail.com", "real_name": "Isabel Rios[:isabel_rios]"}, {"email": "markh@mozilla.com", "id": 16943, "name": "markh@mozilla.com", "real_name": "Mark Hammond [:markh]"}, {"email": "mcastelluccio@mozilla.com", "id": 420453, "name": "mcastelluccio@mozilla.com", "real_name": "Marco Castelluccio [:marco]"}, {"email": "npark@mozilla.com", "id": 499933, "name": "npark@mozilla.com", "real_name": "No-Jun Park [:njpark]"}, {"email": "tchiovoloni@mozilla.com", "id": 567427, "name": "tchiovoloni@mozilla.com", "real_name": "Thom Chiovoloni [:tcsc]"}], "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "last_change_time": "2018-06-08T16:44:18Z", "cf_status_firefox_esr60": "unaffected", "assigned_to": "tchiovoloni@mozilla.com", "is_open": false, "resolution": "FIXED", "op_sys": "Unspecified", "cf_fx_points": "---", "history": [{"changes": [{"removed": "", "field_name": "cc", "added": "tchiovoloni@mozilla.com"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(tchiovoloni@mozilla.com)"}], "who": "dave.hunt@gmail.com", "when": "2018-06-05T12:02:03Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "npark@mozilla.com"}, {"removed": "", "field_name": "blocks", "added": "1463102"}], "who": "irios.mozilla@gmail.com", "when": "2018-06-05T12:16:38Z"}, {"changes": [{"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "tchiovoloni@mozilla.com"}, {"removed": "needinfo?(tchiovoloni@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "tchiovoloni@mozilla.com", "when": "2018-06-05T23:20:13Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8983614, "added": "review?(markh@mozilla.com)"}, {"removed": "", "field_name": "cc", "added": "markh@mozilla.com"}], "who": "tchiovoloni@mozilla.com", "when": "2018-06-05T23:22:16Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(markh@mozilla.com)", "attachment_id": 8983614, "added": "review+"}], "who": "markh@mozilla.com", "when": "2018-06-06T00:09:25Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "Firefox 62"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2018-06-06 09:40:05"}, {"removed": "---", "field_name": "cf_status_firefox62", "added": "fixed"}], "who": "nbeleuzu@mozilla.com", "when": "2018-06-06T09:40:05Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "regression"}, {"removed": "", "field_name": "cc", "added": "mcastelluccio@mozilla.com"}], "who": "mcastelluccio@mozilla.com", "when": "2018-06-07T15:06:41Z"}, {"changes": [{"removed": "", "field_name": "blocks", "added": "1409208"}, {"removed": "---", "field_name": "cf_status_firefox_esr52", "added": "unaffected"}, {"removed": "---", "field_name": "cf_status_firefox_esr60", "added": "unaffected"}, {"removed": "---", "field_name": "cf_status_firefox60", "added": "unaffected"}, {"removed": "---", "field_name": "cf_status_firefox61", "added": "unaffected"}], "who": "ryanvm@gmail.com", "when": "2018-06-08T16:44:18Z"}]}