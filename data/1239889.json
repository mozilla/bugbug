{"cf_tracking_thunderbird_esr52": "---", "status": "RESOLVED", "cf_tracking_firefox60": "---", "attachments": [{"creator": "hikezoe@mozilla.com", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2016-02-04T21:53:38Z", "type_id": 4, "creation_date": "2016-02-04T21:53:38Z", "id": 1336991, "setter": "bbirtles@mozilla.com"}], "content_type": "text/plain", "id": 8708153}, {"creator": "bbirtles@mozilla.com", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2016-02-04T06:59:09Z", "type_id": 4, "creation_date": "2016-02-04T05:27:38Z", "id": 1336356, "setter": "cam@mcc.id.au"}], "content_type": "text/plain", "id": 8715651}], "classification": "Components", "creator": "hikezoe@mozilla.com", "cc": ["bbirtles@mozilla.com", "cam@mcc.id.au", "cbook@mozilla.com", "hikezoe@mozilla.com", "mats@mozilla.com"], "depends_on": [1252599], "creation_time": "2016-01-15T01:10:35Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "cf_status_firefox58": "---", "cf_status_firefox59": "---", "keywords": [], "summary": "KeyframeEffectReadOnly constructor crashes when the target element does not have the parent?", "id": 1239889, "assigned_to_detail": {"email": "bbirtles@mozilla.com", "id": 165012, "name": "bbirtles@mozilla.com", "real_name": "Brian Birtles (:birtles)"}, "severity": "normal", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "assigned_to": "bbirtles@mozilla.com", "comment_count": 12, "comments": [{"text": "Below codes leads the crash.\n\n    var div = document.createElement('div');\n    var effect = new KeyframeEffectReadOnly(div, { opacity: [0, 1] });\n\n 0:04.34 #01: BuildAnimationPropertyListFromPropertyIndexedKeyframes (/home/ikezoe/mozilla-central/dom/animation/KeyframeEffect.cpp:1566)\n 0:04.34 #02: mozilla::dom::KeyframeEffectReadOnly::Constructor(mozilla::dom::GlobalObject const&, mozilla::dom::Element*, mozilla::dom::Optional<JS::Handle<JSObject*> > const&, mozilla::dom::UnrestrictedDoubleOrKeyframeEffectOptions const&, mozilla::ErrorResult&) (/home/ikezoe/mozilla-central/dom/animation/KeyframeEffect.cpp:1732)\n 0:04.40 #03: downcast<mozilla::dom::KeyframeEffectReadOnly> (/home/ikezoe/mozilla-central/obj-firefox/dist/include/mozilla/AlreadyAddRefed.h:138)", "author": "hikezoe@mozilla.com", "id": 11078334, "time": "2016-01-15T01:10:35Z"}, {"text": "Created attachment 8708153\nAutomation test for the crash", "author": "hikezoe@mozilla.com", "id": 11078348, "time": "2016-01-15T01:18:20Z"}, {"text": "I did not paste the most important line.\n\n 0:02.12 Assertion failure: aTargetElement->GetCurrentDoc() (we should only be able to actively animate nodes that are in a document), at /home/ikezoe/mozilla-central/layout/style/StyleAnimationValue.cpp:2596", "author": "hikezoe@mozilla.com", "id": 11078350, "time": "2016-01-15T01:18:41Z"}, {"text": "This is likely the cause for bug 1245735 so I think we need to fix this soon. I spoke to Cameron about what is going on and I think the basic problem is that we are computing values in the KeyframeEffectReadOnly constructor. We really should be storing specified values and only computing them when needed since the computed values will change if mTarget is changed or bound to a different part of the tree.\n\nIt's probably too expensive to re-compute those every on every frame so we'd need to recompute them every time mTarget changed or BindToTree was called on it. That's a fair bit of work, however.\n\nSo, what we can do as an interim step is simply throw if the target element does not have a current doc like we do if mTarget is null.\n\nWe *could* just use the style context from the owner doc but that's going to be wrong in some cases.", "author": "bbirtles@mozilla.com", "id": 11136187, "time": "2016-02-04T04:11:20Z"}, {"text": "Filed bug 1245748 for doing the work described in comment 3.", "author": "bbirtles@mozilla.com", "id": 11136212, "time": "2016-02-04T04:31:34Z"}, {"text": "Created attachment 8715651\nThrow if the animation target does not have a current document\n\nI was thinking of using attachment 8708153 as the test case and writing a more thoroughgoing test when we fix bug 1245748", "author": "bbirtles@mozilla.com", "id": 11136284, "time": "2016-02-04T05:27:38Z"}, {"text": "Comment on attachment 8708153\nAutomation test for the crash\n\nHi Hiro, I hope you don't mind if I land this test along with the fix.", "author": "bbirtles@mozilla.com", "id": 11139291, "time": "2016-02-04T21:53:38Z"}, {"text": "Sure!", "author": "hikezoe@mozilla.com", "id": 11139309, "time": "2016-02-04T21:58:30Z"}, {"text": "https://hg.mozilla.org/integration/mozilla-inbound/rev/3bb3381dc5f8\nhttps://hg.mozilla.org/integration/mozilla-inbound/rev/6b16abc85697", "author": "pulsebot@bots.tld", "id": 11140086, "time": "2016-02-05T03:12:24Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/3bb3381dc5f8\nhttps://hg.mozilla.org/mozilla-central/rev/6b16abc85697", "author": "cbook@mozilla.com", "id": 11140700, "time": "2016-02-05T10:56:51Z"}, {"text": "*** Bug 1245735 has been marked as a duplicate of this bug. ***", "author": "bbirtles@mozilla.com", "id": 11164705, "time": "2016-02-14T23:26:32Z"}, {"text": "*** Bug 1244653 has been marked as a duplicate of this bug. ***", "author": "bbirtles@mozilla.com", "id": 11164708, "time": "2016-02-14T23:27:54Z"}], "cf_last_resolved": "2016-02-05T10:56:51Z", "priority": "--", "mentors_detail": [], "cf_crash_signature": "", "version": "Trunk", "is_cc_accessible": true, "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox59": "---", "last_change_time": "2016-03-01T22:16:56Z", "cf_platform_rel": "---", "product": "Core", "cf_status_firefox_esr52": "---", "blocks": [1245000], "qa_contact": "", "see_also": ["https://bugzilla.mozilla.org/show_bug.cgi?id=1245748"], "cf_fx_iteration": "---", "component": "DOM: Animation", "votes": 0, "groups": [], "cf_status_firefox60": "---", "target_milestone": "mozilla47", "cf_status_firefox47": "fixed", "cf_status_firefox46": "affected", "cf_status_thunderbird_esr52": "---", "url": "", "creator_detail": {"email": "hikezoe@mozilla.com", "id": 131213, "name": "hikezoe@mozilla.com", "real_name": "Hiroyuki Ikezoe (:hiro)"}, "whiteboard": "", "mentors": [], "cc_detail": [{"email": "bbirtles@mozilla.com", "id": 165012, "name": "bbirtles@mozilla.com", "real_name": "Brian Birtles (:birtles)"}, {"email": "cam@mcc.id.au", "id": 54040, "name": "cam@mcc.id.au", "real_name": "Cameron McCormack (:heycam) (away for the moment)"}, {"email": "cbook@mozilla.com", "id": 277293, "name": "cbook@mozilla.com", "real_name": "Carsten Book [:Tomcat]"}, {"email": "hikezoe@mozilla.com", "id": 131213, "name": "hikezoe@mozilla.com", "real_name": "Hiroyuki Ikezoe (:hiro)"}, {"email": "mats@mozilla.com", "id": 5168, "name": "mats@mozilla.com", "real_name": "Mats Palmgren (:mats)"}], "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "cf_tracking_firefox58": "---", "cf_rank": null, "is_open": false, "cf_qa_whiteboard": "", "history": [{"changes": [{"removed": "", "field_name": "cc", "added": "bbirtles@mozilla.com, cam@mcc.id.au"}], "who": "bbirtles@mozilla.com", "when": "2016-01-15T01:11:50Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "hiikezoe@mozilla-japan.org"}], "who": "hikezoe@mozilla.com", "when": "2016-01-15T01:18:41Z"}, {"changes": [{"removed": "", "field_name": "blocks", "added": "1245000"}], "who": "bbirtles@mozilla.com", "when": "2016-02-02T06:10:40Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "ASSIGNED"}, {"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "bbirtles@mozilla.com"}], "who": "bbirtles@mozilla.com", "when": "2016-02-04T04:11:57Z"}, {"changes": [{"removed": "", "field_name": "see_also", "added": "https://bugzilla.mozilla.org/show_bug.cgi?id=1245748"}], "who": "bbirtles@mozilla.com", "when": "2016-02-04T04:31:34Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8715651, "added": "review?(cam@mcc.id.au)"}], "who": "bbirtles@mozilla.com", "when": "2016-02-04T05:27:38Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(cam@mcc.id.au)", "attachment_id": 8715651, "added": "review+"}], "who": "cam@mcc.id.au", "when": "2016-02-04T06:59:09Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8708153, "added": "review+"}], "who": "bbirtles@mozilla.com", "when": "2016-02-04T21:53:38Z"}, {"changes": [{"removed": "ASSIGNED", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla47"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2016-02-05 02:56:51"}, {"removed": "---", "field_name": "cf_status_firefox47", "added": "fixed"}], "who": "cbook@mozilla.com", "when": "2016-02-05T10:56:51Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "mats@mozilla.com"}], "who": "bbirtles@mozilla.com", "when": "2016-02-14T23:26:32Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "cbook@mozilla.com"}], "who": "bbirtles@mozilla.com", "when": "2016-02-14T23:27:54Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1252599"}], "who": "epinal99-bugzilla2@yahoo.fr", "when": "2016-03-01T22:16:56Z"}], "resolution": "FIXED", "op_sys": "Unspecified", "cf_fx_points": "---", "cf_blocking_fennec": "---"}