{"cf_tracking_thunderbird_esr52": "---", "status": "RESOLVED", "cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "cf_tracking_firefox62": "---", "creator": "kmaglione+bmo@mozilla.com", "mentors_detail": [], "depends_on": [], "cf_status_firefox_esr60": "---", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "keywords": [], "cc_detail": [{"email": "erahm@mozilla.com", "id": 496127, "name": "erahm@mozilla.com", "real_name": "Eric Rahm [:erahm] (please no mozreview requests)"}, {"email": "mcastelluccio@mozilla.com", "id": 420453, "name": "mcastelluccio@mozilla.com", "real_name": "Marco Castelluccio [:marco]"}, {"email": "nfroyd@mozilla.com", "id": 417288, "name": "nfroyd@mozilla.com", "real_name": "Nathan Froyd [:froydnj]"}], "cf_last_resolved": "2018-05-10T16:49:10Z", "attachments": [{"creator": "kmaglione+bmo@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-05-09T20:43:42Z", "type_id": 4, "creation_date": "2018-05-09T20:29:52Z", "id": 1754882, "setter": "nfroyd@mozilla.com"}], "content_type": "text/x-review-board-request", "id": 8974529}], "votes": 0, "classification": "Components", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 9, "comments": [{"text": "It looks like we currently have close to 300 unused static atoms, which is not great for memory usage/startup time. We should probably have static analysis that prevents us from accumulating static analysis (possibly using the symbol indexing we already do for Searchfox), but for now I just used a pretty gnarly grep and mangle script to figure out which ones are currently used.", "author": "kmaglione+bmo@mozilla.com", "id": 13266578, "time": "2018-05-09T20:23:53Z"}, {"text": "I assume these unused atoms are \"textually not present in the source code\", not \"never referenced during a browser run of $LENGTH\".  Is that correct?\n\nDo we believe that it's possible some of these atoms might be referenced rather heavily during certain browser usecases and are therefore worthwhile to keep around?", "author": "nfroyd@mozilla.com", "id": 13266588, "time": "2018-05-09T20:26:19Z"}, {"text": "Created attachment 8974529\nBug 1460416: Remove unused static atoms.\n\nThese were found using some ugly text searches, so it's possible some unused\natoms remain. In the future, we should enforce removing unused atoms using\nstatic analysis. Or just generate the static atoms table based on string atom\nnames in our code.\n\nThis patch leaves unused RDF atoms in place, since those are being dealt with\nin another bug.\n\nReview commit: https://reviewboard.mozilla.org/r/242866/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/242866/", "author": "kmaglione+bmo@mozilla.com", "id": 13266599, "time": "2018-05-09T20:29:52Z"}, {"text": "(In reply to Nathan Froyd [:froydnj] from comment #1)\n> I assume these unused atoms are \"textually not present in the source code\",\n> not \"never referenced during a browser run of $LENGTH\".  Is that correct?\n\nCorrect. Textually not referenced.\n\n> Do we believe that it's possible some of these atoms might be referenced\n> rather heavily during certain browser usecases and are therefore worthwhile\n> to keep around?\n\nI think that if we're going to keep around static atoms that aren't referenced by symbol name, for performance reasons, we should be smart about how we do it. I.e., we should do something like count how often a non-static atom is re-created during a PGO run, and keep the list updated as that changes.\n\nBut keeping a mixed bag of static symbols around on the basis that they might be used a bunch, without really tracking which ones actually are, seems like a bad idea.", "author": "kmaglione+bmo@mozilla.com", "id": 13266609, "time": "2018-05-09T20:33:54Z"}, {"text": "Comment on attachment 8974529\nBug 1460416: Remove unused static atoms.\n\nhttps://reviewboard.mozilla.org/r/242866/#review248714\n\nThese all look pretty reasonable to get rid of.  Thanks!", "author": "nfroyd@mozilla.com", "id": 13266636, "time": "2018-05-09T20:43:42Z"}, {"text": "Just a heads up, there's bug 1441292 for making *more* atoms static. Can you verify that these atoms don't end up as dynamic atoms in some sort of standard browsing session?", "author": "erahm@mozilla.com", "id": 13266984, "time": "2018-05-09T22:47:48Z"}, {"text": "(In reply to Eric Rahm [:erahm] (please no mozreview requests) from comment #5)\n> Just a heads up, there's bug 1441292 for making *more* atoms static. Can you\n> verify that these atoms don't end up as dynamic atoms in some sort of\n> standard browsing session?\n\nSome of them might. A large number of them are definitely not referenced at all.\n\nBut I maintain my assertion that if we want to maintain a set of static atoms that aren't referenced by symbol name, we should be systematic about it, and not just keep an arbitrary mixed bag of them mixed in with the rest of the static atoms that are referenced by symbol name.", "author": "kmaglione+bmo@mozilla.com", "id": 13266990, "time": "2018-05-09T22:53:53Z"}, {"text": "https://hg.mozilla.org/integration/mozilla-inbound/rev/e40e77f848063469114960ac2f13dae5649b328f\nBug 1460416: Remove unused static atoms. r=froydnj", "author": "kmaglione+bmo@mozilla.com", "id": 13267038, "time": "2018-05-09T23:25:52Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/e40e77f84806", "author": "ncsoregi@mozilla.com", "id": 13268741, "time": "2018-05-10T16:49:10Z"}], "id": 1460416, "priority": "P3", "cc": ["erahm@mozilla.com", "mcastelluccio@mozilla.com", "nfroyd@mozilla.com"], "cf_crash_signature": "", "version": "unspecified", "is_cc_accessible": true, "cf_tracking_firefox_esr52": "---", "see_also": [], "cf_tracking_thunderbird_esr60": "---", "cf_platform_rel": "---", "product": "Core", "cf_fx_iteration": "---", "blocks": [1436250], "qa_contact": "", "creation_time": "2018-05-09T20:23:53Z", "cf_status_firefox_esr52": "---", "component": "XPCOM", "assigned_to_detail": {"email": "kmaglione+bmo@mozilla.com", "id": 106098, "name": "kmaglione+bmo@mozilla.com", "real_name": "Kris Maglione [:kmag]"}, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "fixed", "cf_status_firefox61": "---", "cf_status_firefox60": "---", "target_milestone": "mozilla62", "cf_rank": null, "cf_qa_whiteboard": "", "severity": "normal", "groups": [], "cf_status_thunderbird_esr52": "---", "url": "", "cf_status_thunderbird_esr60": "---", "creator_detail": {"email": "kmaglione+bmo@mozilla.com", "id": 106098, "name": "kmaglione+bmo@mozilla.com", "real_name": "Kris Maglione [:kmag]"}, "whiteboard": "", "mentors": [], "summary": "Remove unused static atoms", "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "last_change_time": "2018-05-10T16:49:10Z", "assigned_to": "kmaglione+bmo@mozilla.com", "is_open": false, "history": [{"changes": [{"removed": "--", "field_name": "priority", "added": "P3"}, {"removed": "", "field_name": "cc", "added": "nfroyd@mozilla.com"}], "who": "nfroyd@mozilla.com", "when": "2018-05-09T20:26:19Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8974529, "added": "review?(nfroyd@mozilla.com)"}], "who": "kmaglione+bmo@mozilla.com", "when": "2018-05-09T20:29:52Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(nfroyd@mozilla.com)", "attachment_id": 8974529, "added": "review+"}], "who": "nfroyd@mozilla.com", "when": "2018-05-09T20:43:42Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "erahm@mozilla.com"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(kmaglione+bmo@mozilla.com)"}], "who": "erahm@mozilla.com", "when": "2018-05-09T22:47:48Z"}, {"changes": [{"removed": "needinfo?(kmaglione+bmo@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "kmaglione+bmo@mozilla.com", "when": "2018-05-09T22:53:53Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "mcastelluccio@mozilla.com"}], "who": "mcastelluccio@mozilla.com", "when": "2018-05-09T23:48:20Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla62"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2018-05-10 16:49:10"}, {"removed": "---", "field_name": "cf_status_firefox62", "added": "fixed"}], "who": "ncsoregi@mozilla.com", "when": "2018-05-10T16:49:10Z"}], "resolution": "FIXED", "op_sys": "Unspecified", "cf_fx_points": "---", "cf_blocking_fennec": "---"}