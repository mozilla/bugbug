{"cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "classification": "Server Software", "creator": "adrian@mozilla.com", "mentors_detail": [], "depends_on": [1252461, 1361396, 1375434, 1434425, 1435071, 1435551, 1459272, 1459276, 1460125], "creation_time": "2016-03-17T14:38:35Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "keywords": [], "summary": "[tracker] Stop saving crash data to postgresql", "cf_last_resolved": "2018-05-17T20:28:27Z", "attachments": [], "assigned_to_detail": {"email": "willkg@mozilla.com", "id": 424160, "name": "willkg@mozilla.com", "real_name": "Will Kahn-Greene [:willkg] ET needinfo? me"}, "severity": "normal", "is_confirmed": true, "is_creator_accessible": true, "comments": [{"text": "Now that bug 1252461 has landed, we can change the configuration to stop saving the processed crashes in postgres.", "author": "adrian@mozilla.com", "id": 11255415, "time": "2016-03-17T14:38:35Z"}, {"text": "Configuration change:\n\n> [centos@ip-172-31-10-19 ~]$ consulate kv get socorro/processor/destination.storage_classes\n> socorro.external.postgresql.crashstorage.PostgreSQLCrashStorage, socorro.external.es.crashstorage.ESCrashStorage, socorro.external.boto.crashstorage.BotoS3CrashStorage, socorro.external.statsd.crashstorage.StatsdCrashStorage\n> [centos@ip-172-31-10-19 ~]$ consulate kv set socorro/processor/destination.storage_classes 'socorro.external.postgresql.crashstorage.PostgreSQLBasicCrashStorage, socorro.external.es.crashstorage.ESCrashStorage, socorro.external.boto.crashstorage.BotoS3CrashStorage, socorro.external.statsd.crashstorage.StatsdCrashStorage'\n\nr? anyone", "author": "adrian@mozilla.com", "id": 11255420, "time": "2016-03-17T14:39:27Z"}, {"text": "this is not complete.\n\nwhile this will set up the defaults for the destination PolyCrashStore correctly, there is another key that will override it back to the original value.  In each of the separate numbered crashstores within the PolyCrashStore, we override the default with \"socorro.external.statsd.statsd_base.StatsdBenchmarkingWrapper\".  Then we give the original intended crashstorage class to that class.\n\nLook for:\n   destination.storage0.wrapped_crashstore\n\nits current value is:\n    socorro.external.postgresql.crashstorage.PostgreSQLCrashStorage\n\nchange it to:\n    socorro.external.postgresql.crashstorage.PostgreSQLBasicCrashStorage\n\nIf I were to start over with the configuration, and knowing that the benchmarking wrappers are permanent rather than temporary, I would have set the key \"socorro/processor/destination.storage_classes\" to be use the \"socorro.external.statsd.statsd_base.StatsdBenchmarkingWrapper\" 3 times. That way there would be less ambiguity that lead you to your proposal.", "author": "lars@mozilla.com", "id": 11255489, "time": "2016-03-17T15:03:16Z"}, {"text": "Thanks Lars! We clarified on IRC, the key is actually `wrapped_object_class` instead of `wrapped_crashstore` (which is legacy).\n\nVerification: \n\n> [centos@ip-172-31-10-19 ~]$ consulate kv get socorro/processor/destination.storage0.wrapped_object_class\n> socorro.external.postgresql.crashstorage.PostgreSQLCrashStorage\n\n\nNew proposal:\n> $ consulate kv set socorro/processor/destination.storage_classes 'socorro.external.postgresql.crashstorage.PostgreSQLBasicCrashStorage, socorro.external.es.crashstorage.ESCrashStorage, socorro.external.boto.crashstorage.BotoS3CrashStorage, socorro.external.statsd.crashstorage.StatsdCrashStorage'\n> $ consulate kv set socorro/processor/destination.storage0.wrapped_object_class 'socorro.external.postgresql.crashstorage.PostgreSQLBasicCrashStorage'", "author": "adrian@mozilla.com", "id": 11255631, "time": "2016-03-17T15:44:06Z"}, {"text": "I have just applied those changes to stage. I'm watching datadog and logs for the next 30 minutes, after what I'll be gone for the weekend. If things go wrong, here is the config rollback: \n\nconsulate kv set socorro/processor/destination.storage_classes 'socorro.external.postgresql.crashstorage.PostgreSQLCrashStorage, socorro.external.es.crashstorage.ESCrashStorage, socorro.external.boto.crashstorage.BotoS3CrashStorage, socorro.external.statsd.crashstorage.StatsdCrashStorage'\n\nconsulate kv set socorro/processor/destination.storage0.wrapped_object_class 'socorro.external.postgresql.crashstorage.PostgreSQLCrashStorage'", "author": "adrian@mozilla.com", "id": 11255785, "time": "2016-03-17T16:25:52Z"}, {"text": "Red Alert. We need to undo this. Turns out that the current correlations scripts, which we run on crash-analysis (the old dbaron scripts) RELY on processed_crashes (joined with reports). See\nhttps://github.com/mozilla/socorro/blob/f9a84eb267c457c04adbec7891b7e4039f2da857/scripts/crons/cron_libraries.sh#L56\nhttps://github.com/mozilla/socorro/blob/f9a84eb267c457c04adbec7891b7e4039f2da857/scripts/crons/cron_libraries.sh#L81\n\nBasically, it does a join on `processed_crashes` AND `reports_$DATE`.\n\nTo quote Lars (we noticed this today whilst vidyo'ing), \"That's what happens when you have too many moving parts.\"\n\nI think we can leave the source code as is. Just need to make sure our config is set to to continue to write processed crashes to PG.", "author": "peterbe@mozilla.com", "id": 11264896, "time": "2016-03-21T20:27:41Z"}, {"text": "Once we've rewritten how correlations are aggregated and accumulated we should ideally not use PG at all. At all! (since we can get product versions from /api/ProductVersions/).\n\nLars first unfinished prototype of correlations_app.py (which I'm taking over slowly) relies on PG (for UUIDs) and S3 (for processed crash JSON blobs). To start with, we'll get UUIDs out of ES (SuperSearch maybe). Maybe we'll use ES for the processed crashes too and not even involve S3.", "author": "peterbe@mozilla.com", "id": 11264905, "time": "2016-03-21T20:30:23Z"}, {"text": "I have rolled back the configuration on stage, applying the commands I wrote in comment #4.", "author": "adrian@mozilla.com", "id": 11270852, "time": "2016-03-23T14:24:59Z"}, {"text": "Peter, what's the status here? Do we still rely on the old correlation scripts?", "author": "adrian@mozilla.com", "id": 11728102, "time": "2016-09-22T03:39:50Z"}, {"text": "(In reply to Adrian Gaudebert [:adrian] from comment #8)\n> Peter, what's the status here? Do we still rely on the old correlation\n> scripts?\n\nI don't know. I'm certainly not working on it. For the moment we're still relying on pulling down the correlations from crash-analysis with http so they're not even stored in Postgres.", "author": "peterbe@mozilla.com", "id": 11730461, "time": "2016-09-22T18:53:02Z"}, {"text": "If cron_libraries.sh is still running on crash-analysis, then we still rely on this. There are three lines in there that rely on direct postgres access. Replace those with ES backed API calls, update crash-analysis, and we can go ahead with this.", "author": "chris.lonnen@gmail.com", "id": 11748840, "time": "2016-09-30T00:11:41Z"}, {"text": "Shouldn't be possible to replace with some python and requests.get()\nhttps://github.com/mozilla/socorro/blob/394423bbd7da9445b341ef72be60ed602f6367e8/scripts/crons/cron_libraries.sh#L56", "author": "peterbe@mozilla.com", "id": 11751055, "time": "2016-09-30T19:08:17Z"}, {"text": "What's the status of this bug? Do we still use the old correlation scripts mentioned in comment #6?", "author": "willkg@mozilla.com", "id": 12270924, "time": "2017-04-27T12:29:22Z"}, {"text": "It's messy. \n\n1) https://github.com/mozilla/socorro/blob/master/scripts/crons/cron_libraries.sh is still in git. It still depends on talking directly to postgres to query the `processed_crashes` table. \n\n2) The cron job on crash-analysis is still going. Nobody updates as far as I know. And they shouldn't have a reason to either now since figuring out what the featured versions are is automated. Correlations are still generated daily. E.g. https://crash-analysis.mozilla.com/crash_analysis/20170427/ \n\n3) The webapp does NOT depend on crash-analysis.m.c. We used to pull on data from crash-analysis.m.o by requests.get() but we longer do. (:marco replaced this will a query to telemetry)\n\n4) If we re-do the configuration so that our crashstorage stops saving processed crashes in PG, then the output on crash-analysis.m.o will cease. The socorro team certainly \"doesn't care\" since we neither use or depend on it for anything else in socorro. But other stability people might care. \n\nRough outline of a plan\n-----------------------\n\n1. Ask once and twice the stability list if people are dependent of the output on https://crash-analysis.mozilla.com/crash_analysis/*\n\n2. If someone says they are; Ask :marco how we can guide these people away from it and start relying on Telemetry.\n\n3. If nobody says they are; \n  3.1. make the change (again) mentioned in https://bugzilla.mozilla.org/show_bug.cgi?id=1257531#c4 (and on prod too)\n  3.2 remove cron_libraries.sh from our code\n  3.3 talk to calixte if they still need the crash-analysis server at all and if we can recyle it\n\n\n:marco, :calixte Do you know of anybody using the old crash-analysis.m.c?\n\nAdrian, did I get this right?\n\nWho wants to do the comms to find out if we can shut this down?", "author": "peterbe@mozilla.com", "id": 12272180, "time": "2017-04-27T18:25:10Z"}, {"text": ":peterbe, I'm currently removing the stuff we've on c-a.m.c.\nI think Marcia continues to use https://crash-analysis.mozilla.com/release-mgmt/0000.overview.html (Latest Daily Reports) but I'm rewriting this stuff and will put it on Heroku.\nI'll ping you when everything will be finished (I hope very soonly).\nI already filled a bug for that purpose: https://bugzilla.mozilla.org/show_bug.cgi?id=1315007", "author": "cdenizet@mozilla.com", "id": 12282300, "time": "2017-05-02T15:01:02Z"}, {"text": "(In reply to Calixte Denizet (:calixte) from comment #14)\n> :peterbe, I'm currently removing the stuff we've on c-a.m.c.\n> I think Marcia continues to use\n> https://crash-analysis.mozilla.com/release-mgmt/0000.overview.html (Latest\n> Daily Reports) but I'm rewriting this stuff and will put it on Heroku.\n> I'll ping you when everything will be finished (I hope very soonly).\n> I already filled a bug for that purpose:\n> https://bugzilla.mozilla.org/show_bug.cgi?id=1315007\n\nThat's nice but not answering the question :)\n\nDo you know if anybody uses https://crash-analysis.mozilla.com/crash_analysis/\n(Not; Do you use crash-analysis.mozilla.com)\n\nThere's a cron job that generates these .txt and .txt.gz files. We *used* download those from the Socorro webapp and display their content as part of the signature report and/or the report index pages. We don't any more. The question is; do you know anybody else who depends on those .txt (and .txt.gz) files at all?", "author": "peterbe@mozilla.com", "id": 12282529, "time": "2017-05-02T15:56:09Z"}, {"text": ":peterbe, sorry I missed that...\nAs far as I know, nobody use this. Maybe you should check the server logs to see if someone download this stuff.", "author": "cdenizet@mozilla.com", "id": 12282547, "time": "2017-05-02T16:01:03Z"}, {"text": "The only thing I know of is DLL correlations with versions (see bug 1361396).", "author": "mcastelluccio@mozilla.com", "id": 12283065, "time": "2017-05-02T17:18:03Z"}, {"text": "(In reply to Peter Bengtsson [:peterbe] from comment #15)\n> \n> There's a cron job that generates these .txt and .txt.gz files. We *used*\n> download those from the Socorro webapp and display their content as part of\n> the signature report and/or the report index pages. We don't any more. The\n> question is; do you know anybody else who depends on those .txt (and\n> .txt.gz) files at all?\n\nWe at Beijing office scraps these reports to find out if any of our extensions have unusual high correlation with high volumn crashes, it helped a few times in the past.\n\nWe just noticed we've been gotten empty results since 5 May, and it turns out since that day only the first character of the extension id was left. [1][2]\n\n[1]: https://crash-analysis.mozilla.com/crash_analysis/20170504/20170504_Firefox_52.0.2-interesting-addons.txt\n[2]: https://crash-analysis.mozilla.com/crash_analysis/20170505/20170505_Firefox_52.0.2-interesting-addons.txt", "author": "bzhao@mozilla.com", "id": 12381290, "time": "2017-06-08T02:33:14Z"}, {"text": "Hector: Can you write up a new bug for that? That's a different (but related) issue.", "author": "willkg@mozilla.com", "id": 12382439, "time": "2017-06-08T12:48:25Z"}, {"text": "Hector, that problem very likely comes from us changing the format of the addons field. See bug 1250132 for context.", "author": "adrian@mozilla.com", "id": 12382519, "time": "2017-06-08T13:17:33Z"}, {"text": "(In reply to Will Kahn-Greene [:willkg] ET needinfo? me from comment #19)\n> Hector: Can you write up a new bug for that? That's a different (but\n> related) issue.\n\nFiled as bug 1371574.\n\nI'm also interested in knowing what can I do after bug 1361396.", "author": "bzhao@mozilla.com", "id": 12385477, "time": "2017-06-09T09:25:52Z"}, {"text": "*** Bug 1399124 has been marked as a duplicate of this bug. ***", "author": "willkg@mozilla.com", "id": 12905902, "time": "2017-12-07T18:08:30Z"}, {"text": "Adjusting the summary a bit since the postgresql crash storage saves raw and processed crash data to a few different places.", "author": "willkg@mozilla.com", "id": 13032421, "time": "2018-02-10T01:53:15Z"}, {"text": "The last changes removing all the bits from the db related to crashstorage landed today. We're all done here!", "author": "willkg@mozilla.com", "id": 13285581, "time": "2018-05-17T20:28:27Z"}, {"text": "We pushed it all out today in Socorro tag 319. That's the end of that.", "author": "willkg@mozilla.com", "id": 13362662, "time": "2018-05-25T01:16:05Z"}], "id": 1257531, "priority": "--", "platform": "All", "comment_count": 26, "version": "unspecified", "is_cc_accessible": true, "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox62": "---", "status": "RESOLVED", "product": "Socorro", "cf_fx_iteration": "---", "blocks": [1361394], "qa_contact": "", "see_also": [], "cf_status_firefox_esr52": "---", "component": "General", "votes": 0, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "---", "cf_status_firefox61": "---", "cf_status_firefox60": "---", "target_milestone": "---", "cc": ["bzhao@mozilla.com", "cdenizet@mozilla.com", "chris.lonnen@gmail.com", "lars@mozilla.com", "mcastelluccio@mozilla.com", "peterbe@mozilla.com", "willkg@mozilla.com"], "groups": [], "url": "", "creator_detail": {"email": "adrian@mozilla.com", "id": 413366, "name": "adrian@mozilla.com", "real_name": "Adrian Gaudebert [:adrian]"}, "whiteboard": "", "mentors": [], "cc_detail": [{"email": "bzhao@mozilla.com", "id": 424852, "name": "bzhao@mozilla.com", "real_name": "Hector Zhao [:hectorz]"}, {"email": "cdenizet@mozilla.com", "id": 560431, "name": "cdenizet@mozilla.com", "real_name": "Calixte Denizet (:calixte)"}, {"email": "chris.lonnen@gmail.com", "id": 389768, "name": "chris.lonnen@gmail.com", "real_name": "Lonnen :lonnen"}, {"email": "lars@mozilla.com", "id": 254372, "name": "lars@mozilla.com", "real_name": "K Lars Lohn [:lars] [:klohn]"}, {"email": "mcastelluccio@mozilla.com", "id": 420453, "name": "mcastelluccio@mozilla.com", "real_name": "Marco Castelluccio [:marco]"}, {"email": "peterbe@mozilla.com", "id": 412877, "name": "peterbe@mozilla.com", "real_name": "Peter Bengtsson [:peterbe]"}, {"email": "willkg@mozilla.com", "id": 424160, "name": "willkg@mozilla.com", "real_name": "Will Kahn-Greene [:willkg] ET needinfo? me"}], "alias": null, "dupe_of": null, "flags": [], "last_change_time": "2018-05-25T01:16:05Z", "cf_status_firefox_esr60": "---", "assigned_to": "willkg@mozilla.com", "is_open": false, "cf_qa_whiteboard": "", "resolution": "FIXED", "op_sys": "All", "cf_fx_points": "---", "history": [{"changes": [{"removed": "", "field_name": "depends_on", "added": "1252461"}], "who": "adrian@mozilla.com", "when": "2016-03-17T14:40:50Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "lars@mozilla.com"}], "who": "lars@mozilla.com", "when": "2016-03-17T15:03:16Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "peterbe@mozilla.com"}], "who": "peterbe@mozilla.com", "when": "2016-03-21T20:27:41Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "chris.lonnen@gmail.com"}], "who": "chris.lonnen@gmail.com", "when": "2016-09-30T00:11:41Z"}, {"changes": [{"removed": "Infra", "field_name": "component", "added": "General"}], "who": "peterbe@mozilla.com", "when": "2016-11-10T21:18:55Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "willkg@mozilla.com"}], "who": "willkg@mozilla.com", "when": "2017-04-27T12:29:22Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "cdenizet@mozilla.com, mcastelluccio@mozilla.com"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(mcastelluccio@mozilla.com), needinfo?(cdenizet@mozilla.com)"}], "who": "peterbe@mozilla.com", "when": "2017-04-27T18:25:10Z"}, {"changes": [{"removed": "", "field_name": "blocks", "added": "1314814"}], "who": "adrian@mozilla.com", "when": "2017-05-02T14:46:25Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1361396"}], "who": "adrian@mozilla.com", "when": "2017-05-02T14:53:41Z"}, {"changes": [{"removed": "needinfo?(cdenizet@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "cdenizet@mozilla.com", "when": "2017-05-02T15:01:02Z"}, {"changes": [{"removed": "needinfo?(mcastelluccio@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "mcastelluccio@mozilla.com", "when": "2017-05-02T17:18:03Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "bzhao@mozilla.com"}], "who": "bzhao@mozilla.com", "when": "2017-06-08T02:33:14Z"}, {"changes": [{"removed": "adrian@mozilla.com", "field_name": "assigned_to", "added": "nobody@mozilla.org"}], "who": "adrian@mozilla.com", "when": "2017-06-19T09:43:26Z"}, {"changes": [{"removed": "1314814", "field_name": "blocks", "added": "1361394"}], "who": "adrian@mozilla.com", "when": "2017-06-22T15:24:59Z"}, {"changes": [{"removed": "Stop saving processed crash in PostgreSQL", "field_name": "summary", "added": "[tracker] Stop saving processed crash in PostgreSQL"}], "who": "willkg@mozilla.com", "when": "2017-12-07T18:07:47Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1375434"}], "who": "willkg@mozilla.com", "when": "2017-12-07T18:08:52Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1434425"}], "who": "willkg@mozilla.com", "when": "2018-01-30T21:21:09Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1435551"}], "who": "willkg@mozilla.com", "when": "2018-02-10T01:51:27Z"}, {"changes": [{"removed": "[tracker] Stop saving processed crash in PostgreSQL", "field_name": "summary", "added": "[tracker] Stop saving crash data to postgresql"}], "who": "willkg@mozilla.com", "when": "2018-02-10T01:53:15Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1459272"}], "who": "willkg@mozilla.com", "when": "2018-05-04T17:54:51Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1459276"}], "who": "willkg@mozilla.com", "when": "2018-05-04T17:56:21Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1435071"}], "who": "willkg@mozilla.com", "when": "2018-05-04T21:02:03Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1460125"}], "who": "willkg@mozilla.com", "when": "2018-05-09T01:39:36Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "willkg@mozilla.com"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2018-05-17 20:28:27"}], "who": "willkg@mozilla.com", "when": "2018-05-17T20:28:27Z"}]}