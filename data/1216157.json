{"cf_tracking_thunderbird_esr52": "---", "status": "RESOLVED", "cf_tracking_firefox60": "---", "attachments": [{"creator": "jdemooij@mozilla.com", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2015-10-20T12:05:33Z", "type_id": 4, "creation_date": "2015-10-20T12:02:34Z", "id": 1275730, "setter": "jcoppeard@mozilla.com"}], "content_type": "text/plain", "id": 8676199}], "classification": "Components", "creator": "choller@mozilla.com", "cc": ["choller@mozilla.com", "fuzzing@mozilla.com", "jcoppeard@mozilla.com", "jdemooij@mozilla.com", "jruderman@gmail.com", "nth10sd@gmail.com"], "depends_on": [], "creation_time": "2015-10-19T14:24:07Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "x86_64", "cf_status_firefox58": "---", "cf_status_firefox59": "---", "keywords": ["crash", "regression", "testcase"], "summary": "Crash [@ js::jit::AutoWritableJitCode::AutoWritableJitCode] with OOM", "id": 1216157, "assigned_to_detail": {"email": "jdemooij@mozilla.com", "id": 375297, "name": "jdemooij@mozilla.com", "real_name": "Jan de Mooij [:jandem] (PTO Mar 8)"}, "severity": "critical", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "assigned_to": "jdemooij@mozilla.com", "comment_count": 4, "comments": [{"text": "The following testcase crashes on mozilla-central revision 01e37977f8da (build with --enable-optimize --enable-posix-nspr-emulation --enable-valgrind --enable-gczeal --disable-tests --enable-debug, run with --ion-eager):\n\ngcslice(0); // Start IGC, but don't mark anything.\nfunction f(str) {\n    for (var i = 0; i < 10; i++) {\n        arr = /foo(ba(r))?/.exec(str);\n        var x = arr[oomAfterAllocations(100)] + \" \" + arr[1] + \" \" + 1899;\n    }\n}\nf(\"foo\");\n\n\nBacktrace:\n\nProgram received signal SIGSEGV, Segmentation fault.\njs::jit::AutoWritableJitCode::AutoWritableJitCode (this=0x7fffffffb5f0, code=0x0) at js/src/jit/JitCompartment.h:513\n#0  js::jit::AutoWritableJitCode::AutoWritableJitCode (this=0x7fffffffb5f0, code=0x0) at js/src/jit/JitCompartment.h:513\n#1  0x000000000062b1fa in js::jit::JitCode::togglePreBarriers (this=this@entry=0x0, enabled=enabled@entry=true) at js/src/jit/Ion.cpp:872\n#2  0x0000000000603c2d in js::jit::JitCompartment::generateRegExpExecStub (this=this@entry=0x7ffff69160b0, cx=cx@entry=0x7ffff6906c00) at js/src/jit/CodeGenerator.cpp:1450\n#3  0x00000000006e55f4 in ensureRegExpExecStubExists (cx=0x7ffff6906c00, this=0x7ffff69160b0) at js/src/jit/JitCompartment.h:467\n#4  js::jit::IonBuilder::inlineRegExpExec (this=0x7ffff69b5258, callInfo=...) at js/src/jit/MCallOptimize.cpp:1852\n#5  0x000000000066c96d in js::jit::IonBuilder::inlineSingleCall (this=0x7ffff69b5258, callInfo=..., targetArg=<optimized out>) at js/src/jit/IonBuilder.cpp:5518\n#6  0x000000000066e07c in js::jit::IonBuilder::inlineCallsite (this=this@entry=0x7ffff69b5258, targets=..., callInfo=...) at js/src/jit/IonBuilder.cpp:5582\n#7  0x000000000066e415 in js::jit::IonBuilder::jsop_call (this=this@entry=0x7ffff69b5258, argc=1, constructing=<optimized out>) at js/src/jit/IonBuilder.cpp:6468\n#8  0x0000000000667b6e in js::jit::IonBuilder::inspectOpcode (this=this@entry=0x7ffff69b5258, op=op@entry=JSOP_CALL) at js/src/jit/IonBuilder.cpp:1871\n#9  0x0000000000668f30 in js::jit::IonBuilder::traverseBytecode (this=this@entry=0x7ffff69b5258) at js/src/jit/IonBuilder.cpp:1517\n#10 0x00000000006693a5 in js::jit::IonBuilder::build (this=0x7ffff69b5258) at js/src/jit/IonBuilder.cpp:913\n#11 0x000000000068838d in js::jit::IonCompile (cx=cx@entry=0x7ffff6906c00, script=script@entry=0x7ffff3f86090, baselineFrame=baselineFrame@entry=0x7fffffffcbd8, osrPc=<optimized out>, constructing=<optimized out>, recompile=<optimized out>, optimizationLevel=optimizationLevel@entry=js::jit::Optimization_Normal) at js/src/jit/Ion.cpp:2176\n#12 0x0000000000688e2a in js::jit::Compile (cx=cx@entry=0x7ffff6906c00, script=..., script@entry=..., osrFrame=0x7fffffffcbd8, osrPc=osrPc@entry=0x7ffff69176ae \"\\343\\201V\", constructing=<optimized out>, forceRecompile=<optimized out>) at js/src/jit/Ion.cpp:2414\n#13 0x00000000006890c1 in js::jit::CanEnterAtBranch (cx=cx@entry=0x7ffff6906c00, script=script@entry=..., osrFrame=osrFrame@entry=0x7fffffffcbd8, pc=pc@entry=0x7ffff69176ae \"\\343\\201V\") at js/src/jit/Ion.cpp:2501\n#14 0x0000000000bfb18d in EnsureCanEnterIon (stub=<optimized out>, jitcodePtr=<synthetic pointer>, pc=0x7ffff69176ae \"\\343\\201V\", script=..., frame=0x7fffffffcbd8, cx=0x7ffff6906c00) at js/src/jit/BaselineIC.cpp:104\n#15 js::jit::DoWarmUpCounterFallback (cx=0x7ffff6906c00, frame=0x7fffffffcbd8, stub=<optimized out>, infoPtr=0x7fffffffcba0) at js/src/jit/BaselineIC.cpp:268\n#16 0x00007ffff7e50f69 in ?? ()\n[...]\n#27 0x0000000000000000 in ?? ()\nrax\t0x7fffffffb5f0\t140737488336368\nrbx\t0x0\t0\nrcx\t0xc3\t195\nrdx\t0x7ffff6937000\t140737330245632\nrsi\t0x0\t0\nrdi\t0x7fffffffb5f0\t140737488336368\nrbp\t0x7fffffffb5c0\t140737488336320\nrsp\t0x7fffffffb5a0\t140737488336288\nr8\t0x0\t0\nr9\t0xe4af48\t14987080\nr10\t0xb\t11\nr11\t0xe4af48\t14987080\nr12\t0x7fffffffb880\t140737488337024\nr13\t0x1\t1\nr14\t0x7fffffffb890\t140737488337040\nr15\t0x7fffffffb8a0\t140737488337056\nrip\t0x60c84f <js::jit::AutoWritableJitCode::AutoWritableJitCode(js::jit::JitCode*)+15>\n=> 0x60c84f <js::jit::AutoWritableJitCode::AutoWritableJitCode(js::jit::JitCode*)+15>:\tmov    0x10(%rsi),%r13d\n   0x60c853 <js::jit::AutoWritableJitCode::AutoWritableJitCode(js::jit::JitCode*)+19>:\tmov    (%rsi),%r14", "author": "choller@mozilla.com", "id": 10851184, "time": "2015-10-19T14:24:07Z"}, {"text": "Created attachment 8676199\nPatch\n\nMissing an OOM check. This only crashes when we're in the middle of an incremental GC, else we don't call togglePreBarriers.", "author": "jdemooij@mozilla.com", "id": 10854829, "time": "2015-10-20T12:02:34Z"}, {"text": "https://hg.mozilla.org/integration/mozilla-inbound/rev/87b8ec6a9c72", "author": "pulsebot@bots.tld", "id": 10881580, "time": "2015-10-28T15:48:49Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/87b8ec6a9c72", "author": "kwierso@gmail.com", "id": 10883490, "time": "2015-10-29T00:02:08Z"}], "cf_last_resolved": "2015-10-29T00:02:08Z", "priority": "--", "mentors_detail": [], "cf_crash_signature": "[@ js::jit::AutoWritableJitCode::AutoWritableJitCode]", "version": "Trunk", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox59": "---", "last_change_time": "2015-10-29T00:02:08Z", "cf_platform_rel": "---", "product": "Core", "cf_status_firefox_esr52": "---", "blocks": [676763, 912928], "qa_contact": "", "see_also": [], "cf_fx_iteration": "---", "component": "JavaScript Engine", "votes": 0, "groups": [], "cf_status_firefox60": "---", "target_milestone": "mozilla44", "cf_status_firefox44": "fixed", "is_cc_accessible": true, "cf_status_thunderbird_esr52": "---", "url": "", "creator_detail": {"email": "choller@mozilla.com", "id": 395101, "name": "choller@mozilla.com", "real_name": "Christian Holler (:decoder)"}, "whiteboard": "[jsbugmon:update]", "mentors": [], "cc_detail": [{"email": "choller@mozilla.com", "id": 395101, "name": "choller@mozilla.com", "real_name": "Christian Holler (:decoder)"}, {"email": "fuzzing@mozilla.com", "id": 469204, "name": "fuzzing@mozilla.com", "real_name": "Fuzzing Team"}, {"email": "jcoppeard@mozilla.com", "id": 443194, "name": "jcoppeard@mozilla.com", "real_name": "Jon Coppeard (:jonco) (PTO until 13th March)"}, {"email": "jdemooij@mozilla.com", "id": 375297, "name": "jdemooij@mozilla.com", "real_name": "Jan de Mooij [:jandem] (PTO Mar 8)"}, {"email": "jruderman@gmail.com", "id": 11608, "name": "jruderman@gmail.com", "real_name": "Jesse Ruderman"}, {"email": "nth10sd@gmail.com", "id": 132034, "name": "nth10sd@gmail.com", "real_name": "Gary Kwong [:gkw] [:nth10sd]"}], "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "cf_tracking_firefox58": "---", "cf_rank": null, "is_open": false, "history": [{"changes": [{"removed": "[jsbugmon:update,bisect]", "field_name": "whiteboard", "added": "[jsbugmon:update]"}], "who": "fuzzing@mozilla.com", "when": "2015-10-19T15:20:46Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "jdemooij@mozilla.com"}, {"removed": "[jsbugmon:update]", "field_name": "whiteboard", "added": "[jsbugmon:update,bisect]"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(jdemooij@mozilla.com)"}], "who": "jdemooij@mozilla.com", "when": "2015-10-19T18:38:30Z"}, {"changes": [{"removed": "[jsbugmon:update,bisect]", "field_name": "whiteboard", "added": "[jsbugmon:update]"}], "who": "jdemooij@mozilla.com", "when": "2015-10-19T18:38:51Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "ASSIGNED"}, {"removed": "", "field_name": "cc", "added": "jcoppeard@mozilla.com"}, {"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "jdemooij@mozilla.com"}, {"removed": "needinfo?(jdemooij@mozilla.com)", "field_name": "flagtypes.name", "added": ""}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8676199, "added": "review?(jcoppeard@mozilla.com)"}], "who": "jdemooij@mozilla.com", "when": "2015-10-20T12:02:34Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(jcoppeard@mozilla.com)", "attachment_id": 8676199, "added": "review+"}], "who": "jcoppeard@mozilla.com", "when": "2015-10-20T12:05:33Z"}, {"changes": [{"removed": "ASSIGNED", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla44"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2015-10-28 17:02:08"}, {"removed": "affected", "field_name": "cf_status_firefox44", "added": "fixed"}], "who": "kwierso@gmail.com", "when": "2015-10-29T00:02:08Z"}], "resolution": "FIXED", "op_sys": "Linux", "cf_fx_points": "---", "cf_blocking_fennec": "---"}