{"cf_tracking_thunderbird_esr52": "---", "status": "RESOLVED", "cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "cf_tracking_firefox62": "---", "creator": "kmaglione+bmo@mozilla.com", "mentors_detail": [], "depends_on": [], "cf_status_firefox_esr60": "---", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "keywords": [], "cc_detail": [{"email": "bugzilla-mozilla@dorando.at", "id": 110580, "name": "bugzilla-mozilla@dorando.at", "real_name": "Dorando"}, {"email": "continuation@gmail.com", "id": 406194, "name": "continuation@gmail.com", "real_name": "Andrew McCreight [:mccr8]"}, {"email": "felipc@gmail.com", "id": 208747, "name": "felipc@gmail.com", "real_name": ":Felipe Gomes (needinfo me!)"}, {"email": "standard8@mozilla.com", "id": 112088, "name": "standard8@mozilla.com", "real_name": "Mark Banner (:standard8)"}], "cf_last_resolved": "2018-06-08T09:59:22Z", "attachments": [{"creator": "kmaglione+bmo@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-05-29T21:41:38Z", "type_id": 4, "creation_date": "2018-05-26T05:34:37Z", "id": 1762070, "setter": "continuation@gmail.com"}], "content_type": "text/x-review-board-request", "id": 8980835}, {"creator": "kmaglione+bmo@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-05-29T23:17:01Z", "type_id": 4, "creation_date": "2018-05-26T05:34:37Z", "id": 1762071, "setter": "continuation@gmail.com"}], "content_type": "text/x-review-board-request", "id": 8980836}, {"creator": "kmaglione+bmo@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-05-30T09:35:17Z", "type_id": 4, "creation_date": "2018-05-26T05:34:37Z", "id": 1762072, "setter": "standard8@mozilla.com"}], "content_type": "text/x-review-board-request", "id": 8980837}, {"creator": "kmaglione+bmo@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-05-29T23:29:42Z", "type_id": 4, "creation_date": "2018-05-26T05:34:37Z", "id": 1762073, "setter": "continuation@gmail.com"}], "content_type": "text/x-review-board-request", "id": 8980838}], "votes": 1, "classification": "Components", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 15, "comments": [{"text": "It looks like we currently create fetch and XMLHttpRequest bindings in multiple globals in each content process, even though they're generally not used in content processes. Those prototype objects are fairly expensive to create, so we should create them lazily in cases where we're not likely to need them.", "author": "kmaglione+bmo@mozilla.com", "id": 13365545, "time": "2018-05-25T23:58:53Z"}, {"text": "Created attachment 8980835\nBug 1464548: Part 1a - Add defineLazyGlobalGetters helper.\n\nThis allows us to lazily import global properties using\nCu.importGlobalProperties. Aside from making it easier to avoid lazily\nimporting these properties, it also defines them all in the shared JSM global\nso that we don't risk re-creating them in Sandboxes or frameloader globals.\n\nReview commit: https://reviewboard.mozilla.org/r/247024/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/247024/", "author": "kmaglione+bmo@mozilla.com", "id": 13365765, "time": "2018-05-26T05:34:37Z"}, {"text": "Created attachment 8980836\nBug 1464548: Part 2b - Don't delete properties before redefining them, because deleting properties kills JIT performance.\n\nReview commit: https://reviewboard.mozilla.org/r/247026/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/247026/", "author": "kmaglione+bmo@mozilla.com", "id": 13365766, "time": "2018-05-26T05:34:37Z"}, {"text": "Created attachment 8980837\nBug 1464548: Part 2 - Add ESLint support for defineLazyGlobalGetters.\n\nReview commit: https://reviewboard.mozilla.org/r/247028/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/247028/", "author": "kmaglione+bmo@mozilla.com", "id": 13365767, "time": "2018-05-26T05:34:37Z"}, {"text": "Created attachment 8980838\nBug 1464548: Part 3 - Update callers to use defineLazyGlobalGetters.\n\nReview commit: https://reviewboard.mozilla.org/r/247030/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/247030/", "author": "kmaglione+bmo@mozilla.com", "id": 13365768, "time": "2018-05-26T05:34:37Z"}, {"text": "Comment on attachment 8980835\nBug 1464548: Part 1a - Add defineLazyGlobalGetters helper.\n\nhttps://reviewboard.mozilla.org/r/247024/#review253768", "author": "continuation@gmail.com", "id": 13372566, "time": "2018-05-29T21:41:38Z"}, {"text": "Comment on attachment 8980836\nBug 1464548: Part 2b - Don't delete properties before redefining them, because deleting properties kills JIT performance.\n\nhttps://reviewboard.mozilla.org/r/247026/#review253784\n\nI'm not too familiar with this, but it looks okay to me.\n\n::: js/xpconnect/loader/XPCOMUtils.jsm:193\n(Diff revision 1)\n>     *        A function that returns what the getter should return.  This will\n>     *        only ever be called once.\n>     */\n>    defineLazyGetter: function XPCU_defineLazyGetter(aObject, aName, aLambda)\n>    {\n> +    let redefining = false;\n\nI guess this could create an additional closure but hopefully that doesn't matter.\n\n::: js/xpconnect/loader/XPCOMUtils.jsm:235\n(Diff revision 1)\n> -          }\n>            Services.scriptloader.loadSubScript(aResource, aObject);\n>            return aObject[name];\n>          },\n> +        set(value) {\n> +          redefine(aObject, name, value);\n\nSo is the idea here that loadSubScript will hit this new setter and thus replace the property without triggering the proxy?", "author": "continuation@gmail.com", "id": 13372906, "time": "2018-05-29T23:17:01Z"}, {"text": "Comment on attachment 8980838\nBug 1464548: Part 3 - Update callers to use defineLazyGlobalGetters.\n\nhttps://reviewboard.mozilla.org/r/247030/#review253812\n\nYou should post about this in firefox-dev. It seems like something handy that anybody interested in load time would like to know about. I know at least Felipe is looking at content process load time.\n\nDid you just change everything, or only places where you checked that the property wasn't obviously used at the top level, or what?", "author": "continuation@gmail.com", "id": 13372931, "time": "2018-05-29T23:29:42Z"}, {"text": "Comment on attachment 8980838\nBug 1464548: Part 3 - Update callers to use defineLazyGlobalGetters.\n\nhttps://reviewboard.mozilla.org/r/247030/#review253812\n\nI changed pretty much everything outside of tests, double-checked to make sure everything was sane, and then added some logging to make sure we didn't trigger any of the getters in the content process in a normal run.\n\nI think I might have left a couple that seemed OK without lazy getters.", "author": "kmaglione+bmo@mozilla.com", "id": 13372945, "time": "2018-05-29T23:36:59Z"}, {"text": "Comment on attachment 8980837\nBug 1464548: Part 2 - Add ESLint support for defineLazyGlobalGetters.\n\nhttps://reviewboard.mozilla.org/r/247028/#review253968\n\nThanks, r=Standard. \n\nJust to note, it has been my suspicion for a while that at least some of the current importGlobalProperties are unnecessary. Proving that is hard outside the jsm scope though (xref bug 1415483). At least this bug will help remove any harm they are doing.", "author": "standard8@mozilla.com", "id": 13373802, "time": "2018-05-30T09:35:17Z"}, {"text": "(In reply to Mark Banner (:standard8) from comment #9)\n> Just to note, it has been my suspicion for a while that at least some of the\n> current importGlobalProperties are unnecessary. Proving that is hard outside\n> the jsm scope though (xref bug 1415483). At least this bug will help remove\n> any harm they are doing.\n\nI actually found a bunch of unnecessary uses when I added this rule, since it turned the unused imports into errors.", "author": "kmaglione+bmo@mozilla.com", "id": 13395158, "time": "2018-06-07T23:11:09Z"}, {"text": "https://hg.mozilla.org/integration/mozilla-inbound/rev/f738942056e19cbe90efdd8a455e149008ef2deb\nBug 1464548: Part 1a - Add defineLazyGlobalGetters helper. r=mccr8\n\nhttps://hg.mozilla.org/integration/mozilla-inbound/rev/4a8cd93316d6785a593b204bc204d6004449d76a\nBug 1464548: Part 1b - Don't delete properties before redefining them, because deleting properties kills JIT performance. r=mccr8\n\nhttps://hg.mozilla.org/integration/mozilla-inbound/rev/a6e7bfa38103efc76635dfd8d4ecd6bf51a6c590\nBug 1464548: Part 2 - Add ESLint support for defineLazyGlobalGetters. r=standard8\n\nhttps://hg.mozilla.org/integration/mozilla-inbound/rev/22daf991f7b705c6849c5597f9794f1ac8f86a8e\nBug 1464548: Part 3 - Update callers to use defineLazyGlobalGetters. r=mccr8", "author": "kmaglione+bmo@mozilla.com", "id": 13395275, "time": "2018-06-08T00:33:48Z"}, {"text": "https://hg.mozilla.org/integration/mozilla-inbound/rev/5b08fd277ce5f750fbec6aaa239f3c7c9806e22a\nBug 1464548: Fix linux32 xpcshell bustage. r=bustage", "author": "kmaglione+bmo@mozilla.com", "id": 13395324, "time": "2018-06-08T01:25:38Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/f738942056e1\nhttps://hg.mozilla.org/mozilla-central/rev/4a8cd93316d6\nhttps://hg.mozilla.org/mozilla-central/rev/a6e7bfa38103\nhttps://hg.mozilla.org/mozilla-central/rev/22daf991f7b7\nhttps://hg.mozilla.org/mozilla-central/rev/5b08fd277ce5", "author": "aiakab@mozilla.com", "id": 13395818, "time": "2018-06-08T09:59:22Z"}, {"text": "Commit pushed to master at https://github.com/mozilla/activity-stream\n\nhttps://github.com/mozilla/activity-stream/commit/0cf21c41e96d81cfa143b7da96a9959f8e4c4abf\nchore(mc): Port Bug 1464548: Part 3 - Update callers to use defineLazyGlobalGetters. r=mccr8\nSwitched to warning eslint no-undef because https://hg.mozilla.org/mozilla-central/rev/a6e7bfa38103 will be available in something newer than 0.13.1.", "author": "mozilla+bugcloser@davedash.com", "id": 13396935, "time": "2018-06-08T18:40:54Z"}], "id": 1464548, "priority": "--", "cc": ["bugzilla-mozilla@dorando.at", "continuation@gmail.com", "felipc@gmail.com", "standard8@mozilla.com"], "cf_crash_signature": "", "version": "unspecified", "is_cc_accessible": true, "cf_tracking_firefox_esr52": "---", "see_also": [], "cf_tracking_thunderbird_esr60": "---", "cf_platform_rel": "---", "product": "Core", "cf_fx_iteration": "---", "blocks": [1436250], "qa_contact": "", "creation_time": "2018-05-25T23:58:53Z", "cf_status_firefox_esr52": "---", "component": "XPConnect", "assigned_to_detail": {"email": "kmaglione+bmo@mozilla.com", "id": 106098, "name": "kmaglione+bmo@mozilla.com", "real_name": "Kris Maglione [:kmag]"}, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "fixed", "cf_status_firefox61": "---", "cf_status_firefox60": "---", "target_milestone": "mozilla62", "cf_rank": null, "cf_qa_whiteboard": "", "severity": "normal", "groups": [], "cf_status_thunderbird_esr52": "---", "url": "", "cf_status_thunderbird_esr60": "---", "creator_detail": {"email": "kmaglione+bmo@mozilla.com", "id": 106098, "name": "kmaglione+bmo@mozilla.com", "real_name": "Kris Maglione [:kmag]"}, "whiteboard": "", "mentors": [], "summary": "Add lazy version of importGlobalProperties", "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "last_change_time": "2018-06-08T18:40:54Z", "assigned_to": "kmaglione+bmo@mozilla.com", "is_open": false, "history": [{"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8980835, "added": "review?(continuation@gmail.com)"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8980836, "added": "review?(continuation@gmail.com)"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8980837, "added": "review?(standard8@mozilla.com)"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8980838, "added": "review?(continuation@gmail.com)"}, {"removed": "", "field_name": "cc", "added": "continuation@gmail.com, standard8@mozilla.com"}], "who": "kmaglione+bmo@mozilla.com", "when": "2018-05-26T05:34:37Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(continuation@gmail.com)", "attachment_id": 8980835, "added": "review+"}], "who": "continuation@gmail.com", "when": "2018-05-29T21:41:38Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(continuation@gmail.com)", "attachment_id": 8980836, "added": "review+"}], "who": "continuation@gmail.com", "when": "2018-05-29T23:17:01Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "felipc@gmail.com"}], "who": "continuation@gmail.com", "when": "2018-05-29T23:21:08Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(continuation@gmail.com)", "attachment_id": 8980838, "added": "review+"}], "who": "continuation@gmail.com", "when": "2018-05-29T23:29:42Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(standard8@mozilla.com)", "attachment_id": 8980837, "added": "review+"}], "who": "standard8@mozilla.com", "when": "2018-05-30T09:35:17Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "bugzilla-mozilla@dorando.at"}], "who": "bugzilla-mozilla@dorando.at", "when": "2018-05-31T20:33:10Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla62"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2018-06-08 09:59:22"}, {"removed": "---", "field_name": "cf_status_firefox62", "added": "fixed"}], "who": "aiakab@mozilla.com", "when": "2018-06-08T09:59:22Z"}], "resolution": "FIXED", "op_sys": "Unspecified", "cf_fx_points": "---", "cf_blocking_fennec": "---"}