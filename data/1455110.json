{"status": "RESOLVED", "cf_tracking_firefox60": "+", "cf_tracking_firefox61": "---", "classification": "Client Software", "creator": "aklotz@mozilla.com", "cc": ["aklotz@mozilla.com", "felipc@gmail.com", "gijskruitbosch+bugs@gmail.com", "jcristau@mozilla.com", "jmathies@mozilla.com", "ksteuber@mozilla.com", "philringnalda@gmail.com"], "depends_on": [], "creation_time": "2018-04-18T20:43:54Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "cf_status_firefox59": "unaffected", "keywords": ["csectype-bounds", "sec-moderate"], "summary": "PolicyHasRegValue passing incorrect size to RegQueryValueExW", "id": 1455110, "attachments": [{"creator": "aklotz@mozilla.com", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2018-04-19T16:59:35Z", "type_id": 748, "creation_date": "2018-04-18T20:55:51Z", "id": 1745872, "setter": "jmathies@mozilla.com"}, {"status": "+", "name": "approval-mozilla-beta", "modification_date": "2018-04-25T01:11:39Z", "type_id": 721, "creation_date": "2018-04-24T17:01:11Z", "id": 1748368, "setter": "lhenry@mozilla.com"}], "content_type": "text/plain", "id": 8969066}], "assigned_to_detail": {"email": "aklotz@mozilla.com", "id": 454100, "name": "aklotz@mozilla.com", "real_name": "Aaron Klotz [:aklotz]"}, "severity": "normal", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 11, "comments": [{"text": "https://searchfox.org/mozilla-central/source/toolkit/xre/nsAppRunner.cpp#3174\n\n> DWORD len = sizeof(aValue);\n\naValue is a DWORD*, when we should be passing sizeof(DWORD).\n\nOn 64-bit, this could be bad if there is malformed data in the registry.", "author": "aklotz@mozilla.com", "id": 13216694, "time": "2018-04-18T20:43:54Z"}, {"text": "Created attachment 8969066\ns/RegQueryValueEx/RegGetValue/\n\nIn addition to fixing the size, I think we're better off to use RegGetValue, as it does additional validation on the type of the registry value.\n\nIt also gives us good cover for landing this.", "author": "aklotz@mozilla.com", "id": 13216731, "time": "2018-04-18T20:55:51Z"}, {"text": "Comment on attachment 8969066\ns/RegQueryValueEx/RegGetValue/\n\nReview of attachment 8969066:\n-----------------------------------------------------------------\n\ngah, did I approve this?\n\nDWORD len = sizeof(aValue);", "author": "jmathies@mozilla.com", "id": 13219084, "time": "2018-04-19T16:59:35Z"}, {"text": "Comment on attachment 8969066\ns/RegQueryValueEx/RegGetValue/\n\n[Security approval request comment]\nHow easily could an exploit be constructed based on the patch?\nPretty difficult I would think, as it would require editing the Windows registry on the host machine before running Firefox.\n\nDo comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?\nNo. The comment refers to replacing the API used and omits the actual security problem.\n\nWhich older supported branches are affected by this flaw?\n60 beta, 61 nightly.\n\nIf not all supported branches, which bug introduced the flaw?\nbug 1440573\n\nDo you have backports for the affected branches? If not, how different, hard to create, and risky will they be?\nThis patch should be a trivial, low risk uplift to beta.\n\nHow likely is this patch to cause regressions; how much testing does it need?\nUnlikely. It just uses a newer API for accessing registry values.", "author": "aklotz@mozilla.com", "id": 13222194, "time": "2018-04-20T18:31:58Z"}, {"text": "Comment on attachment 8969066\ns/RegQueryValueEx/RegGetValue/\n\nAs a sec-moderate bug, this doesn't need sec-approval to go in. You can just check it into trunk. We only require it for sec-critical and sec-high rated security bugs (and we need bugs to get ratings) that affect more than trunk.\n\nhttps://wiki.mozilla.org/Security/Bug_Approval_Process\n\nSo you're good to go!", "author": "abillings@mozilla.com", "id": 13222279, "time": "2018-04-20T19:15:49Z"}, {"text": "https://hg.mozilla.org/integration/mozilla-inbound/rev/45c6f888c2acabcc8076ce8220e0993f2aee88df\nBug 1455110: Replace RegOpenKeyEx/RegQueryValueEx with RegGetValue; r=jimm", "author": "aklotz@mozilla.com", "id": 13228028, "time": "2018-04-23T22:52:42Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/45c6f888c2acabcc8076ce8220e0993f2aee88df", "author": "philringnalda@gmail.com", "id": 13228591, "time": "2018-04-24T04:57:01Z"}, {"text": "Please request beta uplift when you get a chance so we don't ship this.", "author": "jcristau@mozilla.com", "id": 13228797, "time": "2018-04-24T07:33:44Z"}, {"text": "Comment on attachment 8969066\ns/RegQueryValueEx/RegGetValue/\n\nApproval Request Comment\n[Feature/Bug causing the regression]: bug 1440573\n[User impact if declined]: Potential security issue\n[Is this code covered by automated tests?]: Yes\n[Has the fix been verified in Nightly?]: Yes\n[Needs manual test from QE? If yes, steps to reproduce]: No\n[List of other uplifts needed for the feature/fix]: None\n[Is the change risky?]: No\n[Why is the change risky/not risky?]: Simple change\n[String changes made/needed]: None", "author": "aklotz@mozilla.com", "id": 13230153, "time": "2018-04-24T17:01:11Z"}, {"text": "Comment on attachment 8969066\ns/RegQueryValueEx/RegGetValue/\n\nFix for a regression in 60, let's uplift for beta 16.", "author": "lhenry@mozilla.com", "id": 13231525, "time": "2018-04-25T01:11:39Z"}, {"text": "https://hg.mozilla.org/releases/mozilla-beta/rev/f2d63307f232", "author": "aryx.bugmail@gmx-topmail.de", "id": 13231737, "time": "2018-04-25T06:18:14Z"}], "cf_last_resolved": "2018-04-24T04:57:01Z", "priority": "--", "mentors_detail": [], "cf_crash_signature": "", "version": "unspecified", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox62": "---", "cf_platform_rel": "---", "product": "Firefox", "cf_status_firefox_esr52": "unaffected", "blocks": [1440573], "qa_contact": "", "see_also": [], "cf_fx_iteration": "---", "component": "Enterprise Policies", "votes": 0, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "---", "cf_status_firefox61": "fixed", "cf_status_firefox60": "fixed", "target_milestone": "Firefox 61", "is_cc_accessible": true, "cf_rank": null, "groups": [], "url": "", "creator_detail": {"email": "aklotz@mozilla.com", "id": 454100, "name": "aklotz@mozilla.com", "real_name": "Aaron Klotz [:aklotz]"}, "whiteboard": "", "mentors": [], "cc_detail": [{"email": "aklotz@mozilla.com", "id": 454100, "name": "aklotz@mozilla.com", "real_name": "Aaron Klotz [:aklotz]"}, {"email": "felipc@gmail.com", "id": 208747, "name": "felipc@gmail.com", "real_name": ":Felipe Gomes (needinfo me!)"}, {"email": "gijskruitbosch+bugs@gmail.com", "id": 159069, "name": "gijskruitbosch+bugs@gmail.com", "real_name": ":Gijs (he/him)"}, {"email": "jcristau@mozilla.com", "id": 580382, "name": "jcristau@mozilla.com", "real_name": "Julien Cristau [:jcristau]"}, {"email": "jmathies@mozilla.com", "id": 279663, "name": "jmathies@mozilla.com", "real_name": "Jim Mathies [:jimm]"}, {"email": "ksteuber@mozilla.com", "id": 563604, "name": "ksteuber@mozilla.com", "real_name": "Kirk Steuber [:bytesized]"}, {"email": "philringnalda@gmail.com", "id": 135518, "name": "philringnalda@gmail.com", "real_name": "Phil Ringnalda (:philor)"}], "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "last_change_time": "2018-05-10T00:01:05Z", "cf_status_firefox_esr60": "---", "assigned_to": "aklotz@mozilla.com", "is_open": false, "resolution": "FIXED", "op_sys": "Windows", "cf_fx_points": "---", "history": [{"changes": [{"removed": "", "field_name": "cc", "added": "aklotz@mozilla.com"}], "who": "aklotz@mozilla.com", "when": "2018-04-18T20:44:09Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "jmathies@mozilla.com"}], "who": "aklotz@mozilla.com", "when": "2018-04-18T20:54:11Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "ASSIGNED"}, {"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "aklotz@mozilla.com"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8969066, "added": "review?(jmathies@mozilla.com)"}], "who": "aklotz@mozilla.com", "when": "2018-04-18T20:55:51Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "felipc@gmail.com, gijskruitbosch+bugs@gmail.com, ksteuber@mozilla.com"}], "who": "gijskruitbosch+bugs@gmail.com", "when": "2018-04-18T20:56:44Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "csectype-bounds, sec-moderate"}], "who": "dveditz@mozilla.com", "when": "2018-04-19T00:06:37Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "jcristau@mozilla.com"}, {"removed": "?", "field_name": "cf_tracking_firefox60", "added": "+"}], "who": "jcristau@mozilla.com", "when": "2018-04-19T09:33:07Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(jmathies@mozilla.com)", "attachment_id": 8969066, "added": "review+"}], "who": "jmathies@mozilla.com", "when": "2018-04-19T16:59:35Z"}, {"changes": [{"removed": "---", "field_name": "cf_status_firefox_esr52", "added": "unaffected"}, {"removed": "---", "field_name": "cf_status_firefox59", "added": "unaffected"}], "who": "jcristau@mozilla.com", "when": "2018-04-20T11:57:25Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8969066, "added": "sec-approval?"}], "who": "aklotz@mozilla.com", "when": "2018-04-20T18:31:58Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "sec-approval?", "attachment_id": 8969066, "added": ""}], "who": "abillings@mozilla.com", "when": "2018-04-20T19:15:49Z"}, {"changes": [{"removed": "ASSIGNED", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "cc", "added": "philringnalda@gmail.com"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "Firefox 61"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2018-04-24 04:57:01"}, {"removed": "affected", "field_name": "cf_status_firefox61", "added": "fixed"}], "who": "philringnalda@gmail.com", "when": "2018-04-24T04:57:01Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(aklotz@mozilla.com)"}], "who": "jcristau@mozilla.com", "when": "2018-04-24T07:33:44Z"}, {"changes": [{"removed": "needinfo?(aklotz@mozilla.com)", "field_name": "flagtypes.name", "added": ""}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8969066, "added": "approval-mozilla-beta?"}], "who": "aklotz@mozilla.com", "when": "2018-04-24T17:01:11Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "approval-mozilla-beta?", "attachment_id": 8969066, "added": "approval-mozilla-beta+"}], "who": "lhenry@mozilla.com", "when": "2018-04-25T01:11:39Z"}, {"changes": [{"removed": "affected", "field_name": "cf_status_firefox60", "added": "fixed"}], "who": "aryx.bugmail@gmx-topmail.de", "when": "2018-04-25T06:18:14Z"}, {"changes": [{"removed": "firefox-core-security", "field_name": "groups", "added": "core-security-release"}], "who": "dveditz@mozilla.com", "when": "2018-05-09T23:40:31Z"}, {"changes": [{"removed": "core-security-release", "field_name": "groups", "added": ""}], "who": "dveditz@mozilla.com", "when": "2018-05-10T00:01:05Z"}]}