{"cf_tracking_thunderbird_esr52": "---", "cf_status_firefox39": "fixed", "cf_tracking_firefox60": "---", "attachments": [{"creator": "bzbarsky@mit.edu", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2015-03-26T17:57:24Z", "type_id": 4, "creation_date": "2015-03-26T17:52:22Z", "id": 1132402, "setter": "luke@mozilla.com"}], "content_type": "text/plain", "id": 8583940}], "classification": "Components", "creator": "choller@mozilla.com", "cc": ["bzbarsky@mit.edu", "choller@mozilla.com", "fuzzing@mozilla.com", "jruderman@gmail.com", "luke@mozilla.com", "nth10sd@gmail.com"], "depends_on": [], "creation_time": "2015-03-26T15:11:07Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "x86_64", "cf_status_firefox58": "---", "cf_status_firefox59": "---", "keywords": ["assertion", "regression", "testcase"], "summary": "Assertion failure: !realParent || realParent == cx->global() || realParent->isUnqualifiedVarObj(), at js/src/jsfun.cpp:2145", "id": 1147907, "assigned_to_detail": {"email": "bzbarsky@mit.edu", "id": 20209, "name": "bzbarsky@mit.edu", "real_name": "Boris Zbarsky [:bz] (no decent commit message means r-)"}, "severity": "critical", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "assigned_to": "bzbarsky@mit.edu", "comment_count": 7, "comments": [{"text": "The following testcase crashes on mozilla-central revision cc0950b7a369 (build with --enable-optimize --enable-posix-nspr-emulation --enable-valgrind --enable-gczeal --disable-tests --enable-debug, run with --fuzzing-safe --thread-count=2):\n\nvar evalInFrame = (function (global) {\n  var dbgGlobal = newGlobal();\n  var dbg = new dbgGlobal.Debugger();\n  return function evalInFrame(upCount, code) {\n    dbg.addDebuggee(global);\n    var frame = dbg.getNewestFrame().older;\n    var completion = frame.eval(code);\n  };\n})(this);\nvar x = 5;\nlet (x = eval(\"x++\")) {\n  evalInFrame(0, (\"for (var x = 0; x < 3; ++x) { (function(){})() } \"))\n}\n\n\n\nBacktrace:\n\nProgram received signal SIGSEGV, Segmentation fault.\n0x0000000000b1879d in js::CloneFunctionObject (cx=cx@entry=0x7ffff691b4e0, fun=..., fun@entry=..., parent=..., parent@entry=..., allocKind=js::gc::OBJECT4_BACKGROUND, newKindArg=newKindArg@entry=js::GenericObject, proto=..., proto@entry=...) at js/src/jsfun.cpp:2144\n#0  0x0000000000b1879d in js::CloneFunctionObject (cx=cx@entry=0x7ffff691b4e0, fun=..., fun@entry=..., parent=..., parent@entry=..., allocKind=js::gc::OBJECT4_BACKGROUND, newKindArg=newKindArg@entry=js::GenericObject, proto=..., proto@entry=...) at js/src/jsfun.cpp:2144\n#1  0x00000000006a6b11 in js::CloneFunctionObjectIfNotSingleton (cx=0x7ffff691b4e0, fun=..., parent=..., proto=..., newKind=js::GenericObject) at js/src/jsfuninlines.h:88\n#2  0x000000000065a739 in js::Lambda (cx=cx@entry=0x7ffff691b4e0, fun=fun@entry=..., parent=...) at js/src/vm/Interpreter.cpp:3788\n#3  0x000000000066772d in Interpret (cx=cx@entry=0x7ffff691b4e0, state=...) at js/src/vm/Interpreter.cpp:3089\n#4  0x0000000000671c38 in js::RunScript (cx=cx@entry=0x7ffff691b4e0, state=...) at js/src/vm/Interpreter.cpp:452\n#5  0x0000000000678ca6 in js::ExecuteKernel (cx=cx@entry=0x7ffff691b4e0, script=..., script@entry=..., scopeChainArg=..., thisv=..., type=js::EXECUTE_DEBUG, evalInFrame=..., result=result@entry=0x7fffffffb110) at js/src/vm/Interpreter.cpp:660\n#6  0x00000000006797ec in EvaluateInEnv (rval=..., lineno=<optimized out>, filename=<optimized out>, pc=<optimized out>, frame=..., thisv=..., env=..., cx=0x7ffff691b4e0, chars=...) at js/src/vm/Debugger.cpp:6166\n#7  DebuggerGenericEval (cx=cx@entry=0x7ffff691b4e0, fullMethodName=fullMethodName@entry=0xd569fe \"Debugger.Frame.prototype.eval\", code=..., evalWithBindings=evalWithBindings@entry=EvalWithDefaultBindings, bindings=..., options=..., vp=..., dbg=dbg@entry=0x7ffff695d000, scope=..., iter=iter@entry=0x7fffffffb478) at js/src/vm/Debugger.cpp:6318\n#8  0x000000000067ab52 in DebuggerFrame_eval (cx=0x7ffff691b4e0, argc=<optimized out>, vp=<optimized out>) at js/src/vm/Debugger.cpp:6332\n#9  0x0000000000682d82 in js::CallJSNative (cx=0x7ffff691b4e0, native=0x67a8d0 <DebuggerFrame_eval(JSContext*, unsigned int, JS::Value*)>, args=...) at js/src/jscntxtinlines.h:235\n#10 0x0000000000671ed3 in js::Invoke (cx=cx@entry=0x7ffff691b4e0, args=..., construct=construct@entry=js::NO_CONSTRUCT) at js/src/vm/Interpreter.cpp:502\n#11 0x0000000000673993 in js::Invoke (cx=cx@entry=0x7ffff691b4e0, thisv=..., fval=..., argc=<optimized out>, argv=0x7ffff53e3158, rval=...) at js/src/vm/Interpreter.cpp:558\n#12 0x0000000000b558bb in js::DirectProxyHandler::call (this=this@entry=0x1a07b20 <js::CrossCompartmentWrapper::singleton>, cx=cx@entry=0x7ffff691b4e0, proxy=..., proxy@entry=..., args=...) at js/src/proxy/DirectProxyHandler.cpp:77\n#13 0x0000000000b5c172 in js::CrossCompartmentWrapper::call (this=0x1a07b20 <js::CrossCompartmentWrapper::singleton>, cx=0x7ffff691b4e0, wrapper=..., args=...) at js/src/proxy/CrossCompartmentWrapper.cpp:288\n#14 0x0000000000b677f2 in js::Proxy::call (cx=cx@entry=0x7ffff691b4e0, proxy=proxy@entry=..., args=...) at js/src/proxy/Proxy.cpp:391\n#15 0x0000000000b67872 in js::proxy_Call (cx=0x7ffff691b4e0, argc=<optimized out>, vp=<optimized out>) at js/src/proxy/Proxy.cpp:703\n#16 0x0000000000682d82 in js::CallJSNative (cx=0x7ffff691b4e0, native=0xb67810 <js::proxy_Call(JSContext*, unsigned int, JS::Value*)>, args=...) at js/src/jscntxtinlines.h:235\n#17 0x0000000000672181 in js::Invoke (cx=cx@entry=0x7ffff691b4e0, args=..., construct=construct@entry=js::NO_CONSTRUCT) at js/src/vm/Interpreter.cpp:495\n#18 0x000000000066c59d in Interpret (cx=cx@entry=0x7ffff691b4e0, state=...) at js/src/vm/Interpreter.cpp:2617\n#19 0x0000000000671c38 in js::RunScript (cx=cx@entry=0x7ffff691b4e0, state=...) at js/src/vm/Interpreter.cpp:452\n#20 0x0000000000678ca6 in js::ExecuteKernel (cx=cx@entry=0x7ffff691b4e0, script=..., script@entry=..., scopeChainArg=..., thisv=..., type=type@entry=js::EXECUTE_GLOBAL, evalInFrame=..., evalInFrame@entry=..., result=result@entry=0x0) at js/src/vm/Interpreter.cpp:660\n#21 0x000000000067ad70 in js::Execute (cx=cx@entry=0x7ffff691b4e0, script=script@entry=..., scopeChainArg=..., rval=rval@entry=0x0) at js/src/vm/Interpreter.cpp:703\n#22 0x0000000000a595be in ExecuteScript (cx=cx@entry=0x7ffff691b4e0, obj=..., scriptArg=..., rval=rval@entry=0x0) at js/src/jsapi.cpp:4107\n#23 0x0000000000a5973b in JS_ExecuteScript (cx=cx@entry=0x7ffff691b4e0, scriptArg=..., scriptArg@entry=...) at js/src/jsapi.cpp:4129\n#24 0x000000000042531b in RunFile (compileOnly=false, file=0x7ffff699b800, filename=0x7fffffffe07e \"min.js\", cx=0x7ffff691b4e0) at js/src/shell/js.cpp:466\n#25 Process (cx=cx@entry=0x7ffff691b4e0, filename=0x7fffffffe07e \"min.js\", forceTTY=forceTTY@entry=false) at js/src/shell/js.cpp:597\n#26 0x0000000000472b22 in ProcessArgs (op=0x7fffffffdb50, cx=0x7ffff691b4e0) at js/src/shell/js.cpp:5754\n#27 Shell (envp=<optimized out>, op=0x7fffffffdb50, cx=0x7ffff691b4e0) at js/src/shell/js.cpp:6020\n#28 main (argc=<optimized out>, argv=<optimized out>, envp=<optimized out>) at js/src/shell/js.cpp:6362\nrax\t0x0\t0\nrbx\t0x7fffffffa720\t140737488332576\nrcx\t0x7ffff6cb2f4d\t140737333899085\nrdx\t0x0\t0\nrsi\t0x7ffff6f86a80\t140737336863360\nrdi\t0x7ffff6f85180\t140737336856960\nrbp\t0x7fffffffa7b0\t140737488332720\nrsp\t0x7fffffffa6c0\t140737488332480\nr8\t0x7ffff7fe8740\t140737354041152\nr9\t0x6372732f736a2f6c\t7165916604736876396\nr10\t0x7fffffffa450\t140737488331856\nr11\t0x7ffff6c3a940\t140737333406016\nr12\t0x19c86e0\t27035360\nr13\t0x19aaf20\t26914592\nr14\t0x7ffff691b4f8\t140737330132216\nr15\t0x7ffff691b4e0\t140737330132192\nrip\t0xb1879d <js::CloneFunctionObject(JSContext*, JS::Handle<JSFunction*>, JS::Handle<JSObject*>, js::gc::AllocKind, js::NewObjectKind, JS::Handle<JSObject*>)+461>\n=> 0xb1879d <js::CloneFunctionObject(JSContext*, JS::Handle<JSFunction*>, JS::Handle<JSObject*>, js::gc::AllocKind, js::NewObjectKind, JS::Handle<JSObject*>)+461>:\tmovl   $0x861,0x0\n   0xb187a8 <js::CloneFunctionObject(JSContext*, JS::Handle<JSFunction*>, JS::Handle<JSObject*>, js::gc::AllocKind, js::NewObjectKind, JS::Handle<JSObject*>)+472>:\tcallq  0x423050 <abort@plt>", "author": "choller@mozilla.com", "id": 10081597, "time": "2015-03-26T15:11:07Z"}, {"text": "JSBugMon: Bisection requested, result:\n=== Treeherder Build Bisection Results by autoBisect ===\n\nThe \"good\" changeset has the timestamp \"20150313223419\" and the hash \"94fa4a005c33\".\nThe \"bad\" changeset has the timestamp \"20150313223819\" and the hash \"c0a7bfc8dfae\".\n\nLikely regression window: https://hg.mozilla.org/integration/mozilla-inbound/pushloghtml?fromchange=94fa4a005c33&tochange=c0a7bfc8dfae", "author": "choller@mozilla.com", "id": 10082309, "time": "2015-03-26T17:14:51Z"}, {"text": "Alright.  So realParent is ending up as a Proxy.  In particular, a DebugScopeProxy.\n\nWe should probably loosen up the assert accordingly.  Note also bug 1143794.", "author": "bzbarsky@mit.edu", "id": 10082506, "time": "2015-03-26T17:47:15Z"}, {"text": "Created attachment 8583940\nRelax our realParent asserts in CloneFunction a bit, pending a proper fix for bug 1143794", "author": "bzbarsky@mit.edu", "id": 10082541, "time": "2015-03-26T17:52:22Z"}, {"text": "Comment on attachment 8583940\nRelax our realParent asserts in CloneFunction a bit, pending a proper fix for bug 1143794\n\nReview of attachment 8583940:\n-----------------------------------------------------------------\n\n::: js/src/jsfun.cpp\n@@ +2050,5 @@\n>  #ifdef DEBUG\n>      RootedObject nonScopeParent(cx, SkipScopeParent(enclosingDynamicScope));\n> +    // We'd like to assert that nonScopeParent is null-or-global, but\n> +    // js::ExecuteInGlobalAndReturnScope and debugger eval bits mess that up.\n> +    // Assert that it's one of those or a debug scope prosxy or the unqualified\n\ns/prosxy/proxy/", "author": "luke@mozilla.com", "id": 10082575, "time": "2015-03-26T17:57:24Z"}, {"text": "https://hg.mozilla.org/integration/mozilla-inbound/rev/f0c08ce4f555", "author": "bzbarsky@mit.edu", "id": 10085903, "time": "2015-03-27T03:56:35Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/f0c08ce4f555", "author": "ryanvm@gmail.com", "id": 10088203, "time": "2015-03-27T16:27:24Z"}], "cf_last_resolved": "2015-03-27T16:27:24Z", "priority": "--", "mentors_detail": [], "cf_crash_signature": "", "version": "Trunk", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox59": "---", "last_change_time": "2015-03-27T16:27:24Z", "cf_platform_rel": "---", "product": "Core", "cf_status_firefox_esr52": "---", "blocks": [676763], "qa_contact": "", "see_also": [], "cf_fx_iteration": "---", "component": "JavaScript Engine", "votes": 0, "groups": [], "cf_status_firefox60": "---", "target_milestone": "mozilla39", "is_cc_accessible": true, "status": "RESOLVED", "cf_status_thunderbird_esr52": "---", "url": "", "creator_detail": {"email": "choller@mozilla.com", "id": 395101, "name": "choller@mozilla.com", "real_name": "Christian Holler (:decoder)"}, "whiteboard": "[jsbugmon:update]", "mentors": [], "cc_detail": [{"email": "bzbarsky@mit.edu", "id": 20209, "name": "bzbarsky@mit.edu", "real_name": "Boris Zbarsky [:bz] (no decent commit message means r-)"}, {"email": "choller@mozilla.com", "id": 395101, "name": "choller@mozilla.com", "real_name": "Christian Holler (:decoder)"}, {"email": "fuzzing@mozilla.com", "id": 469204, "name": "fuzzing@mozilla.com", "real_name": "Fuzzing Team"}, {"email": "jruderman@gmail.com", "id": 11608, "name": "jruderman@gmail.com", "real_name": "Jesse Ruderman"}, {"email": "luke@mozilla.com", "id": 347312, "name": "luke@mozilla.com", "real_name": "Luke Wagner [:luke]"}, {"email": "nth10sd@gmail.com", "id": 132034, "name": "nth10sd@gmail.com", "real_name": "Gary Kwong [:gkw] [:nth10sd]"}], "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [{"status": "+", "name": "in-testsuite", "modification_date": "2015-03-27T16:27:24Z", "type_id": 37, "creation_date": "2015-03-27T16:27:24Z", "id": 1133471, "setter": "ryanvm@gmail.com"}], "cf_tracking_firefox58": "---", "cf_rank": null, "is_open": false, "history": [{"changes": [{"removed": "[jsbugmon:update,bisect]", "field_name": "whiteboard", "added": "[jsbugmon:update]"}], "who": "choller@mozilla.com", "when": "2015-03-26T17:14:49Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "bzbarsky@mit.edu"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(bzbarsky@mit.edu)"}], "who": "bbouvier@mozilla.com", "when": "2015-03-26T17:42:30Z"}, {"changes": [{"removed": "needinfo?(bzbarsky@mit.edu)", "field_name": "flagtypes.name", "added": ""}], "who": "bzbarsky@mit.edu", "when": "2015-03-26T17:47:15Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8583940, "added": "review?(luke@mozilla.com)"}, {"removed": "", "field_name": "cc", "added": "luke@mozilla.com"}], "who": "bzbarsky@mit.edu", "when": "2015-03-26T17:52:22Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "ASSIGNED"}, {"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "bzbarsky@mit.edu"}], "who": "bzbarsky@mit.edu", "when": "2015-03-26T17:52:25Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(luke@mozilla.com)", "attachment_id": 8583940, "added": "review+"}], "who": "luke@mozilla.com", "when": "2015-03-26T17:57:24Z"}, {"changes": [{"removed": "ASSIGNED", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla39"}, {"removed": "", "field_name": "flagtypes.name", "added": "in-testsuite+"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2015-03-27 09:27:24"}, {"removed": "affected", "field_name": "cf_status_firefox39", "added": "fixed"}], "who": "ryanvm@gmail.com", "when": "2015-03-27T16:27:24Z"}], "resolution": "FIXED", "op_sys": "Linux", "cf_fx_points": "---", "cf_blocking_fennec": "---"}