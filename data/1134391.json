{"cf_status_firefox39": "fixed", "cf_tracking_firefox60": "---", "attachments": [{"creator": "moz-ian@perix.co.uk", "is_obsolete": 1, "is_patch": 1, "flags": [], "content_type": "text/plain", "id": 8568054}, {"creator": "moz-ian@perix.co.uk", "is_obsolete": 1, "is_patch": 1, "flags": [], "content_type": "text/plain", "id": 8571677}, {"creator": "moz-ian@perix.co.uk", "is_obsolete": 1, "is_patch": 1, "flags": [{"status": "-", "name": "review", "modification_date": "2015-03-06T19:54:14Z", "type_id": 748, "creation_date": "2015-03-05T23:49:37Z", "id": 1115368, "setter": "mconley@mozilla.com"}], "content_type": "text/plain", "id": 8573592}, {"creator": "moz-ian@perix.co.uk", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2015-03-17T14:38:03Z", "type_id": 748, "creation_date": "2015-03-06T23:22:53Z", "id": 1116353, "setter": "mconley@mozilla.com"}], "content_type": "text/plain", "id": 8574192}], "classification": "Client Software", "creator": "moz-ian@perix.co.uk", "cc": ["brad@lassey.us", "mconley@mozilla.com"], "depends_on": [1133577], "creation_time": "2015-02-18T21:54:19Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "All", "cf_status_firefox58": "---", "cf_status_firefox59": "---", "keywords": [], "cf_tracking_e10s": "m8+", "summary": "[e10s] \"View Image/Video\" in remote browser causes unsafe CPOW usage warning", "id": 1134391, "assigned_to_detail": {"email": "moz-ian@perix.co.uk", "id": 237483, "name": "moz-ian@perix.co.uk", "real_name": "Ian Moody [:Kwan] (UTC+0)"}, "severity": "normal", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "assigned_to": "moz-ian@perix.co.uk", "comment_count": 10, "comments": [{"text": "+++ This bug was initially created as a clone of Bug #1133577 +++\n\nSTR:\n\n1) Visit a site with images, <canvas/>, or <video/>s on it in an e10s window\n2) Right-click on an image, <canvas/> or <video/>, and choose \"View Image/Video\"\n\nThis causes some \"unsafe CPOW usage\" warnings in the Browser Console.\n\nIn browser/base/content/nsContextMenu.js:\n\n  // Change current window to the URL of the image, video, or audio.\n  viewMedia: function(e) {\n    var viewURL;\n\n    if (this.onCanvas)\n      viewURL = this.target.toDataURL(); <-- Causes CPOW warning [canvas]\n    else {\n      viewURL = this.mediaURL;\n      urlSecurityCheck(viewURL,\n                       this.browser.contentPrincipal,\n                       Ci.nsIScriptSecurityManager.DISALLOW_SCRIPT);\n    }\n\n    var doc = this.target.ownerDocument; <-- Causes CPOW warning\n    openUILink(viewURL, e, { disallowInheritPrincipal: true,\n                             referrerURI: doc.documentURIObject }); <-- Causes CPOW warning\n  },\n\n\nin toolkit/modules/RemoteWebNavigation.jsm\n\n  loadURI: function(aURI, aLoadFlags, aReferrer, aPostData, aHeaders) {\n    if (aPostData || aHeaders)\n      throw Components.Exception(\"RemoteWebNavigation doesn't accept postdata or headers.\", Cr.NS_ERROR_INVALID_ARGS);\n\n    this._browser._contentTitle = \"\";\n    this._sendMessage(\"WebNavigation:LoadURI\", {\n      uri: aURI,\n      flags: aLoadFlags,\n      referrer: aReferrer ? aReferrer.spec : null <-- Causes CPOW warning\n    });\n  },\n\n\nwarning tagged [canvas] only occurs on a <canvas/>", "author": "moz-ian@perix.co.uk", "id": 9933160, "time": "2015-02-18T21:54:19Z"}, {"text": "Created attachment 8568054\nMake \"View Image/Media\" command use messages to avoid unsafe CPOW warnings\n\nRelies on the gContextMenuContentData.documentURI addition in bug 1133577.", "author": "moz-ian@perix.co.uk", "id": 9947616, "time": "2015-02-23T18:57:30Z"}, {"text": "Created attachment 8571677\nMake \"View Image/Media\" command use messages to avoid unsafe CPOW warnings\n\nUpdated for latest bug 1133577 patch", "author": "moz-ian@perix.co.uk", "id": 9976872, "time": "2015-03-03T00:48:18Z"}, {"text": "Created attachment 8573592\nMake \"View Image/Media\" command use messages to avoid unsafe CPOW warnings\n\nWell this is the next one in my queue, so this can go first.\n\ntoDataURL is a separate function so it can be reused for \"Save Image As...\"ing a canvas later.\nIs Cu.reportError the right thing to put for the promise rejection?", "author": "moz-ian@perix.co.uk", "id": 9993956, "time": "2015-03-05T23:49:37Z"}, {"text": "Comment on attachment 8573592\nMake \"View Image/Media\" command use messages to avoid unsafe CPOW warnings\n\nReview of attachment 8573592:\n-----------------------------------------------------------------\n\n::: browser/base/content/nsContextMenu.js\n@@ +1026,5 @@\n>    },\n>  \n> +  toDataURL: function(aTarget) {\n> +    let mm = this.browser.messageManager;\n> +    return new Promise(function(resolve, reject) {\n\nYou never use reject, so you can probably drop it.\n\n@@ +1027,5 @@\n>  \n> +  toDataURL: function(aTarget) {\n> +    let mm = this.browser.messageManager;\n> +    return new Promise(function(resolve, reject) {\n> +      mm.sendAsyncMessage(\"ContextMenu:ToDataURL\", {}, { aTarget });\n\nA DataURL can represent many things. Let's call this message:\n\nContextMenu:Canvas:ToDataURL\n\nand the function:\n\ncanvasToDataURL", "author": "mconley@mozilla.com", "id": 9998072, "time": "2015-03-06T19:54:14Z"}, {"text": "Created attachment 8574192\nMake \"View Image/Video\" command use messages to avoid unsafe CPOW warnings\n\n(In reply to Mike Conley (:mconley) - Needinfo me! from comment #4)\n> > +    return new Promise(function(resolve, reject) {\n> \n> You never use reject, so you can probably drop it.\nCool, done.\n\n> @@ +1027,5 @@\n> >  \n> > +  toDataURL: function(aTarget) {\n> > +    let mm = this.browser.messageManager;\n> > +    return new Promise(function(resolve, reject) {\n> > +      mm.sendAsyncMessage(\"ContextMenu:ToDataURL\", {}, { aTarget });\n> \n> A DataURL can represent many things. Let's call this message:\n> \n> ContextMenu:Canvas:ToDataURL\nDone.\n\n> and the function:\n> \n> canvasToDataURL\nDone, plus the _ prefixing as discussed on IRC.\n\nAnd reverted the argument name back to \"target\", so the patch actually works again, tested manually.", "author": "moz-ian@perix.co.uk", "id": 9999001, "time": "2015-03-06T23:22:53Z"}, {"text": "Comment on attachment 8574192\nMake \"View Image/Video\" command use messages to avoid unsafe CPOW warnings\n\nReview of attachment 8574192:\n-----------------------------------------------------------------\n\nLooks great! Thanks Ian!", "author": "mconley@mozilla.com", "id": 10039908, "time": "2015-03-17T14:38:03Z"}, {"text": "Try run at https://treeherder.mozilla.org/#/jobs?repo=try&revision=094396e39ebf\norange caused by the other patch for bug 1141186 and fixed in https://treeherder.mozilla.org/#/jobs?repo=try&revision=d06d6f239f24", "author": "moz-ian@perix.co.uk", "id": 10044395, "time": "2015-03-18T09:57:07Z"}, {"text": "https://hg.mozilla.org/integration/fx-team/rev/839427d11a62", "author": "ryanvm@gmail.com", "id": 10045592, "time": "2015-03-18T15:27:19Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/839427d11a62", "author": "kwierso@gmail.com", "id": 10048097, "time": "2015-03-18T22:40:17Z"}], "cf_last_resolved": "2015-03-18T22:40:17Z", "priority": "--", "mentors_detail": [], "cf_crash_signature": "", "version": "Trunk", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox59": "---", "last_change_time": "2015-03-18T22:40:17Z", "cf_platform_rel": "---", "product": "Firefox", "cf_status_firefox_esr52": "---", "blocks": [1109869, 1134424], "qa_contact": "", "see_also": [], "cf_fx_iteration": "---", "component": "Menus", "votes": 0, "groups": [], "cf_status_firefox60": "---", "target_milestone": "Firefox 39", "is_cc_accessible": true, "status": "RESOLVED", "url": "", "creator_detail": {"email": "moz-ian@perix.co.uk", "id": 237483, "name": "moz-ian@perix.co.uk", "real_name": "Ian Moody [:Kwan] (UTC+0)"}, "whiteboard": "", "mentors": [], "cc_detail": [{"email": "brad@lassey.us", "id": 181004, "name": "brad@lassey.us", "real_name": "Brad Lassey [:blassey] (use needinfo?)"}, {"email": "mconley@mozilla.com", "id": 403756, "name": "mconley@mozilla.com", "real_name": "Mike Conley (:mconley) (:\u2699\ufe0f) (Totally backlogged on reviews and needinfos)"}], "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "cf_tracking_firefox58": "---", "cf_rank": null, "is_open": false, "resolution": "FIXED", "op_sys": "All", "cf_fx_points": "---", "history": [{"changes": [{"removed": "?", "field_name": "cf_tracking_e10s", "added": "m8+"}], "who": "mconley@mozilla.com", "when": "2015-02-19T17:37:36Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "ASSIGNED"}, {"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "moz-ian@perix.co.uk"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8568054, "added": "review?(mconley@mozilla.com)"}], "who": "moz-ian@perix.co.uk", "when": "2015-02-23T18:57:30Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8568054, "added": "1"}, {"field_name": "flagtypes.name", "removed": "review?(mconley@mozilla.com)", "attachment_id": 8568054, "added": ""}], "who": "moz-ian@perix.co.uk", "when": "2015-03-03T00:48:18Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1133577"}], "who": "moz-ian@perix.co.uk", "when": "2015-03-03T00:49:20Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8571677, "added": "1"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8573592, "added": "review?(mconley@mozilla.com)"}], "who": "moz-ian@perix.co.uk", "when": "2015-03-05T23:49:37Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(mconley@mozilla.com)", "attachment_id": 8573592, "added": "review-"}], "who": "mconley@mozilla.com", "when": "2015-03-06T19:54:14Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8573592, "added": "1"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8574192, "added": "review?(mconley@mozilla.com)"}], "who": "moz-ian@perix.co.uk", "when": "2015-03-06T23:22:53Z"}, {"changes": [{"removed": "", "field_name": "blocks", "added": "1134424"}], "who": "moz-ian@perix.co.uk", "when": "2015-03-08T16:52:15Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(mconley@mozilla.com)", "attachment_id": 8574192, "added": "review+"}], "who": "mconley@mozilla.com", "when": "2015-03-17T14:38:03Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "checkin-needed"}], "who": "moz-ian@perix.co.uk", "when": "2015-03-18T09:57:07Z"}, {"changes": [{"removed": "checkin-needed", "field_name": "keywords", "added": ""}, {"removed": "", "field_name": "whiteboard", "added": "[fixed-in-fx-team]"}], "who": "ryanvm@gmail.com", "when": "2015-03-18T15:27:19Z"}, {"changes": [{"removed": "ASSIGNED", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "Firefox 39"}, {"removed": "[fixed-in-fx-team]", "field_name": "whiteboard", "added": ""}, {"removed": "", "field_name": "cf_last_resolved", "added": "2015-03-18 15:40:17"}, {"removed": "---", "field_name": "cf_status_firefox39", "added": "fixed"}], "who": "kwierso@gmail.com", "when": "2015-03-18T22:40:17Z"}]}