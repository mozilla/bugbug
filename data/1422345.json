{"cf_tracking_thunderbird_esr52": "---", "status": "NEW", "cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "cf_tracking_firefox62": "---", "creator": "jdiggs@igalia.com", "mentors_detail": [], "depends_on": [], "cf_status_firefox_esr60": "---", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "keywords": [], "cc_detail": [{"email": "gijskruitbosch+bugs@gmail.com", "id": 159069, "name": "gijskruitbosch+bugs@gmail.com", "real_name": ":Gijs (he/him)"}, {"email": "jteh@mozilla.com", "id": 219126, "name": "jteh@mozilla.com", "real_name": "James Teh [:Jamie]"}, {"email": "surkov.alexander@gmail.com", "id": 88369, "name": "surkov.alexander@gmail.com", "real_name": "alexander :surkov"}, {"email": "yzenevich@mozilla.com", "id": 458165, "name": "yzenevich@mozilla.com", "real_name": "Yura Zenevich [:yzen]"}], "cf_last_resolved": null, "attachments": [], "votes": 0, "classification": "Components", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 13, "comments": [{"text": "Steps to reproduce:\n1. Launch Firefox\n2. In the location bar type: javascript:alert(\"alert\");\n3. Press Return\n4. Use an accessibility inspector like Accerciser to view the accessibility tree\n\nExpected results: There would not be any object with ROLE_UNKNOWN in the tree.\n\nActual results: The child of the alert/dialog has ROLE_UNKNOWN. That unknown object  contains the dialog box contents.\n\nImpact: Screen readers don't know what the \"unknown\" object is and may not present it as a result. While we could presumably hack around it, it would be far preferable to either prune this object from the tree or give it a role that indicates what its purpose is.\n\nBTW: I am pretty sure this is a regression. However, I'm afraid I don't have time to track down when it was introduced. Sorry!", "author": "jdiggs@igalia.com", "id": 12890051, "time": "2017-12-01T16:33:29Z"}, {"text": "<vbox anonid=\"mainContainer\"> should have role=\"alert\" I suppose, here's the widget itself [2] if I'm right. Gijs, may you take a look at the findings?\n\n[2] https://dxr.mozilla.org/mozilla-central/source/toolkit/components/prompts/content/tabprompts.xml#22", "author": "surkov.alexander@gmail.com", "id": 12958828, "time": "2018-01-10T18:14:02Z"}, {"text": "(In reply to alexander :surkov from comment #1)\n> <vbox anonid=\"mainContainer\"> should have role=\"alert\" I suppose, here's the\n> widget itself [2] if I'm right. Gijs, may you take a look at the findings?\n> \n> [2]\n> https://dxr.mozilla.org/mozilla-central/source/toolkit/components/prompts/\n> content/tabprompts.xml#22\n\nThis doesn't really make sense to me. Why does the <vbox> need a role but not the containing <hbox> ?\n\nThey're both basically visual-styling-only boxes. They shouldn't show up in the a11y tree at all, I think. Why do they?", "author": "gijskruitbosch+bugs@gmail.com", "id": 12959075, "time": "2018-01-10T19:20:04Z"}, {"text": "(In reply to :Gijs from comment #2)\n> (In reply to alexander :surkov from comment #1)\n> > <vbox anonid=\"mainContainer\"> should have role=\"alert\" I suppose, here's the\n> > widget itself [2] if I'm right. Gijs, may you take a look at the findings?\n> > \n> > [2]\n> > https://dxr.mozilla.org/mozilla-central/source/toolkit/components/prompts/\n> > content/tabprompts.xml#22\n> \n> This doesn't really make sense to me. Why does the <vbox> need a role but\n> not the containing <hbox> ?\n> They're both basically visual-styling-only boxes. They shouldn't show up in\n> the a11y tree at all, I think. Why do they?\n\nFrom what I can tell the <vbox anonid=\"mainContainer\"> corresponds to visual alert dialog boundaries; the container that corresponds to alert dialog inside tabpromptbox widget should have alertdialog role I think.", "author": "surkov.alexander@gmail.com", "id": 12959133, "time": "2018-01-10T19:36:58Z"}, {"text": "(In reply to alexander :surkov from comment #3)\n> (In reply to :Gijs from comment #2)\n> > (In reply to alexander :surkov from comment #1)\n> > > <vbox anonid=\"mainContainer\"> should have role=\"alert\" I suppose, here's the\n> > > widget itself [2] if I'm right. Gijs, may you take a look at the findings?\n> > > \n> > > [2]\n> > > https://dxr.mozilla.org/mozilla-central/source/toolkit/components/prompts/\n> > > content/tabprompts.xml#22\n> > \n> > This doesn't really make sense to me. Why does the <vbox> need a role but\n> > not the containing <hbox> ?\n> > They're both basically visual-styling-only boxes. They shouldn't show up in\n> > the a11y tree at all, I think. Why do they?\n> \n> From what I can tell the <vbox anonid=\"mainContainer\"> corresponds to visual\n> alert dialog boundaries; the container that corresponds to alert dialog\n> inside tabpromptbox widget should have alertdialog role I think.\n\nI'm still confused why the vbox/hbox are in the tree right now. Can you clarify this?\n\nAs for the alertdialog role, the binding already has:\n\n    <xbl:content xmlns=\"http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul\"\n                 role=\"dialog\"\n                 aria-describedby=\"infoBody\">\n\nso it already has role=dialog. We can make that role=alertdialog instead, but without more info I don't think we should set role=dialog/alertdialog twice.", "author": "gijskruitbosch+bugs@gmail.com", "id": 12959592, "time": "2018-01-10T21:52:18Z"}, {"text": "Personally, I think it should be pruned from the tree.\n\nThat said, if for some reason there is any hbox or vbox which must be included in any tree, please give it ROLE_PANEL (the generic widget-container role). I'm pretty sure that's what GTK+ does.\n\nIf you decide to go that route, I think it would make sense to do it in a way that didn't require an explicit ARIA role, but instead JustWorked(tm). After all, ROLE_UNKNOWN is always wrong and having to explicitly take an action on a regular basis to prevent that problem is inefficient and doomed to fail. Extra panels are noise, but noise we're used to.", "author": "jdiggs@igalia.com", "id": 12960616, "time": "2018-01-11T09:16:00Z"}, {"text": "I'd say we should get rid of role=\"dialog\" from tabmodalprompt binding content as it's a background element, and put role=alertdialog it to the actual dialog which is present by vbox.mainContainer, which is focusable and thus has unknown role accessible.\n\nJoanie, do you agree that we should do role=alertdialog and put it on an focusable element that represents a dialog itself?\n\nGijs, does it make sense with you?", "author": "surkov.alexander@gmail.com", "id": 12961251, "time": "2018-01-11T14:23:54Z"}, {"text": "(In reply to alexander :surkov from comment #6)\n> I'd say we should get rid of role=\"dialog\" from tabmodalprompt binding\n> content as it's a background element, and put role=alertdialog it to the\n> actual dialog which is present by vbox.mainContainer, which is focusable and\n> thus has unknown role accessible.\n> \n> Joanie, do you agree that we should do role=alertdialog and put it on an\n> focusable element that represents a dialog itself?\n> \n> Gijs, does it make sense with you?\n\nWFM, but we may need to update commonDialog.xul as well.", "author": "gijskruitbosch+bugs@gmail.com", "id": 12961311, "time": "2018-01-11T14:52:44Z"}, {"text": "(In reply to alexander :surkov from comment #6)\n> I'd say we should get rid of role=\"dialog\" from tabmodalprompt binding\n> content as it's a background element,\n\nWill this cause the above object to be pruned from the accessibility tree? Or to put it another way, will this change result in a new (and unexpected) parent for the following object:\n\n> and put role=alertdialog it to the\n> actual dialog which is present by vbox.mainContainer, which is focusable and\n> thus has unknown role accessible.\n\n?", "author": "jdiggs@igalia.com", "id": 12961445, "time": "2018-01-11T15:33:34Z"}, {"text": "yeah, I think that should remove tabmodalprompt element form the hierarchy, but we should double check that of course", "author": "surkov.alexander@gmail.com", "id": 12961961, "time": "2018-01-11T18:12:47Z"}, {"text": "Yura, could you give an advice how to cover javascript:alert('ho-ho') by browsers tests with some links if possible?", "author": "surkov.alexander@gmail.com", "id": 12961968, "time": "2018-01-11T18:13:57Z"}, {"text": "I question why the dialog root itself is focusable at all. That's non-standard for a dialog. Right now, there are three focusable things for alert(\"alert\"):\n1. When it first opens, the OK button has focus.\n2. If you shift+tab, you get to the \"alert\" label. This too is non-standard, but I can see how some might like this.\n3. If you shift+tab again, focus hits the vbox, which according to comment 3 should be the dialog itself semantically speaking (currently role unknown, proposed role alertdialog).", "author": "jteh@mozilla.com", "id": 13050671, "time": "2018-02-18T22:44:37Z"}, {"text": "(In reply to alexander :surkov from comment #10)\n> Yura, could you give an advice how to cover javascript:alert('ho-ho') by\n> browsers tests with some links if possible?\n\nI would look at accessible/tests/browser/events/browser_test_focus_dialog.js test. It does not have an actual alert but I think it would be similar where we would wait for a show or focused accessible event on the alert (granted it will need a custom target matcher).", "author": "yzenevich@mozilla.com", "id": 13233431, "time": "2018-04-25T19:11:29Z"}], "id": 1422345, "priority": "P3", "cc": ["gijskruitbosch+bugs@gmail.com", "jteh@mozilla.com", "surkov.alexander@gmail.com", "yzenevich@mozilla.com"], "cf_crash_signature": "", "version": "unspecified", "is_cc_accessible": true, "cf_tracking_firefox_esr52": "---", "see_also": [], "cf_tracking_thunderbird_esr60": "---", "cf_platform_rel": "---", "product": "Core", "cf_fx_iteration": "---", "blocks": [], "qa_contact": "", "creation_time": "2017-12-01T16:33:29Z", "cf_status_firefox_esr52": "---", "component": "Disability Access APIs", "assigned_to_detail": {"email": "nobody@mozilla.org", "id": 1, "name": "nobody@mozilla.org", "real_name": "Nobody; OK to take it and work on it"}, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "---", "cf_status_firefox61": "---", "cf_status_firefox60": "---", "target_milestone": "---", "cf_rank": null, "cf_qa_whiteboard": "", "severity": "normal", "groups": [], "cf_status_thunderbird_esr52": "---", "url": "", "cf_status_thunderbird_esr60": "---", "creator_detail": {"email": "jdiggs@igalia.com", "id": 260369, "name": "jdiggs@igalia.com", "real_name": "Joanmarie Diggs"}, "whiteboard": "", "mentors": [], "summary": "Object with ROLE_UNKNOWN in accessibility tree of javascript alerts", "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "last_change_time": "2018-04-25T19:11:29Z", "assigned_to": "nobody@mozilla.org", "is_open": true, "history": [{"changes": [{"removed": "--", "field_name": "priority", "added": "P3"}, {"removed": "", "field_name": "cc", "added": "gijskruitbosch+bugs@gmail.com, surkov.alexander@gmail.com"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(gijskruitbosch+bugs@gmail.com)"}], "who": "surkov.alexander@gmail.com", "when": "2018-01-10T18:14:02Z"}, {"changes": [{"removed": "needinfo?(gijskruitbosch+bugs@gmail.com)", "field_name": "flagtypes.name", "added": "needinfo?(surkov.alexander@gmail.com)"}], "who": "gijskruitbosch+bugs@gmail.com", "when": "2018-01-10T19:20:04Z"}, {"changes": [{"removed": "needinfo?(surkov.alexander@gmail.com)", "field_name": "flagtypes.name", "added": ""}], "who": "surkov.alexander@gmail.com", "when": "2018-01-10T19:36:58Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(surkov.alexander@gmail.com)"}], "who": "gijskruitbosch+bugs@gmail.com", "when": "2018-01-10T21:52:18Z"}, {"changes": [{"removed": "needinfo?(surkov.alexander@gmail.com)", "field_name": "flagtypes.name", "added": ""}], "who": "surkov.alexander@gmail.com", "when": "2018-01-11T14:23:54Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "yzenevich@mozilla.com"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(yzenevich@mozilla.com)"}], "who": "surkov.alexander@gmail.com", "when": "2018-01-11T18:13:57Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "jteh@mozilla.com"}], "who": "jteh@mozilla.com", "when": "2018-02-18T22:44:37Z"}, {"changes": [{"removed": "needinfo?(yzenevich@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "yzenevich@mozilla.com", "when": "2018-04-25T19:11:29Z"}], "resolution": "", "op_sys": "Unspecified", "cf_fx_points": "---", "cf_blocking_fennec": "---"}