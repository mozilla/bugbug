{"cf_tracking_thunderbird_esr52": "---", "cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "cf_tracking_firefox62": "---", "creator": "gijskruitbosch+bugs@gmail.com", "mentors_detail": [], "depends_on": [1451487, 1451743, 1452618, 1454456, 1456171, 1456291, 1456515, 1456677], "cf_status_firefox_esr60": "---", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "keywords": [], "cc_detail": [{"email": "aswan@mozilla.com", "id": 561655, "name": "aswan@mozilla.com", "real_name": "Andrew Swan [:aswan] (on PTO until 6/25)"}, {"email": "dtownsend@mozilla.com", "id": 91159, "name": "dtownsend@mozilla.com", "real_name": "Dave Townsend [:mossop]"}, {"email": "florian@queze.net", "id": 149052, "name": "florian@queze.net", "real_name": "Florian Qu\u00e8ze [:florian]"}, {"email": "kmaglione+bmo@mozilla.com", "id": 106098, "name": "kmaglione+bmo@mozilla.com", "real_name": "Kris Maglione [:kmag]"}, {"email": "mathieu@mozilla.com", "id": 526079, "name": "mathieu@mozilla.com", "real_name": "Mathieu Leplatre (:leplatrem)"}, {"email": "Virtual@teknik.io", "id": 342842, "name": "Virtual@teknik.io", "real_name": "Virtual_ManPL [:Virtual] - (please needinfo? me - so I will see your comment/reply/question/etc.)"}], "cf_last_resolved": "2018-04-30T22:13:52Z", "attachments": [], "votes": 0, "classification": "Components", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 8, "comments": [{"text": "In bug 1257565 we'd like to switch to another data format for storing blocklist information. To do this, ultimately we need to make the APIs that get information from the blocklist service asynchronous, so that we can fetch the data for the blocklist asynchronously. This bug tracks that work.\n\nbug 1371888 made this slightly easier by changing the plugin code to cache blocklist state per plugin, and assuming 'not blocked' state for new sideloaded plugins when they are encountered. It then synchronously fetches state when the blocklist does load.\n\nAs part of this bug I intend to update the plugin code to use asynchronous APIs to fetch that data. I also intend to do a similar thing to the add-ons code (store blocklist state inasmuch as we don't already, update asynchronously (ie \"sometime later\") for new items).\n\nAll of this to eventually move to a storage surface that only provides async access, like (say) sqlite, or a JSON->memory thing that we'd like to load OMT, etc.", "author": "gijskruitbosch+bugs@gmail.com", "id": 13145627, "time": "2018-03-21T15:03:12Z"}, {"text": "(In reply to :Gijs from comment #0)\n> As part of this bug I intend to update the plugin code to use asynchronous\n> APIs to fetch that data. I also intend to do a similar thing to the add-ons\n> code (store blocklist state inasmuch as we don't already, update\n> asynchronously (ie \"sometime later\") for new items).\n\nThere doesn't need to be a \"sometime later\". Add-on installs are already async, and already only check the blocklist status at add-on install and blocklist update time. They can just do an async blocklist query whenever they need to update that information.\n\nThe one caveat is that side-loaded extensions detected at startup are a weird sort of hybrid. They're synchronously \"installed\", and then enabled after users opt in. We should really rework that process, but we can also just block the side-load install prompts on the blocklist state check.", "author": "kmaglione+bmo@mozilla.com", "id": 13146535, "time": "2018-03-21T19:19:11Z"}, {"text": "(In reply to Kris Maglione [:kmag] (long backlog; ping on IRC if you're blocked) from comment #1)\n> The one caveat is that side-loaded extensions detected at startup are a\n> weird sort of hybrid. They're synchronously \"installed\", and then enabled\n> after users opt in. We should really rework that process, but we can also\n> just block the side-load install prompts on the blocklist state check.\n\nRight, when I looked at callers I noticed a fully synchronous codepath into the blocklist from a function literally called \"syncLoadDB\". If that's fine with being updated later (ie not really being fully sync anymore), good - it just wasn't super obvious to me. :-)", "author": "gijskruitbosch+bugs@gmail.com", "id": 13148311, "time": "2018-03-22T13:56:07Z"}, {"text": "Mathieu, I'm about to land bug 1456515. Do you think it's possible for you to take on bug 1257565 for 62 when that's fixed? :-)", "author": "gijskruitbosch+bugs@gmail.com", "id": 13239199, "time": "2018-04-27T21:19:34Z"}, {"text": "\\o/", "author": "kmaglione+bmo@mozilla.com", "id": 13239214, "time": "2018-04-27T21:30:23Z"}, {"text": "I believe all the publicly-exposed methods are now async.", "author": "gijskruitbosch+bugs@gmail.com", "id": 13244940, "time": "2018-04-30T22:13:52Z"}, {"text": "\\o/", "author": "bwong@mozilla.com", "id": 13244981, "time": "2018-04-30T22:28:50Z"}, {"text": "Mathieu and I talked out-of-band. I'll be pursuing bug 1257565 and he's making some changes to kinto to help ease that process.", "author": "gijskruitbosch+bugs@gmail.com", "id": 13271902, "time": "2018-05-11T21:51:09Z"}], "id": 1447680, "priority": "--", "cc": ["aswan@mozilla.com", "dtownsend@mozilla.com", "florian@queze.net", "kmaglione+bmo@mozilla.com", "mathieu@mozilla.com", "Virtual@teknik.io"], "cf_crash_signature": "", "version": "Trunk", "is_cc_accessible": true, "cf_tracking_firefox_esr52": "---", "see_also": ["https://bugzilla.mozilla.org/show_bug.cgi?id=1371888"], "cf_tracking_thunderbird_esr60": "---", "status": "RESOLVED", "product": "Toolkit", "cf_fx_iteration": "---", "blocks": [1257565], "qa_contact": "", "creation_time": "2018-03-21T15:03:12Z", "cf_status_firefox_esr52": "---", "component": "Blocklisting", "assigned_to_detail": {"email": "gijskruitbosch+bugs@gmail.com", "id": 159069, "name": "gijskruitbosch+bugs@gmail.com", "real_name": ":Gijs (he/him)"}, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "---", "cf_status_firefox61": "affected", "cf_status_firefox60": "---", "target_milestone": "---", "cf_rank": null, "cf_qa_whiteboard": "", "severity": "normal", "groups": [], "cf_status_thunderbird_esr52": "---", "url": "", "cf_status_thunderbird_esr60": "---", "creator_detail": {"email": "gijskruitbosch+bugs@gmail.com", "id": 159069, "name": "gijskruitbosch+bugs@gmail.com", "real_name": ":Gijs (he/him)"}, "whiteboard": "[fxperf:p1]", "mentors": [], "summary": "Make blocklist APIs asynchronous", "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "last_change_time": "2018-05-11T21:51:09Z", "assigned_to": "gijskruitbosch+bugs@gmail.com", "is_open": false, "history": [{"changes": [{"removed": "", "field_name": "depends_on", "added": "1451487"}], "who": "gijskruitbosch+bugs@gmail.com", "when": "2018-04-04T20:54:31Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1451743"}], "who": "gijskruitbosch+bugs@gmail.com", "when": "2018-04-05T14:05:11Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1452618"}], "who": "gijskruitbosch+bugs@gmail.com", "when": "2018-04-09T13:36:27Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1454456"}], "who": "gijskruitbosch+bugs@gmail.com", "when": "2018-04-16T19:02:38Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1456171"}], "who": "gijskruitbosch+bugs@gmail.com", "when": "2018-04-23T16:11:14Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1456291"}], "who": "kmaglione+bmo@mozilla.com", "when": "2018-04-23T21:52:16Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1456515"}], "who": "gijskruitbosch+bugs@gmail.com", "when": "2018-04-24T15:31:02Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1456677"}], "who": "kmaglione+bmo@mozilla.com", "when": "2018-04-25T00:45:24Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "Virtual@teknik.io"}], "who": "Virtual@teknik.io", "when": "2018-04-26T12:31:43Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(mathieu@mozilla.com)"}], "who": "gijskruitbosch+bugs@gmail.com", "when": "2018-04-27T21:19:34Z"}, {"changes": [{"removed": "ASSIGNED", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2018-04-30 22:13:52"}], "who": "gijskruitbosch+bugs@gmail.com", "when": "2018-04-30T22:13:52Z"}, {"changes": [{"removed": "needinfo?(mathieu@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "gijskruitbosch+bugs@gmail.com", "when": "2018-05-11T21:51:09Z"}], "resolution": "FIXED", "op_sys": "Unspecified", "cf_fx_points": "---", "cf_blocking_fennec": "---"}