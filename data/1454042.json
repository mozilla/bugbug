{"cf_tracking_thunderbird_esr52": "---", "status": "RESOLVED", "cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "cf_tracking_firefox62": "---", "creator": "jan@ikenmeyer.eu", "mentors_detail": [], "depends_on": [1448896, 1454416, 1459686, 1459714, 1461342, 1462903], "cf_status_firefox_esr60": "unaffected", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "x86_64", "cf_status_firefox59": "unaffected", "keywords": ["nightly-community", "regression"], "cc_detail": [{"email": "ash153311@gmail.com", "id": 548155, "name": "ash153311@gmail.com", "real_name": "Taegeon Lee"}, {"email": "bugmail@mozilla.staktrace.com", "id": 426788, "name": "bugmail@mozilla.staktrace.com", "real_name": "Kartikaya Gupta (email:kats@mozilla.com)"}, {"email": "jmuizelaar@mozilla.com", "id": 309398, "name": "jmuizelaar@mozilla.com", "real_name": "Jeff Muizelaar [:jrmuizel] on parental leave until at least June 25"}, {"email": "johnp@gmx.de", "id": 386893, "name": "johnp@gmx.de", "real_name": "Johannes Pfrang [:johnp]"}, {"email": "josh@joshmatthews.net", "id": 241497, "name": "josh@joshmatthews.net", "real_name": "Josh Matthews [:jdm]"}, {"email": "kvark@mozilla.com", "id": 582393, "name": "kvark@mozilla.com", "real_name": "Dzmitry Malyshau [:kvark]"}, {"email": "mcastelluccio@mozilla.com", "id": 420453, "name": "mcastelluccio@mozilla.com", "real_name": "Marco Castelluccio [:marco]"}, {"email": "milaninbugzilla@gmail.com", "id": 456486, "name": "milaninbugzilla@gmail.com", "real_name": "Milan Sreckovic [:milan] (needinfo for best results)"}, {"email": "sotaro.ikeda.g@gmail.com", "id": 434202, "name": "sotaro.ikeda.g@gmail.com", "real_name": "Sotaro Ikeda [:sotaro]"}], "cf_last_resolved": "2018-05-19T09:41:26Z", "attachments": [{"creator": "sotaro.ikeda.g@gmail.com", "is_obsolete": 0, "is_patch": 1, "flags": [], "content_type": "text/plain", "id": 8968416}, {"creator": "bugmail@mozilla.staktrace.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-05-18T23:00:37Z", "type_id": 4, "creation_date": "2018-05-18T14:32:01Z", "id": 1758815, "setter": "sotaro.ikeda.g@gmail.com"}], "content_type": "text/x-review-board-request", "id": 8976992}], "votes": 2, "classification": "Components", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 21, "comments": [{"text": "Debian Testing, Radeon RX480\nfresh profile: layers.gpu-process.enabled, gfx.webrender.all\n\n> GP+[GFX1-]: WR: Unknown pipeline used for iframe IframeDisplayItem { clip_id: Clip(4, PipelineId(1, 1)), pipeline_id: PipelineId(1, 4) }\n\nOpen a new tab, paste \"about:support\", press enter and scroll down to the graphics failure log.\n\nmozregression --good 2018-04-01 --bad 2018-04-13 --pref gfx.webrender.all:true layers.gpu-process.enabled:true startup.homepage_welcome_url:'https://example.com'\n> 8:23.84 INFO: Last good revision: a67e5015e4564bdb78d84765f9e4ff8580bda243\n> 8:23.84 INFO: First bad revision: 0f807beef229718c015553bac09e4f638ca2add1\n> 8:23.84 INFO: Pushlog:\n> https://hg.mozilla.org/integration/autoland/pushloghtml?fromchange=a67e5015e4564bdb78d84765f9e4ff8580bda243&tochange=0f807beef229718c015553bac09e4f638ca2add1\n\n> 0f807beef229\tKartikaya Gupta \u2014 Bug 1452603 - Update Cargo lockfiles and re-vendor rust dependencies. r=jrmuizel\n> dd843b50cd36\tKartikaya Gupta \u2014 Bug 1452603 - Update Cargo stuff for the serde bump. r=jrmuizel\n> 50c382ab757a\tKartikaya Gupta \u2014 Bug 1452603 - Update webrender to commit 6f997974cec5772b1797725f4a7942d742e7d7ff. r=jrmuize\n\ntry builds from bug 1452603:\n> WR @ 844639034764679b23aaae14cbf6981c8c060b80\nmozregression --repo try --launch 1dd7c19e836fa0b1aba0e646a1fe3288554455be --pref gfx.webrender.all:true layers.gpu-process.enabled:true startup.homepage_welcome_url:'https://example.com'\ngood\n\n> WR @ 86ca11b1ac79c5ee733de4b293c34de5d77419a1\nmozregression --repo try --launch e3a87b9e25e0bb86e9d74e777778e9fea231b088 --pref gfx.webrender.all:true layers.gpu-process.enabled:true startup.homepage_welcome_url:'https://example.com'\nbad\n\n\"Regression\" range: https://github.com/servo/webrender/compare/844639034764679b23aaae14cbf6981c8c060b80...86ca11b1ac79c5ee733de4b293c34de5d77419a1\n\nhttps://github.com/servo/webrender/pull/2647\nintroduced\n> error!(\"Unknown pipeline used for iframe {:?}\", info);\n\nI can't reproduce this without gpu process.", "author": "jan@ikenmeyer.eu", "id": 13204753, "time": "2018-04-13T18:39:24Z"}, {"text": "This is basically what's causing the flickering of https://bugzilla.mozilla.org/show_bug.cgi?id=1448896\nI just added a warning earlier in the code to catch that. At the end of the day we may switch this to a hard error.\n\nkats, why is this a blocker for 1452603 though?", "author": "kvark@mozilla.com", "id": 13205162, "time": "2018-04-13T21:22:49Z"}, {"text": "> why is this a blocker for 1452603 though?\n\nbug 1452603 caused a failure on about:support, so I perceived this as regression (at first).\nWhen I found #2647 I realized that this message has been introduced with intention to fight bad things, so I put the \"Regression\" from \"Regression range\" in quotes. While filing this bug I asked myself whether I should put bug 1452603 into \"Blocks\" or \"See Also\". What would be right here?", "author": "jan@ikenmeyer.eu", "id": 13205310, "time": "2018-04-13T22:23:57Z"}, {"text": "(In reply to Jan Andre Ikenmeyer [:darkspirit] from comment #2)\n> While filing this bug I asked myself whether I should put\n> bug 1452603 into \"Blocks\" or \"See Also\". What would be right here?\n\nIf this were a real regression then yes, marking it blocking bug 1452603 (which introduced the behaviour) would be correct. In this case, the behaviour is just a println that now shows up for what was a pre-existing bug. So the workflow is less obvious. Really we want to fix the pre-existing bug and leave the println in place. I'm ok with leaving it as blocking, just as long as we are clear that the thing we want to fix is a pre-existing issue.", "author": "bugmail@mozilla.staktrace.com", "id": 13206763, "time": "2018-04-15T13:26:28Z"}, {"text": "I see this error constantly on linux without gpu process enabled (~ half a dozen times per page load), even with a fresh profile. Separate bug or should I wait for progress on this one?", "author": "johnp@gmx.de", "id": 13206912, "time": "2018-04-15T21:23:17Z"}, {"text": "@johnp: Wait for this one.\n\nSotaro, it looks like bug 1448896 didn't fix all instances of this problem. Any thoughts on how we can track down and fix the rest?", "author": "bugmail@mozilla.staktrace.com", "id": 13209500, "time": "2018-04-16T13:39:18Z"}, {"text": "Before looking into the problem, I faced another problem. about:support seemed to be broken. The following is mozregression result.\n\n 7:06.28 INFO: No more inbound revisions, bisection finished.\n 7:06.28 INFO: Last good revision: f291b07fa1f869fd3f9af9f5fe940d47b842edcf\n 7:06.28 INFO: First bad revision: 98389f291fe61e622267ba3e5e99792e6f5d6350\n 7:06.30 INFO: Pushlog:\nhttps://hg.mozilla.org/integration/mozilla-inbound/pushloghtml?fromchange=f291b07fa1f869fd3f9af9f5fe940d47b842edcf&tochange=98389f291fe61e622267ba3e5e99792e6f5d6350", "author": "sotaro.ikeda.g@gmail.com", "id": 13211388, "time": "2018-04-17T02:22:38Z"}, {"text": "(In reply to Sotaro Ikeda [:sotaro] from comment #6)\n> Before looking into the problem, I faced another problem. about:support\n> seemed to be broken. The following is mozregression result.\n> \n>  7:06.28 INFO: No more inbound revisions, bisection finished.\n>  7:06.28 INFO: Last good revision: f291b07fa1f869fd3f9af9f5fe940d47b842edcf\n>  7:06.28 INFO: First bad revision: 98389f291fe61e622267ba3e5e99792e6f5d6350\n>  7:06.30 INFO: Pushlog:\n> https://hg.mozilla.org/integration/mozilla-inbound/\n> pushloghtml?fromchange=f291b07fa1f869fd3f9af9f5fe940d47b842edcf&tochange=9838\n> 9f291fe61e622267ba3e5e99792e6f5d6350\n\nI confirmed that Bug 1420908 broke about:support by locally backing out the change.", "author": "sotaro.ikeda.g@gmail.com", "id": 13211438, "time": "2018-04-17T03:16:03Z"}, {"text": "(In reply to Sotaro Ikeda [:sotaro] from comment #7)\n> I confirmed that Bug 1420908 broke about:support by locally backing out the\n> change.\n\nBug 1454416 was created for it.", "author": "sotaro.ikeda.g@gmail.com", "id": 13211439, "time": "2018-04-17T03:18:00Z"}, {"text": "When I tested locally on linux, pipeline ids of errors were always \"PipelineId(1, *)\". \"PipelineSourceId mNamespace\" of PipelineId was always 1. The pipeline ids are always allocated for WebRenderBridgeParent.", "author": "sotaro.ikeda.g@gmail.com", "id": 13211548, "time": "2018-04-17T05:45:34Z"}, {"text": "IframeDisplayItem for WebRenderBridgeParent is pushed at nsDisplayRemote::CreateWebRenderCommands() in chrome process.\n  https://dxr.mozilla.org/mozilla-central/source/layout/ipc/RenderFrameParent.cpp#394\n\nDisplayList of pipelines of non-root WebRenderBridgeParent is pushed by WebRenderBridgeParent. It is triggered by content process. The DisplayList is delivered like WebRenderBridgeChild -> WebRenderBridgeParent -> WebRenderAPI::SendTransaction() ->---> Scene::set_display_list().\n\nIframeDisplayItem and DisplayList of pipelines are triggered in different process. Therefore there could be a case that DisplayList of pipeline was not set, when IframeDisplayItem was handled in DisplayListFlattener::flatten_iframe().\n\n  https://dxr.mozilla.org/mozilla-central/source/gfx/webrender/src/display_list_flattener.rs#571", "author": "sotaro.ikeda.g@gmail.com", "id": 13211566, "time": "2018-04-17T06:07:01Z"}, {"text": "Created attachment 8968416\ntmp patch - Add log out", "author": "sotaro.ikeda.g@gmail.com", "id": 13211569, "time": "2018-04-17T06:14:05Z"}, {"text": "With attachment 8968416, I confirmed the following two cases that caused error logs.\n\n- [1] WebRenderBridgeParent of related pipeline was created, but it do not received DisplayList from WebRenderBridgeChild in content process yet. Then its IframeDisplayItem was handled in DisplayListFlattener::flatten_iframe() in WebRender.\n\n- [2] WebRenderBridgeParent was destroyed and its namespace was removed from WebRender. Then Then its IframeDisplayItem was handled in DisplayListFlattener::flatten_iframe() in WebRender.\n\nFrom current gecko's architecture, it seems not easy to prevent the situation. One solution might be to push dummy DisplayList for the pipelines.", "author": "sotaro.ikeda.g@gmail.com", "id": 13211575, "time": "2018-04-17T06:20:10Z"}, {"text": "Presumably this happens with non-webrender as well, but we just ignore the situations [1] and return gracefully. So maybe we should do the same in webrender, for the case where the IframeDisplayItem points to an out-of-process pipeline. for in-process pipelines (like async images and such) we probably still want the error because in those cases there might be user-visible issues like the flickering that was fixed in the previous bug.\n\n[1] https://searchfox.org/mozilla-central/rev/a30a60eadcff99d2a043241955d215dbeccad876/gfx/layers/composite/AsyncCompositionManager.cpp#126,131", "author": "bugmail@mozilla.staktrace.com", "id": 13212424, "time": "2018-04-17T13:55:04Z"}, {"text": "This seems to be happening a lot still, and I looked into one instance of it that I can reproduce locally while running a reftest. What happens is that the display list contains canvases, which we handle as async images. the EndTransaction message contains the right display list and WebRenderParentCommand objects, but then on the parent side the WebRenderParentCommands are used to update the state in AsyncImagePipelineManager [1] while the display list is sent directly to WR [2]. The contents of the pipelines are not sent to WR until later, just before the GenerateFrame transaction at [3].\n\nWhen the scene building step happens in WR it tries to flatten the iframes from the display list and it spits out this error, because it doesn't have the pipeline contents yet.\n\n[1] https://searchfox.org/mozilla-central/rev/b28b94dc81d60c6d9164315adbd4a5073526d372/gfx/layers/wr/WebRenderBridgeParent.cpp#621\n[2] https://searchfox.org/mozilla-central/rev/b28b94dc81d60c6d9164315adbd4a5073526d372/gfx/layers/wr/WebRenderBridgeParent.cpp#651-655\n[3] https://searchfox.org/mozilla-central/rev/b28b94dc81d60c6d9164315adbd4a5073526d372/gfx/layers/wr/WebRenderBridgeParent.cpp#1293", "author": "bugmail@mozilla.staktrace.com", "id": 13260130, "time": "2018-05-07T17:47:08Z"}, {"text": "The spew from this warning is getting quite annoying. I think what I would like to do is to make some kinds of iframe items have \"ignorable\" pipeline ids (the ones that are actual remote iframes in gecko). For piplines that are from async images we can then promote the warning to an error (since I think I fixed all of those).", "author": "bugmail@mozilla.staktrace.com", "id": 13279060, "time": "2018-05-15T16:18:54Z"}, {"text": "https://treeherder.mozilla.org/#/jobs?repo=try&revision=d4d46f2925e903ad51ea0c24cb45a57c524813fb", "author": "bugmail@mozilla.staktrace.com", "id": 13279610, "time": "2018-05-15T19:22:26Z"}, {"text": "Created attachment 8976992\nBug 1454042 - Allow missing pipeline information for cross-process iframes.\n\nWe should always have the pipeline information for in-process things like\nasync images, but for cross-process iframes we might not have the information\nright away if the content process doesn't get around to sending it for a while.\n\nReview commit: https://reviewboard.mozilla.org/r/245124/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/245124/", "author": "bugmail@mozilla.staktrace.com", "id": 13287350, "time": "2018-05-18T14:32:01Z"}, {"text": "Comment on attachment 8976992\nBug 1454042 - Allow missing pipeline information for cross-process iframes.\n\nhttps://reviewboard.mozilla.org/r/245124/#review251204\n\nNice!", "author": "sotaro.ikeda.g@gmail.com", "id": 13288800, "time": "2018-05-18T23:00:37Z"}, {"text": "Pushed by kgupta@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/75146e6b8a3b\nAllow missing pipeline information for cross-process iframes. r=sotaro", "author": "pulsebot@bots.tld", "id": 13290242, "time": "2018-05-19T02:27:51Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/75146e6b8a3b", "author": "ebalazs@mozilla.com", "id": 13290812, "time": "2018-05-19T09:41:26Z"}], "id": 1454042, "priority": "P1", "cc": ["ash153311@gmail.com", "bugmail@mozilla.staktrace.com", "jmuizelaar@mozilla.com", "johnp@gmx.de", "josh@joshmatthews.net", "kvark@mozilla.com", "mcastelluccio@mozilla.com", "milaninbugzilla@gmail.com", "sotaro.ikeda.g@gmail.com"], "cf_crash_signature": "", "version": "Trunk", "is_cc_accessible": true, "cf_tracking_firefox_esr52": "---", "see_also": ["https://github.com/servo/webrender/pull/2762"], "cf_tracking_thunderbird_esr60": "---", "cf_platform_rel": "---", "product": "Core", "cf_fx_iteration": "---", "blocks": [1386669, 1452603], "qa_contact": "", "creation_time": "2018-04-13T18:39:24Z", "cf_status_firefox_esr52": "unaffected", "component": "Graphics: WebRender", "assigned_to_detail": {"email": "bugmail@mozilla.staktrace.com", "id": 426788, "name": "bugmail@mozilla.staktrace.com", "real_name": "Kartikaya Gupta (email:kats@mozilla.com)"}, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "fixed", "cf_status_firefox61": "disabled", "cf_status_firefox60": "unaffected", "target_milestone": "mozilla62", "cf_rank": null, "cf_qa_whiteboard": "", "severity": "normal", "groups": [], "cf_status_thunderbird_esr52": "---", "url": "", "cf_status_thunderbird_esr60": "---", "creator_detail": {"email": "jan@ikenmeyer.eu", "id": 580271, "name": "jan@ikenmeyer.eu", "real_name": "Jan Andre Ikenmeyer [:darkspirit]"}, "whiteboard": "", "mentors": [], "summary": "WR: Unknown pipeline used for iframe IframeDisplayItem { clip_id: Clip(4, PipelineId(1, 1)), pipeline_id: PipelineId(1, 4) }", "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "last_change_time": "2018-05-22T12:57:27Z", "assigned_to": "bugmail@mozilla.staktrace.com", "is_open": false, "history": [{"changes": [{"removed": "", "field_name": "cc", "added": "bugmail@mozilla.staktrace.com"}, {"removed": "", "field_name": "depends_on", "added": "1448896"}, {"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "kvark@mozilla.com"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(bugmail@mozilla.staktrace.com)"}], "who": "kvark@mozilla.com", "when": "2018-04-13T21:22:49Z"}, {"changes": [{"removed": "needinfo?(bugmail@mozilla.staktrace.com)", "field_name": "flagtypes.name", "added": ""}], "who": "bugmail@mozilla.staktrace.com", "when": "2018-04-15T13:26:28Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "johnp@gmx.de"}], "who": "johnp@gmx.de", "when": "2018-04-15T21:23:17Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "sotaro.ikeda.g@gmail.com"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(sotaro.ikeda.g@gmail.com)"}], "who": "bugmail@mozilla.staktrace.com", "when": "2018-04-16T13:39:18Z"}, {"changes": [{"removed": "--", "field_name": "priority", "added": "P1"}, {"removed": "", "field_name": "cc", "added": "milan@mozilla.com"}, {"removed": "", "field_name": "blocks", "added": "1386669"}], "who": "milaninbugzilla@gmail.com", "when": "2018-04-16T19:35:43Z"}, {"changes": [{"removed": "needinfo?(sotaro.ikeda.g@gmail.com)", "field_name": "flagtypes.name", "added": ""}], "who": "sotaro.ikeda.g@gmail.com", "when": "2018-04-17T03:18:00Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1454416"}], "who": "sotaro.ikeda.g@gmail.com", "when": "2018-04-17T03:18:18Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(sotaro.ikeda.g@gmail.com)"}], "who": "sotaro.ikeda.g@gmail.com", "when": "2018-04-17T03:18:35Z"}, {"changes": [{"removed": "needinfo?(sotaro.ikeda.g@gmail.com)", "field_name": "flagtypes.name", "added": ""}], "who": "sotaro.ikeda.g@gmail.com", "when": "2018-04-17T06:07:01Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "jmuizelaar@mozilla.com"}], "who": "jmuizelaar@mozilla.com", "when": "2018-04-18T21:51:13Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "josh@joshmatthews.net"}], "who": "josh@joshmatthews.net", "when": "2018-04-30T13:14:05Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "ash153311@gmail.com"}], "who": "ash153311@gmail.com", "when": "2018-05-01T17:40:47Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1459686"}], "who": "bugmail@mozilla.staktrace.com", "when": "2018-05-07T18:03:08Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1459714"}], "who": "bugmail@mozilla.staktrace.com", "when": "2018-05-07T19:43:31Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "regression"}, {"removed": "", "field_name": "cc", "added": "mcastelluccio@mozilla.com"}], "who": "mcastelluccio@mozilla.com", "when": "2018-05-08T12:16:25Z"}, {"changes": [{"removed": "", "field_name": "see_also", "added": "https://github.com/servo/webrender/pull/2762"}, {"removed": "", "field_name": "depends_on", "added": "1461342"}, {"removed": "kvark@mozilla.com", "field_name": "assigned_to", "added": "bugmail@mozilla.staktrace.com"}], "who": "bugmail@mozilla.staktrace.com", "when": "2018-05-16T19:00:25Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8976992, "added": "review?(sotaro.ikeda.g@gmail.com)"}], "who": "bugmail@mozilla.staktrace.com", "when": "2018-05-18T14:32:01Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(sotaro.ikeda.g@gmail.com)", "attachment_id": 8976992, "added": "review+"}], "who": "sotaro.ikeda.g@gmail.com", "when": "2018-05-18T23:00:37Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla62"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2018-05-19 09:41:26"}, {"removed": "---", "field_name": "cf_status_firefox62", "added": "fixed"}], "who": "ebalazs@mozilla.com", "when": "2018-05-19T09:41:26Z"}, {"changes": [{"removed": "---", "field_name": "cf_status_firefox_esr60", "added": "unaffected"}], "who": "ryanvm@gmail.com", "when": "2018-05-20T19:21:41Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1462903"}], "who": "bugmail@mozilla.staktrace.com", "when": "2018-05-22T12:57:27Z"}], "resolution": "FIXED", "op_sys": "Linux", "cf_fx_points": "---", "cf_blocking_fennec": "---"}