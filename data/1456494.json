{"cf_tracking_thunderbird_esr52": "---", "status": "RESOLVED", "cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "cf_tracking_firefox62": "---", "creator": "nicolas.b.pierron@mozilla.com", "mentors_detail": [], "depends_on": [], "cf_status_firefox_esr60": "---", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "keywords": [], "cc_detail": [{"email": "jcoppeard@mozilla.com", "id": 443194, "name": "jcoppeard@mozilla.com", "real_name": "Jon Coppeard (:jonco)"}, {"email": "jdemooij@mozilla.com", "id": 375297, "name": "jdemooij@mozilla.com", "real_name": "Jan de Mooij [:jandem]"}, {"email": "nicolas.b.pierron@mozilla.com", "id": 422187, "name": "nicolas.b.pierron@mozilla.com", "real_name": "Nicolas B. Pierron [:nbp] {backlog: 36}"}, {"email": "nth10sd@gmail.com", "id": 132034, "name": "nth10sd@gmail.com", "real_name": "Gary Kwong [:gkw] [:nth10sd]"}], "cf_last_resolved": "2018-04-26T14:17:54Z", "attachments": [{"creator": "jdemooij@mozilla.com", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2018-04-25T10:21:36Z", "type_id": 4, "creation_date": "2018-04-25T10:19:32Z", "id": 1748736, "setter": "jcoppeard@mozilla.com"}], "content_type": "text/plain", "id": 8970839}], "votes": 0, "classification": "Components", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 7, "comments": [{"text": "I reproduced this bug under rr, in this case it failed during the parent process creation, before rendering any window.\n\nThread 1 received signal SIGSEGV, Segmentation fault.\n0x00007f332d3532ab in js::CheckZone<(js::AllowedHelperThread)0>::check (this=0x3240538) at /home/nicolas/mozilla/wksp-5/js/src/threading/ProtectedData.cpp:74\n74              MOZ_ASSERT(zone->ownedByCurrentHelperThread());\n(rr) bt\n#0  0x00007f332d3532ab in js::CheckZone<(js::AllowedHelperThread)0>::check (this=0x3240538) at /home/nicolas/mozilla/wksp-5/js/src/threading/ProtectedData.cpp:74\n#1  0x00007f332d91bf7c in js::ProtectedData<js::CheckZone<(js::AllowedHelperThread)0>, mozilla::EnumeratedArray<js::gc::AllocKind, (js::gc::AllocKind)29, js::gc::FreeSpan*> >::ref\n (this=0x3240450) at /home/nicolas/mozilla/wksp-5/js/src/threading/ProtectedData.h:103\n#2  0x00007f332d900d22 in js::gc::ArenaLists::freeLists (this=0x3240448) at /home/nicolas/mozilla/wksp-5/js/src/gc/ArenaList.h:226\n#3  0x00007f332d8e17bf in js::gc::ArenaLists::ArenaLists (this=0x3240448, rt=0x12447a0, zone=0x32403a0) at /home/nicolas/mozilla/wksp-5/js/src/gc/GC.cpp:3083\n#4  0x00007f332d9ab6a3 in JS::Zone::Zone (this=0x32403a0, rt=0x12447a0) at /home/nicolas/mozilla/wksp-5/js/src/gc/Zone.cpp:67\n#5  0x00007f332d928267 in js::MallocProvider<JSContext>::new_<JS::Zone, JSRuntime*> (this=0x1249eb0, args#0=@0x7ffd98676508: 0x12447a0)\n    at /home/nicolas/mozilla/wksp-5/js/src/vm/MallocProvider.h:187\n#6  0x00007f332d8f193f in js::NewCompartment (cx=0x1249eb0, principals=0x0, options=...) at /home/nicolas/mozilla/wksp-5/js/src/gc/GC.cpp:7936\n#7  0x00007f332d45dc47 in js::GlobalObject::new_ (cx=0x1249eb0, clasp=0x7f3333db3c80 <parseTaskGlobalClass>, principals=0x0, hookOption=JS::DontFireOnNewGlobalHook, options=...)\n    at /home/nicolas/mozilla/wksp-5/js/src/vm/GlobalObject.cpp:500\n#8  0x00007f332d2ecf44 in JS_NewGlobalObject (cx=0x1249eb0, clasp=0x7f3333db3c80 <parseTaskGlobalClass>, principals=0x0, hookOption=JS::DontFireOnNewGlobalHook, options=...)\n    at /home/nicolas/mozilla/wksp-5/js/src/jsapi.cpp:1943\n#9  0x00007f332d462660 in CreateGlobalForOffThreadParse (cx=0x1249eb0, nogc=...) at /home/nicolas/mozilla/wksp-5/js/src/vm/HelperThreads.cpp:714\n#10 0x00007f332d46286c in StartOffThreadParseTask (cx=0x1249eb0, task=0x1ce5040, options=...) at /home/nicolas/mozilla/wksp-5/js/src/vm/HelperThreads.cpp:756\n#11 0x00007f332d4629dc in js::StartOffThreadParseScript (cx=0x1249eb0, options=...,\n    chars=0x3250860 u\"/* -*- Mode: indent-tabs-mode: nil; js-indent-level: 2 -*- */\\n/* vim: set sts=2 sw=2 et tw=80: */\\n/* This Source Code Form is subject to the terms of the M\nozilla Public\\n * License, v. 2.0. If a copy o\"..., length=60188, callback=0x7f332773b357 <OffThreadScriptLoaderCallback(void*, void*)>, callbackData=0x308be40)\n    at /home/nicolas/mozilla/wksp-5/js/src/vm/HelperThreads.cpp:783\n#12 0x00007f332d2f63d6 in JS::CompileOffThread (cx=0x1249eb0, options=...,\n    chars=0x3250860 u\"/* -*- Mode: indent-tabs-mode: nil; js-indent-level: 2 -*- */\\n/* vim: set sts=2 sw=2 et tw=80: */\\n/* This Source Code Form is subject to the terms of the M\nozilla Public\\n * License, v. 2.0. If a copy o\"..., length=60188, callback=0x7f332773b357 <OffThreadScriptLoaderCallback(void*, void*)>, callbackData=0x308be40)\n    at /home/nicolas/mozilla/wksp-5/js/src/jsapi.cpp:4271\n#13 0x00007f332773b4d1 in AsyncScriptCompiler::StartCompile (this=0x308be40, aCx=0x1249eb0) at /home/nicolas/mozilla/wksp-5/js/xpconnect/loader/ChromeScriptLoader.cpp:132\n#14 0x00007f332773bbd1 in AsyncScriptCompiler::OnStreamComplete (this=0x308be40, aLoader=0x308cdb0, aContext=0x0, aStatus=nsresult::NS_OK, aLength=60188,\n    aBuf=0x3241d30 \"/* -*- Mode: indent-tabs-mode: nil; js-indent-level: 2 -*- */\\n/* vim: set sts=2 sw=2 et tw=80: */\\n/* This Source Code Form is subject to the terms of the Moz\nilla Public\\n * License, v. 2.0. If a copy o\"...) at /home/nicolas/mozilla/wksp-5/js/xpconnect/loader/ChromeScriptLoader.cpp:250\n#15 0x00007f33269d5dc9 in nsIncrementalStreamLoader::OnStopRequest (this=0x308cdb0, request=0x308c648, ctxt=0x0, aStatus=nsresult::NS_OK)\n    at /home/nicolas/mozilla/wksp-5/netwerk/base/nsIncrementalStreamLoader.cpp:103\n#16 0x00007f33269ab238 in nsBaseChannel::OnStopRequest (this=0x308c600, request=0x308ce70, ctxt=0x0, status=nsresult::NS_OK)\n    at /home/nicolas/mozilla/wksp-5/netwerk/base/nsBaseChannel.cpp:878\n#17 0x00007f33269d946a in nsInputStreamPump::OnStateStop (this=0x308ce70) at /home/nicolas/mozilla/wksp-5/netwerk/base/nsInputStreamPump.cpp:708\n#18 0x00007f33269d83ff in nsInputStreamPump::OnInputStreamReady (this=0x308ce70, stream=0x308ca80) at /home/nicolas/mozilla/wksp-5/netwerk/base/nsInputStreamPump.cpp:436\n#19 0x00007f332686504d in nsInputStreamReadyEvent::Run (this=0x308c040) at /home/nicolas/mozilla/wksp-5/xpcom/io/nsStreamUtils.cpp:102\n#20 0x00007f33268b08a7 in nsThread::ProcessNextEvent (this=0x1179450, aMayWait=false, aResult=0x7ffd9867725f) at /home/nicolas/mozilla/wksp-5/xpcom/threads/nsThread.cpp:1096\n#21 0x00007f33268d0ef0 in NS_ProcessNextEvent (aThread=0x1179450, aMayWait=false) at /home/nicolas/mozilla/wksp-5/xpcom/threads/nsThreadUtils.cpp:519\n#22 0x00007f3327146199 in mozilla::ipc::MessagePump::Run (this=0x11573d0, aDelegate=0x1126400) at /home/nicolas/mozilla/wksp-5/ipc/glue/MessagePump.cpp:97\n#23 0x00007f332709ea07 in MessageLoop::RunInternal (this=0x1126400) at /home/nicolas/mozilla/wksp-5/ipc/chromium/src/base/message_loop.cc:326\n#24 0x00007f332709e99a in MessageLoop::RunHandler (this=0x1126400) at /home/nicolas/mozilla/wksp-5/ipc/chromium/src/base/message_loop.cc:319\n#25 0x00007f332709e973 in MessageLoop::Run (this=0x1126400) at /home/nicolas/mozilla/wksp-5/ipc/chromium/src/base/message_loop.cc:299\n#26 0x00007f332a555840 in nsBaseAppShell::Run (this=0x1580cb0) at /home/nicolas/mozilla/wksp-5/widget/nsBaseAppShell.cpp:157\n#27 0x00007f332ca62fdf in nsAppStartup::Run (this=0x1580c00) at /home/nicolas/mozilla/wksp-5/toolkit/components/startup/nsAppStartup.cpp:290\n#28 0x00007f332cba2ac2 in XREMain::XRE_mainRun (this=0x7ffd98677990) at /home/nicolas/mozilla/wksp-5/toolkit/xre/nsAppRunner.cpp:4834\n#29 0x00007f332cba372b in XREMain::XRE_main (this=0x7ffd98677990, argc=4, argv=0x7ffd98678d18, aConfig=...) at /home/nicolas/mozilla/wksp-5/toolkit/xre/nsAppRunner.cpp:4979\n#30 0x00007f332cba3a20 in XRE_main (argc=4, argv=0x7ffd98678d18, aConfig=...) at /home/nicolas/mozilla/wksp-5/toolkit/xre/nsAppRunner.cpp:5071\n#31 0x00007f332cbb61f6 in mozilla::BootstrapImpl::XRE_main (this=0x10a6180, argc=4, argv=0x7ffd98678d18, aConfig=...) at /home/nicolas/mozilla/wksp-5/toolkit/xre/Bootstrap.cpp:49\n#32 0x0000000000405f8f in do_main (argc=4, argv=0x7ffd98678d18, envp=0x7ffd98678d40) at /home/nicolas/mozilla/wksp-5/browser/app/nsBrowserApp.cpp:231\n#33 0x00000000004061b7 in main (argc=4, argv=0x7ffd98678d18, envp=0x7ffd98678d40) at /home/nicolas/mozilla/wksp-5/browser/app/nsBrowserApp.cpp:304\n\n(rr) p TlsContext.get()\n$3 = (JSContext *) 0x1249eb0\n(rr) p helperThreadOwnerContext_\n$5 = {<js::ProtectedData<js::CheckUnprotected, JSContext*>> = {value = 0x0, check = {<No data fields>}}, <No data fields>}\n(rr) p Zone::helperThreadUse.mValue._M_i\n$9 = (JS::Zone::HelperThreadUse::Pending | unknown: 629328)\n\nThis might be a regression from Bug 1452982.", "author": "nicolas.b.pierron@mozilla.com", "id": 13229657, "time": "2018-04-24T14:46:03Z"}, {"text": "helperThreadUse may be uninitialized at this point because it's set after we initialize the other fields.", "author": "jdemooij@mozilla.com", "id": 13229683, "time": "2018-04-24T14:56:27Z"}, {"text": "Created attachment 8970839\nPatch\n\nFix Zone constructor to initialize helperThreadUse_ first.\n\n(I could repro the assertion failure with a local hack: malloc + initialize memory with int32_t(2) + calling the constructor.)", "author": "jdemooij@mozilla.com", "id": 13232126, "time": "2018-04-25T10:19:32Z"}, {"text": "Comment on attachment 8970839\nPatch\n\nReview of attachment 8970839:\n-----------------------------------------------------------------\n\nNice, thanks for fixing this.", "author": "jcoppeard@mozilla.com", "id": 13232131, "time": "2018-04-25T10:21:36Z"}, {"text": "Pushed by jandemooij@gmail.com:\nhttps://hg.mozilla.org/integration/mozilla-inbound/rev/cecfe0621cfb\nInitialize Zone::helperThreadUse_ first to avoid accessing uninitialized memory in debug builds. r=jonco", "author": "pulsebot@bots.tld", "id": 13234675, "time": "2018-04-26T08:02:06Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/cecfe0621cfb", "author": "apavel@mozilla.com", "id": 13235355, "time": "2018-04-26T14:17:54Z"}, {"text": "*** Bug 1457232 has been marked as a duplicate of this bug. ***", "author": "jcoppeard@mozilla.com", "id": 13237886, "time": "2018-04-27T10:50:56Z"}], "id": 1456494, "priority": "P1", "cc": ["jcoppeard@mozilla.com", "jdemooij@mozilla.com", "nicolas.b.pierron@mozilla.com", "nth10sd@gmail.com"], "cf_crash_signature": "", "version": "unspecified", "is_cc_accessible": true, "cf_tracking_firefox_esr52": "---", "see_also": [], "cf_tracking_thunderbird_esr60": "---", "cf_platform_rel": "---", "product": "Core", "cf_fx_iteration": "---", "blocks": [1452982], "qa_contact": "", "creation_time": "2018-04-24T14:46:03Z", "cf_status_firefox_esr52": "---", "component": "JavaScript Engine", "assigned_to_detail": {"email": "jdemooij@mozilla.com", "id": 375297, "name": "jdemooij@mozilla.com", "real_name": "Jan de Mooij [:jandem]"}, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "---", "cf_status_firefox61": "fixed", "cf_status_firefox60": "---", "target_milestone": "mozilla61", "cf_rank": null, "cf_qa_whiteboard": "", "severity": "normal", "groups": [], "cf_status_thunderbird_esr52": "---", "url": "", "cf_status_thunderbird_esr60": "---", "creator_detail": {"email": "nicolas.b.pierron@mozilla.com", "id": 422187, "name": "nicolas.b.pierron@mozilla.com", "real_name": "Nicolas B. Pierron [:nbp] {backlog: 36}"}, "whiteboard": "", "mentors": [], "summary": "Start-up assertion: zone->ownedByCurrentHelperThread(), while creating an HelperThread global.", "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "last_change_time": "2018-04-27T10:50:56Z", "assigned_to": "jdemooij@mozilla.com", "is_open": false, "history": [{"changes": [{"removed": "--", "field_name": "priority", "added": "P1"}, {"removed": "---", "field_name": "cf_status_firefox61", "added": "affected"}], "who": "nicolas.b.pierron@mozilla.com", "when": "2018-04-24T14:46:41Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(jdemooij@mozilla.com)"}], "who": "jdemooij@mozilla.com", "when": "2018-04-24T14:56:27Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "ASSIGNED"}, {"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "jdemooij@mozilla.com"}, {"removed": "needinfo?(jdemooij@mozilla.com)", "field_name": "flagtypes.name", "added": ""}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8970839, "added": "review?(jcoppeard@mozilla.com)"}], "who": "jdemooij@mozilla.com", "when": "2018-04-25T10:19:32Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(jcoppeard@mozilla.com)", "attachment_id": 8970839, "added": "review+"}], "who": "jcoppeard@mozilla.com", "when": "2018-04-25T10:21:36Z"}, {"changes": [{"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla61"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2018-04-26 14:17:54"}, {"removed": "affected", "field_name": "cf_status_firefox61", "added": "fixed"}, {"removed": "ASSIGNED", "field_name": "status", "added": "RESOLVED"}], "who": "apavel@mozilla.com", "when": "2018-04-26T14:17:54Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "nth10sd@gmail.com"}], "who": "jcoppeard@mozilla.com", "when": "2018-04-27T10:50:56Z"}], "resolution": "FIXED", "op_sys": "Unspecified", "cf_fx_points": "---", "cf_blocking_fennec": "---"}