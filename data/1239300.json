{"cf_tracking_thunderbird_esr52": "---", "status": "RESOLVED", "cf_tracking_firefox60": "---", "attachments": [{"creator": "kakukogou@gmail.com", "is_obsolete": 1, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2016-01-19T13:45:43Z", "type_id": 4, "creation_date": "2016-01-19T06:37:29Z", "id": 1325744, "setter": "bugs@pettay.fi"}], "content_type": "text/plain", "id": 8709273}, {"creator": "kakukogou@gmail.com", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2016-01-23T06:20:38Z", "type_id": 4, "creation_date": "2016-01-23T06:20:38Z", "id": 1329035, "setter": "kakukogou@gmail.com"}], "content_type": "text/plain", "id": 8711300}], "classification": "Components", "creator": "bugs@pettay.fi", "cc": ["bugs@pettay.fi", "kakukogou@gmail.com"], "depends_on": [], "creation_time": "2016-01-13T13:58:25Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "cf_status_firefox58": "---", "cf_status_firefox59": "---", "keywords": [], "summary": "createImageBitmap ends up throwing wrong exceptions", "id": 1239300, "assigned_to_detail": {"email": "kakukogou@gmail.com", "id": 521651, "name": "kakukogou@gmail.com", "real_name": "Tzuhao Kuo [:kaku]"}, "severity": "normal", "is_confirmed": true, "is_creator_accessible": true, "cf_status_firefox45": "---", "cf_has_regression_range": "---", "assigned_to": "kakukogou@gmail.com", "comment_count": 21, "comments": [{"text": "Testcase:\ncreateImageBitmap(new Blob()).catch(function(a) { console.log(a); });\nin web console\n\nI see NS_ERROR_NOT_AVAILABLE, but if I read the spec correctly, the Promise should be\nresolved with null.", "author": "bugs@pettay.fi", "id": 11072308, "time": "2016-01-13T13:58:25Z"}, {"text": "(In reply to Olli Pettay [:smaug] from comment #0)\n> Testcase:\n> createImageBitmap(new Blob()).catch(function(a) { console.log(a); });\n> in web console\n> \n> I see NS_ERROR_NOT_AVAILABLE, but if I read the spec correctly, the Promise\n> should be resolved with null.\nShould it be \"rejected\" with null, instead of \"resolved\" with null?\n(Spec here: https://html.spec.whatwg.org/multipage/webappapis.html#images)", "author": "kakukogou@gmail.com", "id": 11074993, "time": "2016-01-14T03:29:09Z"}, {"text": "er, yes, rejected with null.", "author": "bugs@pettay.fi", "id": 11075784, "time": "2016-01-14T12:46:39Z"}, {"text": "So, we do reject the promise in this case but with an error message. \n\nHowever, what exactly \"reject the promise with null\" is? In our code base, we all reject promise with an error code. The most similar thing that I can recall is \"resolve the promise with void\" which we call Promise::MaybeResolve(JS::UndefinedHandleValue). \n\nShould we instead reject the promise with JS::UndefinedHandleValue?", "author": "kakukogou@gmail.com", "id": 11078402, "time": "2016-01-15T01:55:37Z"}, {"text": "or, should it be \"JS::NullHandleValue\"?", "author": "kakukogou@gmail.com", "id": 11078763, "time": "2016-01-15T06:54:31Z"}, {"text": "JS::NullHandleValue sounds right.", "author": "bugs@pettay.fi", "id": 11079644, "time": "2016-01-15T14:07:15Z"}, {"text": "Thanks, then I will go this way!", "author": "kakukogou@gmail.com", "id": 11082094, "time": "2016-01-16T04:28:01Z"}, {"text": "Created attachment 8709273\nBug1239300 - reject prmoise with null while creating imagebitmap from empty blob; r?smaug", "author": "kakukogou@gmail.com", "id": 11086388, "time": "2016-01-19T06:37:29Z"}, {"text": "Comment on attachment 8709273\nBug1239300 - reject prmoise with null while creating imagebitmap from empty blob; r?smaug\n\n># Parent  a77b73c7723e1060993045fb31eb2f0a30473486\n>Bug1239300 - reject prmoise with null while creating imagebitmap from empty blob; r?smaug\ns/prmoise/promise/\n\n>@@ -0,0 +1,19 @@\n>+function testBug1239300() {\n>+  return new Promise(function(resolve, reject) {\n>+    createImageBitmap(new Blob()).then(\n>+      function() {\n>+        ok(false, \"The promise should be reject with null.\");\nshould reject or should be rejected\n\n>+        reject();\n>+      },\n>+      function(result) {\n>+        if (result == null) {\n>+          ok(true, \"The promise should be reject with null.\");\n>+          resolve();\n>+        } else {\n>+          ok(false, \"The promise should be reject with null.\");\nwith these too\n\n\n> [test_imagebitmap.html]\n>+tags = imagebitmap\n> [test_imagebitmap_close.html]\n>+tags = imagebitmap\n> [test_imagebitmap_cropping.html]\n>+tags = imagebitmap\n> [test_imagebitmap_on_worker.html]\n>+tags = imagebitmap\n> [test_imagebitmap_structuredclone.html]\n>+tags = imagebitmap\n> [test_imagebitmap_structuredclone_iframe.html]\n>+tags = imagebitmap\n> [test_imagebitmap_structuredclone_window.html]\n>+tags = imagebitmap\n> [test_imagebitmap_transfer.html]\n>+tags = imagebitmap\nI'm not familiar with 'tags'. I assume it is something useful :)", "author": "bugs@pettay.fi", "id": 11087118, "time": "2016-01-19T13:45:43Z"}, {"text": "(In reply to Olli Pettay [:smaug] (expect slower than usual review time for couple of days) from comment #8)\nThanks for your review. \nI should pay attention to my typos more..., sorry about that.\n\n> > [test_imagebitmap_transfer.html]\n> >+tags = imagebitmap\n> I'm not familiar with 'tags'. I assume it is something useful :)\nYes, so that you can use \"./mach mochitest <tag name>\" to invoke all test files tagged with the <tag name>.", "author": "kakukogou@gmail.com", "id": 11090144, "time": "2016-01-20T02:44:18Z"}, {"text": "Created attachment 8711300\nBug1239300 - reject promise with null while creating imagebitmap from empty blob; r=smaug\n\nCarry r+.", "author": "kakukogou@gmail.com", "id": 11101410, "time": "2016-01-23T06:20:38Z"}, {"text": "Try:\nhttps://treeherder.mozilla.org/#/jobs?repo=try&revision=e6c5bad441fe", "author": "kakukogou@gmail.com", "id": 11101411, "time": "2016-01-23T06:21:15Z"}, {"text": "https://hg.mozilla.org/integration/mozilla-inbound/rev/060438e9046e", "author": "pulsebot@bots.tld", "id": 11111655, "time": "2016-01-27T10:25:40Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/060438e9046e", "author": "cbook@mozilla.com", "id": 11115866, "time": "2016-01-28T11:27:31Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/060438e9046e", "author": "cbook@mozilla.com", "id": 11115867, "time": "2016-01-28T11:27:32Z"}, {"text": "Where do you see the spec saying to reject with null?  That's a _really_ weird thing to be doing, and I don't see it anywhere in the spec...", "author": "bzbarsky@mit.edu", "id": 11609222, "time": "2016-08-09T03:08:03Z"}, {"text": "Neither do I see it now, the spec might has been modified. I am happy to update the code if :smaug also agree on it.", "author": "kakukogou@gmail.com", "id": 11609302, "time": "2016-08-09T04:07:31Z"}, {"text": "I'm pretty sure the spec talked about null. Nothing weird about that. \nBut since the spec has changed, ok to change the implementation.", "author": "bugs@pettay.fi", "id": 11610112, "time": "2016-08-09T12:45:12Z"}, {"text": "https://github.com/whatwg/html/pull/884 changed the spec", "author": "bugs@pettay.fi", "id": 11610121, "time": "2016-08-09T12:47:45Z"}, {"text": "> Nothing weird about that.\n\nRejecting with null is just as weird as throwing null would be.  Can you imagine a spec ever saying to throw null?", "author": "bzbarsky@mit.edu", "id": 11610197, "time": "2016-08-09T13:10:26Z"}, {"text": "rejecting with exceptions is the weird thing. Rejecting with null would be just fine, IMHO - some resource just isn't available so you get null.", "author": "bugs@pettay.fi", "id": 11610209, "time": "2016-08-09T13:14:22Z"}], "cf_last_resolved": "2016-01-28T11:27:31Z", "priority": "--", "mentors_detail": [], "cf_crash_signature": "", "version": "36 Branch", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox59": "---", "last_change_time": "2016-08-10T02:21:45Z", "cf_platform_rel": "---", "product": "Core", "cf_status_firefox_esr52": "---", "blocks": [1293878], "qa_contact": "", "see_also": [], "cf_fx_iteration": "---", "component": "DOM", "votes": 0, "groups": [], "cf_status_firefox60": "---", "target_milestone": "mozilla47", "is_cc_accessible": true, "cf_status_thunderbird_esr52": "---", "url": "", "creator_detail": {"email": "bugs@pettay.fi", "id": 39966, "name": "bugs@pettay.fi", "real_name": "Olli Pettay [:smaug]"}, "whiteboard": "", "mentors": [], "cc_detail": [{"email": "bugs@pettay.fi", "id": 39966, "name": "bugs@pettay.fi", "real_name": "Olli Pettay [:smaug]"}, {"email": "kakukogou@gmail.com", "id": 521651, "name": "kakukogou@gmail.com", "real_name": "Tzuhao Kuo [:kaku]"}], "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "cf_tracking_firefox58": "---", "cf_rank": null, "is_open": false, "history": [{"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(tkuo@mozilla.com)"}], "who": "bugs@pettay.fi", "when": "2016-01-13T14:02:38Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "bugs@pettay.fi"}, {"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "tkuo@mozilla.com"}, {"removed": "needinfo?(tkuo@mozilla.com)", "field_name": "flagtypes.name", "added": "needinfo?(bugs@pettay.fi)"}], "who": "kakukogou@gmail.com", "when": "2016-01-14T03:29:09Z"}, {"changes": [{"removed": "needinfo?(bugs@pettay.fi)", "field_name": "flagtypes.name", "added": ""}], "who": "bugs@pettay.fi", "when": "2016-01-14T12:46:39Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(bugs@pettay.fi)"}], "who": "kakukogou@gmail.com", "when": "2016-01-15T01:55:37Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "ASSIGNED"}], "who": "kakukogou@gmail.com", "when": "2016-01-15T01:56:00Z"}, {"changes": [{"removed": "needinfo?(bugs@pettay.fi)", "field_name": "flagtypes.name", "added": ""}], "who": "bugs@pettay.fi", "when": "2016-01-15T14:07:15Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8709273, "added": "review?(bugs@pettay.fi)"}], "who": "kakukogou@gmail.com", "when": "2016-01-19T06:37:29Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(bugs@pettay.fi)", "attachment_id": 8709273, "added": "review+"}], "who": "bugs@pettay.fi", "when": "2016-01-19T13:45:43Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8709273, "added": "1"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8711300, "added": "review+"}], "who": "kakukogou@gmail.com", "when": "2016-01-23T06:20:38Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "checkin-needed"}], "who": "kakukogou@gmail.com", "when": "2016-01-26T02:14:36Z"}, {"changes": [{"removed": "checkin-needed", "field_name": "keywords", "added": ""}], "who": "pulsebot@bots.tld", "when": "2016-01-27T10:25:40Z"}, {"changes": [{"removed": "ASSIGNED", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla47"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2016-01-28 03:27:31"}, {"removed": "---", "field_name": "cf_status_firefox47", "added": "fixed"}], "who": "cbook@mozilla.com", "when": "2016-01-28T11:27:31Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(kaku@mozilla.com), needinfo?(bugs@pettay.fi)"}], "who": "bzbarsky@mit.edu", "when": "2016-08-09T03:08:03Z"}, {"changes": [{"removed": "needinfo?(kaku@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "kakukogou@gmail.com", "when": "2016-08-09T04:07:31Z"}, {"changes": [{"removed": "needinfo?(bugs@pettay.fi)", "field_name": "flagtypes.name", "added": ""}], "who": "bugs@pettay.fi", "when": "2016-08-09T12:45:12Z"}, {"changes": [{"removed": "", "field_name": "blocks", "added": "1293878"}], "who": "kakukogou@gmail.com", "when": "2016-08-10T02:21:45Z"}], "resolution": "FIXED", "op_sys": "Unspecified", "cf_fx_points": "---", "cf_blocking_fennec": "---"}