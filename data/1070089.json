{"status": "RESOLVED", "cf_tracking_firefox60": "---", "attachments": [{"creator": "ttromey@mozilla.com", "is_obsolete": 1, "is_patch": 1, "flags": [{"status": "+", "name": "feedback", "modification_date": "2014-09-22T17:45:11Z", "type_id": 607, "creation_date": "2014-09-22T17:45:11Z", "id": 984167, "setter": "vporof@mozilla.com"}], "content_type": "text/plain", "id": 8493183}, {"creator": "ttromey@mozilla.com", "is_obsolete": 1, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2014-09-24T16:13:32Z", "type_id": 748, "creation_date": "2014-09-24T16:13:32Z", "id": 986564, "setter": "vporof@mozilla.com"}], "content_type": "text/plain", "id": 8493972}, {"creator": "ttromey@mozilla.com", "is_obsolete": 1, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2014-10-09T17:58:22Z", "type_id": 748, "creation_date": "2014-10-03T11:11:03Z", "id": 995115, "setter": "b56girard@gmail.com"}, {"status": "-", "name": "review", "modification_date": "2014-10-10T16:27:35Z", "type_id": 748, "creation_date": "2014-10-10T15:08:37Z", "id": 1001493, "setter": "bugs@pettay.fi"}, {"status": "+", "name": "feedback", "modification_date": "2014-10-03T11:19:25Z", "type_id": 607, "creation_date": "2014-10-03T11:11:03Z", "id": 995116, "setter": "vporof@mozilla.com"}], "content_type": "text/plain", "id": 8498729}, {"creator": "ttromey@mozilla.com", "is_obsolete": 1, "is_patch": 1, "flags": [], "content_type": "text/plain", "id": 8505512}, {"creator": "ttromey@mozilla.com", "is_obsolete": 1, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2014-10-15T22:07:47Z", "type_id": 748, "creation_date": "2014-10-15T20:31:26Z", "id": 1005990, "setter": "bugs@pettay.fi"}], "content_type": "text/plain", "id": 8505517}, {"creator": "ttromey@mozilla.com", "is_obsolete": 0, "is_patch": 1, "flags": [], "content_type": "text/plain", "id": 8506123}], "classification": "Client Software", "creator": "ttromey@mozilla.com", "cc": ["andrei.vaida@softvision.ro", "b56girard@gmail.com", "bugs@pettay.fi", "cbook@mozilla.com", "jordan@jsantell.com", "nfitzgerald@mozilla.com", "paul@mozilla.com", "pbrosset@mozilla.com", "ttromey@mozilla.com", "vporof@mozilla.com"], "depends_on": [], "creation_time": "2014-09-19T19:14:33Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "x86_64", "cf_status_firefox58": "---", "cf_status_firefox59": "---", "keywords": [], "summary": "make marker times start at consistent epoch", "cf_last_resolved": "2014-10-20T12:59:13Z", "assigned_to_detail": {"email": "ttromey@mozilla.com", "id": 516940, "name": "ttromey@mozilla.com", "real_name": "Tom Tromey :tromey"}, "severity": "normal", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "assigned_to": "ttromey@mozilla.com", "comment_count": 45, "comments": [{"text": "Currently marker times are relative to the point at which\ntimeline recording was started; but this can vary by docshell.\nInstead, ake the times relative to some consistent epoch.", "author": "ttromey@mozilla.com", "id": 9335344, "time": "2014-09-19T19:14:33Z"}, {"text": "Making them relative to 'window.performance.now()' could be an option.", "author": "pbrosset@mozilla.com", "id": 9339915, "time": "2014-09-22T07:57:50Z"}, {"text": "What about using a absolute timestamp? Like always using `TimeStamp::Now()`? What's the point of doing `TimeStamp::Now() - mProfileTimelineStartTime`?", "author": "paul@mozilla.com", "id": 9341926, "time": "2014-09-22T16:02:34Z"}, {"text": "Created attachment 8493183\nchange timeline markers to start at epoch\n\nVictor -- the particular hacky bit is in actors/timeline.js, where the\nmarker start and end times are offset.", "author": "ttromey@mozilla.com", "id": 9342133, "time": "2014-09-22T16:36:51Z"}, {"text": "Comment on attachment 8493183\nchange timeline markers to start at epoch\n\nReview of attachment 8493183:\n-----------------------------------------------------------------\n\nShould get a review from benwa as well for the docshell changes.\n\n::: browser/devtools/timeline/timeline.js\n@@ +108,5 @@\n>     */\n>    _startRecording: function*() {\n>      this._markers = [];\n> +    this._markers.startTime = 1000 * Date.now();\n> +    this._markers.endTime = 1000 * Date.now();\n\nThese should be set after calling start with the startTime retrieved from the actor, since communication over the protocol might take a noticeable amount of time. See my remarks inside the actor code.\n\nSomething like this:\n\n_startRecording: function*() {\n  TimelineView.handleRecordingStarted();\n  let startTime = yield gFront.start();  \n  this._markers = [];\n  this._markers.startTime = startTime;\n  this._markers.endTime = startTime;\n})\n\n::: browser/devtools/timeline/widgets/overview.js\n@@ +56,5 @@\n>      this.setBlueprint(TIMELINE_BLUEPRINT);\n>  \n>      var preview = [];\n> +    preview.startTime = 1000 * Date.now();\n> +    preview.endTime = preview.startTime + 1000 * 1000;\n\nThese don't need to be changed, they're just here to offer a nice default preview with a few divisions when the graph is initially built.\n\n::: toolkit/devtools/server/actors/timeline.js\n@@ +116,5 @@\n>      if (markers.length > 0) {\n> +      for (let marker of markers) {\n> +        marker.start -= this._startTime;\n> +        marker.end -= this._startTime;\n> +      }\n\nInstead of iterating over all the markers here (which might take cpu time and slow down devices with restricted hardware), it might be a better idea to expose the startTime when calling `start`, and offset everything in the frontend. See below.\n\n@@ +153,5 @@\n>        docShell.recordProfileTimelineMarkers = true;\n>      }\n>  \n>      this._pullTimelineData();\n>    }, {}),\n\n(function() {\n  ...\n  return this._startTime;\n}, {\n  request: {},\n  response: {\n    value: RetVal(\"number\")\n  }\n})\n\n\nThen, take a look inside browser/devtools/timeline/widgets/overview.js, grep \"Draw the timeline markers.\". The `start` and `end` properties should be offset there by `this._data.startTime`.\n\n\nI *think* that should be enough. If I'm missing something, I'll take a look myself at an updated patch.", "author": "vporof@mozilla.com", "id": 9342547, "time": "2014-09-22T17:45:11Z"}, {"text": "If you store milliseconds/nanosecond in float/double since epoch you're very likely to run into precision issues. The JS precision is insufficient for nanosecond since epoch. We also avoided using PRTime since it's deprecated. So we normalized everything from a common timestamp, the profiling start.", "author": "b56girard@gmail.com", "id": 9348204, "time": "2014-09-23T16:02:06Z"}, {"text": "(In reply to Benoit Girard (:BenWa) from comment #5)\n> If you store milliseconds/nanosecond in float/double since epoch you're very\n> likely to run into precision issues. The JS precision is insufficient for\n> nanosecond since epoch. We also avoided using PRTime since it's deprecated.\n> So we normalized everything from a common timestamp, the profiling start.\n\nBut the profiling start can vary by docshell.\nIt depends, I suppose, on the timing of this loop in timeline.js:\n\n    for (let docShell of this.docShells) {\n      docShell.recordProfileTimelineMarkers = true;\n    }\n\n\nThe patch here is using microseconds since epoch, but that does cause issues,\nsince the timeline is formulated to use milliseconds.  My current tree\nis using milliseconds since epoch.  This also fits better with the\nuse of DOMTimeStamp in ProfileTimelineMarker.webidl, as that is defined in\nmilliseconds.\n\nI think milliseconds since epoch doesn't overflow for quite a long time.\nAssuming my math is right, 2^53+1 is when an integer overflows, so computing\nseconds:\n\n(2^53+1)/1000\n9007199254740.99300000000000000000\n\nFeeding into date:\n\ndate --date=@9007199254741\nWed Oct 12 02:59:01 MDT 287396\n\nSo we have hundreds of thousands of years.\n\nI agree about nanoseconds since the epoch.  If that is what we want then\nwe need another approach, probably also changing the webidl.\n\n\nI couldn't find anything about PRTime being deprecated.  \n\n\nFWIW I'm happy to try some other approach.  One idea might be to let timeline.js\ntell docshell the start time.  I think we ruled out performance.now because it is\nalso computed relative to events we want to mark - reloads I think.  Also it wasn't\nclear how to fetch this from the c++ side, though that's surmountable I'm sure.", "author": "ttromey@mozilla.com", "id": 9348760, "time": "2014-09-23T17:37:34Z"}, {"text": "Created attachment 8493972\nchange timeline markers to start at epoch\n\nThis patch addresses Victor's comments.  Thanks Victor!\n\nIt also changes the times on the markers to be in milliseconds since\nthe epoch.  This was needed because the timeline and other code is all\ndone in terms of milliseconds (mostly this matters for the labels...);\nbut it is also simpler and more consistent with other code.", "author": "ttromey@mozilla.com", "id": 9349640, "time": "2014-09-23T20:12:01Z"}, {"text": "Comment on attachment 8493972\nchange timeline markers to start at epoch\n\nReview of attachment 8493972:\n-----------------------------------------------------------------\n\nI love the timeline changes.", "author": "vporof@mozilla.com", "id": 9354512, "time": "2014-09-24T16:13:32Z"}, {"text": "https://tbpl.mozilla.org/?tree=Try&rev=37c6ace7890f", "author": "ttromey@mozilla.com", "id": 9354568, "time": "2014-09-24T16:22:06Z"}, {"text": "Just FYI - the patch needs a little work to fix up the other test cases.\nI will do that tomorrow.", "author": "ttromey@mozilla.com", "id": 9356141, "time": "2014-09-24T20:46:18Z"}, {"text": "https://tbpl.mozilla.org/?tree=Try&rev=17dc860f2d1d", "author": "ttromey@mozilla.com", "id": 9362283, "time": "2014-09-25T18:35:02Z"}, {"text": "> I couldn't find anything about PRTime being deprecated.  \n\nVictor filled me in that this is true but not necessarily written down.\n\nAlso the current patch using PR_Now shows odd behavior on Windows -- for example\nthe marker array start time coming after the time of the first marker.\n\nI'm looking into using some other approach now.", "author": "ttromey@mozilla.com", "id": 9373113, "time": "2014-09-29T10:35:32Z"}, {"text": "Created attachment 8498729\nchange timeline markers to have a consistent epoch\n\nThe previous patch used Date.now to get a consistent epoch.  However\nthis caused some failures on Windows, presumably due to the well-known\nissues with Date.now.\n\nThis new patch uses the chrome window's performance object as a\nbaseline.  This ensures consistent times from all the docshells.\n\nThe current tree has another subtle problem where timeline/timeline.js\nuses local times.  It's only really correct to use times from the\nactor; there's no guarantee that the times are in sync.\n\nThe patch mostly fixes this, but currently computes an approximate\nelapsed time.  See _startRecording and _onRecordingTick.  Without this\nchange, the timeline will update only when data arrives from the\nactor.  Another approach here would be to have the actor send a\nperiodic \"heartbeat\" event with just the time, but I chose to go with\nless traffic.\n\nFinally, this patch changes ProfileTimelineMarker.webidl to note the\nnew type of the time that is delivered.", "author": "ttromey@mozilla.com", "id": 9392648, "time": "2014-10-02T08:48:52Z"}, {"text": "Try: https://tbpl.mozilla.org/?tree=Try&rev=2224b38fa355", "author": "ttromey@mozilla.com", "id": 9392653, "time": "2014-10-02T08:50:52Z"}, {"text": "Comment on attachment 8498729\nchange timeline markers to have a consistent epoch\n\nReview of attachment 8498729:\n-----------------------------------------------------------------\n\nVery happy with the changes outside nsDocShell.\n\n::: browser/devtools/timeline/timeline.js\n@@ +162,5 @@\n>     */\n>    _onRecordingTick: function() {\n> +    // Compute an approximate ending time for the view.  This is\n> +    // needed to ensure that the view updates even when new data is\n> +    // not being generated.\n\nThis is a very reasonable compromise. Updating the overview periodically is done mostly to give a sense of time passing even though there are no new markers, and doesn't necessarily have to be precise.", "author": "vporof@mozilla.com", "id": 9398732, "time": "2014-10-03T11:19:25Z"}, {"text": "this needs dom peer review it seems:\n\nWebIDL file dom/webidl/ProfileTimelineMarker.webidl altered in changeset 7fe43ea5ffbe without DOM peer review", "author": "cbook@mozilla.com", "id": 9429478, "time": "2014-10-10T07:54:16Z"}, {"text": "Comment on attachment 8498729\nchange timeline markers to have a consistent epoch\n\nThis patch needs DOM peer review for the webidl change.", "author": "ttromey@mozilla.com", "id": 9430784, "time": "2014-10-10T15:08:37Z"}, {"text": "(and changes to docshell/ need a docshell peer review ;) )", "author": "bugs@pettay.fi", "id": 9431115, "time": "2014-10-10T16:13:11Z"}, {"text": "Comment on attachment 8498729\nchange timeline markers to have a consistent epoch\n\n> nsDocShell::AddProfileTimelineMarker(const char* aName,\n>                                      TracingMetadata aMetaData)\n> {\n> #ifdef MOZ_ENABLE_PROFILER_SPS\n>-  if (!mProfileTimelineStartTime.IsNull()) {\n>-    float delta = GetProfileTimelineDelta();\n>-    ProfilerMarkerTracing* payload = new ProfilerMarkerTracing(\"Timeline\",\n>-                                                               aMetaData);\n>-    mProfileTimelineMarkers.AppendElement(\n>-      new InternalProfileTimelineMarker(aName, payload, delta));\n>+  nsCOMPtr<nsIDocShellTreeItem> root;\n>+  if (mProfileTimelineRecording\n>+      && NS_SUCCEEDED(GetRootTreeItem(getter_AddRefs(root)))) {\n>+    nsDocShell* topDocShell = static_cast<nsDocShell*>(root.get());\n>+    nsCOMPtr<nsIDocument> doc(do_GetInterface(GetAsSupports(topDocShell)));\n>+    if (doc) {\n>+      nsCOMPtr<nsPIDOMWindow> win = doc->GetInnerWindow();\n>+      if (win) {\n>+        DOMHighResTimeStamp when = win->GetPerformance()->Now();\nI don't understand how this works in case of page loads. In such case inner window is changed and \n\"The now method MUST return a DOMHighResTimeStamp representing the number of milliseconds from the navigationStart\nattribute of the PerformanceTiming interface [NavigationTiming], the start of navigation of the document, to the occurrence of the call to the now method. \"\n\nr+ for the .webidl change, but r- for the Docshell change, since I'm not aware of anything which guarantees we reset timeline profiling when a new page is loaded.\nIf we do such reset, please explain and ask review again.", "author": "bugs@pettay.fi", "id": 9431216, "time": "2014-10-10T16:27:35Z"}, {"text": "(In reply to Olli Pettay [:smaug] from comment #19)\n> Comment on attachment 8498729\n> change timeline markers to have a consistent epoch\n> \n> > nsDocShell::AddProfileTimelineMarker(const char* aName,\n> >                                      TracingMetadata aMetaData)\n> > {\n> > #ifdef MOZ_ENABLE_PROFILER_SPS\n> >-  if (!mProfileTimelineStartTime.IsNull()) {\n> >-    float delta = GetProfileTimelineDelta();\n> >-    ProfilerMarkerTracing* payload = new ProfilerMarkerTracing(\"Timeline\",\n> >-                                                               aMetaData);\n> >-    mProfileTimelineMarkers.AppendElement(\n> >-      new InternalProfileTimelineMarker(aName, payload, delta));\n> >+  nsCOMPtr<nsIDocShellTreeItem> root;\n> >+  if (mProfileTimelineRecording\n> >+      && NS_SUCCEEDED(GetRootTreeItem(getter_AddRefs(root)))) {\n> >+    nsDocShell* topDocShell = static_cast<nsDocShell*>(root.get());\n> >+    nsCOMPtr<nsIDocument> doc(do_GetInterface(GetAsSupports(topDocShell)));\n> >+    if (doc) {\n> >+      nsCOMPtr<nsPIDOMWindow> win = doc->GetInnerWindow();\n> >+      if (win) {\n> >+        DOMHighResTimeStamp when = win->GetPerformance()->Now();\n> I don't understand how this works in case of page loads. In such case inner\n> window is changed and \n> \"The now method MUST return a DOMHighResTimeStamp representing the number of\n> milliseconds from the navigationStart\n> attribute of the PerformanceTiming interface [NavigationTiming], the start\n> of navigation of the document, to the occurrence of the call to the now\n> method. \"\n\nThe idea was to find the outermost docshell's window and use it as the base point.\nThe window in question here is the chrome window.\nIn gdb with \"set print object on\":\n\n(gdb) p win.mRawPtr\n$3 = (nsGlobalChromeWindow *) 0x7fa2874db400\n\nThe idea here was that this won't change across page loads.\nA simple hand test of this (start the timeline, see some markers, then\nreload and wait for more markers) shows that it seems to work.\n\nI'm not sure if the patch expresses this idea in the best way or not.\n\nAnd TBH I am still not certain this is the very best approach since I\nstill don't know how this timer will be correlated with the memory events,\nwhich are using PR_Now.  (But see above for the reasons this patch isn't using PR_Now.)\n\nNeedinfo'ing you to tell me if this is ok or not.", "author": "ttromey@mozilla.com", "id": 9440359, "time": "2014-10-13T20:32:54Z"}, {"text": "(In reply to Tom Tromey :tromey from comment #20)\n> The idea was to find the outermost docshell's window and use it as the base\n> point.\n> The window in question here is the chrome window.\nNo it isn't in e10s/child process, and that is where the web pages live in e10s.\n\nDo we just need some random time and offset from that? Couldn't we then have a static TimeStamp in\nDocshell or something?", "author": "bugs@pettay.fi", "id": 9444558, "time": "2014-10-14T15:47:05Z"}, {"text": "> Do we just need some random time and offset from that? Couldn't we then have\n> a static TimeStamp in\n> Docshell or something?\n\nI think we need access to the baseline in order to draw the graph properly.\nFrom actor/timeline.js:\n\n    this._startTime = this._chromeWin.performance.now();\n\nHaving a static in docshell would work ok if we could access the value from JS.\nIf this is ok with you I will try it out.\n\nI'm still not sure how synchronizing with the memory data will work given\nthat this data is using PR_Now.", "author": "ttromey@mozilla.com", "id": 9445269, "time": "2014-10-14T17:43:41Z"}, {"text": "Why do we need to access the start time if we stored offset to the start time?", "author": "bugs@pettay.fi", "id": 9445393, "time": "2014-10-14T18:05:45Z"}, {"text": "(In reply to Olli Pettay [:smaug] from comment #23)\n> Why do we need to access the start time if we stored offset to the start\n> time?\n\nWe'd like to know when the timeline started so we can display events\nas relative to this point.\n\nThere's a (semi-) hack in the current patch to do a bit of this on the client\nside.  That's not strictly correct but it seems ok-ish given that it's only used\nto compute the end time when no events are coming.  (This lets the timeline continue\nto update when nothing is happening.)\n\nIt would be possible to do this for the start time as well, provided we don't mind\nsome unknown amount of error.  This may impact the memory data synchronization.  I\nam not sure if it would otherwise be noticeable by the user.", "author": "ttromey@mozilla.com", "id": 9445606, "time": "2014-10-14T18:35:58Z"}, {"text": "Created attachment 8505512\nchange timeline markers to have a consistent epoch\n\nHere is a new version.\n\nOlli said on irc that exposing the docShell timestamp baseline via\nnsIDocShell.idl was ok.\n\nI chose the process start time as a baseline because it already exists\nand because the baseline is arbitrary.\n\nTesting locally has worked fine, though I'll send this through a \"try\"\nbuild shortly just to be sure.", "author": "ttromey@mozilla.com", "id": 9450073, "time": "2014-10-15T15:16:00Z"}, {"text": "Created attachment 8505517\nchange timeline markers to have a consistent epoch\n\nI had neglected to update the UUID in nsIDocShell;\nfixed in this version.", "author": "ttromey@mozilla.com", "id": 9450136, "time": "2014-10-15T15:27:42Z"}, {"text": "https://tbpl.mozilla.org/?tree=Try&rev=3ba7544f361e", "author": "ttromey@mozilla.com", "id": 9450943, "time": "2014-10-15T16:48:37Z"}, {"text": "Comment on attachment 8505517\nchange timeline markers to have a consistent epoch\n\nI think the one oddity in the \"try\" is an unrelated intermittent failure.", "author": "ttromey@mozilla.com", "id": 9452559, "time": "2014-10-15T20:31:26Z"}, {"text": "Comment on attachment 8505517\nchange timeline markers to have a consistent epoch\n\n>   _startRecording: function*() {\n>+    TimelineView.handleRecordingStarted();\n>+    let startTime = yield gFront.start();\n>+    // Times must come from the actor in order to be self-consistent.\n>+    // However, we also want to update the view with the elapsed time\n>+    // even when the actor is not generating data.  To do this we get\n>+    // the local time and use it to compute a reasonable elapsed time.\n>+    // See _onRecordingTick.\n>+    this._localStartTime = performance.now();\nNot reviewing the .js code, but do we actually want to use performance.now() here?\n\n>+nsresult\n>+nsDocShell::Now(DOMHighResTimeStamp* when)\naWhen\n\n\n\n\n>   /**\n>+   * \"Now\" according to the docshell.  This uses an arbitrary baseline\n>+   * for the time -- but, importantly, the same baseline that is used\n>+   * by the timestamps on markers.\nI wouldn't use word baseline here, but just say something like\n\n\"The now method returns a DOMHighResTimeStamp representing the number of milliseconds\n from an arbitrary point of time. Each DocShell object use the same point of time.\"\nand then something about markers", "author": "bugs@pettay.fi", "id": 9453098, "time": "2014-10-15T22:07:47Z"}, {"text": "(In reply to Olli Pettay [:smaug] from comment #29)\n> Comment on attachment 8505517\n\n> >+    this._localStartTime = performance.now();\n> Not reviewing the .js code, but do we actually want to use performance.now()\n> here?\n\nYeah.  This is the semi-hack referred to in comment #24; also see comment #13\nand comment #15.  In short we need something on the client side to ensure the\ndisplay updates when no markers are coming; and as this does not need to be\ntruly exact, it seemed better to do it locally, as opposed to sending timestamp\nevents from the server.\n\n> >+nsresult\n> >+nsDocShell::Now(DOMHighResTimeStamp* when)\n> aWhen\n\nFixed.\n\n> >   /**\n> >+   * \"Now\" according to the docshell.  This uses an arbitrary baseline\n> >+   * for the time -- but, importantly, the same baseline that is used\n> >+   * by the timestamps on markers.\n> I wouldn't use word baseline here, but just say something like\n> \n> \"The now method returns a DOMHighResTimeStamp representing the number of\n> milliseconds\n>  from an arbitrary point of time. Each DocShell object use the same point of\n> time.\"\n> and then something about markers\n\nHow about this?\n\n  /**\n   * Return a DOMHighResTimeStamp representing the number of\n   * milliseconds from an arbitrary point in time.  The reference\n   * point is shared by all DocShells and is also used by timestamps\n   * on markers.\n   */\n  DOMHighResTimeStamp now();", "author": "ttromey@mozilla.com", "id": 9455867, "time": "2014-10-16T13:14:25Z"}, {"text": "Created attachment 8506123\nchange timeline markers to have a consistent epoch\n\nHere's a patch with the review issues fixed.\nI'm \"carrying forward\" your r+ provisionally.\nI've rebased this onto today's fx-team, which required a\nminor conflict resolution, nothing serious.", "author": "ttromey@mozilla.com", "id": 9455969, "time": "2014-10-16T13:34:35Z"}, {"text": "The improved comment looks ok.", "author": "bugs@pettay.fi", "id": 9456843, "time": "2014-10-16T15:53:11Z"}, {"text": "Thanks.  I think I have all the needed reviews now, so marking checkin-needed.", "author": "ttromey@mozilla.com", "id": 9457382, "time": "2014-10-16T17:16:00Z"}, {"text": "Actually, let me cancel that, because I remembered again about synchronizing\nwith the memory data.  I don't see how that can be done without a more globally\nagreed-upon time baseline, or the use of absolute time.  Victor, what do you think?", "author": "ttromey@mozilla.com", "id": 9457451, "time": "2014-10-16T17:26:13Z"}, {"text": "Ok, I finally re-read the patch in bug 1069421.  The times are\ngenerated in actors/timeline.js:\n\n    if (this._memoryActor) {\n      events.emit(this, \"memory\", Date.now(), this._memoryActor.measure());\n    }\n\nThis can trivially be changed to follow what the patch in this bug does.\nSo, I'm clearing the needinfo and adding checkin-needed.", "author": "ttromey@mozilla.com", "id": 9462540, "time": "2014-10-17T15:44:13Z"}, {"text": "https://hg.mozilla.org/integration/fx-team/rev/9acb83f0af3b", "author": "kwierso@gmail.com", "id": 9464583, "time": "2014-10-17T23:04:54Z"}, {"text": "(In reply to Tom Tromey :tromey from comment #35)\n\nThanks for fixing this!", "author": "vporof@mozilla.com", "id": 9465230, "time": "2014-10-18T07:40:02Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/9acb83f0af3b", "author": "cbook@mozilla.com", "id": 9469503, "time": "2014-10-20T12:59:13Z"}, {"text": "Jordan, to make the work on bug 1077442 (the fake actor front) easier, this (and bug 1085407) will need to be uplifted to aurora, to avoid subtle differences in the timeline actor's behavior between Firefox 35 and 36. Does this make sense to you or is there something else you'd prefer?", "author": "vporof@mozilla.com", "id": 9470527, "time": "2014-10-20T15:26:32Z"}, {"text": "Sounds good, don't think it'll change much in the front.", "author": "jordan@jsantell.com", "id": 9471077, "time": "2014-10-20T16:08:59Z"}, {"text": "Tom, does this patch require manual QA coverage? If that is the case, please set the qe-verify flag accordingly. Any information on how to verify this fix would also be appreciated.", "author": "andrei.vaida@softvision.ro", "id": 9511100, "time": "2014-10-28T15:05:29Z"}, {"text": "(In reply to Andrei Vaida, QA [:avaida] from comment #41)\n> Tom, does this patch require manual QA coverage? If that is the case, please\n> set the qe-verify flag accordingly. Any information on how to verify this\n> fix would also be appreciated.\n\nI never knew how to reproduce it :(\nThe possibility was obvious from the code, though, and there was a\nreport of it happening in bug 1069818; however, no reproducer.\n\nI'm not sure what I should do about the qe-verify flag.", "author": "ttromey@mozilla.com", "id": 9512775, "time": "2014-10-28T19:31:08Z"}, {"text": "(In reply to Tom Tromey :tromey from comment #42)\n> (In reply to Andrei Vaida, QA [:avaida] from comment #41)\n> > Tom, does this patch require manual QA coverage? If that is the case, please\n> > set the qe-verify flag accordingly. Any information on how to verify this\n> > fix would also be appreciated.\n> \n> I never knew how to reproduce it :(\n> The possibility was obvious from the code, though, and there was a\n> report of it happening in bug 1069818; however, no reproducer.\n> \n> I'm not sure what I should do about the qe-verify flag.\n\nI see, thank you for clarifying this.\n\nThe qe-verify[?|+|-] flag is used to filter bugs that need manual QA coverage, so if a bug needs to be verified by QA, it will be marked qe-verify+, otherwise qe-verify-. I'm gonna go ahead and set qe-verify- for this one, but I'll take a look at Bug 1069818 myself and try to reproduce it, just to be safe.", "author": "andrei.vaida@softvision.ro", "id": 9515523, "time": "2014-10-29T07:15:57Z"}, {"text": "Sorry for the spam. Moving bugs to Firefox :: Developer Tools: Performance Tools (Profiler/Timeline).\n\ndkl", "author": "dkl@mozilla.com", "id": 10058547, "time": "2015-03-20T21:08:42Z"}], "id": 1070089, "priority": "--", "mentors_detail": [], "cf_crash_signature": "", "version": "unspecified", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox59": "---", "last_change_time": "2015-03-20T21:08:42Z", "cf_platform_rel": "---", "product": "Firefox", "cf_status_firefox_esr52": "---", "blocks": [1050773, 1069421, 1069818], "qa_contact": "", "see_also": [], "cf_fx_iteration": "---", "component": "Developer Tools: Performance Tools (Profiler/Timeline)", "votes": 0, "groups": [], "cf_status_firefox60": "---", "target_milestone": "Firefox 36", "is_cc_accessible": true, "url": "", "creator_detail": {"email": "ttromey@mozilla.com", "id": 516940, "name": "ttromey@mozilla.com", "real_name": "Tom Tromey :tromey"}, "whiteboard": "", "mentors": [], "cc_detail": [{"email": "andrei.vaida@softvision.ro", "id": 488993, "name": "andrei.vaida@softvision.ro", "real_name": "Andrei Vaida [:avaida] \u2013 please ni? me"}, {"email": "b56girard@gmail.com", "id": 368375, "name": "b56girard@gmail.com", "real_name": "Benoit Girard (:BenWa)"}, {"email": "bugs@pettay.fi", "id": 39966, "name": "bugs@pettay.fi", "real_name": "Olli Pettay [:smaug]"}, {"email": "cbook@mozilla.com", "id": 277293, "name": "cbook@mozilla.com", "real_name": "Carsten Book [:Tomcat]"}, {"email": "jordan@jsantell.com", "id": 464691, "name": "jordan@jsantell.com", "real_name": "Jordan Santell [:jsantell] [@jsantell]"}, {"email": "nfitzgerald@mozilla.com", "id": 417695, "name": "nfitzgerald@mozilla.com", "real_name": "Nick Fitzgerald [:fitzgen] [\u23f0PST; UTC-8]"}, {"email": "paul@mozilla.com", "id": 174962, "name": "paul@mozilla.com", "real_name": "Paul Rouget [:paul]"}, {"email": "pbrosset@mozilla.com", "id": 478661, "name": "pbrosset@mozilla.com", "real_name": "Patrick Brosset <:pbro>"}, {"email": "ttromey@mozilla.com", "id": 516940, "name": "ttromey@mozilla.com", "real_name": "Tom Tromey :tromey"}, {"email": "vporof@mozilla.com", "id": 414813, "name": "vporof@mozilla.com", "real_name": "Victor Porof [:vporof][:vp]"}], "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [{"status": "-", "name": "qe-verify", "modification_date": "2014-10-29T07:15:57Z", "type_id": 864, "creation_date": "2014-10-28T15:05:29Z", "id": 1017690, "setter": "andrei.vaida@softvision.ro"}], "cf_tracking_firefox58": "---", "cf_rank": null, "is_open": false, "resolution": "FIXED", "op_sys": "Linux", "cf_fx_points": "---", "history": [{"changes": [{"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "ttromey@mozilla.com"}], "who": "ttromey@mozilla.com", "when": "2014-09-19T19:14:50Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "vporof@mozilla.com"}, {"removed": "", "field_name": "blocks", "added": "1069421"}], "who": "vporof@mozilla.com", "when": "2014-09-19T19:15:19Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "pbrosset@mozilla.com"}], "who": "pbrosset@mozilla.com", "when": "2014-09-22T07:57:50Z"}, {"changes": [{"removed": "", "field_name": "blocks", "added": "1050773"}], "who": "pbrosset@mozilla.com", "when": "2014-09-22T13:33:33Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "bgirard@mozilla.com, paul@mozilla.com"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(bgirard@mozilla.com)"}], "who": "paul@mozilla.com", "when": "2014-09-22T16:02:34Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8493183, "added": "feedback+"}], "who": "vporof@mozilla.com", "when": "2014-09-22T17:45:11Z"}, {"changes": [{"removed": "needinfo?(bgirard@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "b56girard@gmail.com", "when": "2014-09-23T16:02:06Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8493183, "added": "1"}], "who": "ttromey@mozilla.com", "when": "2014-09-23T20:13:50Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8493972, "added": "review+"}], "who": "vporof@mozilla.com", "when": "2014-09-24T16:13:32Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "nfitzgerald@mozilla.com"}], "who": "nfitzgerald@mozilla.com", "when": "2014-09-24T20:40:29Z"}, {"changes": [{"removed": "", "field_name": "blocks", "added": "1069818"}], "who": "paul@mozilla.com", "when": "2014-09-25T11:58:56Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8493972, "added": "1"}], "who": "ttromey@mozilla.com", "when": "2014-10-02T08:50:23Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8498729, "added": "review?(bgirard@mozilla.com), feedback?(vporof@mozilla.com)"}], "who": "ttromey@mozilla.com", "when": "2014-10-03T11:11:03Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "feedback?(vporof@mozilla.com)", "attachment_id": 8498729, "added": "feedback+"}], "who": "vporof@mozilla.com", "when": "2014-10-03T11:19:25Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(bgirard@mozilla.com)", "attachment_id": 8498729, "added": "review+"}], "who": "b56girard@gmail.com", "when": "2014-10-09T17:58:22Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "checkin-needed"}], "who": "ttromey@mozilla.com", "when": "2014-10-09T18:13:21Z"}, {"changes": [{"removed": "checkin-needed", "field_name": "keywords", "added": ""}, {"removed": "", "field_name": "cc", "added": "cbook@mozilla.com"}], "who": "cbook@mozilla.com", "when": "2014-10-10T07:54:16Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8498729, "added": "review?(bugs@pettay.fi)"}, {"removed": "", "field_name": "cc", "added": "bugs@pettay.fi"}], "who": "ttromey@mozilla.com", "when": "2014-10-10T15:08:37Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(bugs@pettay.fi)", "attachment_id": 8498729, "added": "review-"}], "who": "bugs@pettay.fi", "when": "2014-10-10T16:27:35Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(bugs@pettay.fi)"}], "who": "ttromey@mozilla.com", "when": "2014-10-13T20:32:54Z"}, {"changes": [{"removed": "needinfo?(bugs@pettay.fi)", "field_name": "flagtypes.name", "added": ""}], "who": "bugs@pettay.fi", "when": "2014-10-14T15:47:05Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8498729, "added": "1"}], "who": "ttromey@mozilla.com", "when": "2014-10-15T15:16:59Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8505512, "added": "review?(bugs@pettay.fi)"}], "who": "ttromey@mozilla.com", "when": "2014-10-15T15:17:29Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8505512, "added": "1"}, {"field_name": "flagtypes.name", "removed": "review?(bugs@pettay.fi)", "attachment_id": 8505512, "added": ""}], "who": "ttromey@mozilla.com", "when": "2014-10-15T15:27:42Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8505517, "added": "review?(bugs@pettay.fi)"}], "who": "ttromey@mozilla.com", "when": "2014-10-15T20:31:26Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(bugs@pettay.fi)", "attachment_id": 8505517, "added": "review+"}], "who": "bugs@pettay.fi", "when": "2014-10-15T22:07:47Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8505517, "added": "1"}], "who": "ttromey@mozilla.com", "when": "2014-10-16T13:34:35Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "checkin-needed"}], "who": "ttromey@mozilla.com", "when": "2014-10-16T17:16:00Z"}, {"changes": [{"removed": "checkin-needed", "field_name": "keywords", "added": ""}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(vporof@mozilla.com)"}], "who": "ttromey@mozilla.com", "when": "2014-10-16T17:26:13Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "checkin-needed"}, {"removed": "needinfo?(vporof@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "ttromey@mozilla.com", "when": "2014-10-17T15:44:13Z"}, {"changes": [{"removed": "checkin-needed", "field_name": "keywords", "added": ""}, {"removed": "", "field_name": "whiteboard", "added": "[fixed-in-fx-team]"}], "who": "kwierso@gmail.com", "when": "2014-10-17T23:04:54Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "Firefox 36"}, {"removed": "[fixed-in-fx-team]", "field_name": "whiteboard", "added": ""}, {"removed": "", "field_name": "cf_last_resolved", "added": "2014-10-20 05:59:13"}], "who": "cbook@mozilla.com", "when": "2014-10-20T12:59:13Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "jsantell@mozilla.com"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(jsantell@mozilla.com)"}], "who": "vporof@mozilla.com", "when": "2014-10-20T15:26:32Z"}, {"changes": [{"removed": "needinfo?(jsantell@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "jordan@jsantell.com", "when": "2014-10-20T16:08:59Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "andrei.vaida@softvision.ro, ttromey@mozilla.com"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(ttromey@mozilla.com), qe-verify?"}, {"removed": "---", "field_name": "cf_status_firefox36", "added": "fixed"}], "who": "andrei.vaida@softvision.ro", "when": "2014-10-28T15:05:29Z"}, {"changes": [{"removed": "needinfo?(ttromey@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "ttromey@mozilla.com", "when": "2014-10-28T19:31:08Z"}, {"changes": [{"removed": "qe-verify?", "field_name": "flagtypes.name", "added": "qe-verify-"}], "who": "andrei.vaida@softvision.ro", "when": "2014-10-29T07:15:57Z"}, {"changes": [{"removed": "Developer Tools: Timeline", "field_name": "component", "added": "Developer Tools: Performance Tools (Profiler/Timeline)"}], "who": "dkl@mozilla.com", "when": "2015-03-20T21:08:42Z"}]}