{"status": "NEW", "cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "classification": "Client Software", "creator": "sledru@mozilla.com", "cc": ["ato@sny.no", "B00ze64@hotmail.com", "chutten@mozilla.com", "ddurst@mozilla.com", "felipc@gmail.com", "hskupin@gmail.com", "jaws@mozilla.com", "jcristau@mozilla.com", "jgriffiths@mozilla.com", "jmaher@mozilla.com", "kit@mozilla.com", "ksteuber@mozilla.com", "mh+mozilla@glandium.org", "mhowell@mozilla.com", "niklasbetz20@gmail.com", "nthomas@mozilla.com", "robert.strong.bugs@gmail.com", "rtanglao@mozilla.com", "rtestard@mozilla.com", "simon.mainey@gmail.com", "VYV03354@nifty.ne.jp", "wlachance@mozilla.com"], "depends_on": [1460082], "creation_time": "2017-11-24T20:59:35Z", "cf_user_story": "Rationale:\r\nThe \"Never check for Updates\" option is easy to enable and forget about. Once enabled this exposes users to severe security issues and it seems unwise to expose this feature in the preferences? This also contributes to orphaned users.\r\n\r\nRequirements:\r\n- Remove \"Never check for Updates\" option\r\n- Keep \"Check for updates but let me chose to install them\" so users can remain in control of what gets installed on their devices.\r\n- Updates can be disabled via the policy engine", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "keywords": [], "summary": "Remove or hide the update features in the preferences", "cf_last_resolved": null, "attachments": [{"creator": "ksteuber@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-05-22T18:37:24Z", "type_id": 748, "creation_date": "2018-05-22T16:37:24Z", "id": 1760071, "setter": "chutten@mozilla.com"}], "content_type": "text/x-review-board-request", "id": 8979377}, {"creator": "ksteuber@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-05-23T15:50:05Z", "type_id": 748, "creation_date": "2018-05-22T16:35:41Z", "id": 1760069, "setter": "jaws@mozilla.com"}], "content_type": "text/x-review-board-request", "id": 8979378}, {"creator": "ksteuber@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-05-29T23:24:48Z", "type_id": 748, "creation_date": "2018-05-22T16:35:41Z", "id": 1760068, "setter": "robert.strong.bugs@gmail.com"}], "content_type": "text/x-review-board-request", "id": 8979379}, {"creator": "ksteuber@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "-", "name": "review", "modification_date": "2018-06-14T22:12:12Z", "type_id": 748, "creation_date": "2018-05-22T16:37:24Z", "id": 1760070, "setter": "robert.strong.bugs@gmail.com"}], "content_type": "text/x-review-board-request", "id": 8979643}, {"creator": "ksteuber@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-05-31T18:20:08Z", "type_id": 748, "creation_date": "2018-05-22T16:37:24Z", "id": 1760072, "setter": "kit@mozilla.com"}, {"status": "+", "name": "review", "modification_date": "2018-05-30T18:46:24Z", "type_id": 748, "creation_date": "2018-05-30T18:42:41Z", "id": 1763753, "setter": "chutten@mozilla.com"}, {"status": "+", "name": "review", "modification_date": "2018-05-30T22:02:25Z", "type_id": 748, "creation_date": "2018-05-30T20:28:51Z", "id": 1763818, "setter": "jmaher@mozilla.com"}, {"status": "+", "name": "review", "modification_date": "2018-06-01T13:48:15Z", "type_id": 748, "creation_date": "2018-05-31T17:46:32Z", "id": 1764259, "setter": "ato@sny.no"}], "content_type": "text/x-review-board-request", "id": 8979644}, {"creator": "ksteuber@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-05-25T21:35:50Z", "type_id": 748, "creation_date": "2018-05-22T16:37:24Z", "id": 1760073, "setter": "felipc@gmail.com"}], "content_type": "text/x-review-board-request", "id": 8979645}, {"creator": "ksteuber@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"requestee": "robert.strong.bugs@gmail.com", "status": "?", "name": "review", "modification_date": "2018-05-22T16:37:24Z", "type_id": 748, "creation_date": "2018-05-22T16:37:24Z", "id": 1760074, "setter": "ksteuber@mozilla.com"}], "content_type": "text/x-review-board-request", "id": 8979646}], "assigned_to_detail": {"email": "ksteuber@mozilla.com", "id": 563604, "name": "ksteuber@mozilla.com", "real_name": "Kirk Steuber [:bytesized]"}, "severity": "normal", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 60, "comments": [{"text": "We should remove (or move under an advanced option) the options to disable updates.\n\nI don't see any good in this option as we fix critical issues in every release of Firefox.\n\nOf course, the options should remain available under a pref but not available to lambda users.", "author": "sledru@mozilla.com", "id": 12872015, "time": "2017-11-24T20:59:35Z"}, {"text": "Jeff, what do you think?", "author": "sledru@mozilla.com", "id": 12872021, "time": "2017-11-24T21:00:59Z"}, {"text": "Punting to RT to look into. I don't know what to think, I'd need to see data to better understand if this is worth doing. \n\nI'm mildly more interested in hiding the pref under advanced.", "author": "jgriffiths@mozilla.com", "id": 12877058, "time": "2017-11-27T17:07:55Z"}, {"text": "(In reply to Jeff Griffiths (:canuckistani) (:\u26a1\ufe0e) from comment #2)\n> I'm mildly more interested in hiding the pref under advanced.\n\nSide note, we don't have an \"Advanced\" in Prefs anymore, though we could create one.", "author": "jaws@mozilla.com", "id": 12877432, "time": "2017-11-27T18:56:04Z"}, {"text": "(In reply to Jeff Griffiths (:canuckistani) (:\u26a1\ufe0e) from comment #2)\n> Punting to RT to look into. I don't know what to think, I'd need to see data\n> to better understand if this is worth doing. \n> \n> I'm mildly more interested in hiding the pref under advanced.\n\nI updated the user story to clarify what's needed here.\nI'll discuss this with Ddurst team in Q1 planning.", "author": "rtestard@mozilla.com", "id": 12886894, "time": "2017-11-30T16:15:58Z"}, {"text": "https://treeherder.mozilla.org/#/jobs?repo=try&revision=d7c65b369b8c2e62bc76241f2f5f95222b38f366", "author": "ksteuber@mozilla.com", "id": 13281976, "time": "2018-05-16T16:49:32Z"}, {"text": "https://treeherder.mozilla.org/#/jobs?repo=try&revision=80de33dacfd0e9cf3becc7759224d64b8b098d57", "author": "ksteuber@mozilla.com", "id": 13282044, "time": "2018-05-16T17:19:27Z"}, {"text": "https://treeherder.mozilla.org/#/jobs?repo=try&revision=ddfa757cbc37a38dbc8c704e18d5dd679887927b", "author": "ksteuber@mozilla.com", "id": 13282092, "time": "2018-05-16T17:40:44Z"}, {"text": "https://treeherder.mozilla.org/#/jobs?repo=try&revision=e23cb056f7db216e27aa65aa63a39ae1dc17ce8f", "author": "ksteuber@mozilla.com", "id": 13282919, "time": "2018-05-16T21:54:48Z"}, {"text": "https://treeherder.mozilla.org/#/jobs?repo=try&revision=2bd6f5d13e34cf2090696e6c11fe397fb9f2ba89", "author": "ksteuber@mozilla.com", "id": 13285726, "time": "2018-05-17T21:25:12Z"}, {"text": "https://treeherder.mozilla.org/#/jobs?repo=try&revision=d7dcd7ca9ae66d726dade8cfbd5770f12719e207", "author": "ksteuber@mozilla.com", "id": 13288410, "time": "2018-05-18T21:29:20Z"}, {"text": "https://treeherder.mozilla.org/#/jobs?repo=try&revision=41c602f93d0ceaa01067aca908528ae18aaa42c1", "author": "ksteuber@mozilla.com", "id": 13294833, "time": "2018-05-21T19:01:53Z"}, {"text": "Created attachment 8979377\nBug 1420514 - Remove telemetry probes tracking app.update.enabled\n\nGetting rid of this pref allowed some other code to be removed:\n - Changed nsIUpdateService::stopChecking(duration) to nsIUpdateService::stopCurrentCheck() and got rid of the constants representing durations. The available durations were CURRENT_CHECK, CURRENT_SESSION, and ANY_CHECKS, but only CURRENT_CHECK was ever used.\n - nsIUpdateChecker::stopChecking(CURRENT_SESSION) and nsIUpdateChecker::stopChecking(ANY_CHECKS) were the only mechanisms for setting Checker::_enabled to false, so Checker::_enabled and Checker::enabled were removed. References to Checker::enabled were replaced with checks for nsUpdateService::canCheckForUpdates.\n - In browser/base/content/aboutDialog-appUpdater.js, the updateDisabledAndLocked() function was renamed to updateDisabledByAdmin, since the old name is no longer accurate and the new function name is a better description of the function's actual use.\n - Some telemetry probes reporting the status of app.update.enabled or nsUpdateService::_enabled have been removed since those values no longer exist. They were replaced with a probe indicating whether update was disabled by policy.\n\nReview commit: https://reviewboard.mozilla.org/r/245538/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/245538/", "author": "ksteuber@mozilla.com", "id": 13295057, "time": "2018-05-21T20:37:41Z"}, {"text": "Created attachment 8979378\nBug 1420514 - Remove the UI for app.update.enabled in about:preferences\n\nReview commit: https://reviewboard.mozilla.org/r/245540/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/245540/", "author": "ksteuber@mozilla.com", "id": 13295058, "time": "2018-05-21T20:37:41Z"}, {"text": "Created attachment 8979379\nBug 1420514 - Remove app.update.enabled from prefs files\n\nReview commit: https://reviewboard.mozilla.org/r/245542/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/245542/", "author": "ksteuber@mozilla.com", "id": 13295059, "time": "2018-05-21T20:37:41Z"}, {"text": "Comment on attachment 8979377\nBug 1420514 - Remove telemetry probes tracking app.update.enabled\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/245538/diff/1-2/", "author": "ksteuber@mozilla.com", "id": 13295099, "time": "2018-05-21T21:04:25Z"}, {"text": "Comment on attachment 8979378\nBug 1420514 - Remove the UI for app.update.enabled in about:preferences\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/245540/diff/1-2/", "author": "ksteuber@mozilla.com", "id": 13295100, "time": "2018-05-21T21:04:25Z"}, {"text": "Comment on attachment 8979379\nBug 1420514 - Remove app.update.enabled from prefs files\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/245542/diff/1-2/", "author": "ksteuber@mozilla.com", "id": 13295101, "time": "2018-05-21T21:04:25Z"}, {"text": "Created attachment 8979643\nBug 1420514 - Remove pref app.update.enabled from the update mechanism\n\nGetting rid of this pref allowed some other code to be removed:\n - Changed nsIUpdateService::stopChecking(duration) to nsIUpdateService::stopCurrentCheck() and got rid of the constants representing durations. The available durations were CURRENT_CHECK, CURRENT_SESSION, and ANY_CHECKS, but only CURRENT_CHECK was ever used.\n - nsIUpdateChecker::stopChecking(CURRENT_SESSION) and nsIUpdateChecker::stopChecking(ANY_CHECKS) were the only mechanisms for setting Checker::_enabled to false, so Checker::_enabled and Checker::enabled were removed. References to Checker::enabled were replaced with checks for nsUpdateService::canCheckForUpdates.\n - In browser/base/content/aboutDialog-appUpdater.js, the updateDisabledAndLocked() function was renamed to updateDisabledByAdmin, since the old name is no longer accurate and the new function name is a better description of the function's actual use.\n\nReview commit: https://reviewboard.mozilla.org/r/245786/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/245786/", "author": "ksteuber@mozilla.com", "id": 13297112, "time": "2018-05-22T16:35:41Z"}, {"text": "Created attachment 8979644\nBug 1420514 - Replace app.update.enabled with app.update.disabledForTesting in the test harness\n\nReview commit: https://reviewboard.mozilla.org/r/245788/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/245788/", "author": "ksteuber@mozilla.com", "id": 13297113, "time": "2018-05-22T16:35:41Z"}, {"text": "Created attachment 8979645\nBug 1420514 - Replace app.update.enabled with app.update.disabledForTesting in enterprise policy tests\n\nReview commit: https://reviewboard.mozilla.org/r/245790/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/245790/", "author": "ksteuber@mozilla.com", "id": 13297114, "time": "2018-05-22T16:35:41Z"}, {"text": "Created attachment 8979646\nBug 1420514 - Replace app.update.enabled with app.update.disabledForTesting in update tests\n\nReview commit: https://reviewboard.mozilla.org/r/245792/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/245792/", "author": "ksteuber@mozilla.com", "id": 13297115, "time": "2018-05-22T16:35:41Z"}, {"text": "Comment on attachment 8979379\nBug 1420514 - Remove app.update.enabled from prefs files\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/245542/diff/2-3/", "author": "ksteuber@mozilla.com", "id": 13297116, "time": "2018-05-22T16:35:41Z"}, {"text": "Comment on attachment 8979377\nBug 1420514 - Remove telemetry probes tracking app.update.enabled\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/245538/diff/2-3/", "author": "ksteuber@mozilla.com", "id": 13297117, "time": "2018-05-22T16:35:41Z"}, {"text": "Comment on attachment 8979378\nBug 1420514 - Remove the UI for app.update.enabled in about:preferences\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/245540/diff/2-3/", "author": "ksteuber@mozilla.com", "id": 13297118, "time": "2018-05-22T16:35:41Z"}, {"text": "Comment on attachment 8979377\nBug 1420514 - Remove telemetry probes tracking app.update.enabled\n\nhttps://reviewboard.mozilla.org/r/245538/#review251932\n\nLGTM", "author": "chutten@mozilla.com", "id": 13297493, "time": "2018-05-22T18:37:24Z"}, {"text": "Comment on attachment 8979378\nBug 1420514 - Remove the UI for app.update.enabled in about:preferences\n\nhttps://reviewboard.mozilla.org/r/245540/#review252238", "author": "jaws@mozilla.com", "id": 13299824, "time": "2018-05-23T15:50:05Z"}, {"text": "Comment on attachment 8979644\nBug 1420514 - Replace app.update.enabled with app.update.disabledForTesting in the test harness\n\nhttps://reviewboard.mozilla.org/r/245788/#review252864\n\n::: js/src/tests/user.js:1\n(Diff revision 1)\n> -user_pref(\"app.update.enabled\", false);\n> +user_pref(\"app.update.disabledForTesting\", true);\n\nI can\u2019t review changes to this file.\n\n::: testing/geckodriver/src/prefs.rs:19\n(Diff revision 1)\n>  \n>          // Disable automatic downloading of new releases\n>          (\"app.update.auto\", Pref::new(false)),\n>  \n>          // Disable automatically upgrading Firefox\n> -        (\"app.update.enabled\", Pref::new(false)),\n> +        (\"app.update.disabledForTesting\", Pref::new(true)),\n\ngeckodriver is a program used out-of-tree by end-users and to\nmaintain backwards compatibility with earlier Firefoxen, we need\nto keep the old app.update.enabled preference around until 62 reaches\nstable.\n\nCan you add app.update.enabled back in with a comment that it can\nbe removed when 62 becomes stable?\n\n::: testing/geckodriver/src/prefs.rs:20\n(Diff revision 1)\n>          // Disable automatic downloading of new releases\n>          (\"app.update.auto\", Pref::new(false)),\n>  \n>          // Disable automatically upgrading Firefox\n> -        (\"app.update.enabled\", Pref::new(false)),\n> +        (\"app.update.disabledForTesting\", Pref::new(true)),\n> +        (\"security.turn_off_all_security_so_that_viruses_can_take_over_this_computer\", Pref::new(true)),\n\nWhere did this come from?  We removed this in the past because it\ngot removed from Gecko.\n\n::: testing/marionette/client/marionette_driver/geckoinstance.py:505\n(Diff revision 1)\n>  \n>  \n>  class DesktopInstance(GeckoInstance):\n>      desktop_prefs = {\n>          # Disable application updates\n> -        \"app.update.enabled\": False,\n> +        \"app.update.disabledForTesting\": True,\n\nFor the same reasons as with geckodriver, the Marionette Python\nclient is used for Firefox update tests and needs to be backwards\ncompatible with earlier Firefoxen back to ESR.\n\nCan you add app.update.enabled back with a note saying it can be\nremoved when 62 becomes ESR?\n\n::: testing/marionette/components/marionette.js:68\n(Diff revision 1)\n>    // Disable automatically upgrading Firefox.\n>    //\n>    // This should also be set in the profile prior to starting Firefox,\n>    // as it is picked up at runtime.\n> -  [\"app.update.enabled\", false],\n> +  [\"app.update.disabledForTesting\", true],\n> +  [\"security.turn_off_all_security_so_that_viruses_can_take_over_this_computer\", true],\n\nWhy is this needed?\n\n::: testing/raptor/test/test_raptor.py:26\n(Diff revision 1)\n>      assert isinstance(raptor.profile, BaseProfile)\n>      if app != 'firefox':\n>          return\n>  \n> -    # This pref is set in mozprofile\n> -    firefox_pref = 'user_pref(\"app.update.enabled\", false);'\n> +    # These prefs are set in mozprofile\n> +    firefox_prefs = [\n\nFor testing/raptor you should request r? from jmaher, as I\u2019m not a\npeer.\n\n::: testing/talos/talos/unittests/test_talosconfig_browser_config.json:1\n(Diff revision 1)\n> -{'deviceroot': '', 'dirs': {}, 'repository': 'http://hg.mozilla.org/releases/mozilla-release', 'buildid': '20131205075310', 'results_log': 'pathtoresults_log', 'symbols_path': None, 'bcontroller_config': 'pathtobcontroller', 'host': '', 'browser_name': 'Firefox', 'sourcestamp': '39faf812aaec', 'remote': False, 'child_process': 'plugin-container', 'branch_name': '', 'browser_version': '26.0', 'extra_args': '', 'develop': True, 'preferences': {'browser.display.overlaynavbuttons': False, 'extensions.getAddons.get.url': 'http://127.0.0.1/extensions-dummy/repositoryGetURL', 'dom.max_chrome_script_run_time': 0, 'network.proxy.type': 1, 'extensions.update.background.url': 'http://127.0.0.1/extensions-dummy/updateBackgroundURL', 'network.proxy.http': 'localhost', 'plugins.update.url': 'http://127.0.0.1/plugins-dummy/updateCheckURL', 'dom.max_script_run_time': 0, 'extensions.update.enabled': False, 'browser.safebrowsing.keyURL': 'http://127.0.0.1/safebrowsing-dummy/newkey', 'media.navigator.permission.disabled': True, 'app.update.enabled': False, 'extensions.blocklist.url': 'http://127.0.0.1/extensions-dummy/blocklistURL', 'browser.EULA.override': True, 'extensions.checkCompatibility': False, 'talos.logfile': 'pathtofile', 'browser.safebrowsing.gethashURL': 'http://127.0.0.1/safebrowsing-dummy/gethash', 'extensions.hotfix.url': 'http://127.0.0.1/extensions-dummy/hotfixURL', 'dom.disable_window_move_resize': True, 'network.proxy.http_port': 80, 'browser.dom.window.dump.enabled': True, 'extensions.update.url': 'http://127.0.0.1/extensions-dummy/updateURL', 'browser.chrome.dynamictoolbar': False,  'browser.link.open_newwindow': 2, 'browser.cache.disk.smart_size.first_run': False, 'security.turn_off_all_security_so_that_viruses_can_take_over_this_computer': True, 'dom.disable_open_during_load': False, 'extensions.getAddons.search.browseURL': 'http://127.0.0.1/extensions-dummy/repositoryBrowseURL', 'browser.cache.disk.smart_size.enabled': False, 'extensions.getAddons.getWithPerformance.url': 'http://127.0.0.1/extensions-dummy/repositoryGetWithPerformanceURL', 'hangmonitor.timeout': 0, 'dom.send_after_paint_to_content': True, 'security.fileuri.strict_origin_policy': False, 'media.capturestream_hints.enabled': True, 'extensions.update.notifyUser': False, 'extensions.blocklist.enabled': False, 'browser.bookmarks.max_backups': 0, 'browser.shell.checkDefaultBrowser': False, 'media.peerconnection.enabled': True, 'dom.disable_window_flip': True, 'security.enable_java': False, 'browser.warnOnQuit': False, 'media.navigator.enabled': True, 'browser.safebrowsing.updateURL': 'http://127.0.0.1/safebrowsing-dummy/update', 'dom.allow_scripts_to_close_windows': True, 'extensions.webservice.discoverURL': 'http://127.0.0.1/extensions-dummy/discoveryURL'}, 'test_timeout': 1200, 'title': 'qm-pxp01', 'error_filename': 'pathtoerrorfile', 'webserver': 'localhost:15707', 'browser_path':ffox_path, 'port': 20701, 'browser_log': 'browser_output.txt', 'process': 'firefox.exe', 'xperf_path': 'C:/Program Files/Microsoft Windows Performance Toolkit/xperf.exe', 'extensions': ['pathtopageloader'], 'fennecIDs': '', 'env': {'NO_EM_RESTART': '1'}, 'init_url': 'http://localhost:15707/getInfo.html', 'browser_wait': 5}\n> +{'deviceroot': '', 'dirs': {}, 'repository': 'http://hg.mozilla.org/releases/mozilla-release', 'buildid': '20131205075310', 'results_log': 'pathtoresults_log', 'symbols_path': None, 'bcontroller_config': 'pathtobcontroller', 'host': '', 'browser_name': 'Firefox', 'sourcestamp': '39faf812aaec', 'remote': False, 'child_process': 'plugin-container', 'branch_name': '', 'browser_version': '26.0', 'extra_args': '', 'develop': True, 'preferences': {'browser.display.overlaynavbuttons': False, 'extensions.getAddons.get.url': 'http://127.0.0.1/extensions-dummy/repositoryGetURL', 'dom.max_chrome_script_run_time': 0, 'network.proxy.type': 1, 'extensions.update.background.url': 'http://127.0.0.1/extensions-dummy/updateBackgroundURL', 'network.proxy.http': 'localhost', 'plugins.update.url': 'http://127.0.0.1/plugins-dummy/updateCheckURL', 'dom.max_script_run_time': 0, 'extensions.update.enabled': False, 'browser.safebrowsing.keyURL': 'http://127.0.0.1/safebrowsing-dummy/newkey', 'media.navigator.permission.disabled': True, 'app.update.disabledForTesting': True, 'extensions.blocklist.url': 'http://127.0.0.1/extensions-dummy/blocklistURL', 'browser.EULA.override': True, 'extensions.checkCompatibility': False, 'talos.logfile': 'pathtofile', 'browser.safebrowsing.gethashURL': 'http://127.0.0.1/safebrowsing-dummy/gethash', 'extensions.hotfix.url': 'http://127.0.0.1/extensions-dummy/hotfixURL', 'dom.disable_window_move_resize': True, 'network.proxy.http_port': 80, 'browser.dom.window.dump.enabled': True, 'extensions.update.url': 'http://127.0.0.1/extensions-dummy/updateURL', 'browser.chrome.dynamictoolbar': False,  'browser.link.open_newwindow': 2, 'browser.cache.disk.smart_size.first_run': False, 'security.turn_off_all_security_so_that_viruses_can_take_over_this_computer': True, 'dom.disable_open_during_load': False, 'extensions.getAddons.search.browseURL': 'http://127.0.0.1/extensions-dummy/repositoryBrowseURL', 'browser.cache.disk.smart_size.enabled': False, 'extensions.getAddons.getWithPerformance.url': 'http://127.0.0.1/extensions-dummy/repositoryGetWithPerformanceURL', 'hangmonitor.timeout': 0, 'dom.send_after_paint_to_content': True, 'security.fileuri.strict_origin_policy': False, 'media.capturestream_hints.enabled': True, 'extensions.update.notifyUser': False, 'extensions.blocklist.enabled': False, 'browser.bookmarks.max_backups': 0, 'browser.shell.checkDefaultBrowser': False, 'media.peerconnection.enabled': True, 'dom.disable_window_flip': True, 'security.enable_java': False, 'browser.warnOnQuit': False, 'media.navigator.enabled': True, 'browser.safebrowsing.updateURL': 'http://127.0.0.1/safebrowsing-dummy/update', 'dom.allow_scripts_to_close_windows': True, 'extensions.webservice.discoverURL': 'http://127.0.0.1/extensions-dummy/discoveryURL'}, 'test_timeout': 1200, 'title': 'qm-pxp01', 'error_filename': 'pathtoerrorfile', 'webserver': 'localhost:15707', 'browser_path':ffox_path, 'port': 20701, 'browser_log': 'browser_output.txt', 'process': 'firefox.exe', 'xperf_path': 'C:/Program Files/Microsoft Windows Performance Toolkit/xperf.exe', 'extensions': ['pathtopageloader'], 'fennecIDs': '', 'env': {'NO_EM_RESTART': '1'}, 'init_url': 'http://localhost:15707/getInfo.html', 'browser_wait': 5}\n\nFor testing/talos you should also request review from jmaher.\n\n::: testing/tps/tps/testrunner.py:59\n(Diff revision 1)\n>          'MOZ_NO_REMOTE': '1',\n>          'XPCOM_DEBUG_BREAK': 'warn',\n>      }\n>  \n>      default_preferences = {\n> -        'app.update.enabled': False,\n> +        'app.update.disabledForTesting': True,\n\nPlease request review from whimboo on testing/tps.\n\n::: toolkit/components/telemetry/tests/marionette/harness/telemetry_harness/testcase.py\n(Diff revision 1)\n> -    def toggle_update_pref(self):\n> -        value = self.marionette.get_pref('app.update.enabled')\n> -        self.marionette.enforce_gecko_prefs({'app.update.enabled': not value})\n\nI\u2019m not a peer of Telemetry, so I can\u2019t review this.", "author": "ato@sny.no", "id": 13363785, "time": "2018-05-25T13:34:33Z"}, {"text": "Comment on attachment 8979645\nBug 1420514 - Replace app.update.enabled with app.update.disabledForTesting in enterprise policy tests\n\nhttps://reviewboard.mozilla.org/r/245790/#review253064", "author": "felipc@gmail.com", "id": 13365239, "time": "2018-05-25T21:35:50Z"}, {"text": "Comment on attachment 8979379\nBug 1420514 - Remove app.update.enabled from prefs files\n\nhttps://reviewboard.mozilla.org/r/245542/#review253808\n\n::: browser/app/profile/firefox.js\n(Diff revision 3)\n>  // user of the failure. User initiated update checks always notify the user of\n>  // the failure.\n>  pref(\"app.update.backgroundMaxErrors\", 10);\n>  \n> -// Whether or not app updates are enabled\n> -#ifdef MOZ_UPDATER\n\nPlease add a comment in bug 1427471 about this being removed.\n\n::: mobile/android/app/mobile.js\n(Diff revision 3)\n>  pref(\"app.update.autodownload\", \"wifi\");\n>  pref(\"app.update.url.android\", \"https://aus5.mozilla.org/update/4/%PRODUCT%/%VERSION%/%BUILD_ID%/%BUILD_TARGET%/%LOCALE%/%CHANNEL%/%OS_VERSION%/%DISTRIBUTION%/%DISTRIBUTION_VERSION%/%MOZ_VERSION%/update.xml\");\n>  \n>  #ifdef MOZ_UPDATER\n>  /* prefs used specifically for updating the app */\n> -pref(\"app.update.enabled\", false);\n\nAndroid has its own update mechanism and it may resuse this pref so please check with an Android dev if it is ok to remove this.\nhttps://dxr.mozilla.org/mozilla-central/source/toolkit/xre/nsAppRunner.cpp#29", "author": "robert.strong.bugs@gmail.com", "id": 13372922, "time": "2018-05-29T23:24:48Z"}, {"text": "Note: Android also reused the MOZ_UPDATER define - bug 1152634", "author": "robert.strong.bugs@gmail.com", "id": 13372928, "time": "2018-05-29T23:27:03Z"}, {"text": "Adding :chutten to review toolkit/components/telemetry/tests/marionette/harness/telemetry_harness/testcase.py", "author": "ksteuber@mozilla.com", "id": 13375369, "time": "2018-05-30T18:43:18Z"}, {"text": "Comment on attachment 8979644\nBug 1420514 - Replace app.update.enabled with app.update.disabledForTesting in the test harness\n\nhttps://reviewboard.mozilla.org/r/245788/#review254130\n\nr+ on toolkit/components/telemetry/tests/marionette/harness/telemetry_harness/testcase.py for removing dead code.", "author": "chutten@mozilla.com", "id": 13375378, "time": "2018-05-30T18:46:24Z"}, {"text": "@jmaher - Could you please review these files:\njs/src/tests/user.js\ntesting/raptor/test/test_raptor.py\ntesting/talos/talos/unittests/test_talosconfig_browser_config.json\n\n@whimboo - Could you please review testing/tps/tps/testrunner.py\n\nSorry that I did not break up that commit better. I'm afraid that if I broke it up now, I would lose the r+'s that I have already gotten.", "author": "ksteuber@mozilla.com", "id": 13375658, "time": "2018-05-30T20:32:53Z"}, {"text": "Comment on attachment 8979379\nBug 1420514 - Remove app.update.enabled from prefs files\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/245542/diff/3-4/", "author": "ksteuber@mozilla.com", "id": 13375679, "time": "2018-05-30T20:45:16Z"}, {"text": "Comment on attachment 8979643\nBug 1420514 - Remove pref app.update.enabled from the update mechanism\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/245786/diff/1-2/", "author": "ksteuber@mozilla.com", "id": 13375680, "time": "2018-05-30T20:45:16Z"}, {"text": "Comment on attachment 8979377\nBug 1420514 - Remove telemetry probes tracking app.update.enabled\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/245538/diff/3-4/", "author": "ksteuber@mozilla.com", "id": 13375681, "time": "2018-05-30T20:45:16Z"}, {"text": "Comment on attachment 8979378\nBug 1420514 - Remove the UI for app.update.enabled in about:preferences\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/245540/diff/3-4/", "author": "ksteuber@mozilla.com", "id": 13375682, "time": "2018-05-30T20:45:16Z"}, {"text": "Comment on attachment 8979644\nBug 1420514 - Replace app.update.enabled with app.update.disabledForTesting in the test harness\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/245788/diff/1-2/", "author": "ksteuber@mozilla.com", "id": 13375683, "time": "2018-05-30T20:45:16Z"}, {"text": "Comment on attachment 8979645\nBug 1420514 - Replace app.update.enabled with app.update.disabledForTesting in enterprise policy tests\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/245790/diff/1-2/", "author": "ksteuber@mozilla.com", "id": 13375684, "time": "2018-05-30T20:45:16Z"}, {"text": "Comment on attachment 8979646\nBug 1420514 - Replace app.update.enabled with app.update.disabledForTesting in update tests\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/245792/diff/1-2/", "author": "ksteuber@mozilla.com", "id": 13375685, "time": "2018-05-30T20:45:16Z"}, {"text": "Comment on attachment 8979644\nBug 1420514 - Replace app.update.enabled with app.update.disabledForTesting in the test harness\n\nhttps://reviewboard.mozilla.org/r/245788/#review252864\n\n> Where did this come from?  We removed this in the past because it\n> got removed from Gecko.\n\nAs far as I know, this continues to be used to determine whether Firefox is currently running automated tests. See https://searchfox.org/mozilla-central/rev/5a744713370ec47969595e369fd5125f123e6d24/js/xpconnect/src/xpcpublic.h#642\n\n> Why is this needed?\n\nThis is needed so that `Cu.isInAutomation` returns `true`, allowing us to properly determine if Firefox is currently running automated tests.", "author": "ksteuber@mozilla.com", "id": 13375690, "time": "2018-05-30T20:46:12Z"}, {"text": "Comment on attachment 8979644\nBug 1420514 - Replace app.update.enabled with app.update.disabledForTesting in the test harness\n\nhttps://reviewboard.mozilla.org/r/245788/#review254206\n\nI believe you got all the proper harnesses.", "author": "jmaher@mozilla.com", "id": 13375882, "time": "2018-05-30T22:02:25Z"}, {"text": "So what are downstreams supposed to do now to avoid firefox from trying to upgrade itself when it's managed by a package manager? Set app.update.disabledForTesting?", "author": "mh+mozilla@glandium.org", "id": 13376000, "time": "2018-05-30T22:24:29Z"}, {"text": "No. `app.update.disabledForTesting` will only be available in automated testing. Frankly, I have very little understanding of how these downstreams operate, so I am not sure what is and isn't possible, but I will tell you what options they have.\n\nI think that you are referring to *nix distributions, so please correct me if I am wrong, since this information will differ for Windows and macOS.\n\nOne option is to set `app.update.auto` to `false`. This would prevent automatic updates, but would prompt the user to let Firefox install any updates that could be downloaded and installed.\n\nAnother option is to set an enterprise policy that would prevent app update by putting a JSON file in the install directory. I don't recommend this for a number of reasons. It doesn't feel like the right way to solve this problem. It would also result in a banner in about:preferences saying something like \"Some preferences are being controlled by your organization\".\n\nThe thing is though, we typically don't update Linux installations that were installed via a package manager. I have been told that we have no real way of updating Firefox installations on Linux unless we can already write to the installation directory because we have no reliable, cross-platform way of elevating our privileges. Since the installation directory is typically writable only by root, but Firefox is not typically run by root, Firefox never updates.\n\nI have no idea how package manager installations work, but if you wanted to formalize this, maybe you could just end the installation by removing all write permissions from the installation directory so that it could not update, even if run as root.\n\n@mhowell - I haven't spent much time looking at update on Linux; could you confirm that what I have written about it here is correct?", "author": "ksteuber@mozilla.com", "id": 13376179, "time": "2018-05-31T00:06:21Z"}, {"text": "(In reply to Kirk Steuber [:bytesized] from comment #44)\n> No. `app.update.disabledForTesting` will only be available in automated\n> testing. Frankly, I have very little understanding of how these downstreams\n> operate, so I am not sure what is and isn't possible, but I will tell you\n> what options they have.\n\nWhat do you mean by \"only available in automated testing\"? For mozregression, I think we want this setting enabled under most circumstances (mozregression is typically downloading possible bisection candidates while the current build is being tested, and having Firefox pointlessly download an update for an obsolete build would interfere with that).", "author": "wlachance@mozilla.com", "id": 13376385, "time": "2018-05-31T02:48:33Z"}, {"text": "Comment on attachment 8979644\nBug 1420514 - Replace app.update.enabled with app.update.disabledForTesting in the test harness\n\nhttps://reviewboard.mozilla.org/r/245788/#review254314\n\n::: testing/geckodriver/src/prefs.rs:20\n(Diff revision 2)\n>          // Disable automatic downloading of new releases\n>          (\"app.update.auto\", Pref::new(false)),\n>  \n>          // Disable automatically upgrading Firefox\n> +        (\"app.update.disabledForTesting\", Pref::new(true)),\n> +        (\"security.turn_off_all_security_so_that_viruses_can_take_over_this_computer\", Pref::new(true)),\n\nThis is still present since Andreas reviewed the piece of code and no explanation has been given yet.\n\n::: testing/marionette/client/marionette_driver/geckoinstance.py:506\n(Diff revision 2)\n>  \n>  class DesktopInstance(GeckoInstance):\n>      desktop_prefs = {\n>          # Disable application updates\n> +        \"app.update.disabledForTesting\": True,\n> +        \"security.turn_off_all_security_so_that_viruses_can_take_over_this_computer\": True,\n\nSame here.\n\n::: testing/mozbase/mozprofile/mozprofile/profile.py:435\n(Diff revision 2)\n>  class FirefoxProfile(Profile):\n>      \"\"\"Specialized Profile subclass for Firefox\"\"\"\n>  \n>      preferences = {  # Don't automatically update the application\n> -        'app.update.enabled': False,\n> +        'app.update.disabledForTesting': True,\n> +        'security.turn_off_all_security_so_that_viruses_can_take_over_this_computer': True,\n\nSame here.\n\n::: testing/tps/tps/testrunner.py:60\n(Diff revision 2)\n>          'XPCOM_DEBUG_BREAK': 'warn',\n>      }\n>  \n>      default_preferences = {\n> -        'app.update.enabled': False,\n> +        'app.update.disabledForTesting': True,\n> +        'security.turn_off_all_security_so_that_viruses_can_take_over_this_computer': True,\n\nSorry, but I'm not a valid reviewer for TPS. Best is always to check the Bugzilla component who reviews patches at the moment. AFAIR you could ask Kit Cambridge.", "author": "hskupin@gmail.com", "id": 13376548, "time": "2018-05-31T05:57:28Z"}, {"text": "(In reply to Mike Hommey [:glandium] from comment #43)\n> So what are downstreams supposed to do now to avoid firefox from trying to\n> upgrade itself when it's managed by a package manager? Set\n> app.update.disabledForTesting?\n\nIn addition to Kirk's reply, distributions operating a package manager do not tend to package Mozilla builds, and the best way to handle this when using a custom build is to disable update support at build time, as is most often what is already done today.\n\n(In reply to Kirk Steuber [:bytesized] from comment #44)\n> @mhowell - I haven't spent much time looking at update on Linux; could you\n> confirm that what I have written about it here is correct?\n\nIt's correct, to the extent that you can use the word \"typical\" to really describe anything covering all of Linux; I think it's more common for manually installed Linux builds to end up in a home directory, in which case they are writable and updates work fine.", "author": "mhowell@mozilla.com", "id": 13377700, "time": "2018-05-31T14:59:00Z"}, {"text": "(In reply to William Lachance (:wlach) (use needinfo!) from comment #45)\n> What do you mean by \"only available in automated testing\"?\nWe determine if we are in automated testing based on whether the pref `security.turn_off_all_security_so_that_viruses_can_take_over_this_computer` is set to true and the environment variable \"MOZ_DISABLE_NONLOCAL_CONNECTIONS\" is set. This is existing functionality that is available via the `xpc::IsInAutomation` C++ function or the `Cu.isInAutomation` JS function.\n\nSee the implementation of `xpc::IsInAutomation`: https://searchfox.org/mozilla-central/rev/5a744713370ec47969595e369fd5125f123e6d24/js/xpconnect/src/xpcpublic.h#642", "author": "ksteuber@mozilla.com", "id": 13378189, "time": "2018-05-31T17:33:52Z"}, {"text": "Comment on attachment 8979644\nBug 1420514 - Replace app.update.enabled with app.update.disabledForTesting in the test harness\n\nK", "author": "ksteuber@mozilla.com", "id": 13378220, "time": "2018-05-31T17:46:32Z"}, {"text": "Kit - If possible, could you please review testing/tps/tps/testrunner.py\n\nSorry that I did not break up that commit better. I'm afraid that if I broke it up now, I would lose the r+'s that I have already gotten.", "author": "ksteuber@mozilla.com", "id": 13378221, "time": "2018-05-31T17:47:27Z"}, {"text": "Comment on attachment 8979644\nBug 1420514 - Replace app.update.enabled with app.update.disabledForTesting in the test harness\n\nhttps://reviewboard.mozilla.org/r/245788/#review254484\n\nLooks good! As far as TPS goes, review from a test or automation peer is totally sufficient for small tweaks like this, especially if they're part of a refactor that makes similar changes elsewhere...but, of course, you're also welcome to ask for review if you'd like. :-) Thanks!", "author": "kit@mozilla.com", "id": 13378324, "time": "2018-05-31T18:20:08Z"}, {"text": "(In reply to Kirk Steuber [:bytesized] from comment #48)\n> is set to true and the environment variable\n> \"MOZ_DISABLE_NONLOCAL_CONNECTIONS\" is set. This is existing functionality\n> that is available via the `xpc::IsInAutomation` C++ function or the\n> `Cu.isInAutomation` JS function.\n\nPlease note that this doesn't apply to any existing harness. Especially Marionette doesn't support this environment variable yet, and for firefox-ui-tests we specifically don't want to have it set because the tier-2 tests have to access remote content.", "author": "hskupin@gmail.com", "id": 13378370, "time": "2018-05-31T18:38:34Z"}, {"text": "Comment on attachment 8979644\nBug 1420514 - Replace app.update.enabled with app.update.disabledForTesting in the test harness\n\nhttps://reviewboard.mozilla.org/r/245788/#review254722\n\nr+wc that you drop the virus pref from prefs.rs.", "author": "ato@sny.no", "id": 13380267, "time": "2018-06-01T13:48:15Z"}, {"text": "https://treeherder.mozilla.org/#/jobs?repo=try&revision=363493063ddb50bbce079368e85e8fe52f1cf0ec", "author": "ksteuber@mozilla.com", "id": 13380760, "time": "2018-06-01T16:47:19Z"}, {"text": "Comment on attachment 8979644\nBug 1420514 - Replace app.update.enabled with app.update.disabledForTesting in the test harness\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/245788/diff/2-3/", "author": "ksteuber@mozilla.com", "id": 13381157, "time": "2018-06-01T19:19:11Z"}, {"text": "Comment on attachment 8979645\nBug 1420514 - Replace app.update.enabled with app.update.disabledForTesting in enterprise policy tests\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/245790/diff/2-3/", "author": "ksteuber@mozilla.com", "id": 13381158, "time": "2018-06-01T19:19:11Z"}, {"text": "Comment on attachment 8979646\nBug 1420514 - Replace app.update.enabled with app.update.disabledForTesting in update tests\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/245792/diff/2-3/", "author": "ksteuber@mozilla.com", "id": 13381159, "time": "2018-06-01T19:19:11Z"}, {"text": "Comment on attachment 8979643\nBug 1420514 - Remove pref app.update.enabled from the update mechanism\n\nhttps://reviewboard.mozilla.org/r/245786/#review256662\n\n::: browser/base/content/aboutDialog-appUpdater.js:139\n(Diff revision 2)\n>      return this.um.activeUpdate &&\n>             this.um.activeUpdate.state == \"downloading\";\n>    },\n>  \n>    // true when updating is disabled by an administrator.\n> -  get updateDisabledAndLocked() {\n> +  get updateDisabledByAdmin() {\n\nI'm ok with updateDisabledByAdmin for the name but perhaps updateDisabledByPolicy would be better. If it is changed it would be good to change the panel name from adminDisabled to policyDisabled.\n\n::: browser/base/content/aboutDialog-appUpdater.js:145\n(Diff revision 2)\n> -           !Services.policies.isAllowed(\"appUpdate\"));\n>    },\n>  \n>    // true when updating is enabled.\n>    get updateEnabled() {\n> -    try {\n> +    return !Services.policies || Services.policies.isAllowed(\"appUpdate\");\n\nWould be better to just combine updateEnabled with updateDisabledByAdmin or updateDisabledByPolicy if you change the name and call that instead.\n\n::: browser/components/nsBrowserGlue.js:737\n(Diff revision 2)\n>    _checkForOldBuildUpdates() {\n>      // check for update if our build is old\n> +    let updateService = Cc[\"@mozilla.org/updates/update-service;1\"].\n> +                        getService(Ci.nsIApplicationUpdateService);\n>      if (AppConstants.MOZ_UPDATER &&\n> -        Services.prefs.getBoolPref(\"app.update.enabled\") &&\n> +        updateService.canCheckForUpdates &&\n\nThis is going to cause the update service to initialize on every startup. I think this check might not be necessary if nsUpdateService.js handles it properly which I think it does. This will also give us more data for this case in telemetry.\n\n::: toolkit/mozapps/update/content/updates.js:568\n(Diff revision 2)\n> -\n> -    if (Services.prefs.getBoolPref(PREF_APP_UPDATE_ENABLED, true))\n> +    let updateService = Cc[\"@mozilla.org/updates/update-service;1\"].\n> +                        getService(Ci.nsIApplicationUpdateService);\n> +    if (updateService.canCheckForUpdates)\n>        document.getElementById(\"noUpdatesAutoEnabled\").hidden = false;\n>      else\n>        document.getElementById(\"noUpdatesAutoDisabled\").hidden = false;\n\nWhen canCheckForUpdates is false this will display the following message which I don't think is approprite with this change since a user won't be able to easily enable update checking when it is disabled by policy.\nThere are no updates available. Please check again later or enable &brandShortName;'s automatic update checking.\n\nAlso, canCheckForUpdates has several other checks beyond just checking the pref.\n\nI suspect you just want the policy check above vs. canCheckForUpdates and a new string for communicating this state.\n\n::: toolkit/mozapps/update/nsIUpdateService.idl:278\n(Diff revision 2)\n>     * @param   force\n>     *          Forces the checker to check for updates, regardless of the\n>     *          current value of the user's update settings. This is used by\n>     *          any piece of UI that offers the user the imperative option to\n>     *          check for updates now, regardless of their update settings.\n> -   *          force will not work if the system administrator has locked\n> +   *          force will not work if updates are disabled by policy.\n\nnit: please change the comment to something along the lines of:\nSpecifying true for the force param will not check for updates when updates are disabled by policy.\n\n::: toolkit/mozapps/update/nsUpdateService.js:35\n(Diff revision 2)\n>  const PREF_APP_UPDATE_DOWNLOAD_MAXATTEMPTS = \"app.update.download.maxAttempts\";\n>  const PREF_APP_UPDATE_ELEVATE_NEVER        = \"app.update.elevate.never\";\n>  const PREF_APP_UPDATE_ELEVATE_VERSION      = \"app.update.elevate.version\";\n>  const PREF_APP_UPDATE_ELEVATE_ATTEMPTS     = \"app.update.elevate.attempts\";\n>  const PREF_APP_UPDATE_ELEVATE_MAXATTEMPTS  = \"app.update.elevate.maxAttempts\";\n> -const PREF_APP_UPDATE_ENABLED              = \"app.update.enabled\";\n> +const PREF_APP_UPDATE_DISABLED_FOR_TEST    = \"app.update.disabledForTesting\";\n\nAre all of the cases where update checks shouldn't be performed in automation handled in the other patches?\n\n::: toolkit/mozapps/update/nsUpdateService.js\n(Diff revision 2)\n>      // UPDATE_LAST_NOTIFY_INTERVAL_DAYS_NOTIFY\n>      AUSTLMY.pingLastUpdateTime(this._pingSuffix);\n>      // Histogram IDs:\n> -    // UPDATE_NOT_PREF_UPDATE_ENABLED_EXTERNAL\n> -    // UPDATE_NOT_PREF_UPDATE_ENABLED_NOTIFY\n> -    AUSTLMY.pingBoolPref(\"UPDATE_NOT_PREF_UPDATE_ENABLED_\" + this._pingSuffix,\n\nUPDATE_NOT_PREF_UPDATE_ENABLED_etc. need to be removed or commented out in UpdateTelemetry.jsm\n\n::: toolkit/mozapps/update/nsUpdateService.js:2064\n(Diff revision 2)\n>          AUSTLMY.pingCheckCode(this._pingSuffix, AUSTLMY.CHK_NO_OS_ABI);\n>        } else if (!validUpdateURL) {\n>          AUSTLMY.pingCheckCode(this._pingSuffix,\n>                                AUSTLMY.CHK_INVALID_DEFAULT_URL);\n> -      } else if (!Services.prefs.getBoolPref(PREF_APP_UPDATE_ENABLED, true)) {\n> +      } else if (this.disabledByAdmin) {\n>          AUSTLMY.pingCheckCode(this._pingSuffix, AUSTLMY.CHK_PREF_DISABLED);\n\nPlease create a new code instead of re-using CHK_PREF_DISABLED\n\n::: toolkit/mozapps/update/nsUpdateService.js\n(Diff revision 2)\n>        } else if (!hasUpdateMutex()) {\n>          AUSTLMY.pingCheckCode(this._pingSuffix, AUSTLMY.CHK_NO_MUTEX);\n> -      } else if (!gCanCheckForUpdates) {\n> +      } else if (!this.canCheckForUpdates) {\n>          AUSTLMY.pingCheckCode(this._pingSuffix, AUSTLMY.CHK_UNABLE_TO_CHECK);\n> -      } else if (!this.backgroundChecker._enabled) {\n> -        AUSTLMY.pingCheckCode(this._pingSuffix, AUSTLMY.CHK_DISABLED_FOR_SESSION);\n\nCHK_DISABLED_FOR_SESSION needs to be removed or commented out in UpdateTelemetry.jsm\n\n::: toolkit/mozapps/update/nsUpdateService.js:2311\n(Diff revision 2)\n> +  get disabledForTesting() {\n> +    return Cu.isInAutomation &&\n> +           Services.prefs.getBoolPref(PREF_APP_UPDATE_DISABLED_FOR_TEST, false);\n> +  },\n> +\n> +  get disabledByAdmin() {\n\nAs previously mentioned, I'm ok with disabledByAdmin for the name but perhaps disabledByPolicy would be better.\n\n::: toolkit/mozapps/update/nsUpdateService.js:2965\n(Diff revision 2)\n>      if (!listener) {\n>        throw Cr.NS_ERROR_NULL_POINTER;\n>      }\n>  \n> -    if (!this.enabled && !force) {\n> +    let UpdateServiceInstance = UpdateServiceFactory.createInstance();\n> +    if (UpdateServiceInstance.disabledByAdmin ||\n\nPlease add a comment that canCheckForUpdates also calls disabledByAdmin.\n\nI've spent a decent amount of time trying to recall why it doesn't return early when canCheckForUpdates is false and force is true. I am fairly certain it is so we show errors during a check performed via the UI. Please add a comment to this affect.", "author": "robert.strong.bugs@gmail.com", "id": 13406003, "time": "2018-06-14T22:12:12Z"}, {"text": "Comment on attachment 8979643\nBug 1420514 - Remove pref app.update.enabled from the update mechanism\n\nhttps://reviewboard.mozilla.org/r/245786/#review257364\n\n::: toolkit/mozapps/update/nsUpdateService.js:35\n(Diff revision 2)\n>  const PREF_APP_UPDATE_DOWNLOAD_MAXATTEMPTS = \"app.update.download.maxAttempts\";\n>  const PREF_APP_UPDATE_ELEVATE_NEVER        = \"app.update.elevate.never\";\n>  const PREF_APP_UPDATE_ELEVATE_VERSION      = \"app.update.elevate.version\";\n>  const PREF_APP_UPDATE_ELEVATE_ATTEMPTS     = \"app.update.elevate.attempts\";\n>  const PREF_APP_UPDATE_ELEVATE_MAXATTEMPTS  = \"app.update.elevate.maxAttempts\";\n> -const PREF_APP_UPDATE_ENABLED              = \"app.update.enabled\";\n> +const PREF_APP_UPDATE_DISABLED_FOR_TEST    = \"app.update.disabledForTesting\";\n\nnit: please name this pref\nPREF_APP_UPDATE_DISABLEDFORTESTING", "author": "robert.strong.bugs@gmail.com", "id": 13406026, "time": "2018-06-14T22:38:38Z"}], "id": 1420514, "priority": "P3", "mentors_detail": [], "cf_crash_signature": "", "version": "unspecified", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox62": "---", "cf_platform_rel": "---", "product": "Firefox", "cf_status_firefox_esr52": "---", "blocks": [1458308], "qa_contact": "", "see_also": ["https://bugzilla.mozilla.org/show_bug.cgi?id=1420570"], "cf_fx_iteration": "---", "component": "Preferences", "votes": 2, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "---", "cf_status_firefox61": "---", "cf_status_firefox60": "---", "target_milestone": "---", "is_cc_accessible": true, "cf_rank": null, "groups": [], "url": "", "creator_detail": {"email": "sledru@mozilla.com", "id": 495955, "name": "sledru@mozilla.com", "real_name": "Sylvestre Ledru [:sylvestre]"}, "whiteboard": "[ux feature]", "mentors": [], "cc_detail": [{"email": "ato@sny.no", "id": 446296, "name": "ato@sny.no", "real_name": "Andreas Tolfsen \u300c:ato\u300d"}, {"email": "B00ze64@hotmail.com", "id": 437577, "name": "B00ze64@hotmail.com", "real_name": "Booze"}, {"email": "chutten@mozilla.com", "id": 553004, "name": "chutten@mozilla.com", "real_name": "Chris H-C :chutten"}, {"email": "ddurst@mozilla.com", "id": 500559, "name": "ddurst@mozilla.com", "real_name": "David Durst [:ddurst]"}, {"email": "felipc@gmail.com", "id": 208747, "name": "felipc@gmail.com", "real_name": ":Felipe Gomes (needinfo me!)"}, {"email": "hskupin@gmail.com", "id": 76551, "name": "hskupin@gmail.com", "real_name": "Henrik Skupin (:whimboo)"}, {"email": "jaws@mozilla.com", "id": 409754, "name": "jaws@mozilla.com", "real_name": "Jared Wein [:jaws] (please needinfo? me)"}, {"email": "jcristau@mozilla.com", "id": 580382, "name": "jcristau@mozilla.com", "real_name": "Julien Cristau [:jcristau]"}, {"email": "jgriffiths@mozilla.com", "id": 421111, "name": "jgriffiths@mozilla.com", "real_name": "Jeff Griffiths (:canuckistani) (:\u26a1\ufe0e)"}, {"email": "jmaher@mozilla.com", "id": 324370, "name": "jmaher@mozilla.com", "real_name": "Joel Maher ( :jmaher ) (UTC-4)"}, {"email": "kit@mozilla.com", "id": 506322, "name": "kit@mozilla.com", "real_name": "Lina Cambridge (she/her) [:lina, :kitcambridge]"}, {"email": "ksteuber@mozilla.com", "id": 563604, "name": "ksteuber@mozilla.com", "real_name": "Kirk Steuber [:bytesized]"}, {"email": "mh+mozilla@glandium.org", "id": 47192, "name": "mh+mozilla@glandium.org", "real_name": "Mike Hommey [:glandium]"}, {"email": "mhowell@mozilla.com", "id": 550257, "name": "mhowell@mozilla.com", "real_name": "Matt Howell [:mhowell]"}, {"email": "niklasbetz20@gmail.com", "id": 597032, "name": "niklasbetz20@gmail.com", "real_name": "opi123"}, {"email": "nthomas@mozilla.com", "id": 69594, "name": "nthomas@mozilla.com", "real_name": "Nick Thomas [:nthomas] (UTC+12)"}, {"email": "robert.strong.bugs@gmail.com", "id": 141755, "name": "robert.strong.bugs@gmail.com", "real_name": "Robert Strong [:rstrong] (use needinfo to contact me)"}, {"email": "rtanglao@mozilla.com", "id": 352356, "name": "rtanglao@mozilla.com", "real_name": "Roland Tanglao needinfo please :rolandtanglao, :mohnkuchen, :adobo, :sinigang, :roland"}, {"email": "rtestard@mozilla.com", "id": 486264, "name": "rtestard@mozilla.com", "real_name": "Romain Testard [:RT]"}, {"email": "simon.mainey@gmail.com", "id": 587136, "name": "simon.mainey@gmail.com", "real_name": "Simon Mainey"}, {"email": "VYV03354@nifty.ne.jp", "id": 5842, "name": "VYV03354@nifty.ne.jp", "real_name": "Masatoshi Kimura [:emk]"}, {"email": "wlachance@mozilla.com", "id": 420096, "name": "wlachance@mozilla.com", "real_name": "William Lachance (:wlach) (use needinfo!)"}], "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "last_change_time": "2018-06-14T22:38:38Z", "cf_status_firefox_esr60": "---", "assigned_to": "ksteuber@mozilla.com", "is_open": true, "resolution": "", "op_sys": "Unspecified", "cf_fx_points": "---", "history": [{"changes": [{"removed": "", "field_name": "cc", "added": "jgriffiths@mozilla.com"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(jgriffiths@mozilla.com)"}], "who": "sledru@mozilla.com", "when": "2017-11-24T21:00:59Z"}, {"changes": [{"removed": "Remove or hide the update features", "field_name": "summary", "added": "Remove or hide the update features in the preferences"}], "who": "sledru@mozilla.com", "when": "2017-11-24T21:01:33Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "rtanglao@mozilla.com"}], "who": "rtanglao@mozilla.com", "when": "2017-11-24T22:02:47Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "nthomas@mozilla.com"}], "who": "nthomas@mozilla.com", "when": "2017-11-25T08:56:02Z"}, {"changes": [{"removed": "", "field_name": "see_also", "added": "https://bugzilla.mozilla.org/show_bug.cgi?id=1420570"}], "who": "sledru@mozilla.com", "when": "2017-11-25T09:04:10Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "jcristau@mozilla.com"}], "who": "jcristau@mozilla.com", "when": "2017-11-26T10:20:40Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "rtestard@mozilla.com"}, {"removed": "needinfo?(jgriffiths@mozilla.com)", "field_name": "flagtypes.name", "added": "needinfo?(rtestard@mozilla.com)"}], "who": "jgriffiths@mozilla.com", "when": "2017-11-27T17:07:55Z"}, {"changes": [{"removed": "--", "field_name": "priority", "added": "P3"}, {"removed": "", "field_name": "cc", "added": "jaws@mozilla.com"}], "who": "jaws@mozilla.com", "when": "2017-11-27T18:56:04Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "ddurst@mozilla.com, robert.strong.bugs@gmail.com"}], "who": "ddurst@mozilla.com", "when": "2017-11-27T20:45:07Z"}, {"changes": [{"removed": "", "field_name": "cf_user_story", "added": "@@ -0,0 +1,7 @@\n+Rationale:\r\n+The \"Never check for Updates\" option is easy to enable and forget about. Once enabled this exposes users to severe security issues and it seems unwise to expose this feature in the preferences? This also contributes to orphaned users.\r\n+\r\n+Requirements:\r\n+- Remove \"Never check for Updates\" option\r\n+- Keep \"Check for updates but let me chose to install them\" so users can remain in control of what gets installed on their devices.\r\n+- An about:config preferences allows disabling updates\n\\ No newline at end of file\n"}, {"removed": "needinfo?(rtestard@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "rtestard@mozilla.com", "when": "2017-11-30T16:15:58Z"}, {"changes": [{"removed": "P3", "field_name": "priority", "added": "P1"}, {"removed": "", "field_name": "cc", "added": "niklasbetz20@gmail.com"}, {"removed": "normal", "field_name": "severity", "added": "major"}], "who": "niklasbetz20@gmail.com", "when": "2018-02-28T16:43:42Z"}, {"changes": [{"removed": "P1", "field_name": "priority", "added": "P3"}, {"removed": "major", "field_name": "severity", "added": "normal"}], "who": "sledru@mozilla.com", "when": "2018-02-28T17:43:27Z"}, {"changes": [{"removed": "", "field_name": "whiteboard", "added": "[ux feature]"}], "who": "jmathies@mozilla.com", "when": "2018-05-01T17:18:42Z"}, {"changes": [{"removed": "", "field_name": "blocks", "added": "1458308"}], "who": "ksteuber@mozilla.com", "when": "2018-05-08T22:38:34Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "ksteuber@mozilla.com"}, {"removed": "", "field_name": "cf_user_story", "added": "@@ -7 +7 @@\n-- An about:config preferences allows disabling updates\n\\ No newline at end of file\n+- Updates can be disabled via the policy engine\n\\ No newline at end of file\n"}], "who": "ksteuber@mozilla.com", "when": "2018-05-08T22:41:16Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "simon.mainey@gmail.com"}], "who": "simon.mainey@gmail.com", "when": "2018-05-09T03:20:01Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "B00ze64@hotmail.com"}], "who": "B00ze64@hotmail.com", "when": "2018-05-12T00:27:34Z"}, {"changes": [{"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "ksteuber@mozilla.com"}], "who": "ksteuber@mozilla.com", "when": "2018-05-14T21:19:41Z"}, {"changes": [{"field_name": "attachments.description", "removed": "Bug 1420514 - Fix tests to use app.update.disabledForTesting instead of app.update.enabled", "attachment_id": 8979379, "added": "Bug 1420514 - Remove app.update.enabled from prefs files"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8979379, "added": "review?(ato@sny.no), review?(felipc@gmail.com), review?(robert.strong.bugs@gmail.com)"}, {"field_name": "attachments.description", "removed": "Bug 1420514 - Remove pref app.update.enabled", "attachment_id": 8979377, "added": "Bug 1420514 - Remove telemetry probes tracking app.update.enabled"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8979378, "added": "review?(jaws@mozilla.com)"}, {"removed": "", "field_name": "cc", "added": "ato@sny.no, felipc@gmail.com"}], "who": "ksteuber@mozilla.com", "when": "2018-05-22T16:35:41Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(ato@sny.no), review?(felipc@gmail.com)", "attachment_id": 8979379, "added": ""}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8979643, "added": "review?(robert.strong.bugs@gmail.com)"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8979377, "added": "review?(chutten@mozilla.com)"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8979644, "added": "review?(ato@sny.no)"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8979645, "added": "review?(felipc@gmail.com)"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8979646, "added": "review?(robert.strong.bugs@gmail.com)"}, {"removed": "", "field_name": "cc", "added": "chutten@mozilla.com"}], "who": "ksteuber@mozilla.com", "when": "2018-05-22T16:37:24Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(chutten@mozilla.com)", "attachment_id": 8979377, "added": "review+"}], "who": "chutten@mozilla.com", "when": "2018-05-22T18:37:24Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "wlachance@mozilla.com"}], "who": "rtestard@mozilla.com", "when": "2018-05-23T14:09:37Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(jaws@mozilla.com)", "attachment_id": 8979378, "added": "review+"}], "who": "jaws@mozilla.com", "when": "2018-05-23T15:50:05Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1460082"}], "who": "ksteuber@mozilla.com", "when": "2018-05-24T18:14:31Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(ato@sny.no)", "attachment_id": 8979644, "added": "review-"}], "who": "ato@sny.no", "when": "2018-05-25T13:34:33Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(felipc@gmail.com)", "attachment_id": 8979645, "added": "review+"}], "who": "felipc@gmail.com", "when": "2018-05-25T21:35:50Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(robert.strong.bugs@gmail.com)", "attachment_id": 8979379, "added": "review+"}], "who": "robert.strong.bugs@gmail.com", "when": "2018-05-29T23:24:48Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8979644, "added": "review?(chutten@mozilla.com)"}], "who": "ksteuber@mozilla.com", "when": "2018-05-30T18:42:41Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(chutten@mozilla.com)", "attachment_id": 8979644, "added": "review+"}], "who": "chutten@mozilla.com", "when": "2018-05-30T18:46:24Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8979644, "added": "review?(hskupin@gmail.com), review?(jmaher@mozilla.com)"}, {"removed": "", "field_name": "cc", "added": "hskupin@gmail.com, jmaher@mozilla.com"}], "who": "ksteuber@mozilla.com", "when": "2018-05-30T20:28:51Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review-", "attachment_id": 8979644, "added": "review?(ato@sny.no)"}], "who": "ksteuber@mozilla.com", "when": "2018-05-30T20:45:16Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(jmaher@mozilla.com)", "attachment_id": 8979644, "added": "review+"}], "who": "jmaher@mozilla.com", "when": "2018-05-30T22:02:25Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "mh+mozilla@glandium.org"}], "who": "mh+mozilla@glandium.org", "when": "2018-05-30T22:24:29Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "mhowell@mozilla.com"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(mhowell@mozilla.com)"}], "who": "ksteuber@mozilla.com", "when": "2018-05-31T00:06:21Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(hskupin@gmail.com)", "attachment_id": 8979644, "added": "review-"}], "who": "hskupin@gmail.com", "when": "2018-05-31T05:57:28Z"}, {"changes": [{"removed": "needinfo?(mhowell@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "mhowell@mozilla.com", "when": "2018-05-31T14:59:00Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "VYV03354@nifty.ne.jp"}], "who": "VYV03354@nifty.ne.jp", "when": "2018-05-31T15:27:01Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(ato@sny.no)", "attachment_id": 8979644, "added": "review?(kit@mozilla.com)"}, {"removed": "", "field_name": "cc", "added": "kit@mozilla.com"}], "who": "ksteuber@mozilla.com", "when": "2018-05-31T17:44:04Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review-", "attachment_id": 8979644, "added": "review?(ato@sny.no)"}], "who": "ksteuber@mozilla.com", "when": "2018-05-31T17:46:32Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(kit@mozilla.com)", "attachment_id": 8979644, "added": "review+"}], "who": "kit@mozilla.com", "when": "2018-05-31T18:20:08Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(ato@sny.no)", "attachment_id": 8979644, "added": "review+"}], "who": "ato@sny.no", "when": "2018-06-01T13:48:15Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(robert.strong.bugs@gmail.com)", "attachment_id": 8979643, "added": "review-"}], "who": "robert.strong.bugs@gmail.com", "when": "2018-06-14T22:12:12Z"}]}