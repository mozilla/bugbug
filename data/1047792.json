{"cf_tracking_thunderbird_esr52": "---", "status": "RESOLVED", "cf_tracking_firefox60": "---", "attachments": [{"creator": "brian@briansmith.org", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2014-08-02T07:11:25Z", "type_id": 4, "creation_date": "2014-08-02T07:11:25Z", "id": 940703, "setter": "brian@briansmith.org"}], "content_type": "text/plain", "id": 8466628}], "classification": "Components", "creator": "brian@briansmith.org", "cc": ["brian@briansmith.org", "mail@nh2.me"], "depends_on": [], "creation_time": "2014-08-02T07:11:25Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "All", "cf_status_firefox58": "---", "cf_status_firefox59": "---", "keywords": [], "summary": "Filter out expired issuer certificates within mozilla::pkix, instead of relying on NSS's CERT_CreateSubjectCertList to do it", "id": 1047792, "assigned_to_detail": {"email": "brian@briansmith.org", "id": 14661, "name": "brian@briansmith.org", "real_name": "Brian Smith (:briansmith, :bsmith, use NEEDINFO?)"}, "severity": "normal", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "assigned_to": "brian@briansmith.org", "comment_count": 4, "comments": [{"text": "Created attachment 8466628\nfilter-expired-certificates-better.patch\n\nDavid Keeler (:keeler) wrote in bug 1043041 comment 3:\n> ::: security/pkix/lib/pkixbuild.cpp\n> @@ +91,5 @@\n> >  {\n> >    if (newResult == Result::ERROR_UNTRUSTED_CERT) {\n> >      newResult = Result::ERROR_UNTRUSTED_ISSUER;\n> > +  } else if (newResult == Result::ERROR_EXPIRED_CERTIFICATE) {\n> > +    newResult = Result::ERROR_EXPIRED_ISSUER_CERTIFICATE;\n> \n> I agree this is a good change to make, but it seems to violate the \"one bug\n> per bug\" idea. Does it work to have the changes related to this be a\n> separate patch? (it can be part 2 or part 3 of this bug)\n\nIn bug 1043041, we'll change the signature of TrustDomain::FindIssuer so that it no longer has a PRTime to pass to CERT_CreateSubjectCertList. Since we can't pass a time to that function, it won't be able to filter out expired issuer certificates. But, that's OK, because mozilla::pkix already checks the expiration itself anyway, so the check that CERT_CreateSubjectCertList is redundant.\n\nA non-obvious consequence of this is that, in the case where there is only one potential issuer and it is expired, we may calculate a different result than we did previously. Previously, we'd return ERROR_UNKNOWN_ISSUER, but now we'll return ERROR_EXPIRED_ISSUER_CERTIFICATE for that case. Since ERROR_EXPIRED_ISSUER_CERTIFICATE is a more specific error, this side-effect is positive.\n\nDavid had suggested that these changes be split out into a separate patch in bug 1043041. However, these changes can actually be made independently of the changes in bug 1043041, so I filed this bug to do that. David already reviewed these changes in bug 1043041.", "author": "brian@briansmith.org", "id": 9133497, "time": "2014-08-02T07:11:25Z"}, {"text": "https://hg.mozilla.org/integration/mozilla-inbound/rev/64719bb17179", "author": "brian@briansmith.org", "id": 9135076, "time": "2014-08-03T18:02:34Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/64719bb17179", "author": "ryanvm@gmail.com", "id": 9139019, "time": "2014-08-04T20:30:34Z"}, {"text": "*** Bug 1060981 has been marked as a duplicate of this bug. ***", "author": "brian@briansmith.org", "id": 9278454, "time": "2014-09-06T00:02:11Z"}], "cf_last_resolved": "2014-08-04T20:30:34Z", "priority": "--", "mentors_detail": [], "cf_crash_signature": "", "version": "Trunk", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox59": "---", "last_change_time": "2014-09-06T00:02:11Z", "cf_platform_rel": "---", "product": "Core", "cf_status_firefox_esr52": "---", "blocks": [1043041], "qa_contact": "", "see_also": [], "cf_fx_iteration": "---", "component": "Security: PSM", "votes": 0, "groups": [], "cf_status_firefox60": "---", "target_milestone": "mozilla34", "is_cc_accessible": true, "cf_status_thunderbird_esr52": "---", "url": "", "creator_detail": {"email": "brian@briansmith.org", "id": 14661, "name": "brian@briansmith.org", "real_name": "Brian Smith (:briansmith, :bsmith, use NEEDINFO?)"}, "whiteboard": "", "mentors": [], "cc_detail": [{"email": "brian@briansmith.org", "id": 14661, "name": "brian@briansmith.org", "real_name": "Brian Smith (:briansmith, :bsmith, use NEEDINFO?)"}, {"email": "mail@nh2.me", "id": 404761, "name": "mail@nh2.me", "real_name": "Niklas Hamb\u00fcchen"}], "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [{"status": "+", "name": "in-testsuite", "modification_date": "2014-08-04T20:30:34Z", "type_id": 37, "creation_date": "2014-08-04T20:30:34Z", "id": 941746, "setter": "ryanvm@gmail.com"}], "cf_tracking_firefox58": "---", "cf_rank": null, "is_open": false, "history": [{"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8466628, "added": "review+"}], "who": "brian@briansmith.org", "when": "2014-08-02T07:11:25Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "brian@briansmith.org"}], "who": "brian@briansmith.org", "when": "2014-08-03T18:02:34Z"}, {"changes": [{"removed": "ASSIGNED", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "", "field_name": "flagtypes.name", "added": "in-testsuite+"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2014-08-04 13:30:34"}], "who": "ryanvm@gmail.com", "when": "2014-08-04T20:30:34Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "mail@nh2.me"}], "who": "brian@briansmith.org", "when": "2014-09-06T00:02:11Z"}], "resolution": "FIXED", "op_sys": "All", "cf_fx_points": "---", "cf_blocking_fennec": "---"}