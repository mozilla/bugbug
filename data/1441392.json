{"cf_tracking_thunderbird_esr52": "---", "status": "NEW", "cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "cf_tracking_firefox62": "---", "creator": "jschwartzentruber@mozilla.com", "mentors_detail": [], "depends_on": [1444946], "cf_status_firefox_esr60": "disabled", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "cf_status_firefox59": "unaffected", "keywords": ["crash", "testcase"], "cc_detail": [{"email": "bugmail@mozilla.staktrace.com", "id": 426788, "name": "bugmail@mozilla.staktrace.com", "real_name": "Kartikaya Gupta (email:kats@mozilla.com)"}, {"email": "emilio@crisal.io", "id": 546716, "name": "emilio@crisal.io", "real_name": "Emilio Cobos \u00c1lvarez [:emilio]"}, {"email": "fuzzing@mozilla.com", "id": 469204, "name": "fuzzing@mozilla.com", "real_name": "Fuzzing Team"}, {"email": "gwatson@mozilla.com", "id": 504871, "name": "gwatson@mozilla.com", "real_name": "Glenn Watson [:gw]"}, {"email": "jan@ikenmeyer.eu", "id": 580271, "name": "jan@ikenmeyer.eu", "real_name": "Jan Andre Ikenmeyer [:darkspirit]"}, {"email": "milaninbugzilla@gmail.com", "id": 456486, "name": "milaninbugzilla@gmail.com", "real_name": "Milan Sreckovic [:milan] (needinfo for best results)"}, {"email": "sotaro.ikeda.g@gmail.com", "id": 434202, "name": "sotaro.ikeda.g@gmail.com", "real_name": "Sotaro Ikeda [:sotaro]"}], "cf_last_resolved": null, "attachments": [{"creator": "jschwartzentruber@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [], "content_type": "text/html", "id": 8954253}], "votes": 1, "classification": "Components", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 14, "comments": [{"text": "Created attachment 8954253\ntestcase.html\n\nThe attached testcase crashes in m-c 20180226-580d833df9c4 in Xvfb.\n\n=================================================================\n==6600==ERROR: AddressSanitizer: SEGV on unknown address 0x7fd6c3db9008 (pc 0x7fd72a5faf2a bp 0x6310007be780 sp 0x7fd6d0590670 T38)\n==6600==The signal is caused by a READ memory access.\n    #0 0x7fd72a5faf29 in begin_binning (/usr/lib/dri/swrast_dri.so+0x790f29)\n    #1 0x7fd72a5fb3a5 in set_scene_state.isra.7 (/usr/lib/dri/swrast_dri.so+0x7913a5)\n    #2 0x7fd72a5fbec2 in lp_setup_bind_framebuffer (/usr/lib/dri/swrast_dri.so+0x791ec2)\n    #3 0x7fd72a60d5a2 in llvmpipe_set_framebuffer_state (/usr/lib/dri/swrast_dri.so+0x7a35a2)\n    #4 0x7fd72a0adabb in st_update_framebuffer_state (/usr/lib/dri/swrast_dri.so+0x243abb)\n    #5 0x7fd72a0ac538 in st_validate_state (/usr/lib/dri/swrast_dri.so+0x242538)\n    #6 0x7fd72a0b47b3 in st_Clear (/usr/lib/dri/swrast_dri.so+0x24a7b3)\n    #7 0x7fd73e80cb5a in webrender::device::Device::clear_target::h48bee34b9da1e8bc /builds/worker/workspace/build/src/gfx/webrender/src/device.rs:1928\n    #8 0x7fd73e8f9e39 in webrender::renderer::Renderer::draw_alpha_target::h09013a711479cb55 /builds/worker/workspace/build/src/gfx/webrender/src/renderer.rs:3937\n    #9 0x7fd73e8f9e39 in webrender::renderer::Renderer::draw_tile_frame::hf244c05f00232032 /builds/worker/workspace/build/src/gfx/webrender/src/renderer.rs:4427\n    #10 0x7fd73e8ec3ee in webrender::renderer::Renderer::render_impl::_$u7b$$u7b$closure$u7d$$u7d$::h13f5531cbda2b29d /builds/worker/workspace/build/src/gfx/webrender/src/renderer.rs:2880\n    #11 0x7fd73e8ec3ee in webrender::profiler::TimeProfileCounter::profile::h4a84da955fa713a4 /builds/worker/workspace/build/src/gfx/webrender/src/profiler.rs:190\n    #12 0x7fd73e8ec3ee in webrender::renderer::Renderer::render_impl::hfea42b1748348b19 /builds/worker/workspace/build/src/gfx/webrender/src/renderer.rs:2833\n    #13 0x7fd73e7d764d in webrender::renderer::Renderer::render::hb5fb0e293cab898c /builds/worker/workspace/build/src/gfx/webrender/src/renderer.rs:2779\n    #14 0x7fd73e7d764d in wr_renderer_render /builds/worker/workspace/build/src/gfx/webrender_bindings/src/bindings.rs:525\n    #15 0x7fd7332d966e in mozilla::wr::RendererOGL::UpdateAndRender(bool) /builds/worker/workspace/build/src/gfx/webrender_bindings/RendererOGL.cpp:136:8\n    #16 0x7fd7332d816c in mozilla::wr::RenderThread::UpdateAndRender(mozilla::wr::WrWindowId, bool) /builds/worker/workspace/build/src/gfx/webrender_bindings/RenderThread.cpp:256:24\n    #17 0x7fd7332d7d4c in mozilla::wr::RenderThread::NewFrameReady(mozilla::wr::WrWindowId) /builds/worker/workspace/build/src/gfx/webrender_bindings/RenderThread.cpp:174:3\n    #18 0x7fd7332e59c0 in applyImpl<mozilla::wr::RenderThread, void (mozilla::wr::RenderThread::*)(mozilla::wr::WrWindowId), StoreCopyPassByConstLRef<mozilla::wr::WrWindowId> , 0> /builds/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:1149:12\n    #19 0x7fd7332e59c0 in apply<mozilla::wr::RenderThread, void (mozilla::wr::RenderThread::*)(mozilla::wr::WrWindowId)> /builds/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:1155\n    #20 0x7fd7332e59c0 in mozilla::detail::RunnableMethodImpl<mozilla::wr::RenderThread*, void (mozilla::wr::RenderThread::*)(mozilla::wr::WrWindowId), true, (mozilla::RunnableKind)0, mozilla::wr::WrWindowId>::Run() /builds/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:1200\n    #21 0x7fd7314a43b3 in RunTask /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:452:9\n    #22 0x7fd7314a43b3 in DeferOrRunPendingTask /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:460\n    #23 0x7fd7314a43b3 in MessageLoop::DoWork() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:535\n    #24 0x7fd7314a6328 in base::MessagePumpDefault::Run(base::MessagePump::Delegate*) /builds/worker/workspace/build/src/ipc/chromium/src/base/message_pump_default.cc:36:31\n    #25 0x7fd7314a1799 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:326:10\n    #26 0x7fd7314a1799 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:319\n    #27 0x7fd7314a1799 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:299\n    #28 0x7fd7314c0d3f in base::Thread::ThreadMain() /builds/worker/workspace/build/src/ipc/chromium/src/base/thread.cc:181:16\n    #29 0x7fd7314b27ac in ThreadFunc(void*) /builds/worker/workspace/build/src/ipc/chromium/src/base/platform_thread_posix.cc:38:13\n    #30 0x7fd7505d408b in start_thread (/usr/lib/libpthread.so.0+0x708b)\n    #31 0x7fd74f615e7e in __GI___clone (/usr/lib/libc.so.6+0xf5e7e)\n\nAddressSanitizer can not provide additional info.\nSUMMARY: AddressSanitizer: SEGV (/usr/lib/dri/swrast_dri.so+0x790f29) in begin_binning\nThread T38 (Renderer) created by T0 here:\n    #0 0x4b065d in __interceptor_pthread_create /builds/worker/workspace/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_interceptors.cc:204:3\n    #1 0x7fd7314b010f in CreateThread /builds/worker/workspace/build/src/ipc/chromium/src/base/platform_thread_posix.cc:135:14\n    #2 0x7fd7314b010f in PlatformThread::Create(unsigned long, PlatformThread::Delegate*, unsigned long*) /builds/worker/workspace/build/src/ipc/chromium/src/base/platform_thread_posix.cc:146\n    #3 0x7fd7314c06df in base::Thread::StartWithOptions(base::Thread::Options const&) /builds/worker/workspace/build/src/ipc/chromium/src/base/thread.cc:99:8\n    #4 0x7fd7332d6b26 in mozilla::wr::RenderThread::Start() /builds/worker/workspace/build/src/gfx/webrender_bindings/RenderThread.cpp:57:16\n    #5 0x7fd73308b928 in gfxPlatform::InitLayersIPC() /builds/worker/workspace/build/src/gfx/thebes/gfxPlatform.cpp:1031:7\n    #6 0x7fd733086ad3 in gfxPlatform::Init() /builds/worker/workspace/build/src/gfx/thebes/gfxPlatform.cpp:779:5\n    #7 0x7fd7330840fb in gfxPlatform::GetPlatform() /builds/worker/workspace/build/src/gfx/thebes/gfxPlatform.cpp:538:9\n    #8 0x7fd737ebe6d9 in mozilla::widget::GfxInfoBase::GetContentBackend(nsTSubstring<char16_t>&) /builds/worker/workspace/build/src/widget/GfxInfoBase.cpp:1527:25\n    #9 0x7fd7306a4161 in NS_InvokeByIndex /builds/worker/workspace/build/src/xpcom/reflect/xptcall/md/unix/xptcinvoke_asm_x86_64_unix.S:106\n    #10 0x7fd73216cb30 in Invoke /builds/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1948:12\n    #11 0x7fd73216cb30 in Call /builds/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1267\n    #12 0x7fd73216cb30 in XPCWrappedNative::CallMethod(XPCCallContext&, XPCWrappedNative::CallMode) /builds/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1234\n    #13 0x7fd732173ba9 in GetAttribute /builds/worker/workspace/build/src/js/xpconnect/src/xpcprivate.h:1671:17\n    #14 0x7fd732173ba9 in XPC_WN_GetterSetter(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNativeJSOps.cpp:965\n    #15 0x7fd73c8d518e in CallJSNative /builds/worker/workspace/build/src/js/src/vm/JSContext-inl.h:290:15\n    #16 0x7fd73c8d518e in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:467\n    #17 0x7fd73c8d6ee2 in InternalCall /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:516:12\n    #18 0x7fd73c8d6ee2 in Call /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:535\n    #19 0x7fd73c8d6ee2 in js::CallGetter(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:650\n    #20 0x7fd73da375ae in CallGetter /builds/worker/workspace/build/src/js/src/vm/NativeObject.cpp:2155:16\n    #21 0x7fd73da375ae in GetExistingProperty<js::AllowGC::CanGC> /builds/worker/workspace/build/src/js/src/vm/NativeObject.cpp:2208\n    #22 0x7fd73da375ae in NativeGetPropertyInline<js::AllowGC::CanGC> /builds/worker/workspace/build/src/js/src/vm/NativeObject.cpp:2411\n    #23 0x7fd73da375ae in js::NativeGetProperty(JSContext*, JS::Handle<js::NativeObject*>, JS::Handle<JS::Value>, JS::Handle<jsid>, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/NativeObject.cpp:2447\n    #24 0x7fd73c8bf97d in GetProperty /builds/worker/workspace/build/src/js/src/vm/NativeObject.h:1629:12\n    #25 0x7fd73c8bf97d in GetObjectElementOperation /builds/worker/workspace/build/src/js/src/vm/Interpreter-inl.h:520\n    #26 0x7fd73c8bf97d in GetElementOperation /builds/worker/workspace/build/src/js/src/vm/Interpreter-inl.h:626\n    #27 0x7fd73c8bf97d in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2930\n    #28 0x7fd73c89f6e4 in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:417:12\n    #29 0x7fd73c8d4f87 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:489:15\n    #30 0x7fd73c8bcb6b in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:522:12\n    #31 0x7fd73c8bcb6b in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3092\n    #32 0x7fd73c89f6e4 in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:417:12\n    #33 0x7fd73c8d4f87 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:489:15\n    #34 0x7fd73c8bcb6b in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:522:12\n    #35 0x7fd73c8bcb6b in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3092\n    #36 0x7fd73c89f6e4 in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:417:12\n    #37 0x7fd73c8d4f87 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:489:15\n    #38 0x7fd73c8bcb6b in CallFromStack /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:522:12\n    #39 0x7fd73c8bcb6b in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3092\n    #40 0x7fd73c89f6e4 in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:417:12\n    #41 0x7fd73c8d4f87 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:489:15\n    #42 0x7fd73c8d5cf3 in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:535:10\n    #43 0x7fd73d4d7ec5 in JS_CallFunctionValue(JSContext*, JS::Handle<JSObject*>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/jsapi.cpp:2969:12\n    #44 0x7fd732153b42 in nsXPCWrappedJSClass::CallMethod(nsXPCWrappedJS*, unsigned short, XPTMethodDescriptor const*, nsXPTCMiniVariant*) /builds/worker/workspace/build/src/js/xpconnect/src/XPCWrappedJSClass.cpp:1307:23\n    #45 0x7fd7306a573f in PrepareAndDispatch /builds/worker/workspace/build/src/xpcom/reflect/xptcall/md/unix/xptcstubs_x86_64_linux.cpp:120:28\n    #46 0x7fd7306a46ea in SharedStub (/home/truber/builds/m-c-1519683613-fuzzing-asan-opt/libxul.so+0x224e6ea)\n    #47 0x7fd73061e91d in NS_CreateServicesFromCategory(char const*, nsISupports*, char const*, char16_t const*) /builds/worker/workspace/build/src/xpcom/components/nsCategoryManager.cpp:810:19\n    #48 0x7fd73c5e846c in nsXREDirProvider::DoStartup() /builds/worker/workspace/build/src/toolkit/xre/nsXREDirProvider.cpp:1022:11\n    #49 0x7fd73c5c4f68 in XREMain::XRE_mainRun() /builds/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4516:16\n    #50 0x7fd73c5c851c in XREMain::XRE_main(int, char**, mozilla::BootstrapConfig const&) /builds/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4814:8\n    #51 0x7fd73c5c9964 in XRE_main(int, char**, mozilla::BootstrapConfig const&) /builds/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4906:21\n    #52 0x4f6d45 in do_main /builds/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:231:22\n    #53 0x4f6d45 in main /builds/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:304\n    #54 0x7fd74f540f49 in __libc_start_main (/usr/lib/libc.so.6+0x20f49)\n\n==6600==ABORTING", "author": "jschwartzentruber@mozilla.com", "id": 13071366, "time": "2018-02-27T01:43:17Z"}, {"text": "Bug 1442921 seems to be similar bug. attachment 8954253 caused similar crash like Bug 1442921 on my ubuntu pc.", "author": "sotaro.ikeda.g@gmail.com", "id": 13129935, "time": "2018-03-15T04:14:31Z"}, {"text": "I believe this is fixed by https://github.com/servo/webrender/pull/2524, which is now in m-c. Jesse, are you able to confirm?", "author": "gwatson@mozilla.com", "id": 13185183, "time": "2018-04-06T03:00:09Z"}, {"text": "I get the following error now in m-c rev 20180411-cfe6399e142c:\n\nERROR 2018-04-11T17:25:21Z: webrender::render_backend: ERROR: Invalid window dimensions 32767x1335. Please call api.set_window_size()\nfirefox: ../mesa-18.0.0/src/gallium/drivers/llvmpipe/lp_state_surface.c:57: llvmpipe_set_framebuffer_state: Assertion `fb->width <= LP_MAX_WIDTH' failed.\n\nExit code: -6\n\nNo backtrace, only ASan traces from IPC shutdown.", "author": "jschwartzentruber@mozilla.com", "id": 13198671, "time": "2018-04-11T17:31:53Z"}, {"text": "I opened https://bug1441392.bmoattachments.org/attachment.cgi?id=8954253 and allowed the popup.\nbp-18eb2a53-dd34-47a3-8630-7548f0180516", "author": "jan@ikenmeyer.eu", "id": 13281720, "time": "2018-05-16T15:25:24Z"}, {"text": "I couldn't reproduce on Win10 1803 (GeForce GTX 1060) so far.", "author": "jan@ikenmeyer.eu", "id": 13281762, "time": "2018-05-16T15:34:55Z"}, {"text": "I'm fairly confident this is resolved now - we explicitly handle framebuffer dimensions being larger than supported by the hardware or OSMesa now. Has anyone seen this recently?", "author": "gwatson@mozilla.com", "id": 13379405, "time": "2018-06-01T04:32:57Z"}, {"text": "(In reply to Glenn Watson [:gw] from comment #6)\n> I'm fairly confident this is resolved now - we explicitly handle framebuffer dimensions being larger than supported by the hardware or OSMesa now. Has anyone seen this recently?\n\nSame steps: bp-79cf4e1a-d774-491f-9ca2-ed6fa0180601 build 2018-05-31_220139 Linux.", "author": "jan@ikenmeyer.eu", "id": 13379521, "time": "2018-06-01T07:13:36Z"}, {"text": "> WR @ 5e4f257d9f3cdb5691ac62f3affe2e9189d66447 (bug 1465058 comment 6)\n\nRUST_BACKTRACE=1 mozregression --repo try --launch 119a1f4d7e743df417cdb8f008569dda7c0cc18f -B debug --pref gfx.webrender.all:true startup.homepage_welcome_url:'https://bug1441392.bmoattachments.org/attachment.cgi?id=8954253'\n> 0:42.96 INFO: [GFX1-]: Attempting to allocate a texture of size 32688x2048 above the limit, trimming\n> 0:42.96 INFO: ERROR 2018-06-01T16:22:05Z: webrender::device: Attempting to allocate a texture of size 32688x2048 above the limit, trimming\n> 0:42.96 INFO: thread '<unnamed>' panicked at 'assertion failed: `(left == right)`\n> 0:42.96 INFO:   left: `16384\u00d72048`,\n> 0:42.96 INFO:  right: `32688\u00d72048`', gfx/webrender/src/tiling.rs:227:9\n> 0:44.26 INFO: stack backtrace:\n> 0:44.26 INFO:    0: std::sys::unix::backtrace::tracing::imp::unwind_backtrace\n> 0:44.26 INFO:    1: std::sys_common::backtrace::print\n> 0:44.26 INFO:    2: std::panicking::default_hook::{{closure}}\n> 0:44.26 INFO:    3: std::panicking::default_hook\n> 0:44.26 INFO:    4: std::panicking::rust_panic_with_hook\n> 0:44.26 INFO:    5: std::panicking::begin_panic\n> 0:44.26 INFO:    6: std::panicking::begin_panic_fmt\n> 0:44.26 INFO:    7: <unknown>\n> 0:44.26 INFO: Redirecting call to abort() to mozalloc_abort\n\nhttps://github.com/servo/webrender/blob/5e4f257d9f3cdb5691ac62f3affe2e9189d66447/webrender/src/tiling.rs#L227", "author": "jan@ikenmeyer.eu", "id": 13380699, "time": "2018-06-01T16:26:28Z"}, {"text": "comment 8 = Radeon RX480 on Debian Testing.\n\nThis doesn't crash with proprietary Nvidia.\n> Ger\u00e4tekennung\tGeForce GTX 1060 3GB/PCIe/SSE2\n> Treiber-Version\t4.6.0 NVIDIA 390.48\nhttps://packages.debian.org/buster/nvidia-driver", "author": "jan@ikenmeyer.eu", "id": 13386598, "time": "2018-06-04T22:03:37Z"}, {"text": "The problem here appears to be that the check at https://github.com/servo/webrender/blob/952521658aaf331e7b7382fb18ca1d8b7bfc9dc8/webrender/src/render_backend.rs#L182 is no longer enough to avoid trying to render to a very large window.\n\nI think this is because of the way the scene building is forwarded to the scene builder thread avoids this code path.\n\nI tried to add a check to has_pixels() but that doesn't seem to be sufficient - it looks like the scene still gets built with a window size that is larger than the maximum texture size.\n\nkats, any suggestions on the best way to resolve this? Or do you feel like taking this bug? :)", "author": "gwatson@mozilla.com", "id": 13386777, "time": "2018-06-04T23:47:44Z"}, {"text": "(In reply to Glenn Watson [:gw] from comment #10)\n> The problem here appears to be that the check at\n> https://github.com/servo/webrender/blob/\n> 952521658aaf331e7b7382fb18ca1d8b7bfc9dc8/webrender/src/render_backend.\n> rs#L182 is no longer enough to avoid trying to render to a very large window.\n> \n> I think this is because of the way the scene building is forwarded to the\n> scene builder thread avoids this code path.\n\nI had kind of wondered about that inconsistency when I made the has_pixels() check. What is the expected behaviour in this case, if the window size is too large? If it skips doing the scene build isn't that going to just show a blank window instead of crashing?\n\n> I tried to add a check to has_pixels() but that doesn't seem to be\n> sufficient - it looks like the scene still gets built with a window size\n> that is larger than the maximum texture size.\n> \n> kats, any suggestions on the best way to resolve this? Or do you feel like\n> taking this bug? :)\n\nThe has_pixels() check happens after scene build but before rendering. So yeah, it would still do the scene build if you put the check in has_pixels(). We probably want to add the check somewhere near the start of the forward_transaction_to_scene_builder function. But what exactly to do that in case depends on what the expected behaviour is for this scenario. I'm happy to implement the fix if you can answer the above questions.", "author": "bugmail@mozilla.staktrace.com", "id": 13387887, "time": "2018-06-05T13:24:34Z"}, {"text": "For comment 11", "author": "bugmail@mozilla.staktrace.com", "id": 13390898, "time": "2018-06-06T13:23:06Z"}, {"text": "I think the expected behavior, for now at least, can just be to draw nothing. This generally only occurs for one frame, since Gecko then clamps the layout to the actual window size and sends a new display list. In any case, that is an improvement on a crash.\n\nWe could perhaps consider a better solution as a later follow up where we clamp to the maximum window size, but I'm not sure if that would be simple or perhaps cause issues elsewhere.", "author": "gwatson@mozilla.com", "id": 13409775, "time": "2018-06-18T02:56:43Z"}], "id": 1441392, "priority": "P2", "cc": ["bugmail@mozilla.staktrace.com", "emilio@crisal.io", "fuzzing@mozilla.com", "gwatson@mozilla.com", "jan@ikenmeyer.eu", "milaninbugzilla@gmail.com", "sotaro.ikeda.g@gmail.com"], "cf_crash_signature": "[@ mozalloc_abort | abort | webrender::renderer::Renderer::draw_tile_frame ]\r\n[@ mozalloc_abort | abort | webrender::renderer::Renderer::draw_tile_frame::ha0f10af98178cd67 ]\r\n[@ mozalloc_abort | abort | webrender::renderer::Renderer::draw_tile_frame::ha411b13875ee5104 ]\r\n[@ static void webrender::renderer::Renderer::draw_tile_frame ]", "version": "Trunk", "is_cc_accessible": true, "cf_tracking_firefox_esr52": "---", "see_also": ["https://bugzilla.mozilla.org/show_bug.cgi?id=1442921", "https://github.com/servo/webrender/pull/2524", "https://bugzilla.mozilla.org/show_bug.cgi?id=1447037"], "cf_tracking_thunderbird_esr60": "---", "cf_platform_rel": "---", "product": "Core", "cf_fx_iteration": "---", "blocks": [1340565, 1357819, 1386669], "qa_contact": "", "creation_time": "2018-02-27T01:43:17Z", "cf_status_firefox_esr52": "unaffected", "component": "Graphics: WebRender", "assigned_to_detail": {"email": "gwatson@mozilla.com", "id": 504871, "name": "gwatson@mozilla.com", "real_name": "Glenn Watson [:gw]"}, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "disabled", "cf_status_firefox61": "disabled", "cf_status_firefox60": "disabled", "target_milestone": "---", "cf_rank": null, "cf_qa_whiteboard": "", "severity": "critical", "groups": [], "cf_status_thunderbird_esr52": "---", "url": "", "cf_status_thunderbird_esr60": "---", "creator_detail": {"email": "jschwartzentruber@mozilla.com", "id": 486733, "name": "jschwartzentruber@mozilla.com", "real_name": "Jesse Schwartzentruber (:truber)"}, "whiteboard": "", "mentors": [], "summary": "Crash [@ swrast_dri.so+0x790f29 | webrender::device::Device::clear_target]", "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [{"status": "?", "name": "in-testsuite", "modification_date": "2018-02-27T01:43:17Z", "type_id": 37, "creation_date": "2018-02-27T01:43:17Z", "id": 1721983, "setter": "jschwartzentruber@mozilla.com"}], "last_change_time": "2018-06-18T02:56:43Z", "assigned_to": "gwatson@mozilla.com", "is_open": true, "history": [{"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "in-testsuite?"}], "who": "jschwartzentruber@mozilla.com", "when": "2018-02-27T01:43:17Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "jan@ikenmeyer.eu"}], "who": "jan@ikenmeyer.eu", "when": "2018-02-27T02:41:35Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "emilio@crisal.io"}], "who": "emilio@crisal.io", "when": "2018-02-27T16:52:15Z"}, {"changes": [{"removed": "--", "field_name": "priority", "added": "P2"}, {"removed": "", "field_name": "cc", "added": "milan@mozilla.com"}, {"removed": "", "field_name": "depends_on", "added": "1386669"}], "who": "milaninbugzilla@gmail.com", "when": "2018-02-27T18:59:24Z"}, {"changes": [{"removed": "", "field_name": "blocks", "added": "1386669"}, {"removed": "1386669", "field_name": "depends_on", "added": ""}], "who": "milaninbugzilla@gmail.com", "when": "2018-02-28T17:25:39Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "sotaro.ikeda.g@gmail.com"}], "who": "sotaro.ikeda.g@gmail.com", "when": "2018-03-15T04:14:31Z"}, {"changes": [{"removed": "", "field_name": "see_also", "added": "https://bugzilla.mozilla.org/show_bug.cgi?id=1442921"}], "who": "sotaro.ikeda.g@gmail.com", "when": "2018-03-15T04:14:48Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "gwatson@mozilla.com"}, {"removed": "", "field_name": "see_also", "added": "https://github.com/servo/webrender/pull/2524"}], "who": "gwatson@mozilla.com", "when": "2018-03-15T05:08:06Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1444946"}, {"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "gwatson@mozilla.com"}, {"removed": "---", "field_name": "cf_status_firefox_esr52", "added": "unaffected"}, {"removed": "---", "field_name": "cf_status_firefox59", "added": "unaffected"}, {"removed": "affected", "field_name": "cf_status_firefox60", "added": "disabled"}, {"removed": "---", "field_name": "cf_status_firefox61", "added": "disabled"}], "who": "jan@ikenmeyer.eu", "when": "2018-03-16T23:56:48Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(jschwartzentruber@mozilla.com)"}], "who": "gwatson@mozilla.com", "when": "2018-04-06T03:00:09Z"}, {"changes": [{"removed": "needinfo?(jschwartzentruber@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "jschwartzentruber@mozilla.com", "when": "2018-04-11T17:31:53Z"}, {"changes": [{"removed": "", "field_name": "see_also", "added": "https://bugzilla.mozilla.org/show_bug.cgi?id=1447037"}], "who": "jan@ikenmeyer.eu", "when": "2018-04-11T17:35:39Z"}, {"changes": [{"field_name": "attachments.mimetype", "removed": "text/plain", "attachment_id": 8954253, "added": "text/html"}], "who": "jan@ikenmeyer.eu", "when": "2018-05-13T14:22:53Z"}, {"changes": [{"removed": "", "field_name": "cf_crash_signature", "added": "[@ mozalloc_abort | abort | webrender::renderer::Renderer::draw_tile_frame ]"}, {"removed": "", "field_name": "blocks", "added": "1357819"}, {"removed": "---", "field_name": "cf_status_firefox_esr60", "added": "disabled"}, {"removed": "---", "field_name": "cf_status_firefox62", "added": "disabled"}], "who": "jan@ikenmeyer.eu", "when": "2018-05-16T15:25:24Z"}, {"changes": [{"removed": "[@ mozalloc_abort | abort | webrender::renderer::Renderer::draw_tile_frame ]", "field_name": "cf_crash_signature", "added": "[@ mozalloc_abort | abort | webrender::renderer::Renderer::draw_tile_frame ]\r\n[@ mozalloc_abort | abort | webrender::renderer::Renderer::draw_tile_frame::ha0f10af98178cd67 ]"}], "who": "jan@ikenmeyer.eu", "when": "2018-06-01T07:13:36Z"}, {"changes": [{"removed": "[@ mozalloc_abort | abort | webrender::renderer::Renderer::draw_tile_frame ]\r\n[@ mozalloc_abort | abort | webrender::renderer::Renderer::draw_tile_frame::ha0f10af98178cd67 ] ", "field_name": "cf_crash_signature", "added": "[@ mozalloc_abort | abort | webrender::renderer::Renderer::draw_tile_frame ]\r\n[@ mozalloc_abort | abort | webrender::renderer::Renderer::draw_tile_frame::ha0f10af98178cd67 ]\r\n[@ mozalloc_abort | abort | webrender::renderer::Renderer::draw_tile_frame::ha411b13875ee5104 ]"}, {"removed": "Linux", "field_name": "op_sys", "added": "All"}], "who": "jan@ikenmeyer.eu", "when": "2018-06-01T18:41:34Z"}, {"changes": [{"removed": "[@ mozalloc_abort | abort | webrender::renderer::Renderer::draw_tile_frame ]\r\n[@ mozalloc_abort | abort | webrender::renderer::Renderer::draw_tile_frame::ha0f10af98178cd67 ]\r\n[@ mozalloc_abort | abort | webrender::renderer::Renderer::draw_tile_frame::ha411b13875ee5104 ]", "field_name": "cf_crash_signature", "added": "[@ mozalloc_abort | abort | webrender::renderer::Renderer::draw_tile_frame ]\r\n[@ mozalloc_abort | abort | webrender::renderer::Renderer::draw_tile_frame::ha0f10af98178cd67 ]\r\n[@ mozalloc_abort | abort | webrender::renderer::Renderer::draw_tile_frame::ha411b13875ee5104 ]\r\n[@ static void webrender::renderer::Renderer::draw_tile_frame ]"}], "who": "jan@ikenmeyer.eu", "when": "2018-06-04T21:30:04Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "bugmail@mozilla.staktrace.com"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(bugmail@mozilla.staktrace.com)"}], "who": "gwatson@mozilla.com", "when": "2018-06-04T23:47:44Z"}, {"changes": [{"removed": "needinfo?(bugmail@mozilla.staktrace.com)", "field_name": "flagtypes.name", "added": ""}], "who": "bugmail@mozilla.staktrace.com", "when": "2018-06-05T13:24:34Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(gwatson@mozilla.com)"}], "who": "bugmail@mozilla.staktrace.com", "when": "2018-06-06T13:23:06Z"}, {"changes": [{"removed": "needinfo?(gwatson@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "gwatson@mozilla.com", "when": "2018-06-18T02:56:43Z"}], "resolution": "", "op_sys": "All", "cf_fx_points": "---", "cf_blocking_fennec": "---"}