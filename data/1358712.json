{"status": "VERIFIED", "cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "classification": "Client Software", "creator": "smokey101stair@gmail.com", "cc": ["cristian.comorasu@softvision.ro", "dao+bmo@mozilla.com", "dothayer@mozilla.com", "ehsan@mozilla.com", "felipc@gmail.com", "florian@queze.net", "geeknik@protonmail.ch", "gijskruitbosch+bugs@gmail.com", "kmaglione+bmo@mozilla.com", "mcastelluccio@mozilla.com", "mconley@mozilla.com", "nihsanullah@invalid.bugs", "nika@thelayzells.com", "nissan4321@gmail.com", "Tobias.Marty@gmx.de"], "depends_on": [1356663, 1383367, 1454493, 1456411], "creation_time": "2017-04-22T06:30:27Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "keywords": ["perf", "stale-bug"], "summary": "uninterruptible reflow at _calcMouseTargetRect@chrome://browser/content/tabbrowser.xml:7697:27 when moving the mouse", "id": 1358712, "attachments": [{"creator": "kmaglione+bmo@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "-", "name": "review", "modification_date": "2017-08-09T10:44:11Z", "type_id": 748, "creation_date": "2017-07-25T10:17:05Z", "id": 1617379, "setter": "dao+bmo@mozilla.com"}], "content_type": "text/x-review-board-request", "id": 8889021}, {"creator": "mconley@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-04-06T22:48:19Z", "type_id": 748, "creation_date": "2018-03-29T18:16:39Z", "id": 1736943, "setter": "felipc@gmail.com"}], "content_type": "text/x-review-board-request", "id": 8960312}, {"creator": "mconley@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-04-20T16:24:40Z", "type_id": 748, "creation_date": "2018-04-20T15:58:58Z", "id": 1747004, "setter": "nika@thelayzells.com"}], "content_type": "text/x-review-board-request", "id": 8969658}], "assigned_to_detail": {"email": "mconley@mozilla.com", "id": 403756, "name": "mconley@mozilla.com", "real_name": "Mike Conley (:mconley) (:\u2699\ufe0f) (Catching up on needinfos / reviews)"}, "severity": "normal", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "qa_contact_detail": {"email": "adrian.florinescu@softvision.ro", "id": 556562, "name": "adrian.florinescu@softvision.ro", "real_name": "Adrian Florinescu [:adrian_sv]"}, "comment_count": 46, "comments": [{"text": "Here's the stack:\n\n_calcMouseTargetRect@chrome://browser/content/tabbrowser.xml:7697:27\ngetMouseTargetRect@chrome://browser/content/tabbrowser.xml:7661:13\n_callListener@chrome://browser/content/browser.js:8233:16\naddListener@chrome://browser/content/browser.js:8211:5\nset_label@chrome://browser/content/tabbrowser.xml:7645:13\nupdateStatusField@chrome://browser/content/browser.js:4512:7\n_showDelayed/this._timer<@chrome://browser/content/browser.js:4921:7\nsetTimeout handler*_showDelayed@chrome://browser/content/browser.js:4920:19\nhandleEvent@chrome://browser/content/browser.js:4914:9\nEventListener.handleEvent*update@chrome://browser/content/browser.js:4905:7\nsetOverLink@chrome://browser/content/browser.js:4467:5\n\n\nThis occurs for me when mousing out of the \"File a bug\" and \"File a new bug anyway\" links on the OhNoReflow Report page.", "author": "smokey101stair@gmail.com", "id": 12256473, "time": "2017-04-22T06:30:27Z"}, {"text": "This happens when moving the mouse after the status panel content has changed. It's the result of bug 1356663 where we changed this code to not trigger a sync reflow immediately when the status panel content changed.", "author": "florian@queze.net", "id": 12256531, "time": "2017-04-22T08:14:26Z"}, {"text": "*** Bug 1358426 has been marked as a duplicate of this bug. ***", "author": "florian@queze.net", "id": 12256534, "time": "2017-04-22T08:15:50Z"}, {"text": "Another stack:\n\n_calcMouseTargetRect@chrome://browser/content/tabbrowser.xml:7697:27\ngetMouseTargetRect@chrome://browser/content/tabbrowser.xml:7661:13\n_callListener@chrome://browser/content/browser.js:8233:16\nhandleEvent/<@chrome://browser/content/browser.js:8225:9\nhandleEvent@chrome://browser/content/browser.js:8223:5\nEventListener.handleEvent*_delayedStartup@chrome://browser/content/browser.js:1531:5\nEventListener.handleEvent*onLoad@chrome://browser/content/browser.js:1239:5\nonload@chrome://browser/content/browser.xul:1:1", "author": "geeknik@protonmail.ch", "id": 12257216, "time": "2017-04-23T06:48:44Z"}, {"text": "Created attachment 8889021\nBug 1358712: Don't trigger reflows from MousePosTracker.\n\nReview commit: https://reviewboard.mozilla.org/r/160066/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/160066/", "author": "kmaglione+bmo@mozilla.com", "id": 12496003, "time": "2017-07-22T05:32:34Z"}, {"text": "Comment on attachment 8889021\nBug 1358712: Don't trigger reflows from MousePosTracker.\n\nhttps://reviewboard.mozilla.org/r/160066/#review166192\n\n::: browser/base/content/browser.js:8568\n(Diff revision 1)\n>  \n> -    this._callListener(listener);\n> +    let rect = await PromiseUtils.layoutFlushed(\n> +      document, \"layout\",\n> +      () => listener.getMouseTargetRect());\n> +\n> +    this._callListener(listener, rect);\n\nThis looks like it might regress bug 646038?", "author": "dao+bmo@mozilla.com", "id": 12503569, "time": "2017-07-25T10:17:05Z"}, {"text": "Comment on attachment 8889021\nBug 1358712: Don't trigger reflows from MousePosTracker.\n\nhttps://reviewboard.mozilla.org/r/160066/#review166192\n\n> This looks like it might regress bug 646038?\n\nCertainly worth checking.", "author": "mconley@mozilla.com", "id": 12508548, "time": "2017-07-26T15:49:46Z"}, {"text": "Comment on attachment 8889021\nBug 1358712: Don't trigger reflows from MousePosTracker.\n\nhttps://reviewboard.mozilla.org/r/160066/#review166814\n\nClearing review until we're sure this doesn't re-open bug 646038.", "author": "mconley@mozilla.com", "id": 12508551, "time": "2017-07-26T15:50:05Z"}, {"text": "(In reply to D\u00e3o Gottwald [::dao] from comment #5)\n> Comment on attachment 8889021\n> Bug 1358712: Don't trigger reflows from MousePosTracker.\n> \n> https://reviewboard.mozilla.org/r/160066/#review166192\n> \n> ::: browser/base/content/browser.js:8568\n> (Diff revision 1)\n> >  \n> > -    this._callListener(listener);\n> > +    let rect = await PromiseUtils.layoutFlushed(\n> > +      document, \"layout\",\n> > +      () => listener.getMouseTargetRect());\n> > +\n> > +    this._callListener(listener, rect);\n> \n> This looks like it might regress bug 646038?\n\nAs far as I can tell, it does not. The behavior of the status panel seems to be identical with or without this patch.", "author": "kmaglione+bmo@mozilla.com", "id": 12508717, "time": "2017-07-26T16:34:50Z"}, {"text": "Comment on attachment 8889021\nBug 1358712: Don't trigger reflows from MousePosTracker.\n\nhttps://reviewboard.mozilla.org/r/160066/#review166848\n\nOkay, I'll give this another look.", "author": "dao+bmo@mozilla.com", "id": 12508750, "time": "2017-07-26T16:43:33Z"}, {"text": "Comment on attachment 8889021\nBug 1358712: Don't trigger reflows from MousePosTracker.\n\nhttps://reviewboard.mozilla.org/r/160066/#review171656\n\nFinally was able to test this after figuring out that I need to replace PromiseUtils.layoutFlushed with BrowserUtils.promiseLayoutFlushed. Alas, this does regress bug 646038.", "author": "dao+bmo@mozilla.com", "id": 12549962, "time": "2017-08-09T10:44:11Z"}, {"text": "This should be for non-remote pages only, which should be rare enough these days that I feel pretty comfortable making this a qf:p3.", "author": "mconley@mozilla.com", "id": 12881264, "time": "2017-11-28T21:18:09Z"}, {"text": "I've realized that comment 11 is just dead wrong. We can and do still hit this when hovering links in remote tabs as well. I'm setting this to fxperf:p1 and taking.", "author": "mconley@mozilla.com", "id": 13111817, "time": "2018-03-07T18:43:07Z"}, {"text": "Created attachment 8960312\nBug 1358712 - Get rid of synchronous layout flushes when calculating where to put the StatusPanel.\n\nReview commit: https://reviewboard.mozilla.org/r/229070/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/229070/", "author": "mconley@mozilla.com", "id": 13140638, "time": "2018-03-19T19:44:21Z"}, {"text": "Comment on attachment 8960312\nBug 1358712 - Get rid of synchronous layout flushes when calculating where to put the StatusPanel.\n\nhttps://reviewboard.mozilla.org/r/229070/#review235490\n\n::: browser/base/content/browser.js:8998\n(Diff revision 1)\n> +   *\n> +   * We wait until after the next refresh driver tick to account for\n> +   * the case that that removeListener called soon after addListener,\n> +   * but before a refresh driver tick. This ensures that clean-up\n> +   * actions that need to occur after removeListener happen _after_\n> +   * any set-up actions that occurred for addListener.\n\nWhy are you assuming that the addListener callback still wants to run after removeListener was called? Seems like the promise should instead be rejected.\n\n::: browser/base/content/browser.js:9060\n(Diff revision 1)\n> -      listener.onMouseLeave();\n> +        functionsToCall.push(listener.onMouseLeave.bind(listener));\n> +      }\n> +    }\n> +\n> +    window.requestAnimationFrame(() => {\n> +      for (let fn of functionsToCall) {\n\nWhat's the rationale here? I don't think you can assume much about what kind of things onMouseEnter and onMouseLeave will do.", "author": "dao+bmo@mozilla.com", "id": 13145726, "time": "2018-03-21T15:31:04Z"}, {"text": "Comment on attachment 8960312\nBug 1358712 - Get rid of synchronous layout flushes when calculating where to put the StatusPanel.\n\nhttps://reviewboard.mozilla.org/r/229070/#review235490\n\n> Why are you assuming that the addListener callback still wants to run after removeListener was called? Seems like the promise should instead be rejected.\n\nI'm thinking mostly of the case where the StatusPanel value is set and then cleared - for example, if a page load completes, and the \"Transferring...\" StatusPanel message ends up being set to \"\" before the next refresh driver tick.\n\nDuring my own testing, this was pretty frequent. It seems wrong to me to reject for such a frequent case.\n\nAnd the reason I am assuming that addListener still wants to run after removeListener is because I'm assuming the addListener callback is going to set some state, like the StatusPanel does, and that the removeListener will then remove / unset that state. I'm really just trying to make sure that we get an ordered sequence of events here, regardless of how quickly the StatusPanel string changes.\n\nDoes that convince you? Or is there another alternative that I should consider?\n\n> What's the rationale here? I don't think you can assume much about what kind of things onMouseEnter and onMouseLeave will do.\n\n\\_callListeners is being called from within a promiseDocumentFlushed callback. In that scope, we desperately need to avoid touching the DOM (bug 1441168 will hopefully make doing this impossible). Because we have no real knowledge about what onMouseEnter and onMouseLeave are doing, we can either:\n\n1. Assume that they'll obey the invariant that the DOM must not be touched, or\n2. Assume that the consumers will not obey that invarient, and queue up the functions to run when it's safe to touch the DOM instead\n\nI went with 2 on this one.", "author": "mconley@mozilla.com", "id": 13145771, "time": "2018-03-21T15:43:13Z"}, {"text": "Are the above explanations sufficient to drop the issues?", "author": "mconley@mozilla.com", "id": 13145775, "time": "2018-03-21T15:43:38Z"}, {"text": "(In reply to Mike Conley (:mconley) (:\u2699\ufe0f) (Totally backlogged on reviews and needinfos) from comment #15)\n> Comment on attachment 8960312\n> Bug 1358712 - Get rid of synchronous layout flushes when calculating where\n> to put the StatusPanel.\n> \n> https://reviewboard.mozilla.org/r/229070/#review235490\n> \n> > Why are you assuming that the addListener callback still wants to run after removeListener was called? Seems like the promise should instead be rejected.\n> \n> I'm thinking mostly of the case where the StatusPanel value is set and then\n> cleared - for example, if a page load completes, and the \"Transferring...\"\n> StatusPanel message ends up being set to \"\" before the next refresh driver\n> tick.\n> \n> During my own testing, this was pretty frequent. It seems wrong to me to\n> reject for such a frequent case.\n\nWhy does that seem wrong? I don't interpret \"reject\" as a failure per se.\n\n> And the reason I am assuming that addListener still wants to run after\n> removeListener is because I'm assuming the addListener callback is going to\n> set some state, like the StatusPanel does, and that the removeListener will\n> then remove / unset that state.\n\nThe inactive attribute can be set unconditionally after the removeListener call, it doesn't really matter whether the addListener callback ended up removing it.\n\n> I'm really just trying to make sure that we\n> get an ordered sequence of events here, regardless of how quickly the\n> StatusPanel string changes.\n\nBut my point is that the StatusPanel doesn't really want further events after calling removeListener. Briefly setting the label and removing the inactive attribute seems like pointless work, even more so if this happens frequently.\n\n> > What's the rationale here? I don't think you can assume much about what kind of things onMouseEnter and onMouseLeave will do.\n> \n> \\_callListeners is being called from within a promiseDocumentFlushed\n> callback. In that scope, we desperately need to avoid touching the DOM (bug\n> 1441168 will hopefully make doing this impossible). Because we have no real\n> knowledge about what onMouseEnter and onMouseLeave are doing, we can either:\n> \n> 1. Assume that they'll obey the invariant that the DOM must not be touched,\n> or\n> 2. Assume that the consumers will not obey that invarient, and queue up the\n> functions to run when it's safe to touch the DOM instead\n> \n> I went with 2 on this one.\n\nOkay. Can you document this briefly?", "author": "dao+bmo@mozilla.com", "id": 13149488, "time": "2018-03-22T19:17:11Z"}, {"text": "(In reply to D\u00e3o Gottwald [::dao] from comment #17)\n> \n> Why does that seem wrong? I don't interpret \"reject\" as a failure per se.\n> \n\nasync functions that might consume this API _do_ interpret rejections as a failure, and throw exceptions if they're not explicitly caught. We also have code in our test framework that tries to ensure that we don't have any uncaught rejections: https://searchfox.org/mozilla-central/rev/c217fbde244344fedfd07b57a740c694a456dbca/testing/xpcshell/head.js#1389\n\nWould you prefer that each callpoint must catch() when talking to MousePosTracker?\n\n> > And the reason I am assuming that addListener still wants to run after\n> > removeListener is because I'm assuming the addListener callback is going to\n> > set some state, like the StatusPanel does, and that the removeListener will\n> > then remove / unset that state.\n> \n> The inactive attribute can be set unconditionally after the removeListener\n> call, it doesn't really matter whether the addListener callback ended up\n> removing it.\n\nAlright. I'll see if I can find a way of cancelling the addListener callback if removeListener is called for the same listener.\n\n> Okay. Can you document this briefly?\n\nSure, will do, thanks.", "author": "mconley@mozilla.com", "id": 13149514, "time": "2018-03-22T19:26:34Z"}, {"text": "Comment on attachment 8960312\nBug 1358712 - Get rid of synchronous layout flushes when calculating where to put the StatusPanel.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/229070/diff/1-2/", "author": "mconley@mozilla.com", "id": 13167374, "time": "2018-03-29T18:16:39Z"}, {"text": "I've seen a bunch of review requests go by for you dao, so if you're overloaded, let me know and I'll redirect this.", "author": "mconley@mozilla.com", "id": 13167376, "time": "2018-03-29T18:17:12Z"}, {"text": "Green-ish try run: https://treeherder.mozilla.org/#/jobs?repo=try&revision=8129036fb87e8583191b9f4f833cc03296f231d1", "author": "mconley@mozilla.com", "id": 13167780, "time": "2018-03-29T20:45:01Z"}, {"text": "I think Dao is busy - what do you think of this, Gijs?", "author": "mconley@mozilla.com", "id": 13176208, "time": "2018-04-03T13:17:13Z"}, {"text": "Hey felipe - do you have cycles to review this, or should I redirect it?", "author": "mconley@mozilla.com", "id": 13186335, "time": "2018-04-06T14:28:57Z"}, {"text": "Hey, sorry for the delay. I can review it today", "author": "felipc@gmail.com", "id": 13186451, "time": "2018-04-06T14:53:58Z"}, {"text": "Comment on attachment 8960312\nBug 1358712 - Get rid of synchronous layout flushes when calculating where to put the StatusPanel.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/229070/diff/2-3/", "author": "mconley@mozilla.com", "id": 13187643, "time": "2018-04-06T22:05:19Z"}, {"text": "Comment on attachment 8960312\nBug 1358712 - Get rid of synchronous layout flushes when calculating where to put the StatusPanel.\n\nhttps://reviewboard.mozilla.org/r/229070/#review240356\n\nAwesome, thanks for the change to onTrackingStarted", "author": "felipc@gmail.com", "id": 13187724, "time": "2018-04-06T22:48:19Z"}, {"text": "Pushed by mconley@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/d9110e28f361\nGet rid of synchronous layout flushes when calculating where to put the StatusPanel. r=Felipe", "author": "pulsebot@bots.tld", "id": 13188511, "time": "2018-04-07T17:08:56Z"}, {"text": "Backout by rgurzau@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/e1d77f98515e\nBacked out changeset d9110e28f361 for wpt mass failures on Linux QuantumRender, e.g. in /css/css-tables/height-distribution/computing-row-measure-1.html", "author": "pulsebot@bots.tld", "id": 13188802, "time": "2018-04-07T23:00:18Z"}, {"text": "Backed out changeset d9110e28f361 (bug 1358712) for wpt mass failures on Linux QuantumRender, e.g. in /css/css-tables/height-distribution/computing-row-measure-1.html\n\nBackout link: https://hg.mozilla.org/integration/autoland/rev/e1d77f98515ee5dd3ac85f0850b259435d8d7bcc\n\nPush with failures: https://treeherder.mozilla.org/#/jobs?repo=autoland&revision=d9110e28f3612bd40cfa21b29b0e05fc5afd10aa\n\nLog link: https://treeherder.mozilla.org/logviewer.html#?job_id=172498430&repo=autoland&lineNumber=1972\n\nLog snippet: \n[task 2018-04-07T21:29:17.334Z] 21:29:17     INFO - TEST-START | /css/css-grid/grid-definition/grid-change-fit-content-argument-001.html\n[task 2018-04-07T21:29:17.562Z] 21:29:17     INFO - \n[task 2018-04-07T21:29:17.564Z] 21:29:17     INFO - TEST-PASS | /css/css-grid/grid-definition/grid-change-fit-content-argument-001.html | .grid 1 \n[task 2018-04-07T21:29:17.565Z] 21:29:17     INFO - TEST-PASS | /css/css-grid/grid-definition/grid-change-fit-content-argument-001.html | .grid 2 \n[task 2018-04-07T21:29:17.566Z] 21:29:17     INFO - TEST-UNEXPECTED-FAIL | /css/css-grid/grid-definition/grid-change-fit-content-argument-001.html | .grid 3 - assert_equals:", "author": "rgurzau@mozilla.com", "id": 13188861, "time": "2018-04-08T01:28:04Z"}, {"text": "So I think I know what's going on here.\n\nTL;DR: lol, this is crazy.\n\nLonger:\n\nSo it seems as if in certain circumstances (which are strangely easy to hit in automation with WebRender enabled but much harder locally), when we create a new remote <xul:browser>, it's possible for the content of that browser to finish loading and calculating before the parent has told the child how big the <xul:browser> is. That's because the parent has yet to run layout, so as far as its concerned, the <xul:browser> is of size 0,0.\n\nThis means that in TabChild::RecvShow, the TabChild is told that its PuppetWidget has no size, and layout is calculated appropriately. In the case of the test I'm currently working with, that means table cells get widths of 0 when they should be closer to 17. And so my test fails.\n\nAfter the parent finally figures out how big the <xul:browser> is, it updates the TabChild, which then updates the dimensions of everything inside of it.\n\nSo I think the reflows that were being caused by the StatusPanel when updating browser status were keeping these tests passing by forcing sync layout in the parent and ensuring that the TabChild knew the right widget dimensions in time for the test to run.\n\nHilarious!", "author": "mconley@mozilla.com", "id": 13204782, "time": "2018-04-13T18:45:45Z"}, {"text": "Thanks for the back-out - it looks like landing this would actually open us to potential web breakage because of the increased risk of web content opened in new tabs thinking that the viewport is too small early in their lifetime.\n\nHoping to fix that in bug 1454493.", "author": "mconley@mozilla.com", "id": 13218800, "time": "2018-04-19T15:18:39Z"}, {"text": "*** Bug 1454493 has been marked as a duplicate of this bug. ***", "author": "mconley@mozilla.com", "id": 13221497, "time": "2018-04-20T14:34:31Z"}, {"text": "Created attachment 8969658\nBug 1358712 - Force the frameloader to go through layout when content causes a TabParent to be created.\n\nThis is necessary to avoid web platform test failures for tests that rely on layout calculations occurring\ninside a recently opened tab or window. Originally, the layout flush was happening \"accidentally\" within\nthe StatusPanel that displays loading status for the browser. That flush is being removed in another patch\nin this series.\n\nReview commit: https://reviewboard.mozilla.org/r/238454/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/238454/", "author": "mconley@mozilla.com", "id": 13221498, "time": "2018-04-20T14:34:54Z"}, {"text": "Comment on attachment 8960312\nBug 1358712 - Get rid of synchronous layout flushes when calculating where to put the StatusPanel.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/229070/diff/3-4/", "author": "mconley@mozilla.com", "id": 13221499, "time": "2018-04-20T14:34:54Z"}, {"text": "Comment on attachment 8969658\nBug 1358712 - Force the frameloader to go through layout when content causes a TabParent to be created.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/238454/diff/1-2/", "author": "mconley@mozilla.com", "id": 13221759, "time": "2018-04-20T15:58:58Z"}, {"text": "Comment on attachment 8960312\nBug 1358712 - Get rid of synchronous layout flushes when calculating where to put the StatusPanel.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/229070/diff/4-5/", "author": "mconley@mozilla.com", "id": 13221760, "time": "2018-04-20T15:58:58Z"}, {"text": "Comment on attachment 8969658\nBug 1358712 - Force the frameloader to go through layout when content causes a TabParent to be created.\n\nhttps://reviewboard.mozilla.org/r/238454/#review244250\n\n::: dom/ipc/ContentParent.cpp:4744\n(Diff revision 2)\n>          aNewTabParent = frameLoader->GetTabParent();\n> +        // At this point, it's possible the inserted frameloader hasn't gone through\n> +        // layout yet. To ensure that the dimensions that we send down when telling the\n> +        // frameloader to display will be correct (instead of falling back to a 10x10\n> +        // default), we force layout if necessary to get the most up-to-date dimensions.\n> +        TabParent::GetFrom(aNewTabParent)->ForceFrameLoaderLayoutIfNecessary();\n\nIs there any chance you could add a mention of this bug to the comment so people can get context if they need it in the future?\n\n::: dom/ipc/TabParent.h:146\n(Diff revision 2)\n>    void AddWindowListeners();\n>  \n> +  // Used when content is causing a TabParent to be created, and\n> +  // needs to try forcing layout to flush in order to get accurate\n> +  // dimensions for the content area.\n> +  void ForceFrameLoaderLayoutIfNecessary();\n\nThis feels to me like it makes more sense on the nsFrameLoader, rather than here on the TabParent -- especially after Fission, when a single FrameLoader may have many TabParents.", "author": "nika@thelayzells.com", "id": 13221848, "time": "2018-04-20T16:24:40Z"}, {"text": "Comment on attachment 8969658\nBug 1358712 - Force the frameloader to go through layout when content causes a TabParent to be created.\n\nhttps://reviewboard.mozilla.org/r/238454/#review244250\n\n> Is there any chance you could add a mention of this bug to the comment so people can get context if they need it in the future?\n\nSure thing.", "author": "mconley@mozilla.com", "id": 13222258, "time": "2018-04-20T19:04:30Z"}, {"text": "Comment on attachment 8969658\nBug 1358712 - Force the frameloader to go through layout when content causes a TabParent to be created.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/238454/diff/2-3/", "author": "mconley@mozilla.com", "id": 13222259, "time": "2018-04-20T19:04:50Z"}, {"text": "Comment on attachment 8960312\nBug 1358712 - Get rid of synchronous layout flushes when calculating where to put the StatusPanel.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/229070/diff/5-6/", "author": "mconley@mozilla.com", "id": 13222260, "time": "2018-04-20T19:04:50Z"}, {"text": "Pushed by mconley@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/52471746531a\nForce the frameloader to go through layout when content causes a TabParent to be created. r=Nika\nhttps://hg.mozilla.org/integration/autoland/rev/a7fc392e48ab\nGet rid of synchronous layout flushes when calculating where to put the StatusPanel. r=Felipe", "author": "pulsebot@bots.tld", "id": 13222471, "time": "2018-04-20T20:39:17Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/52471746531a\nhttps://hg.mozilla.org/mozilla-central/rev/a7fc392e48ab", "author": "apavel@mozilla.com", "id": 13223229, "time": "2018-04-21T09:38:18Z"}, {"text": "Can you please provide some steps to reproduce this issue? Thank you!", "author": "cristian.comorasu@softvision.ro", "id": 13281114, "time": "2018-05-16T11:56:44Z"}, {"text": "(In reply to Cristian Comorasu [:CristiComo] from comment #43)\n> Can you please provide some steps to reproduce this issue? Thank you!\n\nHi CristiComo,\n\nSTR:\n\n1. Install Oh no! Reflow! (Instructions: https://mikeconley.github.io/ohnoreflow/)\n2. Open the add-on panel, and set the threshold to 0, and click \"Not recording. Click to enable.\" to start recording.\n3. Hover any link on any webpage such that the status panel shows up in the bottom corner.\n\nER:\n\nThe add-on should not report a reflow occurred when hovering a link. It will increment a counter in a badge in the add-on button when it observes a reflow (to see some example reflows, type in the URL bar - we reflow like crazy in there).\n\nAR:\n\nWe reflow when hovering links.\n\n\n\nThe AR are true without the patch. With this patch, we successfully avoid reflowing.\n\nHopefully that's enough!", "author": "mconley@mozilla.com", "id": 13282631, "time": "2018-05-16T20:20:15Z"}, {"text": "I can confirm the browser respects the ER from comment 44. I tested using Fx 61.0b6 Developer Edition.", "author": "cristian.comorasu@softvision.ro", "id": 13286993, "time": "2018-05-18T11:44:57Z"}], "cf_last_resolved": "2018-04-21T09:38:18Z", "priority": "P1", "mentors_detail": [], "cf_crash_signature": "", "version": "unspecified", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox62": "---", "cf_platform_rel": "---", "product": "Firefox", "cf_status_firefox_esr52": "---", "blocks": [1363771, 1363777], "qa_contact": "adrian.florinescu@softvision.ro", "see_also": [], "cf_fx_iteration": "---", "component": "General", "votes": 1, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "---", "cf_status_firefox61": "verified", "cf_status_firefox60": "---", "target_milestone": "Firefox 61", "is_cc_accessible": true, "cf_rank": null, "groups": [], "url": "", "creator_detail": {"email": "smokey101stair@gmail.com", "id": 475400, "name": "smokey101stair@gmail.com", "real_name": "Trevor Rowbotham"}, "whiteboard": "[ohnoreflow][qf:p3][fxperf:p1]", "mentors": [], "cc_detail": [{"email": "cristian.comorasu@softvision.ro", "id": 572409, "name": "cristian.comorasu@softvision.ro", "real_name": "Cristian Comorasu [:ccomorasu], Release Desktop QA"}, {"email": "dao+bmo@mozilla.com", "id": 219124, "name": "dao+bmo@mozilla.com", "real_name": "D\u00e3o Gottwald [::dao]"}, {"email": "dothayer@mozilla.com", "id": 582499, "name": "dothayer@mozilla.com", "real_name": "Doug Thayer [:dthayer] (PTO on June 4)"}, {"email": "ehsan@mozilla.com", "id": 251051, "name": "ehsan@mozilla.com", "real_name": ":Ehsan Akhgari"}, {"email": "felipc@gmail.com", "id": 208747, "name": "felipc@gmail.com", "real_name": ":Felipe Gomes (needinfo me!)"}, {"email": "florian@queze.net", "id": 149052, "name": "florian@queze.net", "real_name": "Florian Qu\u00e8ze [:florian]"}, {"email": "geeknik@protonmail.ch", "id": 31466, "name": "geeknik@protonmail.ch", "real_name": "Brian Carpenter [:geeknik]"}, {"email": "gijskruitbosch+bugs@gmail.com", "id": 159069, "name": "gijskruitbosch+bugs@gmail.com", "real_name": ":Gijs (he/him)"}, {"email": "kmaglione+bmo@mozilla.com", "id": 106098, "name": "kmaglione+bmo@mozilla.com", "real_name": "Kris Maglione [:kmag]"}, {"email": "mcastelluccio@mozilla.com", "id": 420453, "name": "mcastelluccio@mozilla.com", "real_name": "Marco Castelluccio [:marco]"}, {"email": "mconley@mozilla.com", "id": 403756, "name": "mconley@mozilla.com", "real_name": "Mike Conley (:mconley) (:\u2699\ufe0f) (Catching up on needinfos / reviews)"}, {"email": "nihsanullah@invalid.bugs", "id": 441971, "name": "nihsanullah@invalid.bugs", "real_name": "Naveed Ihsanullah [:naveed]"}, {"email": "nika@thelayzells.com", "id": 534482, "name": "nika@thelayzells.com", "real_name": ":Nika Layzell"}, {"email": "nissan4321@gmail.com", "id": 414417, "name": "nissan4321@gmail.com", "real_name": "Mikel"}, {"email": "Tobias.Marty@gmx.de", "id": 572549, "name": "Tobias.Marty@gmx.de", "real_name": "TMart"}], "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "last_change_time": "2018-05-18T11:44:57Z", "cf_status_firefox_esr60": "---", "assigned_to": "mconley@mozilla.com", "is_open": false, "resolution": "FIXED", "op_sys": "Unspecified", "cf_fx_points": "---", "history": [{"changes": [{"removed": "", "field_name": "cc", "added": "florian@queze.net"}, {"removed": "", "field_name": "blocks", "added": "1356663"}, {"removed": "3.85ms uninterruptible reflow at _calcMouseTargetRect@chrome://browser/content/tabbrowser.xml:7697:27", "field_name": "summary", "added": "uninterruptible reflow at _calcMouseTargetRect@chrome://browser/content/tabbrowser.xml:7697:27 when moving the mouse"}], "who": "florian@queze.net", "when": "2017-04-22T08:14:26Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "mcastelluccio@mozilla.com"}], "who": "florian@queze.net", "when": "2017-04-22T08:15:50Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "dao+bmo@mozilla.com"}, {"removed": "Untriaged", "field_name": "component", "added": "General"}, {"removed": "1356663", "field_name": "blocks", "added": ""}, {"removed": "", "field_name": "depends_on", "added": "1356663"}], "who": "dao+bmo@mozilla.com", "when": "2017-04-22T09:19:50Z"}, {"changes": [{"removed": "--", "field_name": "priority", "added": "P2"}, {"removed": "", "field_name": "cc", "added": "mmucci@mozilla.com"}, {"removed": "", "field_name": "flagtypes.name", "added": "qe-verify?"}], "who": "mmucci@mozilla.com", "when": "2017-04-22T19:40:36Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "geeknik@protonmail.ch"}], "who": "geeknik@protonmail.ch", "when": "2017-04-23T06:48:44Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "mconley@mozilla.com"}, {"removed": "[ohnoreflow][qf][photon-performance]", "field_name": "whiteboard", "added": "[ohnoreflow][qf:p1][photon-performance]"}], "who": "mconley@mozilla.com", "when": "2017-04-27T20:19:01Z"}, {"changes": [{"removed": "", "field_name": "blocks", "added": "1363771"}], "who": "florian@queze.net", "when": "2017-05-10T19:53:22Z"}, {"changes": [{"removed": "", "field_name": "blocks", "added": "1363777"}], "who": "florian@queze.net", "when": "2017-05-10T19:55:51Z"}, {"changes": [{"removed": "1348289", "field_name": "blocks", "added": ""}], "who": "florian@queze.net", "when": "2017-05-10T20:18:36Z"}, {"changes": [{"removed": "P2", "field_name": "priority", "added": "P3"}, {"removed": "[ohnoreflow][qf:p1][photon-performance]", "field_name": "whiteboard", "added": "[ohnoreflow][qf:p1][reserve-photon-performance]"}], "who": "mmucci@mozilla.com", "when": "2017-05-23T15:04:49Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "nihsanullah@mozilla.com"}, {"removed": "[ohnoreflow][qf:p1][reserve-photon-performance]", "field_name": "whiteboard", "added": "[ohnoreflow][qf:p2][reserve-photon-performance]"}], "who": "nihsanullah@invalid.bugs", "when": "2017-05-26T15:41:46Z"}, {"changes": [{"removed": "", "field_name": "qa_contact", "added": "adrian.florinescu@softvision.ro"}, {"removed": "qe-verify?", "field_name": "flagtypes.name", "added": "qe-verify+"}], "who": "mmucci@mozilla.com", "when": "2017-06-06T14:33:42Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "kmaglione+bmo@mozilla.com"}, {"removed": "", "field_name": "depends_on", "added": "1383367"}, {"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "kmaglione+bmo@mozilla.com"}], "who": "kmaglione+bmo@mozilla.com", "when": "2017-07-22T05:30:05Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8889021, "added": "review?(mconley@mozilla.com)"}], "who": "kmaglione+bmo@mozilla.com", "when": "2017-07-22T05:32:34Z"}, {"changes": [{"removed": "P3", "field_name": "priority", "added": "P1"}, {"removed": "NEW", "field_name": "status", "added": "ASSIGNED"}], "who": "mmucci@mozilla.com", "when": "2017-07-22T14:13:23Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8889021, "added": "review-"}], "who": "dao+bmo@mozilla.com", "when": "2017-07-25T10:17:05Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(mconley@mozilla.com)", "attachment_id": 8889021, "added": ""}], "who": "mconley@mozilla.com", "when": "2017-07-26T15:50:05Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review-", "attachment_id": 8889021, "added": "review?(dao+bmo@mozilla.com)"}], "who": "dao+bmo@mozilla.com", "when": "2017-07-26T16:43:33Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(dao+bmo@mozilla.com)", "attachment_id": 8889021, "added": "review-"}], "who": "dao+bmo@mozilla.com", "when": "2017-08-09T10:44:11Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "ehsan@mozilla.com"}], "who": "ehsan@mozilla.com", "when": "2017-08-14T21:45:11Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "stale-bug"}], "who": "ehumphries@mozilla.com", "when": "2017-08-30T22:57:19Z"}, {"changes": [{"removed": "stale-bug", "field_name": "keywords", "added": ""}], "who": "kmaglione+bmo@mozilla.com", "when": "2017-08-30T23:01:28Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "stale-bug"}], "who": "ehumphries@mozilla.com", "when": "2017-10-03T01:10:20Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "perf"}], "who": "bug-husbandry-bot@mozilla.bugs", "when": "2017-10-07T00:04:58Z"}, {"changes": [{"removed": "mmucci@mozilla.com", "field_name": "cc", "added": ""}], "who": "mmucci@mozilla.com", "when": "2017-11-14T19:39:20Z"}, {"changes": [{"removed": "[ohnoreflow][qf:p2][reserve-photon-performance]", "field_name": "whiteboard", "added": "[ohnoreflow][qf:p3][reserve-photon-performance]"}], "who": "mconley@mozilla.com", "when": "2017-11-28T21:18:09Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "nissan4321@gmail.com"}], "who": "nissan4321@gmail.com", "when": "2018-01-23T19:36:11Z"}, {"changes": [{"removed": "[ohnoreflow][qf:p3][reserve-photon-performance]", "field_name": "whiteboard", "added": "[ohnoreflow][qf:p3][reserve-photon-performance] [fxperf]"}], "who": "bug-husbandry-bot@mozilla.bugs", "when": "2018-02-09T23:58:29Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "dothayer@mozilla.com"}, {"removed": "[ohnoreflow][qf:p3][reserve-photon-performance] [fxperf]", "field_name": "whiteboard", "added": "[ohnoreflow][qf:p3][reserve-photon-performance] [fxperf:p3]"}], "who": "dothayer@mozilla.com", "when": "2018-03-01T23:33:16Z"}, {"changes": [{"removed": "kmaglione+bmo@mozilla.com", "field_name": "assigned_to", "added": "mconley@mozilla.com"}, {"removed": "[ohnoreflow][qf:p3][reserve-photon-performance] [fxperf:p3]", "field_name": "whiteboard", "added": "[ohnoreflow][qf:p3][reserve-photon-performance] [fxperf:p1]"}], "who": "mconley@mozilla.com", "when": "2018-03-07T18:43:07Z"}, {"changes": [{"removed": "[ohnoreflow][qf:p3][reserve-photon-performance] [fxperf:p1]", "field_name": "whiteboard", "added": "[ohnoreflow][qf:p3][fxperf:p1]"}], "who": "mconley@mozilla.com", "when": "2018-03-19T19:03:31Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8960312, "added": "review?(dao+bmo@mozilla.com)"}], "who": "mconley@mozilla.com", "when": "2018-03-19T19:50:40Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(dao+bmo@mozilla.com)", "attachment_id": 8960312, "added": ""}], "who": "dao+bmo@mozilla.com", "when": "2018-03-21T15:31:04Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(dao+bmo@mozilla.com)"}], "who": "mconley@mozilla.com", "when": "2018-03-21T15:43:38Z"}, {"changes": [{"removed": "needinfo?(dao+bmo@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "dao+bmo@mozilla.com", "when": "2018-03-22T19:17:11Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8960312, "added": "review?(dao+bmo@mozilla.com)"}], "who": "mconley@mozilla.com", "when": "2018-03-29T18:16:39Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(dao+bmo@mozilla.com)", "attachment_id": 8960312, "added": "review?(gijskruitbosch+bugs@gmail.com)"}, {"removed": "", "field_name": "cc", "added": "gijskruitbosch+bugs@gmail.com"}], "who": "mconley@mozilla.com", "when": "2018-04-03T13:16:55Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(gijskruitbosch+bugs@gmail.com)", "attachment_id": 8960312, "added": "review?(felipc@gmail.com)"}, {"removed": "", "field_name": "cc", "added": "felipc@gmail.com"}], "who": "mconley@mozilla.com", "when": "2018-04-03T16:15:29Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(felipc@gmail.com)"}], "who": "mconley@mozilla.com", "when": "2018-04-06T14:28:57Z"}, {"changes": [{"removed": "needinfo?(felipc@gmail.com)", "field_name": "flagtypes.name", "added": ""}], "who": "felipc@gmail.com", "when": "2018-04-06T14:53:58Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(felipc@gmail.com)", "attachment_id": 8960312, "added": "review+"}], "who": "felipc@gmail.com", "when": "2018-04-06T22:48:19Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(mconley@mozilla.com)"}], "who": "rgurzau@mozilla.com", "when": "2018-04-08T01:28:04Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1454493"}], "who": "mconley@mozilla.com", "when": "2018-04-16T20:51:26Z"}, {"changes": [{"removed": "needinfo?(mconley@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "mconley@mozilla.com", "when": "2018-04-19T15:18:39Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8969658, "added": "review?(nika@thelayzells.com)"}, {"removed": "", "field_name": "cc", "added": "nika@thelayzells.com"}], "who": "mconley@mozilla.com", "when": "2018-04-20T14:34:54Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(nika@thelayzells.com)", "attachment_id": 8969658, "added": ""}], "who": "mconley@mozilla.com", "when": "2018-04-20T15:46:33Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8969658, "added": "review?(nika@thelayzells.com)"}], "who": "mconley@mozilla.com", "when": "2018-04-20T15:58:58Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(nika@thelayzells.com)", "attachment_id": 8969658, "added": "review+"}], "who": "nika@thelayzells.com", "when": "2018-04-20T16:24:40Z"}, {"changes": [{"removed": "ASSIGNED", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "Firefox 61"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2018-04-21 09:38:18"}, {"removed": "---", "field_name": "cf_status_firefox61", "added": "fixed"}], "who": "apavel@mozilla.com", "when": "2018-04-21T09:38:18Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1456411"}], "who": "igoldan@mozilla.com", "when": "2018-04-24T08:58:33Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "Tobias.Marty@gmx.de"}], "who": "Tobias.Marty@gmx.de", "when": "2018-04-25T07:53:08Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "cristian.comorasu@softvision.ro"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(mconley@mozilla.com)"}], "who": "cristian.comorasu@softvision.ro", "when": "2018-05-16T11:56:44Z"}, {"changes": [{"removed": "needinfo?(mconley@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "mconley@mozilla.com", "when": "2018-05-16T20:20:15Z"}, {"changes": [{"removed": "RESOLVED", "field_name": "status", "added": "VERIFIED"}, {"removed": "qe-verify+", "field_name": "flagtypes.name", "added": ""}, {"removed": "fixed", "field_name": "cf_status_firefox61", "added": "verified"}], "who": "cristian.comorasu@softvision.ro", "when": "2018-05-18T11:44:57Z"}]}