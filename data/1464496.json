{"cf_tracking_thunderbird_esr52": "---", "status": "RESOLVED", "cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "cf_tracking_firefox62": "---", "creator": "emilio@crisal.io", "mentors_detail": [], "depends_on": [1395112], "cf_status_firefox_esr60": "---", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "keywords": [], "cc_detail": [{"email": "canaltinova@gmail.com", "id": 525693, "name": "canaltinova@gmail.com", "real_name": "Naz\u0131m Can Alt\u0131nova [:canaltinova]"}, {"email": "jan@ikenmeyer.eu", "id": 580271, "name": "jan@ikenmeyer.eu", "real_name": "Jan Andre Ikenmeyer [:darkspirit]"}, {"email": "mreavy@mozilla.com", "id": 74434, "name": "mreavy@mozilla.com", "real_name": "Maire Reavy [:mreavy] Plz needinfo?"}], "cf_last_resolved": "2018-05-31T21:55:04Z", "attachments": [{"creator": "canaltinova@gmail.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-05-30T19:51:37Z", "type_id": 4, "creation_date": "2018-05-30T19:18:05Z", "id": 1763781, "setter": "emilio@crisal.io"}], "content_type": "text/x-review-board-request", "id": 8982000}, {"creator": "canaltinova@gmail.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-05-31T12:02:23Z", "type_id": 4, "creation_date": "2018-05-31T09:40:26Z", "id": 1764024, "setter": "emilio@crisal.io"}], "content_type": "text/x-review-board-request", "id": 8982161}], "votes": 0, "classification": "Components", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 11, "comments": [{"text": "", "author": "emilio@crisal.io", "id": 13364799, "time": "2018-05-25T18:44:15Z"}, {"text": "Nazim wanted to take this while waiting for answers in other bugs. Thanks Nazim!", "author": "emilio@crisal.io", "id": 13374261, "time": "2018-05-30T13:09:08Z"}, {"text": "Thanks Emilio!", "author": "canaltinova@gmail.com", "id": 13374266, "time": "2018-05-30T13:10:20Z"}, {"text": "Created attachment 8982000\nBug 1464496 - Part 1: Merge ServoDeclarationBlock and DeclarationBlock\n\nReview commit: https://reviewboard.mozilla.org/r/248044/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/248044/", "author": "canaltinova@gmail.com", "id": 13375464, "time": "2018-05-30T19:18:05Z"}, {"text": "Comment on attachment 8982000\nBug 1464496 - Part 1: Merge ServoDeclarationBlock and DeclarationBlock\n\nhttps://reviewboard.mozilla.org/r/248044/#review254150\n\nLooks great, thank you!\n\nr=me with these, feel free to land or re-request review at your will :)\n\nThanks again!\n\n::: layout/style/DeclarationBlock.h:36\n(Diff revision 1)\n> -protected:\n> -  DeclarationBlock()\n> +public:\n> +  explicit DeclarationBlock(\n> +    already_AddRefed<RawServoDeclarationBlock> aRaw)\n>      : mImmutable(false)\n>      , mIsDirty(false)\n> +    , mRaw(aRaw)\n\nnit: moving mRaw before the two booleans allows better packing, maybe do that either here or as a followup commit?\n\n::: layout/style/DeclarationBlock.h:97\n(Diff revision 1)\n>    void UnsetDirty() { mIsDirty = false; }\n>  \n>    /**\n>     * Copy |this|, if necessary to ensure that it can be modified.\n>     */\n> -  inline already_AddRefed<DeclarationBlock> EnsureMutable();\n> +  already_AddRefed<DeclarationBlock> EnsureMutable();\n\nnit: There's no reason this can't remain being inline, right?\n\n::: layout/style/DeclarationBlock.h:135\n(Diff revision 1)\n> -  inline void ToString(nsAString& aString) const;\n> +  static already_AddRefed<DeclarationBlock>\n> +  FromCssText(const nsAString& aCssText, URLExtraData* aExtraData,\n> +              nsCompatibility aMode, css::Loader* aLoader);\n> +\n> +  RawServoDeclarationBlock* Raw() const { return mRaw; }\n> +  RawServoDeclarationBlock* const* RefRaw() const {\n\nnit: Let's move the brace to the following line in the inline functions, to be consistent.\n\n::: layout/style/DeclarationBlock.h:177\n(Diff revision 1)\n> -  inline bool RemoveProperty(const nsAString& aProperty);\n> +  bool RemoveProperty(const nsAString& aProperty);\n>    // Returns whether the property was removed.\n> -  inline bool RemovePropertyByID(nsCSSPropertyID aProperty);\n> +  bool RemovePropertyByID(nsCSSPropertyID aProperty);\n>  \n>  private:\n> +  ~DeclarationBlock() {}\n\nnit: You can use `= default;`\n\n::: layout/style/DeclarationBlock.cpp:40\n(Diff revision 1)\n> +                              URLExtraData* aExtraData,\n> +                              nsCompatibility aMode,\n> +                              css::Loader* aLoader)\n> +{\n> +  NS_ConvertUTF16toUTF8 value(aCssText);\n> +  // FIXME (bug 1343964): Figure out a better solution for sending the base uri to servo\n\nnit: While you're here, you may as well remove this given that bug is fixed.\n\n::: layout/style/DeclarationBlock.cpp:59\n(Diff revision 1)\n> +\n> +void\n> +DeclarationBlock::GetPropertyValueByID(nsCSSPropertyID aPropID,\n> +                                       nsAString& aValue) const\n> +{\n> +  Servo_DeclarationBlock_GetPropertyValueById(mRaw, aPropID, &aValue);\n\nnit: Given you're including ServoBindings.h in the header, you may as well inline these and the other functions in there.\n\n::: servo/components/style/gecko/wrapper.rs:1226\n(Diff revision 1)\n>  \n>      fn smil_override(&self) -> Option<ArcBorrow<Locked<PropertyDeclarationBlock>>> {\n>          unsafe {\n>              let slots = self.extended_slots()?;\n>  \n> -            let base_declaration: &structs::DeclarationBlock =\n> +            let declaration: &structs::DeclarationBlock =\n\nlovely :)", "author": "emilio@crisal.io", "id": 13375565, "time": "2018-05-30T19:51:37Z"}, {"text": "Created attachment 8982161\nBug 1464496 - Part 2: Move the mRaw before the two booleans for better packing\n\nReview commit: https://reviewboard.mozilla.org/r/248174/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/248174/", "author": "canaltinova@gmail.com", "id": 13376908, "time": "2018-05-31T09:40:26Z"}, {"text": "Comment on attachment 8982000\nBug 1464496 - Part 1: Merge ServoDeclarationBlock and DeclarationBlock\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/248044/diff/1-2/", "author": "canaltinova@gmail.com", "id": 13376909, "time": "2018-05-31T09:40:26Z"}, {"text": "Comment on attachment 8982161\nBug 1464496 - Part 2: Move the mRaw before the two booleans for better packing\n\nhttps://reviewboard.mozilla.org/r/248174/#review254372\n\nYou could've just landed it with rs=emilio fwiw.\n\nThanks!", "author": "emilio@crisal.io", "id": 13377181, "time": "2018-05-31T12:02:23Z"}, {"text": "Thanks for the review Emilio!", "author": "canaltinova@gmail.com", "id": 13377195, "time": "2018-05-31T12:08:31Z"}, {"text": "Pushed by canaltinova@gmail.com:\nhttps://hg.mozilla.org/integration/autoland/rev/d6e582ce9bab\nPart 1: Merge ServoDeclarationBlock and DeclarationBlock r=emilio\nhttps://hg.mozilla.org/integration/autoland/rev/edc3670ec282\nPart 2: Move the mRaw before the two booleans for better packing r=emilio", "author": "pulsebot@bots.tld", "id": 13377198, "time": "2018-05-31T12:09:14Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/d6e582ce9bab\nhttps://hg.mozilla.org/mozilla-central/rev/edc3670ec282", "author": "nerli@mozilla.com", "id": 13378929, "time": "2018-05-31T21:55:04Z"}], "id": 1464496, "priority": "P3", "cc": ["canaltinova@gmail.com", "jan@ikenmeyer.eu", "mreavy@mozilla.com"], "cf_crash_signature": "", "version": "unspecified", "is_cc_accessible": true, "cf_tracking_firefox_esr52": "---", "see_also": [], "cf_tracking_thunderbird_esr60": "---", "cf_platform_rel": "---", "product": "Core", "cf_fx_iteration": "---", "blocks": [], "qa_contact": "", "creation_time": "2018-05-25T18:44:15Z", "cf_status_firefox_esr52": "---", "component": "CSS Parsing and Computation", "assigned_to_detail": {"email": "canaltinova@gmail.com", "id": 525693, "name": "canaltinova@gmail.com", "real_name": "Naz\u0131m Can Alt\u0131nova [:canaltinova]"}, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "fixed", "cf_status_firefox61": "---", "cf_status_firefox60": "---", "target_milestone": "mozilla62", "cf_rank": null, "cf_qa_whiteboard": "", "severity": "normal", "groups": [], "cf_status_thunderbird_esr52": "---", "url": "", "cf_status_thunderbird_esr60": "---", "creator_detail": {"email": "emilio@crisal.io", "id": 546716, "name": "emilio@crisal.io", "real_name": "Emilio Cobos \u00c1lvarez [:emilio]"}, "whiteboard": "", "mentors": [], "summary": "Merge ServoDeclarationBlock and DeclarationBlock", "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "last_change_time": "2018-05-31T21:55:04Z", "assigned_to": "canaltinova@gmail.com", "is_open": false, "history": [{"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(emilio@crisal.io)"}], "who": "emilio@crisal.io", "when": "2018-05-25T18:44:37Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "jan@ikenmeyer.eu"}], "who": "jan@ikenmeyer.eu", "when": "2018-05-25T19:09:20Z"}, {"changes": [{"removed": "--", "field_name": "priority", "added": "P3"}, {"removed": "", "field_name": "cc", "added": "mreavy@mozilla.com"}], "who": "mreavy@mozilla.com", "when": "2018-05-30T05:07:47Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "canaltinova@gmail.com"}, {"removed": "needinfo?(emilio@crisal.io)", "field_name": "flagtypes.name", "added": "needinfo?(canaltinova@gmail.com)"}], "who": "emilio@crisal.io", "when": "2018-05-30T13:09:08Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "ASSIGNED"}, {"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "canaltinova@gmail.com"}, {"removed": "needinfo?(canaltinova@gmail.com)", "field_name": "flagtypes.name", "added": ""}], "who": "canaltinova@gmail.com", "when": "2018-05-30T13:10:20Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8982000, "added": "review?(emilio@crisal.io)"}], "who": "canaltinova@gmail.com", "when": "2018-05-30T19:18:05Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(emilio@crisal.io)", "attachment_id": 8982000, "added": "review+"}], "who": "emilio@crisal.io", "when": "2018-05-30T19:51:37Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8982161, "added": "review?(emilio@crisal.io)"}, {"field_name": "attachments.description", "removed": "Bug 1464496 - Merge ServoDeclarationBlock and DeclarationBlock", "attachment_id": 8982000, "added": "Bug 1464496 - Part 1: Merge ServoDeclarationBlock and DeclarationBlock"}], "who": "canaltinova@gmail.com", "when": "2018-05-31T09:40:26Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(emilio@crisal.io)", "attachment_id": 8982161, "added": "review+"}], "who": "emilio@crisal.io", "when": "2018-05-31T12:02:23Z"}, {"changes": [{"removed": "ASSIGNED", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla62"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2018-05-31 21:55:04"}, {"removed": "---", "field_name": "cf_status_firefox62", "added": "fixed"}], "who": "nerli@mozilla.com", "when": "2018-05-31T21:55:04Z"}], "resolution": "FIXED", "op_sys": "Unspecified", "cf_fx_points": "---", "cf_blocking_fennec": "---"}