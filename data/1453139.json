{"cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "classification": "Server Software", "creator": "m@owca.info", "mentors_detail": [], "depends_on": [], "creation_time": "2018-04-10T21:12:59Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "keywords": [], "summary": "DoesNotExist can be seen when translating all projects", "cf_last_resolved": "2018-05-01T14:32:58Z", "attachments": [{"creator": "pulgasaur@mozilla.bugs", "is_obsolete": 0, "is_patch": 0, "flags": [], "content_type": "text/x-github-pull-request", "id": 8967175}], "assigned_to_detail": {"email": "m@owca.info", "id": 275214, "name": "m@owca.info", "real_name": "Matjaz Horvat [:mathjazz]"}, "severity": "normal", "is_confirmed": true, "is_creator_accessible": true, "comments": [{"text": "This is a regression from bug 1305281: if you translate all projects and don't have sufficeint permission, we error:\nhttps://github.com/mozilla/pontoon/blob/master/pontoon/base/models.py#L365\n\nTraceback (most recent call last):\n  File \"/Users/mathjazz/Desktop/pontoon/venv/lib/python2.7/site-packages/django/core/handlers/exception.py\", line 41, in inner\n    response = get_response(request)\n  File \"/Users/mathjazz/Desktop/pontoon/venv/lib/python2.7/site-packages/django/core/handlers/base.py\", line 249, in _legacy_get_response\n    response = self._get_response(request)\n  File \"/Users/mathjazz/Desktop/pontoon/venv/lib/python2.7/site-packages/django/core/handlers/base.py\", line 187, in _get_response\n    response = self.process_exception_by_middleware(e, request)\n  File \"/Users/mathjazz/Desktop/pontoon/venv/lib/python2.7/site-packages/django/core/handlers/base.py\", line 185, in _get_response\n    response = wrapped_callback(request, *callback_args, **callback_kwargs)\n  File \"/Users/mathjazz/Desktop/pontoon/pontoon/base/views.py\", line 109, in translate\n    else None)\n  File \"/Users/mathjazz/Desktop/pontoon/venv/lib/python2.7/site-packages/django/shortcuts.py\", line 30, in render\n    content = loader.render_to_string(template_name, context, request, using=using)\n  File \"/Users/mathjazz/Desktop/pontoon/venv/lib/python2.7/site-packages/django/template/loader.py\", line 68, in render_to_string\n    return template.render(context, request)\n  File \"/Users/mathjazz/Desktop/pontoon/venv/lib/python2.7/site-packages/django_jinja/backend.py\", line 106, in render\n    return mark_safe(self.template.render(context))\n  File \"/Users/mathjazz/Desktop/pontoon/venv/lib/python2.7/site-packages/jinja2/environment.py\", line 989, in render\n    return self.environment.handle_exception(exc_info, True)\n  File \"/Users/mathjazz/Desktop/pontoon/venv/lib/python2.7/site-packages/jinja2/environment.py\", line 754, in handle_exception\n    reraise(exc_type, exc_value, tb)\n  File \"/Users/mathjazz/Desktop/pontoon/pontoon/base/templates/translate.html\", line 9, in top-level template code\n    {% import \"contributors/widgets/notifications_menu.html\" as Notifications with context %}\n  File \"/Users/mathjazz/Desktop/pontoon/pontoon/base/templates/base.html\", line 35, in top-level template code\n    {% block content %}\n  File \"/Users/mathjazz/Desktop/pontoon/pontoon/base/templates/translate.html\", line 337, in block \"content\"\n    {% if user.can_translate(project=project, locale=locale) %}\n  File \"/Users/mathjazz/Desktop/pontoon/pontoon/base/models.py\", line 365, in can_translate\n    project_locale = ProjectLocale.objects.get(project=project, locale=locale)\n  File \"/Users/mathjazz/Desktop/pontoon/venv/lib/python2.7/site-packages/django/db/models/manager.py\", line 85, in manager_method\n    return getattr(self.get_queryset(), name)(*args, **kwargs)\n  File \"/Users/mathjazz/Desktop/pontoon/venv/lib/python2.7/site-packages/django/db/models/query.py\", line 380, in get\n    self.model._meta.object_name\nDoesNotExist: ProjectLocale matching query does not exist.", "author": "m@owca.info", "id": 13196164, "time": "2018-04-10T21:12:59Z"}, {"text": "Created attachment 8967175\nLink to GitHub pull-request: https://github.com/mozilla/pontoon/pull/927", "author": "pulgasaur@mozilla.bugs", "id": 13199343, "time": "2018-04-11T21:00:43Z"}, {"text": "Commit pushed to master at https://github.com/mozilla/pontoon\n\nhttps://github.com/mozilla/pontoon/commit/4f9a7d2f07c43f7d507ccc519560cb7f1cf2d918\nBug 1453139: Prevent DoesNotExist for non-managers (#927)\n\nThe error was caused when User.can_translate() was called when checking\nif Make Suggestions toggle should be available, and the Project with\nslug \"all-project\" was passed as a parameter.\n\nWe now check for the visibility of the toggle for each string separately\nand not on translate page load. Which is the right way of doing it,\nbecause a user could have Translator permission for some strings\nwithin the locale and not for some others.\n\nAlso included:\n* The Save button is now also updated for each string\n* Permission to Translate is now also checked for each string (if possible)", "author": "mozilla+bugcloser@davedash.com", "id": 13200815, "time": "2018-04-12T13:56:50Z"}, {"text": "Fixed in:\nhttps://github.com/mozilla/pontoon/commit/4f9a7d2f07c43f7d507ccc519560cb7f1cf2d918", "author": "m@owca.info", "id": 13246066, "time": "2018-05-01T14:32:58Z"}], "id": 1453139, "priority": "P2", "platform": "Unspecified", "comment_count": 4, "version": "Trunk", "is_cc_accessible": true, "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox62": "---", "status": "RESOLVED", "product": "Webtools", "cf_fx_iteration": "---", "blocks": [], "qa_contact": "", "see_also": [], "cf_status_firefox_esr52": "---", "component": "Pontoon", "votes": 0, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "---", "cf_status_firefox61": "---", "cf_status_firefox60": "---", "target_milestone": "---", "cc": ["gmontagu@gmail.com"], "groups": [], "url": "", "creator_detail": {"email": "m@owca.info", "id": 275214, "name": "m@owca.info", "real_name": "Matjaz Horvat [:mathjazz]"}, "whiteboard": "", "mentors": [], "cc_detail": [{"email": "gmontagu@gmail.com", "id": 334073, "name": "gmontagu@gmail.com", "real_name": "Gabriela [:gaby2300]"}], "alias": null, "dupe_of": null, "flags": [], "last_change_time": "2018-05-01T14:32:58Z", "cf_status_firefox_esr60": "---", "assigned_to": "m@owca.info", "is_open": false, "cf_qa_whiteboard": "", "resolution": "FIXED", "op_sys": "Unspecified", "cf_fx_points": "---", "history": [{"changes": [{"removed": "", "field_name": "cc", "added": "gmontagu@gmail.com"}], "who": "gmontagu@gmail.com", "when": "2018-04-11T18:17:11Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2018-05-01 14:32:58"}], "who": "m@owca.info", "when": "2018-05-01T14:32:58Z"}]}