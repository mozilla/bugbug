{"cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "classification": "Components", "creator": "kmaglione+bmo@mozilla.com", "cc": ["bgrinstead@mozilla.com", "bobbyholley@gmail.com", "brunoaiss@gmail.com", "dao+bmo@mozilla.com", "felipc@gmail.com", "florian@queze.net", "gandalf@aviary.pl", "gijskruitbosch+bugs@gmail.com", "jmaher@mozilla.com", "joe-bugzilla@cursive.net", "jryans@gmail.com", "mcastelluccio@mozilla.com", "mconley@mozilla.com", "myk@mykzilla.org", "rwood@mozilla.com", "ryanvm@gmail.com", "Tobias.Marty@gmx.de"], "depends_on": [], "creation_time": "2018-04-23T20:47:36Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "keywords": [], "summary": "Improve talos startup tests to collect more relevant numbers", "cf_last_resolved": null, "attachments": [], "assigned_to_detail": {"email": "nobody@mozilla.org", "id": 1, "name": "nobody@mozilla.org", "real_name": "Nobody; OK to take it and work on it"}, "severity": "normal", "is_confirmed": true, "is_creator_accessible": true, "cf_crash_signature": "", "comments": [{"text": "I may be missing something, or there may be a duplicate bug, but I can't find one.\n\nWhen bug 1447719 landed, our ts_paint numbers went way down, because the test now measures the time to the first paint of the blank window. That's an important number, but it's different from what ts_paint used to measure.\n\nIf ts_paint is going to measure blank window timing now, we need another test to measure the paint time of the actual browser UI, or people are going to be free to regress that without noticing.\n\nAs it stands, from my local talos runs, it looks like we pay a pretty hefty price for the layout and styling of the initial blank window, so we probably took a hit to the timing for the actual UI being visible despite talos showing an improvement.", "author": "kmaglione+bmo@mozilla.com", "id": 13227739, "time": "2018-04-23T20:47:36Z"}, {"text": "(In reply to Kris Maglione [:kmag] (long backlog; ping on IRC if you're blocked) from comment #0)\n> we probably\n> took a hit to the timing for the actual UI being visible despite talos\n> showing an improvement.\n\nWe have telemetry numbers that look pretty flat: https://mzl.la/2J46N6y (if you ignore the pic due to bug 1454908).", "author": "florian@queze.net", "id": 13227877, "time": "2018-04-23T21:51:34Z"}, {"text": "(In reply to Kris Maglione [:kmag] (long backlog; ping on IRC if you're blocked) from comment #0)\n> I may be missing something, or there may be a duplicate bug, but I can't\n> find one.\n\nBug 1369417 may be what you were looking for. Although there was a lot of discussion but little action there.", "author": "florian@queze.net", "id": 13227884, "time": "2018-04-23T21:54:15Z"}, {"text": "(In reply to Florian Qu\u00e8ze [:florian] from comment #1)\n> (In reply to Kris Maglione [:kmag] (long backlog; ping on IRC if you're\n> blocked) from comment #0)\n> > we probably\n> > took a hit to the timing for the actual UI being visible despite talos\n> > showing an improvement.\n> \n> We have telemetry numbers that look pretty flat: https://mzl.la/2J46N6y (if\n> you ignore the pic due to bug 1454908).\n\nTelemetry is good, but we really need talos tests for this. We know how easy it is to regress startup performance, how often it happens, and how important it is not to.\n\nIt's bad enough that people already have a tendency to fix startup perf regressions in ways that add jank during startup. Fixing them in ways that prevent the UI from being visible, or not even noticing that they've regressed that in the first place, is a much bigger problem.\n\nThis feels like a blocker to me.", "author": "kmaglione+bmo@mozilla.com", "id": 13227893, "time": "2018-04-23T21:57:25Z"}, {"text": "Thanks for filing this :kmag, we could always add the old test back- in this case I need someone to own the documentation here and directing what we want to measure.  In addition, what makes sense to measure with the \"webext\" case as well.\n\nNext week rwood or myself can help out to ensure this is running everywhere as desired.", "author": "jmaher@mozilla.com", "id": 13228721, "time": "2018-04-24T06:30:09Z"}, {"text": "(In reply to Joel Maher ( :jmaher - limited bugzilla access until May 1st) (UTC+2) from comment #4)\n> In addition, what makes sense to measure with the \"webext\" case as well.\n\nI think the webext case should probably just measure the full UI visibility, and ignore blank window case. That's what I tend to be most worried about us regressing.", "author": "kmaglione+bmo@mozilla.com", "id": 13230573, "time": "2018-04-24T19:08:40Z"}, {"text": "(In reply to Kris Maglione [:kmag] from comment #0)\n\n> When bug 1447719 landed, our ts_paint numbers went way down, because the\n> test now measures the time to the first paint of the blank window. That's an\n> important number, but it's different from what ts_paint used to measure.\n\nThe fact that bug 1447719 landing made ts_paint drop by more than 50% on Linux but didn't affect it at all on Windows makes me think it was already pretty broken, and couldn't be relied on. I don't know what it actually measured, nor what it measures now.\n\n> If ts_paint is going to measure blank window timing now, we need another\n> test to measure the paint time of the actual browser UI, or people are going\n> to be free to regress that without noticing.\n\nThankfully, in the current situation people are not \"free to regress that without noticing\". I did regress it with bug 1450293, and Talos caught it in the sessionrestore_many_windows test (see bug 1454908).\n\n> As it stands, from my local talos runs, it looks like we pay a pretty hefty\n> price for the layout and styling of the initial blank window, so we probably\n> took a hit to the timing for the actual UI being visible despite talos\n> showing an improvement.\n\nI think you were seeing bug 1454908.\n\n\nThe more I think about this, the more I think I would like a Talos startup test that reports the startup timings that telemetry collects.\nThis would give us a way to compare what Talos reports (which is more stable, but also more artificial, due to only having warm startups) with what real Nightly users experience.\nA side benefit would be that Talos would no longer need custom code in its startup test to collect numbers.\n\nFrom about:telemetry#simple-measurements-tab, I think (at least) the following numbers would be relevant:\n- afterProfileLocked or selectProfile\n- blankWindowShown\n- firstPaint (<-- fwiw, on Windows this isn't the blank window anymore)\n- delayedStartupStarted (<-- this is when the browser UI is guaranteed to be on screen)\n- delayedStartupFinished\n- sessionRestored", "author": "florian@queze.net", "id": 13238211, "time": "2018-04-27T14:13:19Z"}, {"text": "I would like to see us start using standardized terminology around those topics. It's not \"first paint\" and \"another first paint\". And it shouldn't use named based on our internal functions either.\n\nIn my proposal for the bootstrap architecture and measuring from last year [0] I suggested we follow W3C paint-timing spec proposal [1].\n\nAt the time, some confusion came from the distinction between `firstPaint` stage and `firstContentfulPaint`.\n\nI believe that now it may be more easy to understand because it perfectly first this scenario, both as a milestone and measuring timestamp, but also as a stage of bootstrapping that all bootstrap code can be attached to.\n\n[0] https://groups.google.com/d/msg/mozilla.dev.platform/z7MQVwrJayk/SvJt-dnkAAAJ\n[1] https://github.com/w3c/paint-timing", "author": "gandalf@aviary.pl", "id": 13238732, "time": "2018-04-27T17:20:25Z"}, {"text": ":rwood- do you think the ts_paint and sessionrestore tests could be ported to the new raptor framework?  That is where we support by default multiple data points to collect.\n\n:kmag, is the proposal that :florian proposed sound like a solution to your concerns?", "author": "jmaher@mozilla.com", "id": 13246587, "time": "2018-05-01T17:19:57Z"}, {"text": "(In reply to Joel Maher ( :jmaher - limited bugzilla access until May 1st) (UTC+2) from comment #8)\n\n> :rwood- do you think the ts_paint and sessionrestore tests could be ported\n> to the new raptor framework?  That is where we support by default multiple\n> data points to collect.\n\nNo, as much as I'd like raptor to be able to do all types of tests, due to its architecture I don't think it's a good idea to try to adapt it to handle startup tests. That would be a significant design shift. The raptor runner core that drives the pageload tests (and takes the measurements) is a web extension which in itself makes it limited. We use a control server to be the go-between for the raptor web extension and python harness, which works fine for pageloads but wouldn't work for startup tests.\n\nAlso, one goal of raptor is to work cross-browser on both Firefox and Google Chrome - we haven't attempted any kind of startup tests on Chrome (as far as I know) so I think there's a bunch of unknowns there too.\n\nI believe we should keep raptor strictly for pageload tests and standard benchmark tests like speedometer. That way we reduce it's complexity as much as possible so it is easier to maintain, and add new types of pageload measurements, etc.\n\nIn the case of talos ts_paint and sessionrestore, I think we'll have to modify the existing tests to support the new measurement types. If it's too much overhead in production to have separate tests / subtests for each single measurement type, then yes we'd need to add multiple measurement support per startup to talos. Being startup tests makes it more complex as they don't just use the standard pageloader addon content code like talos pageloader tests do, so it would take a fair bit of work IMO but probably the best and fastest route.", "author": "rwood@mozilla.com", "id": 13247562, "time": "2018-05-02T01:17:08Z"}], "id": 1456270, "priority": "--", "mentors_detail": [], "comment_count": 10, "version": "unspecified", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox62": "---", "status": "NEW", "product": "Testing", "cf_fx_iteration": "---", "blocks": [1447719], "qa_contact": "", "see_also": [], "cf_status_firefox_esr52": "---", "component": "Talos", "votes": 0, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "---", "cf_status_firefox61": "---", "cf_status_firefox60": "---", "target_milestone": "---", "is_cc_accessible": true, "groups": [], "url": "", "creator_detail": {"email": "kmaglione+bmo@mozilla.com", "id": 106098, "name": "kmaglione+bmo@mozilla.com", "real_name": "Kris Maglione [:kmag]"}, "whiteboard": "[fxperf:p2]", "mentors": [], "cc_detail": [{"email": "bgrinstead@mozilla.com", "id": 476442, "name": "bgrinstead@mozilla.com", "real_name": "Brian Grinstead [:bgrins]"}, {"email": "bobbyholley@gmail.com", "id": 313730, "name": "bobbyholley@gmail.com", "real_name": "Bobby Holley (On Leave Until June 11th)"}, {"email": "brunoaiss@gmail.com", "id": 399973, "name": "brunoaiss@gmail.com", "real_name": "brunoais"}, {"email": "dao+bmo@mozilla.com", "id": 219124, "name": "dao+bmo@mozilla.com", "real_name": "D\u00e3o Gottwald [::dao]"}, {"email": "felipc@gmail.com", "id": 208747, "name": "felipc@gmail.com", "real_name": ":Felipe Gomes (needinfo me!)"}, {"email": "florian@queze.net", "id": 149052, "name": "florian@queze.net", "real_name": "Florian Qu\u00e8ze [:florian]"}, {"email": "gandalf@aviary.pl", "id": 41270, "name": "gandalf@aviary.pl", "real_name": "Zibi Braniecki [:gandalf][:zibi]"}, {"email": "gijskruitbosch+bugs@gmail.com", "id": 159069, "name": "gijskruitbosch+bugs@gmail.com", "real_name": ":Gijs (he/him)"}, {"email": "jmaher@mozilla.com", "id": 324370, "name": "jmaher@mozilla.com", "real_name": "Joel Maher ( :jmaher ) (UTC-4)"}, {"email": "joe-bugzilla@cursive.net", "id": 582586, "name": "joe-bugzilla@cursive.net", "real_name": "Joe Hildebrand  [:hildjj] (UTC-6)"}, {"email": "jryans@gmail.com", "id": 282978, "name": "jryans@gmail.com", "real_name": "J. Ryan Stinnett [:jryans] (use ni?)"}, {"email": "mcastelluccio@mozilla.com", "id": 420453, "name": "mcastelluccio@mozilla.com", "real_name": "Marco Castelluccio [:marco]"}, {"email": "mconley@mozilla.com", "id": 403756, "name": "mconley@mozilla.com", "real_name": "Mike Conley (:mconley) (:\u2699\ufe0f) (Catching up on needinfos / reviews)"}, {"email": "myk@mykzilla.org", "id": 27300, "name": "myk@mykzilla.org", "real_name": "Myk Melez [:myk] [@mykmelez]"}, {"email": "rwood@mozilla.com", "id": 447387, "name": "rwood@mozilla.com", "real_name": "Robert Wood [:rwood]"}, {"email": "ryanvm@gmail.com", "id": 75935, "name": "ryanvm@gmail.com", "real_name": "Ryan VanderMeulen [:RyanVM]"}, {"email": "Tobias.Marty@gmx.de", "id": 572549, "name": "Tobias.Marty@gmx.de", "real_name": "TMart"}], "alias": null, "dupe_of": null, "flags": [{"requestee": "kmaglione+bmo@mozilla.com", "status": "?", "name": "needinfo", "modification_date": "2018-05-01T17:19:57Z", "type_id": 800, "creation_date": "2018-05-01T17:19:57Z", "id": 1751235, "setter": "jmaher@mozilla.com"}], "last_change_time": "2018-06-05T15:20:00Z", "cf_status_firefox_esr60": "---", "assigned_to": "nobody@mozilla.org", "is_open": true, "resolution": "", "op_sys": "Unspecified", "cf_fx_points": "---", "history": [{"changes": [{"removed": "", "field_name": "cc", "added": "jmaher@mozilla.com, rwood@mozilla.com"}], "who": "jmaher@mozilla.com", "when": "2018-04-24T06:30:09Z"}, {"changes": [{"removed": "", "field_name": "whiteboard", "added": "[PI:May]"}], "who": "jmaher@mozilla.com", "when": "2018-04-24T06:30:31Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "felipc@gmail.com"}], "who": "felipc@gmail.com", "when": "2018-04-24T16:19:47Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "dao+bmo@mozilla.com"}], "who": "dao+bmo@mozilla.com", "when": "2018-04-27T11:35:44Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "mcastelluccio@mozilla.com"}], "who": "mcastelluccio@mozilla.com", "when": "2018-04-27T12:02:35Z"}, {"changes": [{"removed": "We no longer have an equivalent to the old ts_paint test", "field_name": "summary", "added": "Improve talos startup tests to collect more relevant numbers"}], "who": "florian@queze.net", "when": "2018-04-27T14:13:19Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "jryans@gmail.com"}], "who": "jryans@gmail.com", "when": "2018-04-27T14:20:29Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "myk@mykzilla.org"}], "who": "myk@mykzilla.org", "when": "2018-04-27T15:50:28Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "gandalf@aviary.pl"}], "who": "gandalf@aviary.pl", "when": "2018-04-27T17:20:25Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "Tobias.Marty@gmx.de"}], "who": "Tobias.Marty@gmx.de", "when": "2018-04-29T20:54:21Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "ryanvm@gmail.com"}], "who": "ryanvm@gmail.com", "when": "2018-05-01T13:08:17Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(rwood@mozilla.com), needinfo?(kmaglione+bmo@mozilla.com)"}], "who": "jmaher@mozilla.com", "when": "2018-05-01T17:19:57Z"}, {"changes": [{"removed": "needinfo?(rwood@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "rwood@mozilla.com", "when": "2018-05-02T01:17:08Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "bobbyholley@gmail.com, joe-bugzilla@cursive.net"}], "who": "joe-bugzilla@cursive.net", "when": "2018-05-02T16:04:26Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "brunoaiss@gmail.com"}], "who": "brunoaiss@gmail.com", "when": "2018-05-08T07:38:46Z"}, {"changes": [{"removed": "[PI:May]", "field_name": "whiteboard", "added": "[PI:May][fxperf]"}], "who": "mconley@mozilla.com", "when": "2018-05-08T18:10:51Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "bgrinstead@mozilla.com"}], "who": "bgrinstead@mozilla.com", "when": "2018-05-08T20:24:24Z"}, {"changes": [{"removed": "[PI:May][fxperf]", "field_name": "whiteboard", "added": "[PI:May][fxperf:p2]"}], "who": "mconley@mozilla.com", "when": "2018-05-15T14:45:10Z"}, {"changes": [{"removed": "[PI:May][fxperf:p2]", "field_name": "whiteboard", "added": "[fxperf:p2]"}], "who": "jmaher@mozilla.com", "when": "2018-06-05T15:20:00Z"}]}