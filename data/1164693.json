{"cf_tracking_thunderbird_esr52": "---", "status": "RESOLVED", "cf_tracking_firefox60": "---", "attachments": [{"creator": "ted.clancy@gmail.com", "is_obsolete": 1, "is_patch": 1, "flags": [], "content_type": "text/plain", "id": 8614511}, {"creator": "ted.clancy@gmail.com", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2015-06-08T08:00:34Z", "type_id": 4, "creation_date": "2015-06-06T02:14:49Z", "id": 1183573, "setter": "smontagu@smontagu.org"}], "content_type": "text/plain", "id": 8616322}, {"creator": "ted.clancy@gmail.com", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2015-06-08T08:08:09Z", "type_id": 4, "creation_date": "2015-06-06T02:16:16Z", "id": 1183574, "setter": "smontagu@smontagu.org"}], "content_type": "text/plain", "id": 8616323}, {"creator": "ted.clancy@gmail.com", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2015-06-22T09:28:12Z", "type_id": 4, "creation_date": "2015-06-20T16:28:06Z", "id": 1195610, "setter": "smontagu@smontagu.org"}], "content_type": "text/plain", "id": 8625066}], "classification": "Components", "creator": "ted.clancy@gmail.com", "cc": ["anygregor@gmail.com", "ehsan@mozilla.com", "gandalf@aviary.pl", "jfkthame@gmail.com", "jryans@gmail.com", "mvocom@gmail.com", "sledru@mozilla.com", "smontagu@smontagu.org", "stas@mozilla.com"], "depends_on": [1207761, 1177505, 1180417, 1221904], "creation_time": "2015-05-13T22:33:06Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "cf_status_firefox58": "---", "cf_status_firefox59": "---", "keywords": [], "summary": "The directional caret should point in the opposite direction of what backspace will do", "id": 1164693, "assigned_to_detail": {"email": "ted.clancy@gmail.com", "id": 494954, "name": "ted.clancy@gmail.com", "real_name": "Ted Clancy [:tedders1]"}, "severity": "normal", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "assigned_to": "ted.clancy@gmail.com", "comment_count": 18, "comments": [{"text": "When the pref |bidi.browser.ui| is true, the caret is replaced with a \"directional\" caret.\n\nRight now, this caret seems to reflect the directionality of the current paragraph, which isn't terribly useful.\n\nWhat would be better is if the caret reflected the directionality of the current text it's in. And if the caret is at a bidi boundary, the caret should always point in the OPPOSITE direction of the movement that would happen when backspace is pressed. That is, backspace should always move the cursor backwards relative to the direction it's pointing in.\n\nThis way, the user never needs to be confused about what hitting \"backspace\" will do.", "author": "ted.clancy@gmail.com", "id": 10266259, "time": "2015-05-13T22:33:06Z"}, {"text": "Caret. I mean \"caret\", not cursor.", "author": "ted.clancy@gmail.com", "id": 10266280, "time": "2015-05-13T22:40:25Z"}, {"text": "> Right now, this caret seems to reflect the directionality of the current paragraph, which isn't terribly useful.\n\nMy apologies. It seems that the caret currently reflects the current input language.", "author": "ted.clancy@gmail.com", "id": 10266883, "time": "2015-05-14T01:52:36Z"}, {"text": "Created attachment 8614511\nbug-1164693-fix.patch\n\nThis patch:\n\n1) Shows the bidi caret whenever: (a) the document is bidi; (b) the user is using an RTL keyboard; or (c) The bidi.browser.ui pref is set to true.\n\n2) Makes the hook on the caret point reflect the caret bidi level. (I shall call this the \"caret bidi direction\".)\n\n3) Did you know that when you have a bidi boundary (e.g. ABC\u05d0\u05d1\u05d2) and you click on the boundary (e.g. right between the C and the gimmel), the caret bidi direction depends on whether you clicked slightly to the right of the boundary or slightly to the left of the boundary? I didn't. And since you couldn't see the caret direction, it was really confusing. But now that you can see the caret direction, it's pretty nifty.\n\n\nMake sure you update to a recent version of mozilla-central before testing this. It relies on Bug 1167788, which just recently landed on mozilla-central.", "author": "ted.clancy@gmail.com", "id": 10339553, "time": "2015-06-03T05:09:02Z"}, {"text": "Oops. I mean, it depends on Bug 1067788, not Bug 1167788.", "author": "ted.clancy@gmail.com", "id": 10339556, "time": "2015-06-03T05:10:43Z"}, {"text": "(In reply to Ted Clancy [:tedders1] from comment #3)\n> This patch:\n> \n> 1) Shows the bidi caret whenever: (a) the document is bidi;\n\nWe used to do that but people complained -- see bug 418513. The problem is that a lot of documents happen to be bidi because they have an RTL character tucked away somewhere -- a good example is any Wikipedia page that has an RTL language in the \"this page in other languages\" list.", "author": "smontagu@smontagu.org", "id": 10341091, "time": "2015-06-03T15:07:00Z"}, {"text": "From a UX point of view, maybe the ideal thing to do would be to show the bidi caret automatically at bidi boundaries, but not otherwise. But I'm not sure offhand how tricky this might be to implement.", "author": "jfkthame@gmail.com", "id": 10341201, "time": "2015-06-03T15:32:15Z"}, {"text": "How about we show the bidi caret automatically in bidi paragraphs?\n\n(Mind you, I don't know how I'd detect that the caret is in a bidi paragraph. But I'll figure something out.)\n\n> maybe the ideal thing to do would be to show the bidi caret automatically at bidi boundaries, but not\n> otherwise. But I'm not sure offhand how tricky this might be to implement.\n\nThat's not hard.", "author": "ted.clancy@gmail.com", "id": 10341539, "time": "2015-06-03T16:41:46Z"}, {"text": "Created attachment 8616322\nbug-1164693-fix-part-1.patch\n\nI modified the patch so that it only shows the bidi caret in paragraphs that are bidi. It does this by checking for NS_FRAME_IS_BIDI, which is set on frames that are in bidi paragraphs.\n\nOtherwise, it shows the bidi caret if the keyboard language is RTL, or if bidi.browser.ui is set, as before.", "author": "ted.clancy@gmail.com", "id": 10353494, "time": "2015-06-06T02:14:49Z"}, {"text": "Created attachment 8616323\nbug-1164693-fix-part-2.patch\n\nThis patch fixes a problem where non-bidi paragraphs ending with a newline (which is most of them) were accidentally considered bidi.", "author": "ted.clancy@gmail.com", "id": 10353496, "time": "2015-06-06T02:16:16Z"}, {"text": "Comment on attachment 8616322\nbug-1164693-fix-part-1.patch\n\nReview of attachment 8616322:\n-----------------------------------------------------------------\n\n::: layout/base/nsCaret.cpp\n@@ +934,5 @@\n> +    int caretBidiLevel = selection->GetFrameSelection()->GetCaretBidiLevel();\n> +    if (caretBidiLevel & BIDI_LEVEL_UNDEFINED) {\n> +      caretBidiLevel = NS_GET_EMBEDDING_LEVEL(aFrame);\n> +    }\n> +    bool isCaretRTL = caretBidiLevel % 2;\n\nPlease make caretBidiLevel an nsBidiLevel, and use IS_LEVEL_RTL(caretBidiLevel) here", "author": "smontagu@smontagu.org", "id": 10355533, "time": "2015-06-08T08:00:34Z"}, {"text": "Comment on attachment 8616323\nbug-1164693-fix-part-2.patch\n\nReview of attachment 8616323:\n-----------------------------------------------------------------\n\n::: layout/base/nsBidiPresUtils.cpp\n@@ +733,5 @@\n>  #endif\n>  #endif\n>  #endif\n>  \n> +  bool isNonBidi = false;\n\nNit: Double negatives are confusing. I think it's clearer to call this isBidi (and reverse the true/false values, of course)", "author": "smontagu@smontagu.org", "id": 10355548, "time": "2015-06-08T08:08:09Z"}, {"text": "A thought for future enhancement: maybe it would be useful to add a new frame property to cache the result of GetDirection: NSBIDI_LTR, NSBIDI_RTL, or NSBIDI_MIXED? I think using that would be more accurate than using NS_FRAME_IS_BIDI -- I think I've been inclined to set NS_FRAME_IS_BIDI on a \"can't do any harm\" basis in the past.", "author": "smontagu@smontagu.org", "id": 10355562, "time": "2015-06-08T08:17:38Z"}, {"text": "Created attachment 8625066\nbug-1164693-fix-part-3.patch\n\nSome assertions were failing during tests, and it's because nsTextFrame::GetInFlowContentLength() makes some assumptions that aren't true for preformatted blocks of text.", "author": "ted.clancy@gmail.com", "id": 10411691, "time": "2015-06-20T16:28:06Z"}, {"text": "Treeherder run: https://treeherder.mozilla.org/#/jobs?repo=try&revision=2a4bd9caceb3", "author": "ted.clancy@gmail.com", "id": 10411692, "time": "2015-06-20T16:29:41Z"}, {"text": "Newer treeherder run: https://treeherder.mozilla.org/#/jobs?repo=try&revision=6ee4649cf002", "author": "ted.clancy@gmail.com", "id": 10415389, "time": "2015-06-23T07:29:49Z"}, {"text": "https://hg.mozilla.org/integration/mozilla-inbound/rev/b355b20f6123\nhttps://hg.mozilla.org/integration/mozilla-inbound/rev/2a383ebb99d5\nhttps://hg.mozilla.org/integration/mozilla-inbound/rev/b232c2a5af6d", "author": "pulsebot@bots.tld", "id": 10415453, "time": "2015-06-23T08:23:04Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/b355b20f6123\nhttps://hg.mozilla.org/mozilla-central/rev/2a383ebb99d5\nhttps://hg.mozilla.org/mozilla-central/rev/b232c2a5af6d", "author": "cbook@mozilla.com", "id": 10418368, "time": "2015-06-24T14:07:44Z"}], "cf_last_resolved": "2015-06-24T14:07:44Z", "priority": "--", "mentors_detail": [], "cf_crash_signature": "", "version": "unspecified", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox59": "---", "last_change_time": "2015-11-25T17:24:57Z", "cf_platform_rel": "---", "product": "Core", "cf_status_firefox_esr52": "---", "blocks": [], "qa_contact": "", "see_also": [], "cf_fx_iteration": "---", "component": "Layout: Text", "votes": 0, "groups": [], "cf_status_firefox60": "---", "cf_status_firefox41": "fixed", "target_milestone": "2.2 S14 (12june)", "is_cc_accessible": true, "cf_status_thunderbird_esr52": "---", "url": "", "creator_detail": {"email": "ted.clancy@gmail.com", "id": 494954, "name": "ted.clancy@gmail.com", "real_name": "Ted Clancy [:tedders1]"}, "whiteboard": "", "mentors": [], "cc_detail": [{"email": "anygregor@gmail.com", "id": 314734, "name": "anygregor@gmail.com", "real_name": "Gregor Wagner [:gwagner]"}, {"email": "ehsan@mozilla.com", "id": 251051, "name": "ehsan@mozilla.com", "real_name": ":Ehsan Akhgari"}, {"email": "gandalf@aviary.pl", "id": 41270, "name": "gandalf@aviary.pl", "real_name": "Zibi Braniecki [:gandalf][:zibi]"}, {"email": "jfkthame@gmail.com", "id": 329583, "name": "jfkthame@gmail.com", "real_name": "Jonathan Kew (:jfkthame) [PTO, 5-16 Mar]"}, {"email": "jryans@gmail.com", "id": 282978, "name": "jryans@gmail.com", "real_name": "J. Ryan Stinnett [:jryans] (use ni?)"}, {"email": "mvocom@gmail.com", "id": 463876, "name": "mvocom@gmail.com", "real_name": "Yaron"}, {"email": "sledru@mozilla.com", "id": 495955, "name": "sledru@mozilla.com", "real_name": "Sylvestre Ledru [:sylvestre]"}, {"email": "smontagu@smontagu.org", "id": 11171, "name": "smontagu@smontagu.org", "real_name": "Simon Montagu :smontagu"}, {"email": "stas@mozilla.com", "id": 164048, "name": "stas@mozilla.com", "real_name": "Sta\u015b Ma\u0142olepszy :stas"}], "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "cf_tracking_firefox58": "---", "cf_rank": null, "is_open": false, "history": [{"changes": [{"removed": "The directional cursor should reflect the direction of the text it's in", "field_name": "summary", "added": "The directional cursor should point in the opposite direction of what backspace will do"}], "who": "ted.clancy@gmail.com", "when": "2015-05-13T22:34:12Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "anygregor@gmail.com, gandalf@aviary.pl, smontagu@smontagu.org, stas@mozilla.com"}], "who": "ted.clancy@gmail.com", "when": "2015-05-13T22:34:59Z"}, {"changes": [{"removed": "The directional cursor should point in the opposite direction of what backspace will do", "field_name": "summary", "added": "The directional caret should point in the opposite direction of what backspace will do"}], "who": "ted.clancy@gmail.com", "when": "2015-05-13T22:40:41Z"}, {"changes": [{"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "tclancy@mozilla.com"}], "who": "ted.clancy@gmail.com", "when": "2015-06-03T04:43:32Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8614511, "added": "review?(smontagu@smontagu.org)"}], "who": "ted.clancy@gmail.com", "when": "2015-06-03T05:09:02Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "jfkthame@gmail.com"}], "who": "jfkthame@gmail.com", "when": "2015-06-03T15:32:15Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8614511, "added": "1"}, {"field_name": "flagtypes.name", "removed": "review?(smontagu@smontagu.org)", "attachment_id": 8614511, "added": ""}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8616322, "added": "review?(smontagu@smontagu.org)"}], "who": "ted.clancy@gmail.com", "when": "2015-06-06T02:14:49Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8616323, "added": "review?(smontagu@smontagu.org)"}], "who": "ted.clancy@gmail.com", "when": "2015-06-06T02:16:16Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(smontagu@smontagu.org)", "attachment_id": 8616322, "added": "review+"}], "who": "smontagu@smontagu.org", "when": "2015-06-08T08:00:34Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(smontagu@smontagu.org)", "attachment_id": 8616323, "added": "review+"}], "who": "smontagu@smontagu.org", "when": "2015-06-08T08:08:09Z"}, {"changes": [{"removed": "---", "field_name": "target_milestone", "added": "2.2 S14 (12june)"}], "who": "anygregor@gmail.com", "when": "2015-06-12T03:54:26Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8625066, "added": "review?(smontagu@smontagu.org)"}], "who": "ted.clancy@gmail.com", "when": "2015-06-20T16:28:06Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(smontagu@smontagu.org)", "attachment_id": 8625066, "added": "review+"}], "who": "smontagu@smontagu.org", "when": "2015-06-22T09:28:12Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "checkin-needed"}], "who": "ted.clancy@gmail.com", "when": "2015-06-23T07:29:49Z"}, {"changes": [{"removed": "checkin-needed", "field_name": "keywords", "added": ""}], "who": "pulsebot@bots.tld", "when": "2015-06-23T08:23:04Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2015-06-24 07:07:44"}, {"removed": "---", "field_name": "cf_status_firefox41", "added": "fixed"}], "who": "cbook@mozilla.com", "when": "2015-06-24T14:07:44Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1177505"}], "who": "alex_mayorga@yahoo.com", "when": "2015-06-25T20:22:51Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1180417"}], "who": "alice0775@yahoo.co.jp", "when": "2015-07-04T23:19:22Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "jryans@gmail.com"}], "who": "jryans@gmail.com", "when": "2015-07-17T17:39:03Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "ehsan@mozilla.com"}], "who": "ehsan@mozilla.com", "when": "2015-07-20T21:53:47Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "mvocom@gmail.com"}], "who": "mvocom@gmail.com", "when": "2015-10-16T13:47:07Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "sledru@mozilla.com"}, {"removed": "", "field_name": "depends_on", "added": "1207761"}], "who": "sledru@mozilla.com", "when": "2015-10-19T11:30:58Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1221904"}], "who": "mats@mozilla.com", "when": "2015-11-25T17:24:57Z"}], "resolution": "FIXED", "op_sys": "Unspecified", "cf_fx_points": "---", "cf_blocking_fennec": "---"}