{"cf_tracking_thunderbird_esr52": "---", "status": "UNCONFIRMED", "cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "cf_tracking_firefox62": "---", "creator": "mayankleoboy1@gmail.com", "mentors_detail": [], "depends_on": [], "cf_status_firefox_esr60": "---", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "keywords": [], "cc_detail": [{"email": "aosmond@mozilla.com", "id": 505306, "name": "aosmond@mozilla.com", "real_name": "Andrew Osmond [:aosmond]"}, {"email": "bugmail@mozilla.staktrace.com", "id": 426788, "name": "bugmail@mozilla.staktrace.com", "real_name": "Kartikaya Gupta (email:kats@mozilla.com)"}, {"email": "honzab.moz@firemni.cz", "id": 269762, "name": "honzab.moz@firemni.cz", "real_name": "Honza Bambas (:mayhemer)"}, {"email": "hurley@mozilla.com", "id": 408661, "name": "hurley@mozilla.com", "real_name": "Nicholas Hurley [:nwgh][:hurley]"}, {"email": "mconley@mozilla.com", "id": 403756, "name": "mconley@mozilla.com", "real_name": "Mike Conley (:mconley) (:\u2699\ufe0f) (Catching up on needinfos / reviews)"}, {"email": "Tobias.Marty@gmx.de", "id": 572549, "name": "Tobias.Marty@gmx.de", "real_name": "TMart"}, {"email": "valentin.gosu@gmail.com", "id": 415378, "name": "valentin.gosu@gmail.com", "real_name": "Valentin Gosu [:valentin]"}], "cf_last_resolved": null, "attachments": [{"creator": "mayankleoboy1@gmail.com", "is_obsolete": 0, "is_patch": 0, "flags": [], "content_type": "video/mp4", "id": 8984405}, {"creator": "mayankleoboy1@gmail.com", "is_obsolete": 0, "is_patch": 0, "flags": [], "content_type": "video/mp4", "id": 8984408}, {"creator": "mayankleoboy1@gmail.com", "is_obsolete": 0, "is_patch": 0, "flags": [], "content_type": "application/x-7z-compressed", "id": 8984986}, {"creator": "mayankleoboy1@gmail.com", "is_obsolete": 0, "is_patch": 0, "flags": [], "content_type": "application/x-7z-compressed", "id": 8985165}], "votes": 1, "classification": "Components", "is_confirmed": false, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 23, "comments": [{"text": "User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:62.0) Gecko/20100101 Firefox/62.0\nBuild ID: 20180605220158\n\nSteps to reproduce:\n\nSince the last 1-1.5 weeks, I have been seeing spinners while switching tabs.\nTypical STR:\n1. Open a webpage in a tab. The webpage has some URL's.\n1.5  Have a slow internet connection\n2. Open a URL in a background tab, and switch to it\n\n\nActual results:\n\nsee spinner\n\n\nExpected results:\n\nnot so\nI am not surenwhether WR is needed for this or not. However, i have been using WR as my primary engine, and i see the spinners.", "author": "mayankleoboy1@gmail.com", "id": 13390156, "time": "2018-06-06T07:17:02Z"}, {"text": "the spinners dont last long, typically less than a second.\nni? mconley. He might have some idea on how do i properly diagnose this", "author": "mayankleoboy1@gmail.com", "id": 13390162, "time": "2018-06-06T07:19:55Z"}, {"text": "(In reply to Mayank Bansal from comment #1)\n> the spinners dont last long, typically less than a second.\n> ni? mconley. He might have some idea on how do i properly diagnose this\n\nA performance profile would be super helpful here. Next time you see this, can you please add one?", "author": "mconley@mozilla.com", "id": 13391803, "time": "2018-06-06T18:17:48Z"}, {"text": "https://perfht.ml/2JqyVBE\n\nhere is a not-so-useful profile of 1 tab showing spinner for ~5-6seconds when i switched to it. Network was very slow at that time, specially the upload speed.\nI confirmed that there is no CPU exhaustion when the spinner showed (CPU usage was at 10%)", "author": "mayankleoboy1@gmail.com", "id": 13395277, "time": "2018-06-08T00:35:32Z"}, {"text": "This is with WebRender enabled, right? If you disable WebRender, does the problem persist?", "author": "mconley@mozilla.com", "id": 13395286, "time": "2018-06-08T00:52:57Z"}, {"text": "(In reply to Mike Conley (:mconley) (:\u2699\ufe0f) (Catching up on needinfos / reviews) from comment #4)\n> This is with WebRender enabled, right? If you disable WebRender, does the\n> problem persist?\n\n\nThis is reproducible with WR enabled only.\n\nrough STR:\n\n1. Download netlimiter from here: https://www.netlimiter.com/products\n2. Limit nightly limits to 5kbps/2kbps for DL/UL\n3. Start nightly with WR\n4. Open 4 tabs at once from bookmarks\n5. open a new URL in a new tab\n6. switch between the tabs with mouse until you see a spinner\n\nTab warming has no effect on this bug.", "author": "mayankleoboy1@gmail.com", "id": 13396043, "time": "2018-06-08T12:28:36Z"}, {"text": "Created attachment 8984405\nbandicam 2018-06-08 17-53-02-400.mp4", "author": "mayankleoboy1@gmail.com", "id": 13396047, "time": "2018-06-08T12:30:09Z"}, {"text": "here is a profile with WR-y threads added. The interesting bits should be the last 10 seconds or so.\n\nhttps://perfht.ml/2sLkJMq", "author": "mayankleoboy1@gmail.com", "id": 13396053, "time": "2018-06-08T12:37:01Z"}, {"text": "easier STR:\n\n1. Rate limit nightly as above\n2. Open 2 tabs (A and B). \n3. In B, type google.com and press enter\n3. Open another new tab (C), and paste https://mozillagfx.wordpress.com/ and press enter\n4. Switch between the three tabs till you see spinner.", "author": "mayankleoboy1@gmail.com", "id": 13396057, "time": "2018-06-08T12:41:26Z"}, {"text": "Created attachment 8984408\neasier STR.mp4", "author": "mayankleoboy1@gmail.com", "id": 13396070, "time": "2018-06-08T12:49:25Z"}, {"text": "I see what looks like a really really long wait on a lock inside both content process 4 main thread and the parent process main thread:\n\nhttps://perfht.ml/2HvG01T\n\nHey valentin, is this sort of main-thread blocking a known issue?", "author": "mconley@mozilla.com", "id": 13397476, "time": "2018-06-08T23:29:11Z"}, {"text": "Not that I'm aware of.\nI see a stack waiting for the lock in GetThreadSafely()... But I don't see what's holding that lock.\nIs it possible to get another profile with \"Socket Thread\" also tracked?\nLogging also wouldn't hurt https://developer.mozilla.org/en-US/docs/Mozilla/Debugging/HTTP_logging", "author": "valentin.gosu@gmail.com", "id": 13401896, "time": "2018-06-12T01:38:18Z"}, {"text": "ni? to Mayank for comment 11", "author": "mconley@mozilla.com", "id": 13401977, "time": "2018-06-12T05:21:41Z"}, {"text": "Created attachment 8984986\nlog.txt-main.7z\n\nhttps://perfht.ml/2HLwHLG and logging", "author": "mayankleoboy1@gmail.com", "id": 13402306, "time": "2018-06-12T14:12:02Z"}, {"text": "Honza, can you take a look at this?\nThe socket treads still seem to be spending most time in ::Poll()\nI initially thought it could be a regression from bug 1444160, but now I'm not very sure. Also, I don't see how WebRender is involved.", "author": "valentin.gosu@gmail.com", "id": 13402334, "time": "2018-06-12T14:43:11Z"}, {"text": "Here is a profile with *all* the threads.. hopefully this is helpful\nhttps://perfht.ml/2LKlFIL", "author": "mayankleoboy1@gmail.com", "id": 13402369, "time": "2018-06-12T15:27:13Z"}, {"text": "(In reply to Mayank Bansal from comment #13)\n> Created attachment 8984986\n> log.txt-main.7z\n> \n> https://perfht.ml/2HLwHLG and logging\n\nThere are 3 pending channels, one of them shows this:\n\n2018-06-12 14:07:45.546 \u2043 nsHttpChannel \u2043 27a40e81000 \u2043 connected \u2043 http-status=n/a \u2043 url=https://syndication.twitter.com/settings\n-> nsHttpTransaction @27a394f0c00 created 2018-06-12 14:07:45.560\n-> nsHttpConnection @27a39b07800 created 2018-06-12 14:07:45.946\n\n2018-06-12 14:07:49.575000 UTC - [17040:Socket Thread]: V/nsHttp nsHttpConnection::OnSocketWritable [this=0000027A39B07800] host=syndication.twitter.com\n2018-06-12 14:07:49.575000 UTC - [17040:Socket Thread]: V/nsHttp   writing transaction request stream\n2018-06-12 14:07:49.575000 UTC - [17040:Socket Thread]: I/nsHttp Http2Session::ReadSegments 0000027A3D510800\n2018-06-12 14:07:49.575000 UTC - [17040:Socket Thread]: I/nsHttp Http2Session 0000027A3D510800 could not identify a stream to write; suspending.\n\nSince then there is no activity on the transaction.\n\n\nBefore that I can also see:\n\n2018-06-12 14:07:49.537000 UTC - [17040:Socket Thread]: V/nsHttp UpdateCoalescingForNewConn() shutting down old connection (0000027A39B70400) because new spdy connection (0000027A39B07800) takes precedence\n\n(it's nsHttpConnection @27a39b70400 created 2018-06-12 14:07:47.301)\n\nNick, any idea?", "author": "honzab.moz@firemni.cz", "id": 13403429, "time": "2018-06-13T13:40:02Z"}, {"text": "Created attachment 8985165\nlog.txt-main.7z\n\nanother log\n\nhere, i opened google.co.in in one tab, and https://mozillagfx.wordpress.com/ in another tab\n\nThe google page showed spinner, and the mozgfx blog page failed to load and gave some error.\n\nSometimes, it happens that the page doesnt load at all, just shows blank (bug 1320360)", "author": "mayankleoboy1@gmail.com", "id": 13403504, "time": "2018-06-13T14:30:33Z"}, {"text": "OK, so me and Nick were looking once more at the log and there doesn't seem to be anything wrong, except slow responses, which is expected on slow networks.\n\nAt first wasn't clear to me what the \"see spinner\" meant.  This is a content process or rendering process delay, not a networking problem.\n\nThrowing back to Fx/Gen for retriage.", "author": "honzab.moz@firemni.cz", "id": 13404027, "time": "2018-06-13T19:10:04Z"}, {"text": "(In reply to Mayank Bansal from comment #15)\n> Here is a profile with *all* the threads.. hopefully this is helpful\n> https://perfht.ml/2LKlFIL\n\nBased on this profile it seems like the image decoder threads are the key here, since they are also being shown as blocked on a lock in this profile. My guess is that the slow network behaviour is blocking the network threads, which is blocking the image decoder threads, which is blocking rendering somehow. It's conceivable that the interaction with the image decoder threads is different between WR and non-WR.\n\nAndrew, do you have any ideas what's going on here? Which thread is holding the lock that mozilla::image::DecodePoolImpl::PopWorkLocked(bool) is trying to acquire? All the image decoder threads seem to get to to this function and get stuck.", "author": "bugmail@mozilla.staktrace.com", "id": 13406693, "time": "2018-06-15T13:36:15Z"}, {"text": "https://perfht.ml/2ydtRzj  with \"Image\" added in the profiler.. \nthis should be more accurate than the one above, as the overhead of capturing all the threads is a lot on my 2c/4t CPU\n\nLet me know if any other profile is needed", "author": "mayankleoboy1@gmail.com", "id": 13406722, "time": "2018-06-15T13:50:24Z"}, {"text": "Actually I'm not sure comment 19 is right any more. I think the profiler UI is just showing the red \"event processing delay\" incorrectly. Based on the code those threads are just waiting for work. Leaving ni to aosmond to confirm.", "author": "bugmail@mozilla.staktrace.com", "id": 13406736, "time": "2018-06-15T14:02:50Z"}, {"text": "Markus confirmed that the processing delay is based on when events posted to the gecko event loop are run. So if the thread implements its own job queue that it waits on, then yeah that processing delay is going to show up even though it doesn't mean anything.", "author": "bugmail@mozilla.staktrace.com", "id": 13407049, "time": "2018-06-15T16:58:03Z"}], "id": 1467044, "priority": "P1", "cc": ["aosmond@mozilla.com", "bugmail@mozilla.staktrace.com", "honzab.moz@firemni.cz", "hurley@mozilla.com", "mconley@mozilla.com", "Tobias.Marty@gmx.de", "valentin.gosu@gmail.com"], "cf_crash_signature": "", "version": "Trunk", "is_cc_accessible": true, "cf_tracking_firefox_esr52": "---", "see_also": [], "cf_tracking_thunderbird_esr60": "---", "cf_platform_rel": "---", "product": "Core", "cf_fx_iteration": "---", "blocks": [1386665, 1463851], "qa_contact": "", "creation_time": "2018-06-06T07:17:02Z", "cf_status_firefox_esr52": "---", "component": "Graphics: WebRender", "assigned_to_detail": {"email": "nobody@mozilla.org", "id": 1, "name": "nobody@mozilla.org", "real_name": "Nobody; OK to take it and work on it"}, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "---", "cf_status_firefox61": "---", "cf_status_firefox60": "---", "target_milestone": "---", "cf_rank": null, "cf_qa_whiteboard": "", "severity": "normal", "groups": [], "cf_status_thunderbird_esr52": "---", "url": "", "cf_status_thunderbird_esr60": "---", "creator_detail": {"email": "mayankleoboy1@gmail.com", "id": 440227, "name": "mayankleoboy1@gmail.com", "real_name": "Mayank Bansal"}, "whiteboard": "[qf]", "mentors": [], "summary": "Seeing spinner while switching tabs with WebRender enabled (Possibly due to slow network)", "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "last_change_time": "2018-06-15T16:58:03Z", "assigned_to": "nobody@mozilla.org", "is_open": true, "history": [{"changes": [{"removed": "", "field_name": "cc", "added": "mconley@mozilla.com"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(mconley@mozilla.com)"}], "who": "mayankleoboy1@gmail.com", "when": "2018-06-06T07:19:55Z"}, {"changes": [{"removed": "needinfo?(mconley@mozilla.com)", "field_name": "flagtypes.name", "added": "needinfo?(mayankleoboy1@gmail.com)"}], "who": "mconley@mozilla.com", "when": "2018-06-06T18:17:48Z"}, {"changes": [{"removed": "needinfo?(mayankleoboy1@gmail.com)", "field_name": "flagtypes.name", "added": "needinfo?(mconley@mozilla.com)"}], "who": "mayankleoboy1@gmail.com", "when": "2018-06-08T00:35:32Z"}, {"changes": [{"removed": "needinfo?(mconley@mozilla.com)", "field_name": "flagtypes.name", "added": "needinfo?(mayankleoboy1@gmail.com)"}], "who": "mconley@mozilla.com", "when": "2018-06-08T00:52:57Z"}, {"changes": [{"removed": "needinfo?(mayankleoboy1@gmail.com)", "field_name": "flagtypes.name", "added": "needinfo?(mconley@mozilla.com)"}], "who": "mayankleoboy1@gmail.com", "when": "2018-06-08T12:28:36Z"}, {"changes": [{"removed": "Seeing spinner while switching tabs (Possibly due to slow network)", "field_name": "summary", "added": "Seeing spinner while switching tabs with WebRender enabled (Possibly due to slow network)"}, {"removed": "needinfo?(mconley@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "mconley@mozilla.com", "when": "2018-06-08T23:23:04Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "valentin.gosu@gmail.com"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(valentin.gosu@gmail.com)"}], "who": "mconley@mozilla.com", "when": "2018-06-08T23:29:11Z"}, {"changes": [{"removed": "General", "field_name": "component", "added": "Networking"}, {"removed": "", "field_name": "whiteboard", "added": "[qf]"}], "who": "mconley@mozilla.com", "when": "2018-06-08T23:29:39Z"}, {"changes": [{"removed": "needinfo?(valentin.gosu@gmail.com)", "field_name": "flagtypes.name", "added": ""}], "who": "valentin.gosu@gmail.com", "when": "2018-06-12T01:38:18Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(mayankleoboy1@gmail.com)"}], "who": "mconley@mozilla.com", "when": "2018-06-12T05:21:41Z"}, {"changes": [{"removed": "needinfo?(mayankleoboy1@gmail.com)", "field_name": "flagtypes.name", "added": "needinfo?(valentin.gosu@gmail.com)"}], "who": "mayankleoboy1@gmail.com", "when": "2018-06-12T14:12:02Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "honzab.moz@firemni.cz"}, {"removed": "needinfo?(valentin.gosu@gmail.com)", "field_name": "flagtypes.name", "added": "needinfo?(honzab.moz@firemni.cz)"}], "who": "valentin.gosu@gmail.com", "when": "2018-06-12T14:43:11Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "hurley@mozilla.com"}, {"removed": "needinfo?(honzab.moz@firemni.cz)", "field_name": "flagtypes.name", "added": "needinfo?(hurley@mozilla.com)"}], "who": "honzab.moz@firemni.cz", "when": "2018-06-13T13:40:02Z"}, {"changes": [{"removed": "Networking", "field_name": "component", "added": "General"}, {"removed": "Core", "field_name": "product", "added": "Firefox"}], "who": "honzab.moz@firemni.cz", "when": "2018-06-13T19:10:04Z"}, {"changes": [{"removed": "needinfo?(hurley@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "honzab.moz@firemni.cz", "when": "2018-06-13T19:10:09Z"}, {"changes": [{"removed": "General", "field_name": "component", "added": "Graphics: WebRender"}, {"removed": "Firefox", "field_name": "product", "added": "Core"}], "who": "mayankleoboy1@gmail.com", "when": "2018-06-15T13:15:05Z"}, {"changes": [{"removed": "--", "field_name": "priority", "added": "P1"}, {"removed": "", "field_name": "cc", "added": "aosmond@mozilla.com, bugmail@mozilla.staktrace.com"}, {"removed": "", "field_name": "blocks", "added": "1463851, 1386665"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(aosmond@mozilla.com)"}], "who": "bugmail@mozilla.staktrace.com", "when": "2018-06-15T13:36:15Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "Tobias.Marty@gmx.de"}], "who": "Tobias.Marty@gmx.de", "when": "2018-06-15T13:37:59Z"}, {"changes": [{"removed": "needinfo?(aosmond@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "bugmail@mozilla.staktrace.com", "when": "2018-06-15T16:58:03Z"}], "resolution": "", "op_sys": "Unspecified", "cf_fx_points": "---", "cf_blocking_fennec": "---"}