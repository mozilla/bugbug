{"cf_tracking_thunderbird_esr52": "---", "status": "RESOLVED", "cf_tracking_firefox60": "---", "attachments": [{"creator": "zentner.kyle@gmail.com", "is_obsolete": 1, "is_patch": 1, "flags": [], "content_type": "text/plain", "id": 8609071}, {"creator": "zentner.kyle@gmail.com", "is_obsolete": 1, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2015-05-26T17:24:33Z", "type_id": 4, "creation_date": "2015-05-26T16:59:31Z", "id": 1174959, "setter": "dholbert@mozilla.com"}], "content_type": "text/plain", "id": 8610661}, {"creator": "zentner.kyle@gmail.com", "is_obsolete": 1, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2015-05-26T22:34:23Z", "type_id": 4, "creation_date": "2015-05-26T22:34:23Z", "id": 1175386, "setter": "zentner.kyle@gmail.com"}], "content_type": "text/plain", "id": 8610857}, {"creator": "zentner.kyle@gmail.com", "is_obsolete": 1, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2015-05-27T16:57:53Z", "type_id": 4, "creation_date": "2015-05-27T16:57:53Z", "id": 1176109, "setter": "zentner.kyle@gmail.com"}, {"status": "-", "name": "checkin", "modification_date": "2015-05-28T15:01:55Z", "type_id": 41, "creation_date": "2015-05-27T16:57:53Z", "id": 1176110, "setter": "ryanvm@gmail.com"}], "content_type": "text/plain", "id": 8611290}, {"creator": "zentner.kyle@gmail.com", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2015-05-29T16:17:13Z", "type_id": 4, "creation_date": "2015-05-29T16:17:13Z", "id": 1178570, "setter": "zentner.kyle@gmail.com"}], "content_type": "text/plain", "id": 8612937}, {"creator": "dholbert@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2016-06-18T18:48:29Z", "type_id": 4, "creation_date": "2016-06-16T11:09:50Z", "id": 1410666, "setter": "dholbert@mozilla.com"}, {"status": "+", "name": "review", "modification_date": "2016-06-18T11:11:17Z", "type_id": 4, "creation_date": "2016-06-16T11:09:50Z", "id": 1410667, "setter": "mats@mozilla.com"}], "content_type": "text/x-review-board-request", "id": 8763059}], "classification": "Components", "creator": "dbaron@dbaron.org", "cc": ["bzbarsky@mit.edu", "cbook@mozilla.com", "dholbert@mozilla.com", "florian@queze.net", "jorge@mozilla.com", "jypenator@gmail.com", "kohei.yoshino@gmail.com", "mats@mozilla.com", "percyley@qq.com", "zentner.kyle@gmail.com"], "depends_on": [1169837, 1169839, 1280422], "creation_time": "2015-05-20T13:59:38Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "cf_status_firefox58": "---", "cf_status_firefox59": "---", "keywords": ["addon-compat", "dev-doc-complete", "site-compat"], "summary": "remove box-sizing: padding-box", "id": 1166728, "cf_status_firefox50": "fixed", "assigned_to_detail": {"email": "zentner.kyle@gmail.com", "id": 539400, "name": "zentner.kyle@gmail.com", "real_name": "Kyle Zentner"}, "severity": "normal", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "assigned_to": "zentner.kyle@gmail.com", "comment_count": 53, "comments": [{"text": "The CSS WG just resolved to remove box-sizing: padding-box.  We should remove it.\n\nNeed to deal with:\nhttps://mxr.mozilla.org/mozilla-central/search?string=box-sizing%3A+padding-box&find=&findi=&filter=^[^\\0]*%24&hitlimit=&tree=mozilla-central\nfirst.", "author": "dbaron@dbaron.org", "id": 10290050, "time": "2015-05-20T13:59:38Z"}, {"text": "And also https://mxr.mozilla.org/addons/search?string=box-sizing%3A+padding-box&find=&findi=&filter=^[^\\0]*%24&hitlimit=&tree=addons", "author": "bzbarsky@mit.edu", "id": 10290614, "time": "2015-05-20T15:53:45Z"}, {"text": "To get the property not-recognized-by-the-CSS-parser (fixing this bug), we need to:\n(1) remove the line here:\n https://mxr.mozilla.org/mozilla-central/source/layout/style/nsCSSProps.cpp?rev=956a03448bbe#895\n\n(That maps the CSS keyword \"padding-box\" to our internal numeric representation of this box-sizing value, which we use in layout.  We use that same keyword table when re-serializing the style for getComputedStyle and elem.style, too; so I don't think there's any extra work for that.)\n\nThat one-line change should \"fix\" this bug, as far as web developers can see. Beyond that, we need to:\n (2) fix the *usages* of this property in tests & our browser UI\n\nand then:\n (3) fix the now-dead-code that checks for this value in layout:\nhttps://mxr.mozilla.org/mozilla-central/ident?i=NS_STYLE_BOX_SIZING_PADDING\n\nWe also need to get add-ons updated, per the URL in comment 1, but that should maybe happen separately.", "author": "dholbert@mozilla.com", "id": 10290856, "time": "2015-05-20T16:25:14Z"}, {"text": "http://caniuse.com/#search=box-sizing currently shows that we're literally the only browser to support \"padding-box\".", "author": "dholbert@mozilla.com", "id": 10290935, "time": "2015-05-20T16:36:12Z"}, {"text": "https://treeherder.mozilla.org/#/jobs?repo=try&revision=391b976818d3", "author": "zentner.kyle@gmail.com", "id": 10292691, "time": "2015-05-20T22:16:54Z"}, {"text": "The searchbar.css changes are suspicious -- changing from padding-box to border-box on an element with a border is a substantive change.  Does it have padding?  (Can't tell from local examination of the CSS, but you could tell from, e.g., inspector, if you can get it to inspect chrome.)  If it doesn't have padding, you should be able to change to content-box.", "author": "dbaron@dbaron.org", "id": 10292848, "time": "2015-05-20T22:51:43Z"}, {"text": "(Comment 5 is about changes to a \" .searchbar-engine-one-off-item:not(.last-row) {\" rule.)\n\nI believe that style is applied to this element:\n> 1321           let button = document.createElementNS(kXULNS, \"button\");\n[...]\n> 1328           button.setAttribute(\"class\", \"searchbar-engine-one-off-item\");\nhttp://mxr.mozilla.org/mozilla-central/source/browser/base/content/urlbarBindings.xml?rev=446ce38d0005&mark=1321-1321,1328-1328#1321\n\nIf XUL buttons are anything like HTML buttons, they've got nonzero padding by default. (At least, an unstyled HTML button shows that is has 6px of padding-left/padding-right, in devtools.)\n\nSo, this searchbar.css change probably does change behavior. Not sure yet what the best solution is, though. (Probably using either \"border-box\" or \"content-box\" and adjusting the width/height setting, I suppose...)", "author": "dholbert@mozilla.com", "id": 10293131, "time": "2015-05-21T00:04:23Z"}, {"text": "Looks like that \"one-off-item\" styling (with 'box-sizing:padding-box') was added in bug 1088660, by Florian:\nhttp://hg.mozilla.org/mozilla-central/annotate/6bcf7110d616/browser/themes/linux/searchbar.css#l153\n\nFlorian, do you remember what the context of this element looks like, and do you have a suggestion as to what tweaks might be needed there, given that \"box-sizing: padding-box\" is going away?", "author": "dholbert@mozilla.com", "id": 10293173, "time": "2015-05-21T00:09:49Z"}, {"text": "(In reply to David Baron [:dbaron] from comment #5)\n> The searchbar.css changes are suspicious -- changing from padding-box to\n> border-box on an element with a border is a substantive change.  Does it\n> have padding?  (Can't tell from local examination of the CSS, but you could\n> tell from, e.g., inspector, if you can get it to inspect chrome.)  If it\n> doesn't have padding, you should be able to change to content-box.\n\nThe padding is set to 0 at:\nhttp://hg.mozilla.org/mozilla-central/annotate/6bcf7110d616/browser/themes/linux/searchbar.css#l146\n\n(In reply to Daniel Holbert [:dholbert] from comment #7)\n> Looks like that \"one-off-item\" styling (with 'box-sizing:padding-box') was\n> added in bug 1088660, by Florian:\n> http://hg.mozilla.org/mozilla-central/annotate/6bcf7110d616/browser/themes/\n> linux/searchbar.css#l153\n> \n> Florian, do you remember what the context of this element looks like, and do\n> you have a suggestion as to what tweaks might be needed there, given that\n> \"box-sizing: padding-box\" is going away?\n\nPlease change this line to:\n   box-sizing: content-box;\n\nRemoving the line or changing it to border-box causes some pixels of empty space at the bottom of the list of one-off engines in the search panel.", "author": "florian@queze.net", "id": 10295302, "time": "2015-05-21T13:02:12Z"}, {"text": "https://treeherder.mozilla.org/#/jobs?repo=try&revision=6fe43a6fcee9", "author": "zentner.kyle@gmail.com", "id": 10296364, "time": "2015-05-21T16:26:31Z"}, {"text": "https://treeherder.mozilla.org/#/jobs?repo=try&revision=208898e5231e", "author": "zentner.kyle@gmail.com", "id": 10297786, "time": "2015-05-21T20:49:18Z"}, {"text": "https://treeherder.mozilla.org/#/jobs?repo=try&revision=1ed345c379e8", "author": "zentner.kyle@gmail.com", "id": 10298137, "time": "2015-05-21T22:21:38Z"}, {"text": "Created attachment 8609071\nRemoveBoxSizingPaddingBox\n\nUnless there are failures in the test run above, I think that this patch is good to go. I looked carefully at the about private browsing page, so that change should be fine. I've also simplified the logic in various places due to this change. Let me know if it makes *less* sense now.", "author": "zentner.kyle@gmail.com", "id": 10298289, "time": "2015-05-21T22:58:56Z"}, {"text": "Comment on attachment 8609071\nRemoveBoxSizingPaddingBox\n\nPreliminary review nit:\n\n>diff --git a/layout/reftests/css-blending/background-blending-background-clip-padding-box.html b/layout/reftests/css-blending/background-blending-background-clip-padding-box.html\n>--- a/layout/reftests/css-blending/background-blending-background-clip-padding-box.html\n>+++ /dev/null\n>@@ -1,22 +0,0 @@\n>-<!-- Blend a background image and a background color specifying background-clip: padding-box  -->\n[...]\n>-  background-clip: padding-box;\n\nLooks like this file (and its reference case) are being removed, but they shouldn't be. (\"background-clip: padding-box\" still exists, independent of the \"box-sizing: padding-box\" removal.)\n\nIt looks like only reftest failure on the Try run is this testcase/reference case failing to run (because they still exist in the manifest file, but the files were removed in this patch).  I expect when you revert this file-removal, you'll have green reftest results.", "author": "dholbert@mozilla.com", "id": 10298664, "time": "2015-05-22T01:18:25Z"}, {"text": "Comment on attachment 8609071\nRemoveBoxSizingPaddingBox\n\nHaven't looked at the reftests yet, but here are my review notes on the code changes:\n\n>+++ b/layout/base/nsLayoutUtils.cpp\n>@@ -4798,22 +4780,18 @@ nsLayoutUtils::ComputeSizeWithIntrinsicD\n>+  if (stylePos->mBoxSizing == NS_STYLE_BOX_SIZING_BORDER) {\n>+      boxSizingAdjust += aBorder + aPadding;\n>   }\n\nDe-indent \"boxSizingAdjust\" by 2 spaces.  (Most code in layout, including this file, uses 2-space indentation, not 4-space).\n\n>+++ b/layout/generic/nsFrame.cpp\n>+  if (stylePos->mBoxSizing == NS_STYLE_BOX_SIZING_BORDER) {\n>+      boxSizingAdjust += aBorder + aPadding;\n>   }\n\nDe-indent by 2 spaces.\n\n(Also, observation: I think a lot of functions like this pass border & padding separately *so that we can support* box-sizing: padding-box vs. border-box.  Now that border/padding will always be added/subtracted as a package, we might want to consider combining these args into aBorderPadding in a lot of spots, so that we don't need to perform \"aBorder + aPadding\" all over the place.)\n\n>+++ b/layout/generic/nsHTMLReflowState.cpp\n> nsCSSOffsetState::ComputeWidthValue(nscoord aContainingBlockWidth,\n>                                     uint8_t aBoxSizing,\n>                                     const nsStyleCoord& aCoord)\n> {\n>   nscoord inside = 0, outside = ComputedPhysicalBorderPadding().LeftRight() +\n>                                 ComputedPhysicalMargin().LeftRight();\n>-  switch (aBoxSizing) {\n>-    case NS_STYLE_BOX_SIZING_BORDER:\n>+  if (aBoxSizing == NS_STYLE_BOX_SIZING_BORDER) {\n>       inside = ComputedPhysicalBorderPadding().LeftRight();\n\nDe-indent by 2 spaces.\n\n> nscoord\n> nsCSSOffsetState::ComputeHeightValue(nscoord aContainingBlockHeight,\n>                                      uint8_t aBoxSizing,\n>                                      const nsStyleCoord& aCoord)\n> {\n>   nscoord inside = 0;\n>-  switch (aBoxSizing) {\n>-    case NS_STYLE_BOX_SIZING_BORDER:\n>+  if (aBoxSizing == NS_STYLE_BOX_SIZING_BORDER) {\n>       inside = ComputedPhysicalBorderPadding().TopBottom();\n\nHere too.\n\n>@@ -1091,22 +1081,18 @@ nsHTMLReflowState::CalculateHorizBorderP\n>   nscoord outside =\n>     padding.LeftRight() + border.LeftRight() + margin.LeftRight();\n>   nscoord inside = 0;\n>+  if (mStylePosition->mBoxSizing == NS_STYLE_BOX_SIZING_BORDER) {\n>+    inside += border.LeftRight() + padding.LeftRight();\n>   }\n>   outside -= inside;\n\nThis \"outside/inside\" calculation feels a bit churny, now that we've only got 2 cases to consider. In particular -- the common case (content-box) feels a bit silly here; we end up performing this calculation, effectively:\n  outside = padding + border + margin;\n  outside -= border - padding\n...which is a bit silly.\n\nI suspect this should be simplified (arithmetic-wise at least) to something like:\n if (mStylePosition->mBoxSizing == NS_STYLE_BOX_SIZING_BORDER) {\n   inside += border.LeftRight() + padding.LeftRight();\n } else {\n   outside += border.LeftRight() + padding.LeftRight();\n }\n outside += margin.LeftRight();\n\nCould you make that change, perhaps in a followup patch so that the main patch stays mostly-mechanical?\n\n>+++ b/layout/style/nsComputedDOMStyle.cpp\n> nsMargin\n> nsComputedDOMStyle::GetAdjustedValuesForBoxSizing()\n> {\n[...]\n>-  switch(stylePos->mBoxSizing) {\n>-    case NS_STYLE_BOX_SIZING_BORDER:\n>+  if (stylePos->mBoxSizing == NS_STYLE_BOX_SIZING_BORDER) {\n>       adjustment += mInnerFrame->GetUsedBorder();\n[...]\n>       adjustment += mInnerFrame->GetUsedPadding();\n\nDe-indent. Also, collapse these 2 lines to one, w/ the existing convenience function:\n  mInnerFrame->GetUsedBorderAndPadding();\n\n>+++ b/layout/tables/BasicTableLayoutStrategy.cpp\n>-        if (isQuirks) {\n>+        if (isQuirks || stylePos->mBoxSizing == NS_STYLE_BOX_SIZING_CONTENT) {\n>             boxSizingToBorderEdge = offsets.hPadding + offsets.hBorder;\n>         }\n>         else {\n[...]\n>+            // NS_STYLE_BOX_SIZING_BORDER\n>+            minCoord += offsets.hPadding + offsets.hBorder;\n>+            prefCoord += offsets.hPadding + offsets.hBorder;\n\nAdd \"(and standards-mode)\" to end of comment here.\n\n>+++ b/layout/tables/nsTableRowFrame.cpp\n>@@ -624,26 +624,18 @@ nsTableRowFrame::CalculateCellActualHeig\n>       if (PresContext()->CompatibilityMode() != eCompatibility_NavQuirks) {\n>-        switch (position->mBoxSizing) {\n>-          case NS_STYLE_BOX_SIZING_CONTENT:\n>+        if (position->mBoxSizing == NS_STYLE_BOX_SIZING_CONTENT) {\n>             outsideBoxSizing = aCellFrame->GetUsedBorderAndPadding().TopBottom();\n\nde-indent \"outsideBoxSizing\". (contextual code is 2-space indented)\n\n>+++ b/layout/xul/nsResizerFrame.cpp\n>-          switch (frameToResize->StylePosition()->mBoxSizing) {\n>-            case NS_STYLE_BOX_SIZING_CONTENT:\n>+          if (frameToResize->StylePosition()->mBoxSizing == NS_STYLE_BOX_SIZING_CONTENT) {\n>               rect.Deflate(frameToResize->GetUsedPadding());\n>-            case NS_STYLE_BOX_SIZING_PADDING:\n>-              rect.Deflate(frameToResize->GetUsedBorder());\n>-            default:\n>-              break;\n>           }\n\nDe-indent the \"Deflate\" line here.\n\nAlso, it looks like the old code had \"box-sizing:content\" fall through here -- so I think you really want to keep the second Deflate call. (And then they can be combined using the convenience method mentioned above -- so this should end up being \"rect.Deflate(frameToResize->GetUsedBorderAndPadding())\"", "author": "dholbert@mozilla.com", "id": 10308051, "time": "2015-05-26T03:31:18Z"}, {"text": "https://treeherder.mozilla.org/#/jobs?repo=try&revision=c2ac4181f47e", "author": "zentner.kyle@gmail.com", "id": 10309906, "time": "2015-05-26T15:03:37Z"}, {"text": "Created attachment 8610661\nRemoveBoxSizingPaddingBox\n\nThis version is what was tested in the most recent try run. I think I made all of the changes you suggested.", "author": "zentner.kyle@gmail.com", "id": 10310450, "time": "2015-05-26T16:59:31Z"}, {"text": "Comment on attachment 8610661\nRemoveBoxSizingPaddingBox\n\n>+++ b/layout/tables/BasicTableLayoutStrategy.cpp\n>@@ -108,35 +108,23 @@ GetWidthInfo(nsRenderingContext *aRender\n>-        if (isQuirks) {\n>-            boxSizingToBorderEdge = offsets.hPadding + offsets.hBorder;\n>+        if (isQuirks || stylePos->mBoxSizing == NS_STYLE_BOX_SIZING_CONTENT) {\n>+          boxSizingToBorderEdge = offsets.hPadding + offsets.hBorder;\n>         }\n>         else {\n>-            switch (stylePos->mBoxSizing) {\n[...]\n>-            }\n>+          // NS_STYLE_BOX_SIZING_BORDER and standards-mode\n>+          minCoord += offsets.hPadding + offsets.hBorder;\n>+          prefCoord += offsets.hPadding + offsets.hBorder;\n>         }\n\nThe contextual code here (in BasicTableLayoutStrategy) actually does use 4-space indentation, as shown by removed contextual code. :)\n\nSo, please match that & restore the indentation you had before for the new lines here. (add 2 spaces before boxSizingToBorderEdge, and the comment / minCoord / prefCoord.)\n\n>+++ b/layout/xul/nsResizerFrame.cpp\n>+          if (frameToResize->StylePosition()->mBoxSizing == NS_STYLE_BOX_SIZING_CONTENT) {\n>+            rect.Deflate(frameToResize->GetUsedPadding());\n>+            rect.Deflate(frameToResize->GetUsedBorder());\n\nPer final sentence of comment 14, these should collapse to use GetUsedBorderAndPadding().\n\nr=me with that. (I'd still like a followup / \"part 2\" patch to address the churny outside/inside calculation mentioned in comment 14, too.)\n\nThanks!", "author": "dholbert@mozilla.com", "id": 10310603, "time": "2015-05-26T17:24:33Z"}, {"text": "(In reply to Daniel Holbert [:dholbert] from comment #14)\n> (Also, observation: I think a lot of functions like this pass border &\n> padding separately *so that we can support* box-sizing: padding-box vs.\n> border-box.  Now that border/padding will always be added/subtracted as a\n> package, we might want to consider combining these args into aBorderPadding\n> in a lot of spots, so that we don't need to perform \"aBorder + aPadding\" all\n> over the place.)\n\n(I filed bug 1168478 on this, FWIW.)", "author": "dholbert@mozilla.com", "id": 10310710, "time": "2015-05-26T17:42:33Z"}, {"text": "https://treeherder.mozilla.org/#/jobs?repo=try&revision=31b5ac7a6f8a", "author": "zentner.kyle@gmail.com", "id": 10311362, "time": "2015-05-26T18:52:23Z"}, {"text": "Created attachment 8610857\nRemoveBoxSizingPaddingBox w/ feedback addressed\n\nI fixed the above, and the try run looks good. More extensive cleanup will be done in a later patch on the same bug, so this patch is ready for check in.", "author": "zentner.kyle@gmail.com", "id": 10312518, "time": "2015-05-26T22:34:23Z"}, {"text": "I'll be submitting a second patch to clean up some of the logic, but this patch is ready now.", "author": "zentner.kyle@gmail.com", "id": 10312540, "time": "2015-05-26T22:36:03Z"}, {"text": "Hi, this patch seems not to apply cleanly:\n\napplying RemoveBoxSizingPaddingBox\npatching file toolkit/themes/shared/in-content/info-pages.inc.css\nHunk #1 FAILED at 0\nHunk #2 FAILED at 80\n2 out of 2 hunks FAILED -- saving rejects to file toolkit/themes/shared/in-content/info-pages.inc.css.rej\npatch failed, unable to continue (try -v)\npatch failed, rejects left in working directory\nerrors during apply, please fix and refresh RemoveBoxSizingPaddingBox\n\ncan you take a look ?", "author": "cbook@mozilla.com", "id": 10314099, "time": "2015-05-27T07:44:15Z"}, {"text": "Created attachment 8611290\nUpdated RemoveBoxSizingPaddingBox w/ feedback addressed\n\nSorry about that. This version should apply cleanly. Only one of the context lines in the patch needed to be updated.", "author": "zentner.kyle@gmail.com", "id": 10315981, "time": "2015-05-27T16:57:53Z"}, {"text": "Comment on attachment 8611290\nUpdated RemoveBoxSizingPaddingBox w/ feedback addressed\n\nIn the future, the checkin-needed keyword is the preferred way of making this request. Plays more nicely with the various bug marking tools.", "author": "ryanvm@gmail.com", "id": 10321431, "time": "2015-05-28T14:07:19Z"}, {"text": "https://hg.mozilla.org/integration/mozilla-inbound/rev/dd96df1da2b5", "author": "pulsebot@bots.tld", "id": 10321466, "time": "2015-05-28T14:14:56Z"}, {"text": "Comment on attachment 8611290\nUpdated RemoveBoxSizingPaddingBox w/ feedback addressed\n\nBacked out for making test_bug320799.html permafail on Mulet.\nhttps://treeherder.mozilla.org/logviewer.html#?job_id=10224750&repo=mozilla-inbound\n\nhttps://hg.mozilla.org/integration/mozilla-inbound/rev/703ace2e0414", "author": "ryanvm@gmail.com", "id": 10321739, "time": "2015-05-28T15:01:55Z"}, {"text": "Failed on Android too.", "author": "ryanvm@gmail.com", "id": 10321886, "time": "2015-05-28T15:31:19Z"}, {"text": "https://treeherder.mozilla.org/#/jobs?repo=try&revision=1b688ec2d3f8", "author": "zentner.kyle@gmail.com", "id": 10322058, "time": "2015-05-28T16:00:20Z"}, {"text": "https://treeherder.mozilla.org/#/jobs?repo=try&revision=a82c8a3eff90", "author": "zentner.kyle@gmail.com", "id": 10324180, "time": "2015-05-28T22:34:29Z"}, {"text": "Given the result of the last test run, I think I've fixed everything.", "author": "zentner.kyle@gmail.com", "id": 10326265, "time": "2015-05-29T14:27:40Z"}, {"text": "https://hg.mozilla.org/integration/mozilla-inbound/rev/541cd29ea626", "author": "pulsebot@bots.tld", "id": 10326682, "time": "2015-05-29T15:54:54Z"}, {"text": "Created attachment 8612937\nRemoveBoxSizingPaddingBox\n\nSorry, I forgot to upload the new patch. That one will need to be backed out now. This patch is the one that passed the tests above.", "author": "zentner.kyle@gmail.com", "id": 10326802, "time": "2015-05-29T16:17:13Z"}, {"text": "(I can backout & reland in a few minutes; I've got something else to land anyway.)", "author": "dholbert@mozilla.com", "id": 10326825, "time": "2015-05-29T16:20:37Z"}, {"text": "(Er, never mind -- I believe RyanVM is already backing out some other stuff, so unless I hear otherwise from him I'll let him do the backout/reland here as part of that push. Thanks, Ryan!)", "author": "dholbert@mozilla.com", "id": 10327004, "time": "2015-05-29T16:59:04Z"}, {"text": "https://hg.mozilla.org/integration/mozilla-inbound/rev/236d4caad091 (backout)\nhttps://hg.mozilla.org/integration/mozilla-inbound/rev/4126c66c9a80", "author": "pulsebot@bots.tld", "id": 10327046, "time": "2015-05-29T17:07:50Z"}, {"text": "Backed out for Gaia sound_manager_test.js failures. Unfortunately, they were present in the last Try run too and we missed them :(\nhttps://treeherder.mozilla.org/logviewer.html#?job_id=10272944&repo=mozilla-inbound", "author": "ryanvm@gmail.com", "id": 10327583, "time": "2015-05-29T19:17:08Z"}, {"text": "Backout:\nhttps://hg.mozilla.org/integration/mozilla-inbound/rev/a62605b31838", "author": "pulsebot@bots.tld", "id": 10327622, "time": "2015-05-29T19:27:55Z"}, {"text": "What's the plan for background-clip: padding-box?\nhttps://developer.mozilla.org/en-US/docs/Web/CSS/background-clip", "author": "kohei.yoshino@gmail.com", "id": 10333174, "time": "2015-06-01T21:26:17Z"}, {"text": "That's not changing, as far as I'm aware.", "author": "dholbert@mozilla.com", "id": 10333191, "time": "2015-06-01T21:30:54Z"}, {"text": "I briefly worried that we might need to remove usages of this feature from Thunderbird/Seamonkey, but it looks like we're OK on that front -- they don't use \"box-sizing:padding-box\".  At least, this MXR search...\n  http://mxr.mozilla.org/comm-central/search?string=box-sizing\n...turns up no hits for \"padding-box\".", "author": "dholbert@mozilla.com", "id": 10437141, "time": "2015-06-30T19:31:48Z"}, {"text": "Posted the site compatibility doc: https://www.fxsitecompat.com/en-US/docs/2015/box-sizing-padding-box-will-be-removed/", "author": "kohei.yoshino@gmail.com", "id": 10879939, "time": "2015-10-28T03:08:03Z"}, {"text": "Firefox OS is moving to Tier 3 support[1], which means we don't have to gate this bug's change on fixing gaia content & tests anymore (which was filed as bug 1169839).\n\n(The gaia content & tests might already be mostly-fixed -- not sure how many of bug 1169839's pull requests were merged in.  But regardless, they don't need to hold back this platform change.)\n\nKyle, not sure how much time you've got for Mozilla stuff at this point -- but would you be up for getting this bug's patch unbitrotted & ready to be landable? Note that a large chunk of the patch here (~36 KB of this ~53 KB patch) already landed in bug 1169837.\n\nIf you don't have time, no worries -- I can also try to unbitrot this & shepherd it in.  I'd like to have this happen on the sooner side, since it looks like we're haven't been running tests for this feature (box-sizing:padding-box) for some time now, as of bug 1169837.\n\n[1] https://groups.google.com/forum/?fromgroups#!topic/mozilla.dev.platform/gF-kiJV21ro", "author": "dholbert@mozilla.com", "id": 11105282, "time": "2016-01-25T18:45:12Z"}, {"text": "Created attachment 8763059\nBug 1166728 - Remove support for \"box-sizing: padding-box\", per CSS WG resolution.\n\nReview commit: https://reviewboard.mozilla.org/r/59392/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/59392/", "author": "dholbert@mozilla.com", "id": 11486152, "time": "2016-06-16T11:09:50Z"}, {"text": "Comment on attachment 8763059\nBug 1166728 - Remove support for \"box-sizing: padding-box\", per CSS WG resolution.\n\nI've unbitrotted the latest patch here. Carrying forward r=me, but I should probably have a second pair of eyes look at this, to sanity-check my unbitrotting.  Tagging mats!\n\nFortunately, the final patch is significantly smaller than the previous patch here, since the majority of the previous patch (fixing *usages* of box-sizing:padding-box in tests/frontend code) was landed independently in bug 1169837.  So, this patch just has the unbitrotted c++ code-changes from the most recent patch here, as well as the insertion of \"padding-box\" into the list of invalid_values in property_database.js, to test that support has really been removed.\n\nThis leaves us with only 3 usages of \"box-sizing.*padding-box\" in the tree, all of which are in tests that were added since bug 1166728 landed. I'll post a trivial followup patch to address those, separate from the main patch here.", "author": "dholbert@mozilla.com", "id": 11486165, "time": "2016-06-16T11:21:06Z"}, {"text": "(The only non-obvious change in this patch, IMO, is in BasicTableLayoutStrategy.cpp.  That chunk has us doing stuff for both box-sizing:content-box as well as box-sizing:border-box, and it turns out one of those clauses exactly matches another clause directly above, so the patch just merges those clauses to share code.\n\nI'm also happy to undo that merging, though, if you prefer.)", "author": "dholbert@mozilla.com", "id": 11486170, "time": "2016-06-16T11:22:41Z"}, {"text": "Comment on attachment 8763059\nBug 1166728 - Remove support for \"box-sizing: padding-box\", per CSS WG resolution.\n\nhttps://reviewboard.mozilla.org/r/59392/#review56644\n\n::: layout/base/nsLayoutUtils.cpp:5452\n(Diff revision 1)\n>    const bool isAutoISize = inlineStyleCoord->GetUnit() == eStyleUnit_Auto;\n>    bool isAutoBSize = IsAutoBSize(*blockStyleCoord, aCBSize.BSize(aWM));\n>  \n>    LogicalSize boxSizingAdjust(aWM);\n> -  switch (stylePos->mBoxSizing) {\n> -    case StyleBoxSizing::Border:\n> +  if (stylePos->mBoxSizing == StyleBoxSizing::Border) {\n> +    boxSizingAdjust += aBorder + aPadding;\n\nnit: just a plain assignment might be clearer now\n\n::: layout/generic/nsFrame.cpp:4657\n(Diff revision 1)\n>                                         aFlags & ComputeSizeFlags::eShrinkWrap);\n>    LogicalSize boxSizingAdjust(aWM);\n>    const nsStylePosition *stylePos = StylePosition();\n>  \n> -  switch (stylePos->mBoxSizing) {\n> -    case StyleBoxSizing::Border:\n> +  if (stylePos->mBoxSizing == StyleBoxSizing::Border) {\n> +    boxSizingAdjust += aBorder + aPadding;\n\nnit: same here, if you move the boxSizingAdjust declaration just before the if-statement.\n\n::: layout/generic/nsHTMLReflowState.cpp:1169\n(Diff revision 1)\n>    }\n>  \n>    nscoord outside = paddingStartEnd + borderStartEnd + marginStartEnd;\n>    nscoord inside = 0;\n> -  switch (mStylePosition->mBoxSizing) {\n> -    case StyleBoxSizing::Border:\n> +  if (mStylePosition->mBoxSizing == StyleBoxSizing::Border) {\n> +    inside += borderStartEnd + paddingStartEnd;\n\nnit: I'd use a plain assignment here too\n\n::: layout/style/nsComputedDOMStyle.cpp:546\n(Diff revision 1)\n>    // which can be different depending on the value of the 'box-sizing' property.\n>    const nsStylePosition* stylePos = StylePosition();\n>  \n>    nsMargin adjustment;\n> -  switch(stylePos->mBoxSizing) {\n> -    case StyleBoxSizing::Border:\n> +  if (stylePos->mBoxSizing == StyleBoxSizing::Border) {\n> +    adjustment += mInnerFrame->GetUsedBorder() + mInnerFrame->GetUsedPadding();\n\n... and here.  Also, I'd prefer mInnerFrame->GetUsedBorderAndPadding()\n\n::: layout/tables/FixedTableLayoutStrategy.cpp:261\n(Diff revision 1)\n>            float pct = styleISize->GetPercentValue();\n>            colISize = NSToCoordFloor(pct * float(tableISize));\n>  \n>            nscoord boxSizingAdjust = 0;\n> -          switch (cellFrame->StylePosition()->mBoxSizing) {\n> -            case StyleBoxSizing::Content:\n> +          if (cellFrame->StylePosition()->mBoxSizing == StyleBoxSizing::Content) {\n> +            boxSizingAdjust += offsets.hPadding + offsets.hBorder;\n\nnit: in this case I think we should just increment 'colISize' directly\nand remove the 'boxSizingAdjust' variable.  Also, the 'offsets' variable\ncan be moved inside the if-statement.\n\n::: layout/tables/nsTableRowFrame.cpp:671\n(Diff revision 1)\n>        if (PresContext()->CompatibilityMode() != eCompatibility_NavQuirks) {\n> -        switch (position->mBoxSizing) {\n> +        if (position->mBoxSizing == StyleBoxSizing::Content) {\n\nnit: I'd prefer one if-statement using &&.\nAlso, I think 'outsideBoxSizing' is unnecessary; just assign 'specifiedBSize' before the 'if' and then increment it inside.", "author": "mats@mozilla.com", "id": 11488526, "time": "2016-06-18T11:11:17Z"}, {"text": "Comment on attachment 8763059\nBug 1166728 - Remove support for \"box-sizing: padding-box\", per CSS WG resolution.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/59392/diff/1-2/", "author": "dholbert@mozilla.com", "id": 11488748, "time": "2016-06-18T18:46:24Z"}, {"text": "All good points, thanks!  I addressed all of that feedback.\n\nI made one additional change -- I swapped out the cellFrame->StylePosition() call in FixedTableLayoutStrategy.cpp, to share a local variable with another cellFrame->StylePosition() call a bit further up.\n\nTry run: https://treeherder.mozilla.org/#/jobs?repo=try&revision=9cb483e19aa4", "author": "dholbert@mozilla.com", "id": 11488750, "time": "2016-06-18T18:51:35Z"}, {"text": "Pushed by dholbert@mozilla.com:\nhttps://hg.mozilla.org/integration/mozilla-inbound/rev/ea578e2813f4\nRemove support for \"box-sizing: padding-box\", per CSS WG resolution. r=dholbert r=mats", "author": "pulsebot@bots.tld", "id": 11488805, "time": "2016-06-18T22:05:40Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/ea578e2813f4", "author": "cbook@mozilla.com", "id": 11489856, "time": "2016-06-20T11:57:56Z"}, {"text": "Posted the site compatibility doc: https://www.fxsitecompat.com/en-CA/docs/2016/box-sizing-padding-box-has-been-removed/", "author": "kohei.yoshino@gmail.com", "id": 11489902, "time": "2016-06-20T12:20:20Z"}, {"text": "Updated compat tables in:\nhttps://developer.mozilla.org/en-US/docs/Web/CSS/box-sizing\nand\nhttps://developer.mozilla.org/en-US/Firefox/Releases/50#CSS", "author": "jypenator@gmail.com", "id": 11551030, "time": "2016-07-15T14:40:34Z"}], "cf_last_resolved": "2016-06-20T11:57:56Z", "priority": "--", "mentors_detail": [], "cf_crash_signature": "", "version": "Trunk", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox59": "---", "last_change_time": "2016-07-15T14:40:34Z", "cf_platform_rel": "---", "product": "Core", "cf_status_firefox_esr52": "---", "blocks": [1168478, 1170318], "qa_contact": "", "see_also": ["https://bugzilla.mozilla.org/show_bug.cgi?id=1178168"], "cf_fx_iteration": "---", "component": "CSS Parsing and Computation", "votes": 0, "groups": [], "cf_status_firefox60": "---", "cf_status_firefox41": "affected", "target_milestone": "mozilla50", "is_cc_accessible": true, "cf_status_thunderbird_esr52": "---", "url": "", "creator_detail": {"email": "dbaron@dbaron.org", "id": 3881, "name": "dbaron@dbaron.org", "real_name": "David Baron :dbaron: \u231a\ufe0fUTC-8"}, "whiteboard": "", "mentors": [], "cc_detail": [{"email": "bzbarsky@mit.edu", "id": 20209, "name": "bzbarsky@mit.edu", "real_name": "Boris Zbarsky [:bz] (no decent commit message means r-)"}, {"email": "cbook@mozilla.com", "id": 277293, "name": "cbook@mozilla.com", "real_name": "Carsten Book [:Tomcat]"}, {"email": "dholbert@mozilla.com", "id": 278074, "name": "dholbert@mozilla.com", "real_name": "Daniel Holbert [:dholbert]"}, {"email": "florian@queze.net", "id": 149052, "name": "florian@queze.net", "real_name": "Florian Qu\u00e8ze [:florian]"}, {"email": "jorge@mozilla.com", "id": 189742, "name": "jorge@mozilla.com", "real_name": "Jorge Villalobos [:jorgev]"}, {"email": "jypenator@gmail.com", "id": 248150, "name": "jypenator@gmail.com", "real_name": "Jean-Yves Perrier [:teoli]"}, {"email": "kohei.yoshino@gmail.com", "id": 232883, "name": "kohei.yoshino@gmail.com", "real_name": "Kohei Yoshino [:kohei]"}, {"email": "mats@mozilla.com", "id": 5168, "name": "mats@mozilla.com", "real_name": "Mats Palmgren (:mats)"}, {"email": "percyley@qq.com", "id": 543470, "name": "percyley@qq.com", "real_name": ""}, {"email": "zentner.kyle@gmail.com", "id": 539400, "name": "zentner.kyle@gmail.com", "real_name": "Kyle Zentner"}], "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "cf_tracking_firefox58": "---", "cf_rank": null, "is_open": false, "history": [{"changes": [{"removed": "", "field_name": "cc", "added": "bzbarsky@mit.edu"}], "who": "bzbarsky@mit.edu", "when": "2015-05-20T15:53:53Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "dholbert@mozilla.com"}], "who": "dholbert@mozilla.com", "when": "2015-05-20T16:25:14Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "kzentner@mozilla.com"}], "who": "dholbert@mozilla.com", "when": "2015-05-20T16:25:25Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "dev-doc-needed"}, {"removed": "", "field_name": "cc", "added": "jypenator@gmail.com"}], "who": "jypenator@gmail.com", "when": "2015-05-20T19:08:12Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "florian@queze.net"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(florian@queze.net)"}], "who": "dholbert@mozilla.com", "when": "2015-05-21T00:09:49Z"}, {"changes": [{"removed": "needinfo?(florian@queze.net)", "field_name": "flagtypes.name", "added": ""}], "who": "florian@queze.net", "when": "2015-05-21T13:02:12Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "ASSIGNED"}, {"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "kzentner@mozilla.com"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8609071, "added": "review?(dholbert@mozilla.com)"}], "who": "zentner.kyle@gmail.com", "when": "2015-05-21T22:58:56Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8609071, "added": "1"}, {"field_name": "flagtypes.name", "removed": "review?(dholbert@mozilla.com)", "attachment_id": 8609071, "added": ""}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8610661, "added": "review?(dholbert@mozilla.com)"}], "who": "zentner.kyle@gmail.com", "when": "2015-05-26T16:59:31Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(dholbert@mozilla.com)", "attachment_id": 8610661, "added": "review+"}], "who": "dholbert@mozilla.com", "when": "2015-05-26T17:24:33Z"}, {"changes": [{"removed": "", "field_name": "blocks", "added": "1168478"}], "who": "dholbert@mozilla.com", "when": "2015-05-26T17:33:59Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8610661, "added": "1"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8610857, "added": "review+, checkin?"}], "who": "zentner.kyle@gmail.com", "when": "2015-05-26T22:34:23Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "checkin-needed, leave-open"}], "who": "zentner.kyle@gmail.com", "when": "2015-05-26T22:36:03Z"}, {"changes": [{"removed": "checkin-needed", "field_name": "keywords", "added": ""}, {"removed": "", "field_name": "cc", "added": "cbook@mozilla.com"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(kzentner@mozilla.com)"}], "who": "cbook@mozilla.com", "when": "2015-05-27T07:44:15Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "checkin?", "attachment_id": 8610857, "added": ""}], "who": "ryanvm@gmail.com", "when": "2015-05-27T12:12:29Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8610857, "added": "1"}, {"removed": "needinfo?(kzentner@mozilla.com)", "field_name": "flagtypes.name", "added": ""}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8611290, "added": "review+, checkin?"}], "who": "zentner.kyle@gmail.com", "when": "2015-05-27T16:57:53Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "checkin?", "attachment_id": 8611290, "added": "checkin+"}], "who": "ryanvm@gmail.com", "when": "2015-05-28T14:07:19Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "checkin+", "attachment_id": 8611290, "added": "checkin-"}], "who": "ryanvm@gmail.com", "when": "2015-05-28T15:01:55Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "checkin-needed"}], "who": "zentner.kyle@gmail.com", "when": "2015-05-29T14:27:40Z"}, {"changes": [{"removed": "checkin-needed", "field_name": "keywords", "added": ""}], "who": "pulsebot@bots.tld", "when": "2015-05-29T15:54:54Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8611290, "added": "1"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8612937, "added": "review+, checkin?"}], "who": "zentner.kyle@gmail.com", "when": "2015-05-29T16:17:13Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "checkin?", "attachment_id": 8612937, "added": ""}], "who": "ryanvm@gmail.com", "when": "2015-05-29T19:24:27Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1169839"}], "who": "zentner.kyle@gmail.com", "when": "2015-05-29T22:34:22Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1169837"}], "who": "zentner.kyle@gmail.com", "when": "2015-05-29T22:34:43Z"}, {"changes": [{"removed": "", "field_name": "blocks", "added": "1170318"}], "who": "dholbert@mozilla.com", "when": "2015-06-01T21:14:50Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "site-compat"}, {"removed": "", "field_name": "cc", "added": "kohei.yoshino@gmail.com"}], "who": "kohei.yoshino@gmail.com", "when": "2015-06-01T21:18:14Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "addon-compat"}], "who": "kohei.yoshino@gmail.com", "when": "2015-06-01T21:26:17Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "jorge@mozilla.com"}], "who": "jorge@mozilla.com", "when": "2015-06-01T21:30:24Z"}, {"changes": [{"removed": "", "field_name": "see_also", "added": "https://bugzilla.mozilla.org/show_bug.cgi?id=1178168"}], "who": "dholbert@mozilla.com", "when": "2015-06-29T06:02:43Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(zentner.kyle@gmail.com)"}], "who": "dholbert@mozilla.com", "when": "2016-01-25T18:45:12Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(dholbert@mozilla.com)"}], "who": "dholbert@mozilla.com", "when": "2016-01-25T18:45:55Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "percyley@qq.com"}], "who": "percyley@qq.com", "when": "2016-03-10T03:16:03Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8763059, "added": "review?(dholbert@mozilla.com), review?(mats@mozilla.com)"}, {"removed": "", "field_name": "cc", "added": "mats@mozilla.com"}], "who": "dholbert@mozilla.com", "when": "2016-06-16T11:09:50Z"}, {"changes": [{"removed": "needinfo?(zentner.kyle@gmail.com), needinfo?(dholbert@mozilla.com)", "field_name": "flagtypes.name", "added": ""}, {"field_name": "flagtypes.name", "removed": "review?(dholbert@mozilla.com)", "attachment_id": 8763059, "added": "review+"}], "who": "dholbert@mozilla.com", "when": "2016-06-16T11:21:06Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1280422"}], "who": "dholbert@mozilla.com", "when": "2016-06-16T11:37:50Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(mats@mozilla.com)", "attachment_id": 8763059, "added": "review+"}], "who": "mats@mozilla.com", "when": "2016-06-18T11:11:17Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review+", "attachment_id": 8763059, "added": "review?(dholbert@mozilla.com)"}], "who": "dholbert@mozilla.com", "when": "2016-06-18T18:46:24Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(dholbert@mozilla.com)", "attachment_id": 8763059, "added": "review+"}], "who": "dholbert@mozilla.com", "when": "2016-06-18T18:48:29Z"}, {"changes": [{"removed": "leave-open", "field_name": "keywords", "added": ""}], "who": "dholbert@mozilla.com", "when": "2016-06-20T08:30:42Z"}, {"changes": [{"removed": "ASSIGNED", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla50"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2016-06-20 11:57:56"}, {"removed": "---", "field_name": "cf_status_firefox50", "added": "fixed"}], "who": "cbook@mozilla.com", "when": "2016-06-20T11:57:56Z"}, {"changes": [{"removed": "dev-doc-needed", "field_name": "keywords", "added": "dev-doc-complete"}], "who": "jypenator@gmail.com", "when": "2016-07-15T14:40:34Z"}], "resolution": "FIXED", "op_sys": "Unspecified", "cf_fx_points": "---", "cf_blocking_fennec": "---"}