{"status": "REOPENED", "cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "classification": "Client Software", "creator": "jean-sebastien.frenette@stm.info", "cc": ["francesco.lodolo@gmail.com", "gandalf@aviary.pl", "gijskruitbosch+bugs@gmail.com", "gingerbread_man@live.com", "jean-sebastien.frenette@stm.info", "mozilla@kaply.com", "myk@mykzilla.org"], "depends_on": [], "creation_time": "2018-06-05T12:46:47Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "keywords": [], "summary": "inability to set some default localized preferences", "cf_last_resolved": "2018-06-05T20:40:00Z", "attachments": [{"creator": "jean-sebastien.frenette@stm.info", "is_obsolete": 0, "is_patch": 0, "flags": [], "content_type": "image/png", "id": 8983723}, {"creator": "jean-sebastien.frenette@stm.info", "is_obsolete": 0, "is_patch": 0, "flags": [], "content_type": "image/png", "id": 8983725}, {"creator": "jean-sebastien.frenette@stm.info", "is_obsolete": 0, "is_patch": 0, "flags": [], "content_type": "image/png", "id": 8983726}, {"creator": "jean-sebastien.frenette@stm.info", "is_obsolete": 0, "is_patch": 0, "flags": [], "content_type": "image/png", "id": 8983728}, {"creator": "jean-sebastien.frenette@stm.info", "is_obsolete": 0, "is_patch": 0, "flags": [], "content_type": "application/x-zip-compressed", "id": 8983884}], "assigned_to_detail": {"email": "mozilla@kaply.com", "id": 7313, "name": "mozilla@kaply.com", "real_name": "Mike Kaply [:mkaply]"}, "severity": "normal", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 22, "comments": [{"text": "User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:60.0) Gecko/20100101 Firefox/60.0\nBuild ID: 20180516032417\n\nSteps to reproduce:\n\nCreate a .cfg file with the following content:\n  \"preferences\": {\n\"intl.accept_languages\": {\n      \"value\": \"fr-ca,fr,fr-fr,en-us,en\"\n    }\n}\n\n(created with CCK2)\n\n\nActual results:\n\nWhen going into the options, the language pane is empty. If I try to add a language, nothing happen and the value isn't change.\n\nAlso, when visiting a website, it doesn't send the values and instead send only english. If I open about:config, the value is there. If I change it at this place and add another language, the UI work again and the values are sent.\n\n\nExpected results:\n\nUI should show the correct language and send them in the header like it used to in 52.4 ESR.", "author": "jean-sebastien.frenette@stm.info", "id": 13387800, "time": "2018-06-05T12:46:47Z"}, {"text": "(In reply to jean-sebastien.frenette from comment #0)\n> When going into the options, the language pane is empty. If I try to add a\n> language, nothing happen and the value isn't change.\n\nDo you mean the Language section of about:preferences#general? Are you adding languages in the configuration file and the changes aren't reflected there after restarting?\nOr do you mean the Language category of the Add-ons Manager? The latter only lists language packs for the user interface [1].\n\nAlso, what's your Firefox locale (the language of the user interface)?\n\n> Also, when visiting a website, it doesn't send the values and instead send\n> only english.\n\nYou verified this using the Browser Console request headers?\n\n[1] https://addons.mozilla.org/firefox/language-tools/\n[2] https://developer.mozilla.org/docs/Tools/Browser_Console", "author": "gingerbread_man@live.com", "id": 13387981, "time": "2018-06-05T13:55:00Z"}, {"text": "Hello,\n\nI'm talking about Options ==> General ==> Select language preference for pages ==> Select. This GUI is blank when something is set through a configuration file (like mozilla.cfg). You must reset user preference for this to happen (if the user have preference, it won't work).\n\nMy Firefox Local is French, but pages like www.google.ca get showed in english, while my Windows is also in French. When using Firefox 52.4 ESR using the same configuration, the page are in french.\n\nIn the console, I see en-US when checking google.ca in incognito mode (so my logins doesn't affect) while it's in french in old version. We also have intranet website that show in english or just doesn't work because we use french language and now, they received bad header.\n\nIf I remove the configuration from the config file, the GUI work properly and our internal web page work.", "author": "jean-sebastien.frenette@stm.info", "id": 13388030, "time": "2018-06-05T14:04:45Z"}, {"text": "This isn't policy specific, but I'm taking it.\n\nYou can recreate it with an autoConfig like this:\n\ndefaultPref(\"intl.accept_languages\", \"fr-ca,fr,fr-fr,en-us,en\");\n\nIt only happens if it is a default pref not a user preference.", "author": "mozilla@kaply.com", "id": 13389021, "time": "2018-06-05T19:35:13Z"}, {"text": "I remember why now. intl.accept_languages is a localized preference.\n\nThat means you have to set the value like this:\n\ndata:text/plain,intl.accept_languages=fr-ca,fr,fr-fr,en-us,en\n\nSee:\n\nhttps://mike.kaply.com/2012/08/29/setting-the-default-firefox-homepage-with-autoconfig/\n\nBut this is a regression from the preferences XBL binding rewrite, because you used to be able to just set the value and it worked.", "author": "mozilla@kaply.com", "id": 13389039, "time": "2018-06-05T19:42:22Z"}, {"text": "I just tested Firefox 52 ESR and it has the same behavior, so I'm going to close this.\n\nYou have two choices in the CCK2:\n\n1. Use the data:text/plain idea.\n2. Set it as a user preference instead of a default preference.\n\nI'll probably add this preference as a policy as well.", "author": "mozilla@kaply.com", "id": 13389165, "time": "2018-06-05T20:40:00Z"}, {"text": "@mkaply: If 52 ESR exhibits the same behavior, then it isn't a regression from bug 1379338 after all, right?", "author": "myk@mykzilla.org", "id": 13389253, "time": "2018-06-05T21:15:28Z"}, {"text": "Correct. Forgot to remove the block. Sorry for the churn.", "author": "mozilla@kaply.com", "id": 13389257, "time": "2018-06-05T21:16:33Z"}, {"text": "Hello, you say that the same behavior happen with 52.4 ESR, but I can't reproduce with 52.4 ESR. Brand new installation, everything work like it should with the exact same configuration file.\n\nI don't want it as a user pref because it get reset each close, which is something I don't want. If I could I would attach some file but I don't see the option. Don't forget you need to clear your user profile to see the default pref applied.\n\nRight now, I have a Windows 10 Ent 1709 FR open with a brand new installation of Firefox 52.4 ESR Fr. In it, the exact same configuration file. I go into Options ==> Content ==> Languages ==> Select and the GUI show me all 5 languages. When I go to google.ca or an intranet website, I get the french webpage. I don't see why you say it's the same behavior as 52 since I don't have the problem with 52.\n\nThank you", "author": "jean-sebastien.frenette@stm.info", "id": 13390603, "time": "2018-06-06T11:01:23Z"}, {"text": "Created attachment 8983723\n52.4ESR-1.png\n\nConfiguration file, Languages selection GUI and Firefox about. This all work properly in firefox 52.4 ESR", "author": "jean-sebastien.frenette@stm.info", "id": 13390607, "time": "2018-06-06T11:03:48Z"}, {"text": "Created attachment 8983725\n52.4ESR-2.png\n\nGoogle.ca loaded in french by itself", "author": "jean-sebastien.frenette@stm.info", "id": 13390612, "time": "2018-06-06T11:05:34Z"}, {"text": "Created attachment 8983726\n60.0.1ESR-1.png\n\n60.0.1 ESR 64-bits with configuration file, GUI showing blank, about window", "author": "jean-sebastien.frenette@stm.info", "id": 13390621, "time": "2018-06-06T11:09:04Z"}, {"text": "Created attachment 8983728\n60.0.1ESR-2.png\n\ngoogle.ca loaded in english canada instead of french", "author": "jean-sebastien.frenette@stm.info", "id": 13390623, "time": "2018-06-06T11:09:32Z"}, {"text": "When you go to about:config in Firefox 60, what is the intl.accept_languages value set to?\n\nI have code in the CCK2 that should set it to the value:\n\ndata:text/plain,intl.accept_languages=fr-ca,fr,fr-fr,en-us,en\n\nWhich works.\n\nBut in the screenshots you posted to the list, it is just set to:\n\nfr-ca,fr,fr-fr,en-us,en (as a default preference).", "author": "mozilla@kaply.com", "id": 13390918, "time": "2018-06-06T13:32:07Z"}, {"text": "It is set to fr-\u00c7a, fr, fr-fr, en-us, en in about:config. If I modify the value to remove or add a language in about config, the Gui work back and the header get sent properly. Thus Google will now give me French web page. Funny thing, I made a different default without fr, it gave me the same bug. I added back with about config fr, it now show me the whole list properly unless I reset to default since it's now in the user pref.\n\nIll be able to take screenshot tomorrow, I'm out of office.", "author": "jean-sebastien.frenette@stm.info", "id": 13390933, "time": "2018-06-06T13:36:28Z"}, {"text": "Ok, just checked about:config and I see what you mean. With the same config file, I have different result. In 60.0.1, it's \n\nfr-ca,fr,fr-fr,en-us,en\n\nIn 52.4, it's \"data:text/plain,intl.accept_languages=fr-ca,fr,fr-fr,en-us,en\".\n\nBut what's weird. In firefox 60, if I modify the value in about config (like, for instance, removing fr so it's now \"fr-ca,fr,fr-fr,en-us,en\"), the value is properly parsed by the GUI and it's working properly. Samething with 52.4, if I do a change in the GUI, the \"data:text/plain,intl.accept_languages=\" part is removed.\n\nBut the config file work without the \"data:text/plain..\" part in 52.4.\n\nThank you", "author": "jean-sebastien.frenette@stm.info", "id": 13391652, "time": "2018-06-06T17:16:35Z"}, {"text": "The data:text/plain part is only needed if it is a default preference. Once it is modified (bold in about:config), it's read differently, so it doesn't need that.\n\nAs far as working without data:text/plain in 52.4, that wasn't my experience when I set the preference via autoconfig directly (versus using CCK2). And again, the CCK2 has code that always adds the data:text/plain for this preference if it is default:\n\nhttps://github.com/mkaply/cck2wizard/blob/b7537afe28df546225de27f3cea8c34642b3caff/cck2/modules/CCK2.jsm#L226\n\nSo the real question is why the CCK2 isn't adding the data:text/plain in Firefox 60 for you. In my testing it was.", "author": "mozilla@kaply.com", "id": 13391692, "time": "2018-06-06T17:29:09Z"}, {"text": "Thats weird because I generated a new CCK2 configuration with the latest version of CCK2, but using 52.4 since it's unsuported by 60.0. Could it be because I repackaged the firefox installation like it's stated on the wiki to do?", "author": "jean-sebastien.frenette@stm.info", "id": 13391697, "time": "2018-06-06T17:31:23Z"}, {"text": "Created attachment 8983884\ncck2.zip\n\nHere's the config file I'm using", "author": "jean-sebastien.frenette@stm.info", "id": 13391701, "time": "2018-06-06T17:33:22Z"}, {"text": "This doesn't look like something that we need to track as part of Firefox's internal preferences work, only as cck2/enterprise-policies stuff.", "author": "gijskruitbosch+bugs@gmail.com", "id": 13393810, "time": "2018-06-07T14:51:46Z"}, {"text": "Isn't the cck2.cfg a simple autoconfig file?", "author": "jean-sebastien.frenette@stm.info", "id": 13393900, "time": "2018-06-07T15:08:50Z"}, {"text": "> Isn't the cck2.cfg a simple autoconfig file?\n\nNo, it's more complex than that. I'm still investigating.", "author": "mozilla@kaply.com", "id": 13393915, "time": "2018-06-07T15:12:33Z"}], "id": 1466829, "priority": "--", "mentors_detail": [], "cf_crash_signature": "", "version": "60 Branch", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox62": "---", "cf_platform_rel": "---", "product": "Firefox", "cf_status_firefox_esr52": "---", "blocks": [], "qa_contact": "", "see_also": [], "cf_fx_iteration": "---", "component": "Enterprise Policies", "votes": 1, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "---", "cf_status_firefox61": "---", "cf_status_firefox60": "---", "target_milestone": "---", "is_cc_accessible": true, "cf_rank": null, "groups": [], "url": "", "creator_detail": {"email": "jean-sebastien.frenette@stm.info", "id": 618853, "name": "jean-sebastien.frenette@stm.info", "real_name": ""}, "whiteboard": "", "mentors": [], "cc_detail": [{"email": "francesco.lodolo@gmail.com", "id": 130462, "name": "francesco.lodolo@gmail.com", "real_name": "Francesco Lodolo [:flod]"}, {"email": "gandalf@aviary.pl", "id": 41270, "name": "gandalf@aviary.pl", "real_name": "Zibi Braniecki [:gandalf][:zibi]"}, {"email": "gijskruitbosch+bugs@gmail.com", "id": 159069, "name": "gijskruitbosch+bugs@gmail.com", "real_name": ":Gijs (he/him)"}, {"email": "gingerbread_man@live.com", "id": 353206, "name": "gingerbread_man@live.com", "real_name": "Gingerbread Man"}, {"email": "jean-sebastien.frenette@stm.info", "id": 618853, "name": "jean-sebastien.frenette@stm.info", "real_name": ""}, {"email": "mozilla@kaply.com", "id": 7313, "name": "mozilla@kaply.com", "real_name": "Mike Kaply [:mkaply]"}, {"email": "myk@mykzilla.org", "id": 27300, "name": "myk@mykzilla.org", "real_name": "Myk Melez [:myk] [@mykmelez]"}], "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "last_change_time": "2018-06-07T15:12:33Z", "cf_status_firefox_esr60": "---", "assigned_to": "mozilla@kaply.com", "is_open": true, "resolution": "", "op_sys": "Unspecified", "cf_fx_points": "---", "history": [{"changes": [{"removed": "", "field_name": "cc", "added": "jean-sebastien.frenette@stm.info"}], "who": "jean-sebastien.frenette@stm.info", "when": "2018-06-05T12:47:10Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "gingerbread_man@live.com, mozilla@kaply.com"}, {"removed": "Untriaged", "field_name": "component", "added": "Enterprise Policies"}], "who": "gingerbread_man@live.com", "when": "2018-06-05T13:55:00Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "francesco.lodolo@gmail.com, gandalf@aviary.pl"}], "who": "francesco.lodolo@gmail.com", "when": "2018-06-05T14:02:23Z"}, {"changes": [{"removed": "UNCONFIRMED", "field_name": "status", "added": "ASSIGNED"}, {"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "mozilla@kaply.com"}, {"removed": "0", "field_name": "is_confirmed", "added": "1"}], "who": "mozilla@kaply.com", "when": "2018-06-05T19:35:13Z"}, {"changes": [{"removed": "Enterprise Policies", "field_name": "component", "added": "Preferences"}, {"removed": "", "field_name": "blocks", "added": "1379338"}, {"removed": "intl.accept_languages not working in FF 60 ESR", "field_name": "summary", "added": "scriptifying preferences XBL broke the ability to set some default localized preferences"}], "who": "mozilla@kaply.com", "when": "2018-06-05T19:42:22Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "myk@mykzilla.org"}], "who": "myk@mykzilla.org", "when": "2018-06-05T20:32:47Z"}, {"changes": [{"removed": "ASSIGNED", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "WONTFIX"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2018-06-05 20:40:00"}], "who": "mozilla@kaply.com", "when": "2018-06-05T20:40:00Z"}, {"changes": [{"removed": "1379338", "field_name": "blocks", "added": ""}], "who": "mozilla@kaply.com", "when": "2018-06-05T21:16:33Z"}, {"changes": [{"removed": "scriptifying preferences XBL broke the ability to set some default localized preferences", "field_name": "summary", "added": "inability to set some default localized preferences"}], "who": "myk@mykzilla.org", "when": "2018-06-05T22:03:19Z"}, {"changes": [{"removed": "RESOLVED", "field_name": "status", "added": "REOPENED"}, {"removed": "WONTFIX", "field_name": "resolution", "added": ""}], "who": "jean-sebastien.frenette@stm.info", "when": "2018-06-06T11:01:23Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "gijskruitbosch+bugs@gmail.com"}, {"removed": "Preferences", "field_name": "component", "added": "Enterprise Policies"}], "who": "gijskruitbosch+bugs@gmail.com", "when": "2018-06-07T14:51:46Z"}]}