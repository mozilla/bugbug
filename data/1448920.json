{"status": "RESOLVED", "cf_tracking_firefox60": "-", "cf_tracking_firefox61": "-", "classification": "Client Software", "creator": "ciprian.georgiu@softvision.ro", "cc": ["dothayer@mozilla.com", "gijskruitbosch+bugs@gmail.com", "jcristau@mozilla.com", "mak77@bonardo.net", "MattN+bmo@mozilla.com", "ryanvm@gmail.com"], "depends_on": [], "creation_time": "2018-03-26T16:00:38Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "All", "cf_status_firefox59": "wontfix", "keywords": [], "summary": "Browsing History item is not displayed anymore in the Import Wizard on the recent Insider Preview builds from Edge", "id": 1448920, "attachments": [{"creator": "gijskruitbosch+bugs@gmail.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-04-19T09:31:01Z", "type_id": 748, "creation_date": "2018-04-18T16:52:59Z", "id": 1745729, "setter": "mak77@bonardo.net"}], "content_type": "text/x-review-board-request", "id": 8968962}], "assigned_to_detail": {"email": "gijskruitbosch+bugs@gmail.com", "id": 159069, "name": "gijskruitbosch+bugs@gmail.com", "real_name": ":Gijs (he/him)"}, "severity": "normal", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 13, "comments": [{"text": "[Affected versions]:\n- latest Nightly 61.0a1\n- Beta 60.0b6\n- Release 59.0.2\n- esr 52.7.3   \n\n[Affected platforms]:\n- Windows 10 x64 and x86 Version 1803 (OS Build 17128.1)\n\n[Preconditions]:\n- Edge is installed and closed\n- browsing history\n- saved favorites\n- saved pages to reading list\n- saved passwords\n\n[Steps to reproduce]:\n1. Launch Firefox on a clean profile with firefox -no-remote -migration parameter.\n2. From the Import Wizard choose Microsoft Edge and click Next.\n\n[Expected result]:\n- The Browsing History item is not displayed in the Import Wizard, therefore the history is not imported\n\n[Actual result]:\n- Only the following items are imported: Cookies, Saved Passwords, Favorites\n\n[Regression range]:\n- Not a regression, I was able to reproduce it on 50.0b4 as well.\n\n[Additional notes]:\n- note that on esr 52.7.3 the Import Wizard migrates only Cookies and Favorites, please let me know if I should file a separate bug for this\n- not reproducible on the current release version of Windows 10, Version 1709 (OS Build 16299.309)", "author": "ciprian.georgiu@softvision.ro", "id": 13156114, "time": "2018-03-26T16:00:38Z"}, {"text": "(In reply to Ciprian Georgiu, QA [:ciprian_georgiu] from comment #0)\n...\n> [Expected result]:\n> - The Browsing History item is not displayed in the Import Wizard, therefore\n> the history is not imported\n\nI have to make a correction here, as this is the current behavior, alongside with the one already written.\n\nThe right [Expected result]: Browsing History is displayed in the Import Wizard and the history is properly imported from Edge", "author": "ciprian.georgiu@softvision.ro", "id": 13156709, "time": "2018-03-26T19:01:52Z"}, {"text": "Hi Gijs, Microsoft is expected to start rolling out the Spring Creators Update this week. Have you had a chance to look at this more?", "author": "ryanvm@gmail.com", "id": 13195972, "time": "2018-04-10T19:55:04Z"}, {"text": "(In reply to Ryan VanderMeulen [:RyanVM] from comment #2)\n> Hi Gijs, Microsoft is expected to start rolling out the Spring Creators\n> Update this week. Have you had a chance to look at this more?\n\nNo. FWIW, I haven't (internally) prioritized this very highly because:\n\n1) we no longer show the import dialog on startup. Ever. The user has to go find it (e.g. via History > Show All history > star button > Import...). I don't think a lot of people coming from Edge would bother going through all those steps. We do still show a prompt to import data from another browser in activity stream for new profiles, but I'm still skeptical that many people would choose to go through that (based on previous use of the import wizard, where the most popular action was to get out of it without any imports). That said, I don't have any *current* data about this.\n2) even before this bug, the only history we imported was typed history (ie full URLs users literally typed into the urlbar - not navigations, or searches, or bookmark items - which for most users would be most of their history). So it was never very useful.\n3) this isn't really manifesting as \"broken\" just as \"it's not there/supported\". So it's not something that users will miss. In that sense, it's almost better than the previous state which would have imported only a subset of what users might expect it to import. (Something about which, fwiw, I don't recall ever seeing complaints / bugs filed by users, which strengthens (1).\n4) I *suspect* (but haven't verified) that the data has moved into the same database where the rest of the history data is. We've had significant difficulty trying to access data in that database (see https://bugzilla.mozilla.org/show_bug.cgi?id=1192034#c6 ). IE used to expose an API for history, and the last time I checked that API didn't return results from Edge. I'd be surprised if that had changed. Despite repeated requests to Microsoft both on non-public mailing lists and via direct email for a way to access this data, I'm not aware of any.\n\nAll of this means this hasn't exactly been at the top of my priority list. I don't think it should track for 60. If by some miracle the data is somewhere useful and it's safe/easy for us to access it, we could consider backporting something. But my tea leaf reading makes me skeptical.\n\nI'll see if I can have a look tomorrow or later this week if relman is anxious to have a resolution here despite the points above.", "author": "gijskruitbosch+bugs@gmail.com", "id": 13196431, "time": "2018-04-10T23:09:12Z"}, {"text": "Thanks, that's a really helpful comment. Agreed that it doesn't sound like this needs to be tracked then.", "author": "ryanvm@gmail.com", "id": 13196441, "time": "2018-04-10T23:13:12Z"}, {"text": "So the good news is it seems this data has moved into the spartan db that we already read for favourites and reading list items, which at least means we can fix the importer...", "author": "gijskruitbosch+bugs@gmail.com", "id": 13197290, "time": "2018-04-11T10:35:53Z"}, {"text": "Created attachment 8968962\nBug 1448920 - add support for importing Edge typed URL history from its database instead,\n\nReview commit: https://reviewboard.mozilla.org/r/237662/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/237662/", "author": "gijskruitbosch+bugs@gmail.com", "id": 13215965, "time": "2018-04-18T16:52:59Z"}, {"text": "While I would have liked to add a test, I don't have cycles right now to create one, as it'd require using some ESE tools to create/update a test database to use.", "author": "gijskruitbosch+bugs@gmail.com", "id": 13215968, "time": "2018-04-18T16:53:53Z"}, {"text": "Comment on attachment 8968962\nBug 1448920 - add support for importing Edge typed URL history from its database instead,\n\nhttps://reviewboard.mozilla.org/r/237662/#review243644\n\n::: browser/components/migration/EdgeProfileMigrator.js:178\n(Diff revision 1)\n> +      {name: \"AccessDateTimeUTC\", type: \"date\"},\n> +    ];\n> +\n> +    let typedUrls = [];\n> +    try {\n> +      typedUrls = readTableFromEdgeDB(\"TypedUrls\", columns, () => true, this.db);\n\nnit: it sounds a bit crazy that filterFn is mandatory it's a pointless function call for each row, when the code in readTableFromEdgeDB could just do:\nif (!filterFn || filterFn(row))\n\nIn all the previous usages the function was used, this is the first case where it's pointless.\n\n::: browser/components/migration/EdgeProfileMigrator.js:184\n(Diff revision 1)\n> +    } catch (ex) {\n> +      // Maybe the table doesn't exist (older versions of Win10).\n> +      // Just fall through and we'll return because there's no data.\n> +    }\n> +    if (!typedUrls.length) {\n> +      return;\n\nCan we somehow make the exception catch more specific, or maybe reportError regardless, because this is hiding any possible errors, that means this could start failing and nobody will notice.\n\nESEDB exposes a tableExists, thus potentially the Error could be customized for that case.\n\n::: browser/components/migration/EdgeProfileMigrator.js:189\n(Diff revision 1)\n> +      return;\n> +    }\n> +\n> +    let pageInfos = [];\n> +    // Sometimes the values are bogus (e.g. 0 becomes some date in 1600),\n> +    // and places will throw *everything* away, not just the bogus ones,\n\nWe could maybe add an option to ignore bogus entries in insertMany, if useful. What happens currently is normal input validation, if one of the entries is bogus, input is bogus and we don't want to hide possible mistakes from the caller.\n\n::: browser/components/migration/EdgeProfileMigrator.js:190\n(Diff revision 1)\n> +    }\n> +\n> +    let pageInfos = [];\n> +    // Sometimes the values are bogus (e.g. 0 becomes some date in 1600),\n> +    // and places will throw *everything* away, not just the bogus ones,\n> +    // so deal with that by having a cutoff date.\n\nTL;DR: I'd probably import only entries more recent than a cutoff date, empty dated entries could be imported with the cutoff date.\n\nFrom the comment (and var name) it looks like we throw away anything that is older than cutoff, rather than converting those dates. Maybe rename to kMinDate, if that's the case?\nAlso, if dates are older than cutoff, maybe they should get the cutoff date, rather than now? Do we have evidence those are new enough to go over entries with a real recent date?\n\nI'd suggest to have a more realistic cutoff date that could either be:\n1. 2016/01/01 - Edge was released half 2016\n2. 6 months ago, because if the Places db is full we'll likely expire anything older as soon as it's added. On the other side, it's unlikely for a user to import into a full Places db, so it may not matter in practice.", "author": "mak77@bonardo.net", "id": 13217863, "time": "2018-04-19T09:31:01Z"}, {"text": "Comment on attachment 8968962\nBug 1448920 - add support for importing Edge typed URL history from its database instead,\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/237662/diff/1-2/", "author": "gijskruitbosch+bugs@gmail.com", "id": 13221919, "time": "2018-04-20T16:52:57Z"}, {"text": "Comment on attachment 8968962\nBug 1448920 - add support for importing Edge typed URL history from its database instead,\n\nhttps://reviewboard.mozilla.org/r/237662/#review244260\n\n::: browser/components/migration/EdgeProfileMigrator.js:178\n(Diff revision 1)\n> +      {name: \"AccessDateTimeUTC\", type: \"date\"},\n> +    ];\n> +\n> +    let typedUrls = [];\n> +    try {\n> +      typedUrls = readTableFromEdgeDB(\"TypedUrls\", columns, () => true, this.db);\n\nFixed by making this optional.\n\n::: browser/components/migration/EdgeProfileMigrator.js:184\n(Diff revision 1)\n> +    } catch (ex) {\n> +      // Maybe the table doesn't exist (older versions of Win10).\n> +      // Just fall through and we'll return because there's no data.\n> +    }\n> +    if (!typedUrls.length) {\n> +      return;\n\nThe helper will report the error. I made this clear in the comment. I also made sure the error message was more readable by checking what error code ESE returns if the table doesn't exist.\n\n::: browser/components/migration/EdgeProfileMigrator.js:190\n(Diff revision 1)\n> +    }\n> +\n> +    let pageInfos = [];\n> +    // Sometimes the values are bogus (e.g. 0 becomes some date in 1600),\n> +    // and places will throw *everything* away, not just the bogus ones,\n> +    // so deal with that by having a cutoff date.\n\nIgnoring entries before the cutoff now, and using the cutoff date for entries without a date.", "author": "gijskruitbosch+bugs@gmail.com", "id": 13221924, "time": "2018-04-20T16:54:14Z"}, {"text": "Pushed by gijskruitbosch@gmail.com:\nhttps://hg.mozilla.org/integration/autoland/rev/1f04da36cb83\nadd support for importing Edge typed URL history from its database instead, r=mak", "author": "pulsebot@bots.tld", "id": 13221928, "time": "2018-04-20T16:55:50Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/1f04da36cb83", "author": "dluca@mozilla.com", "id": 13222799, "time": "2018-04-20T23:01:45Z"}], "cf_last_resolved": "2018-04-20T23:01:45Z", "priority": "--", "mentors_detail": [], "cf_crash_signature": "", "version": "Trunk", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox62": "---", "cf_platform_rel": "---", "product": "Firefox", "cf_status_firefox_esr52": "wontfix", "blocks": [], "qa_contact": "", "see_also": ["https://bugzilla.mozilla.org/show_bug.cgi?id=1455116"], "cf_fx_iteration": "---", "component": "Migration", "votes": 0, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "---", "cf_status_firefox61": "fixed", "cf_status_firefox60": "wontfix", "target_milestone": "Firefox 61", "is_cc_accessible": true, "cf_rank": null, "groups": [], "url": "", "creator_detail": {"email": "ciprian.georgiu@softvision.ro", "id": 576182, "name": "ciprian.georgiu@softvision.ro", "real_name": "Ciprian Georgiu, QA [:ciprian_georgiu]"}, "whiteboard": "", "mentors": [], "cc_detail": [{"email": "dothayer@mozilla.com", "id": 582499, "name": "dothayer@mozilla.com", "real_name": "Doug Thayer [:dthayer] (PTO on June 4)"}, {"email": "gijskruitbosch+bugs@gmail.com", "id": 159069, "name": "gijskruitbosch+bugs@gmail.com", "real_name": ":Gijs (he/him)"}, {"email": "jcristau@mozilla.com", "id": 580382, "name": "jcristau@mozilla.com", "real_name": "Julien Cristau [:jcristau]"}, {"email": "mak77@bonardo.net", "id": 240353, "name": "mak77@bonardo.net", "real_name": "Marco Bonardo [::mak]"}, {"email": "MattN+bmo@mozilla.com", "id": 305228, "name": "MattN+bmo@mozilla.com", "real_name": "Matthew N. [:MattN] (PM if requests are blocking you)"}, {"email": "ryanvm@gmail.com", "id": 75935, "name": "ryanvm@gmail.com", "real_name": "Ryan VanderMeulen [:RyanVM]"}], "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "last_change_time": "2018-06-10T01:17:44Z", "cf_status_firefox_esr60": "---", "assigned_to": "gijskruitbosch+bugs@gmail.com", "is_open": false, "resolution": "FIXED", "op_sys": "Windows 10", "cf_fx_points": "---", "history": [{"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(gijskruitbosch+bugs@gmail.com)"}], "who": "gijskruitbosch+bugs@gmail.com", "when": "2018-03-28T09:36:24Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "ryanvm@gmail.com"}, {"removed": "affected", "field_name": "cf_status_firefox59", "added": "wontfix"}, {"removed": "---", "field_name": "cf_tracking_firefox60", "added": "+"}, {"removed": "---", "field_name": "cf_tracking_firefox61", "added": "+"}], "who": "ryanvm@gmail.com", "when": "2018-03-28T15:21:35Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "jcristau@mozilla.com"}], "who": "jcristau@mozilla.com", "when": "2018-04-05T13:31:48Z"}, {"changes": [{"removed": "affected", "field_name": "cf_status_firefox_esr52", "added": "wontfix"}, {"removed": "+", "field_name": "cf_tracking_firefox60", "added": "-"}, {"removed": "affected", "field_name": "cf_status_firefox60", "added": "fix-optional"}, {"removed": "+", "field_name": "cf_tracking_firefox61", "added": "-"}, {"removed": "affected", "field_name": "cf_status_firefox61", "added": "fix-optional"}], "who": "ryanvm@gmail.com", "when": "2018-04-10T23:13:12Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "ASSIGNED"}, {"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "gijskruitbosch+bugs@gmail.com"}, {"removed": "needinfo?(gijskruitbosch+bugs@gmail.com)", "field_name": "flagtypes.name", "added": ""}], "who": "gijskruitbosch+bugs@gmail.com", "when": "2018-04-18T16:23:48Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8968962, "added": "review?(mak77@bonardo.net)"}, {"removed": "", "field_name": "cc", "added": "mak77@bonardo.net"}], "who": "gijskruitbosch+bugs@gmail.com", "when": "2018-04-18T16:52:59Z"}, {"changes": [{"removed": "", "field_name": "see_also", "added": "https://bugzilla.mozilla.org/show_bug.cgi?id=1455116"}], "who": "gijskruitbosch+bugs@gmail.com", "when": "2018-04-18T20:53:33Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(mak77@bonardo.net)", "attachment_id": 8968962, "added": "review+"}], "who": "mak77@bonardo.net", "when": "2018-04-19T09:31:01Z"}, {"changes": [{"removed": "ASSIGNED", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "Firefox 61"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2018-04-20 23:01:45"}, {"removed": "fix-optional", "field_name": "cf_status_firefox61", "added": "fixed"}], "who": "dluca@mozilla.com", "when": "2018-04-20T23:01:45Z"}, {"changes": [{"removed": "fix-optional", "field_name": "cf_status_firefox60", "added": "wontfix"}], "who": "ryanvm@gmail.com", "when": "2018-06-10T01:17:44Z"}]}