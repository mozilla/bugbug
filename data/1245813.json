{"status": "RESOLVED", "cf_tracking_firefox60": "---", "attachments": [{"creator": "mdeboer@mozilla.com", "is_obsolete": 1, "is_patch": 1, "flags": [], "content_type": "text/plain", "id": 8715831}, {"creator": "legacy-github-autolander-bot@mozilla.bugs", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2016-02-12T13:30:44Z", "type_id": 748, "creation_date": "2016-02-11T21:12:35Z", "id": 1341255, "setter": "standard8@mozilla.com"}], "content_type": "text/x-github-pull-request", "id": 8718511}, {"creator": "mdeboer@mozilla.com", "is_obsolete": 1, "is_patch": 1, "flags": [], "content_type": "text/plain", "id": 8718518}, {"creator": "mdeboer@mozilla.com", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2016-02-11T23:46:43Z", "type_id": 748, "creation_date": "2016-02-11T22:11:35Z", "id": 1341300, "setter": "mixedpuppy@gmail.com"}, {"status": "+", "name": "approval-mozilla-aurora", "modification_date": "2016-03-03T21:24:47Z", "type_id": 720, "creation_date": "2016-03-02T13:45:54Z", "id": 1352317, "setter": "lhenry@mozilla.com"}], "content_type": "text/plain", "id": 8718541}, {"creator": "mdeboer@mozilla.com", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2016-02-11T22:16:08Z", "type_id": 748, "creation_date": "2016-02-11T22:12:25Z", "id": 1341302, "setter": "bugs@pettay.fi"}], "content_type": "text/plain", "id": 8718542}, {"creator": "mdeboer@mozilla.com", "is_obsolete": 0, "is_patch": 1, "flags": [], "content_type": "text/plain", "id": 8727967}, {"creator": "mdeboer@mozilla.com", "is_obsolete": 1, "is_patch": 1, "flags": [{"status": "-", "name": "review", "modification_date": "2016-03-16T19:15:01Z", "type_id": 748, "creation_date": "2016-03-15T11:08:51Z", "id": 1360146, "setter": "standard8@mozilla.com"}], "content_type": "text/plain", "id": 8730654}, {"creator": "nical.bugzilla@gmail.com", "is_obsolete": 1, "is_patch": 1, "flags": [], "content_type": "text/plain", "id": 8731673}, {"creator": "nical.bugzilla@gmail.com", "is_obsolete": 1, "is_patch": 1, "flags": [], "content_type": "text/plain", "id": 8731695}, {"creator": "mdeboer@mozilla.com", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2016-03-22T16:10:55Z", "type_id": 748, "creation_date": "2016-03-17T15:10:19Z", "id": 1361881, "setter": "standard8@mozilla.com"}], "content_type": "text/plain", "id": 8731716}, {"creator": "nical.bugzilla@gmail.com", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2016-03-18T07:54:37Z", "type_id": 748, "creation_date": "2016-03-17T15:53:25Z", "id": 1361910, "setter": "dvander@alliedmods.net"}], "content_type": "text/plain", "id": 8731732}], "classification": "Client Software", "creator": "mdeboer@mozilla.com", "cc": ["bill.mccloskey@gmail.com", "bugs@pettay.fi", "cbook@mozilla.com", "dmose@mozilla.org", "dvander@alliedmods.net", "edilee@mozilla.com", "felipc@gmail.com", "freesamael@gmail.com", "ianb@mozilla.com", "jgriffiths@mozilla.com", "jmathies@mozilla.com", "mconley@mozilla.com", "mdeboer@mozilla.com", "mixedpuppy@gmail.com", "nical.bugzilla@gmail.com", "ovidiu.boca@softvision.ro", "ryanvm@gmail.com", "standard8@mozilla.com"], "depends_on": [1154277, 1248377, 1255491, 1258768, 1266421], "creation_time": "2016-02-04T12:48:26Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "cf_status_firefox58": "---", "cf_status_firefox59": "---", "keywords": [], "summary": "Swapping docShells doesn't work for regular browser elements", "id": 1245813, "cf_status_firefox50": "---", "assigned_to_detail": {"email": "mdeboer@mozilla.com", "id": 463945, "name": "mdeboer@mozilla.com", "real_name": "Mike de Boer [:mikedeboer] (Away from March 5 - 21st)"}, "severity": "major", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "assigned_to": "mdeboer@mozilla.com", "comment_count": 102, "comments": [{"text": "In fact, https://hg.mozilla.org/integration/fx-team/annotate/tip/toolkit/content/widgets/browser.xml#l1210 throws a \u2018NOT_IMPLEMENTED\u2019 error.\n\nRight now I\u2019ve put it in a try\u2026catch block to catch this, but it blocks correct functioning of detaching chat windows, for example.", "author": "mdeboer@mozilla.com", "id": 11137109, "time": "2016-02-04T12:48:26Z"}, {"text": "What is this bug about? We do swap when moving tabs to a different window, no?", "author": "bugs@pettay.fi", "id": 11137219, "time": "2016-02-04T13:32:40Z"}, {"text": "In fact swapping xul:browsers is the only case where swapping should work, IIRC.", "author": "bugs@pettay.fi", "id": 11137221, "time": "2016-02-04T13:33:08Z"}, {"text": "Mike or Dave, who could I work with to get this issue resolved?", "author": "mdeboer@mozilla.com", "id": 11137233, "time": "2016-02-04T13:36:14Z"}, {"text": "(In reply to Olli Pettay [:smaug] (high review load) from comment #2)\n> In fact swapping xul:browsers is the only case where swapping should work,\n> IIRC.\n\nI'll put up a patch that exposes the bug and probably shows what this is about.", "author": "mdeboer@mozilla.com", "id": 11137238, "time": "2016-02-04T13:37:32Z"}, {"text": "For posterity: It's `this.QueryInterface(Components.interfaces.nsIFrameLoaderOwner).swapFrameLoaders(aOtherBrowser);` throws 'NOT_IMPLEMENTED' and the comment I added in the `catch` clause is likely to be wrong.", "author": "mdeboer@mozilla.com", "id": 11137243, "time": "2016-02-04T13:39:23Z"}, {"text": "Olli, I'm investigating this atm too - because the patch you reviewed in bug 1154277 should've fixed this(?)", "author": "mdeboer@mozilla.com", "id": 11137281, "time": "2016-02-04T13:56:30Z"}, {"text": "Ah, we're talking about that case.\nThat patch was for the remote browsers, and here you're dealing with non-remote, no?", "author": "bugs@pettay.fi", "id": 11137327, "time": "2016-02-04T14:06:02Z"}, {"text": "Frameloader has different methods for swapping remote and non-remote browsers.", "author": "bugs@pettay.fi", "id": 11137329, "time": "2016-02-04T14:07:01Z"}, {"text": "Created attachment 8715831\nDebug code\n\nWith this patch applied I did the following (whilst chatting with Olli on IRC):\n\n1. Open NightlyDebug.app, open Hello panel and start a conversation (open room)\n2. Once the conversation window has opened and shows my webcam feed, I detach the conversation by clicking the button next to the big red one in the title bar.\n3. See that in the popup that appears nothing loads and the logging in the terminal show the output of the active xul:browser element.\n\nExample output:\n\nCONTENT:: <xul:browser xmlns:xul=\"http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul\" anonid=\"remote-content\" class=\"chat-frame\" flex=\"1\" context=\"contentAreaContextMenu\" disableglobalhistory=\"true\" frameType=\"social\" message=\"true\" messagemanagergroup=\"social\" tooltip=\"aHTMLTooltip\" remote=\"true\" xbl:inherits=\"src,origin\" xmlns:xbl=\"http://www.mozilla.org/xbl\" type=\"content\" clickthrough=\"never\"/>, undefined, undefined\n\n(meaning that `offsetLeft` and `offsetHeight` return 'undefined').\n\n4. Do the same thing in a fresh Non-e10s window and notice that it works just fine. Except that from thereafter the messageListeners are not receiving messages anymore through the messageManager. Everything _seems_ fine, but no message are coming through anymore.", "author": "mdeboer@mozilla.com", "id": 11137581, "time": "2016-02-04T15:26:31Z"}, {"text": "I forgot a step 0: set 'loop.remote.autostart' to `true` in about:config.", "author": "mdeboer@mozilla.com", "id": 11137600, "time": "2016-02-04T15:34:55Z"}, {"text": "Olli, what we're experiencing are things like bug 1245179, because messages sent with `browser.messageManager.sendAsyncMessage` don't end up in the framescript anymore after we swapped its docShell with one from another browser element.\n\nWith comment 9 and comment 10 in mind, is there anything you can think of, do or investigate that might help us here?", "author": "mdeboer@mozilla.com", "id": 11153657, "time": "2016-02-10T13:33:10Z"}, {"text": "I'm not sure what comment 9 and 10 are about, but why you think sensAsyncMessage doesn't work anymore?\nHave you tested tabchildglobals that they don't get the messages\nRemember the parent side of the message manager stays in the same place in the message manager tree even after swap. So when we swap the frameloader of a <browser>, we also swap message manager, so that\nthe browser.messageManager should keep returning the same object. But the child side of message manager is swapped, so the context where scripts are executed isn't the same.", "author": "bugs@pettay.fi", "id": 11153967, "time": "2016-02-10T15:19:34Z"}, {"text": "(In reply to Olli Pettay [:smaug] (high review load) from comment #12)\n> I'm not sure what comment 9 and 10 are about, but why you think\n> sensAsyncMessage doesn't work anymore?\n\nBecause messages we're sending do not seem to arrive anymore. When we swap the frameloader of a remote browser, it even throws a NOT_IMPLEMENTED error (see comment 5) and things stop working, period.\n\n> Have you tested tabchildglobals that they don't get the messages\n\nI don't really know what they are, I'm afraid... something tells me these are connected to tabs - Social API/ Firefox Hello browser elements are _not_ connected to a tab.\n\n> Remember the parent side of the message manager stays in the same place in\n> the message manager tree even after swap. So when we swap the frameloader of\n> a <browser>, we also swap message manager, so that\n> the browser.messageManager should keep returning the same object. But the\n> child side of message manager is swapped, so the context where scripts are\n> executed isn't the same.\n\nSo what happens to event listeners added in the child script?", "author": "mdeboer@mozilla.com", "id": 11154126, "time": "2016-02-10T16:00:05Z"}, {"text": "(In reply to Mike de Boer [:mikedeboer] from comment #13)\n> (In reply to Olli Pettay [:smaug] (high review load) from comment #12)\n> > I'm not sure what comment 9 and 10 are about, but why you think\n> > sensAsyncMessage doesn't work anymore?\n> \n> Because messages we're sending do not seem to arrive anymore. When we swap\n> the frameloader of a remote browser, it even throws a NOT_IMPLEMENTED error\n> (see comment 5) and things stop working, period.\nOk, so you're doing swap at a moment when it is not expected/supported.\nBut sure, if you get that, nothing probably works. Are you getting the error still in the same place\n(no primary frame) or somewhere else?\n\n\n\n> \n> > Have you tested tabchildglobals that they don't get the messages\n> \n> I don't really know what they are,\ntabchildglobal is the JS global where frame scripts are executed.\n\n> So what happens to event listeners added in the child script?\nNothing special. They are still there added to the tabchildglobal.", "author": "bugs@pettay.fi", "id": 11154619, "time": "2016-02-10T17:49:52Z"}, {"text": "(In reply to Olli Pettay [:smaug] (high review load) from comment #14)\n> Ok, so you're doing swap at a moment when it is not expected/supported.\n> But sure, if you get that, nothing probably works. Are you getting the error\n> still in the same place\n> (no primary frame) or somewhere else?\n\nYeah, still the same. But I'm very sure the browser element is visible and the parent doc has finished loading. I'm also not savvy enough (yet) to log all the appropriate things in nsFrameLoader.cpp, I'm sure. But don't you think it's curious that this only happen in the remote=true case?\n\n> tabchildglobal is the JS global where frame scripts are executed.\n\nOooh, I'll be looking into that. Thanks!", "author": "mdeboer@mozilla.com", "id": 11154760, "time": "2016-02-10T18:22:19Z"}, {"text": "Both browser elements need to be visible. And they are not if they don't have primary frames.", "author": "bugs@pettay.fi", "id": 11154952, "time": "2016-02-10T19:05:22Z"}, {"text": "(In reply to Olli Pettay [:smaug] (high review load) from comment #16)\n> Both browser elements need to be visible. And they are not if they don't\n> have primary frames.\n\nHmmm, what might be happening then is that - even though the chat box is closed in-code _after_ the `swapDocShell` call, the close is fact happening quicker than the async mechanics are able to work. So basically: wait until the swap is complete. I'll look into it and report back tomorrow.", "author": "mdeboer@mozilla.com", "id": 11155053, "time": "2016-02-10T19:26:05Z"}, {"text": "Olli, I was wrong in comment 11. What's _really_ happening (in non-e10s windows for sure) is that `browser.messageManager.addEventListener(\"foo\", () => {})` is not invoked when a child script does `sendAsyncMessage(\"foo\");` _after_ the swapDocShell-dance.\nI confirmed that messages sent from the parent with `browser.messageManager.sendAsyncMessage(\"bar\");` are arriving in the child as expected, thus invalidating what I said in comment 11.\n\nIs it expected that I need to re-attach message listeners in the parent after a docShell swap? Or is that a bug?", "author": "mdeboer@mozilla.com", "id": 11156883, "time": "2016-02-11T10:44:26Z"}, {"text": "I can work around this - probably - by re-attaching the listeners after each docShell swap, but I'd like to get your opinion first, if you don't mind...\nThanks!", "author": "mdeboer@mozilla.com", "id": 11157940, "time": "2016-02-11T16:26:28Z"}, {"text": "(this was discussed on IRC)", "author": "bugs@pettay.fi", "id": 11158136, "time": "2016-02-11T17:10:48Z"}, {"text": "Created attachment 8718511\n[loop] mikedeboer:bug-1245813-messageManagerSwapparoo > mozilla:master", "author": "legacy-github-autolander-bot@mozilla.bugs", "id": 11159097, "time": "2016-02-11T21:03:49Z"}, {"text": "Created attachment 8718518\nPatch 1: dispatch an event when docShells were swapped", "author": "mdeboer@mozilla.com", "id": 11159121, "time": "2016-02-11T21:12:12Z"}, {"text": "Comment on attachment 8718518\nPatch 1: dispatch an event when docShells were swapped\n\nHold on, gonna try something with existing events.", "author": "mdeboer@mozilla.com", "id": 11159132, "time": "2016-02-11T21:16:09Z"}, {"text": "My initial reaction is questioning whether this only fixes swap for loop, since there is no handling of the event otherwise.  But I'll wait and see what else you come up with.", "author": "mixedpuppy@gmail.com", "id": 11159154, "time": "2016-02-11T21:20:36Z"}, {"text": "(In reply to Shane Caraveo (:mixedpuppy) from comment #24)\n> My initial reaction is questioning whether this only fixes swap for loop,\n> since there is no handling of the event otherwise.  But I'll wait and see\n> what else you come up with.\n\nI'm working on the SocialAPI things right now - separate patches from the Loop things. I though it'd be cleaner that way.", "author": "mdeboer@mozilla.com", "id": 11159219, "time": "2016-02-11T21:36:34Z"}, {"text": "https://treeherder.mozilla.org/#/jobs?repo=try&revision=8765ca2da712", "author": "mdeboer@mozilla.com", "id": 11159306, "time": "2016-02-11T21:52:07Z"}, {"text": "Created attachment 8718541\nPatch 1: make sure that messageManager message listeners are swapped as well after chat window attach/ detach\n\nRe-enables a mochitest as a bonus ;-)", "author": "mdeboer@mozilla.com", "id": 11159389, "time": "2016-02-11T22:11:35Z"}, {"text": "Created attachment 8718542\nPatch 2: add documentation to explain more about what swapDocShells does and, most importantly, does not do", "author": "mdeboer@mozilla.com", "id": 11159393, "time": "2016-02-11T22:12:25Z"}, {"text": "Comment on attachment 8718542\nPatch 2: add documentation to explain more about what swapDocShells does and, most importantly, does not do\n\n>           // Give others a chance to swap state.\n>+          // IMPORTANT: Since a swapDocShells call does not swap the messageManager\n>+          //            instances attached to a browser to aOtherBrowser, others\n>+          //            will need to re-attach the message listeners to the new\n>+          //            messageManager.\nNit, I wouldn't say \"re-attach\", since those listeners were never attached to the new message manager.\nperhaps just \"will need to add the message listeners...\"\n\n\n\nthanks", "author": "bugs@pettay.fi", "id": 11159408, "time": "2016-02-11T22:16:08Z"}, {"text": "Comment on attachment 8718541\nPatch 1: make sure that messageManager message listeners are swapped as well after chat window attach/ detach\n\nReview of attachment 8718541:\n-----------------------------------------------------------------\n\n::: browser/extensions/loop/chrome/content/modules/MozLoopService.jsm\n@@ +1032,5 @@\n>          // Since a swapDocShells call does not swap the messageManager instances\n>          // attached to a browser, we'll need to re-attach the message listeners\n>          // to the new messageManager. This is not a bug in swapDocShells, merely\n>          // a design decision.\n> +        chatbox.content.addEventListener(\"SwapDocShells\", function swapped(ev) {\n\nOops, please ignore this change - should not be part of this patch.", "author": "mdeboer@mozilla.com", "id": 11159414, "time": "2016-02-11T22:16:57Z"}, {"text": "https://hg.mozilla.org/integration/fx-team/rev/0485ab41f1410c120e0e00c56152b5878fe4bb56\nBug 1245813: add documentation to explain more about what swapDocShells does and, most importantly, does not do with respect to messageManagers. r=smaug\n\nhttps://hg.mozilla.org/integration/fx-team/rev/02c72568abff59c895c172fc6540aec369fd4a97\nBug 1245813: make sure that messageManager message listeners are swapped as well after chat window attach/ detach. This means that the browser_tearoff.js mochitest can be enabled again. r=mixedpuppy", "author": "mdeboer@mozilla.com", "id": 11160774, "time": "2016-02-12T12:25:13Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/0485ab41f141\nhttps://hg.mozilla.org/mozilla-central/rev/02c72568abff", "author": "philringnalda@gmail.com", "id": 11164037, "time": "2016-02-14T03:17:20Z"}, {"text": "Requesting tracking for e10s: Without this we can't turn Loop in e10s mode because it breaks detaching and re-attaching the chat window.\n\nLoop needs to be able to turn on e10s itself for tab sharing to work in e10s mode.", "author": "standard8@mozilla.com", "id": 11190881, "time": "2016-02-24T11:05:14Z"}, {"text": "What's left to do here?", "author": "jmathies@mozilla.com", "id": 11195536, "time": "2016-02-25T17:37:48Z"}, {"text": "Mike, can you clarify please?", "author": "standard8@mozilla.com", "id": 11195913, "time": "2016-02-25T19:06:30Z"}, {"text": "(In reply to Jim Mathies [:jimm] from comment #34)\n> What's left to do here?\n\nWell, the most important part, I'd say: currently when we attempt to swap the docShell from a chatbox - which is a child of the chatbar inside a browser window - to a chatbox in a dialogWindow which has chatWindow.xul loaded.\n(I'm really talking about the docShell of a document of a browser element of a remote=true browser element that you can find in the chatbox binding is socialchat.xml: https://dxr.mozilla.org/mozilla-central/source/browser/base/content/socialchat.xml#30 )\n\nThe error I see is 'NS_ERROR_NOT_IMPLEMENTED', originating from https://dxr.mozilla.org/mozilla-central/source/dom/base/nsFrameLoader.cpp#911 .\nIn other words, the content is not visible. However, even when I wait until getBoundingClientRect() yields a width and height for the browser element and then attempt the swap, still no good.\n\nIt just won't work, whatever I try - and I have to admit I'm at wits' end with regard to finding more options.\nI mean, I know switching the 'remote' attribute from 'false' to 'true' on non-tabbrowser browser elements doesn't work, hence you see two distinct browser elements in chatbox binding.\n\nThis is where I hope you can step in - set 'loop.remote.autoStart' to `true` and see what the problem might be...", "author": "mdeboer@mozilla.com", "id": 11196503, "time": "2016-02-25T21:33:33Z"}, {"text": "Remember that _both_ browser elements need to be visible. If you get NS_ERROR_NOT_IMPLEMENTED from there, either one or neither of the elements is visible.", "author": "bugs@pettay.fi", "id": 11196521, "time": "2016-02-25T21:37:09Z"}, {"text": "(In reply to Olli Pettay [:smaug] (HIGH REVIEW LOAD) from comment #37)\n> Remember that _both_ browser elements need to be visible. If you get\n> NS_ERROR_NOT_IMPLEMENTED from there, either one or neither of the elements\n> is visible.\n\nQuestion partly out of curiosity...is it *visibility* or that the browser element is attached to a visible window?  e.g. If you open a new window that entirely obscures the document you intend to swap with, will it fail?\n\nI remember the chat window swap stuff being a bit of a battle to get right when it was initially written.  That was pre-messageManager/e10s.", "author": "mixedpuppy@gmail.com", "id": 11196814, "time": "2016-02-25T22:39:20Z"}, {"text": "visibility in this case means \"has layout object\". Nothing to do with window being active or such.\nelement.getBoundingClientRect() returns DOMRect with properties set to 0 if there is no layout object.", "author": "bugs@pettay.fi", "id": 11198236, "time": "2016-02-26T13:30:28Z"}, {"text": "(In reply to Mike de Boer [:mikedeboer] from comment #36)\n> (In reply to Jim Mathies [:jimm] from comment #34)\n> > What's left to do here?\n> \n> Well, the most important part, I'd say: currently when we attempt to swap\n> the docShell from a chatbox - which is a child of the chatbar inside a\n> browser window - to a chatbox in a dialogWindow which has chatWindow.xul\n> loaded.\n> (I'm really talking about the docShell of a document of a browser element of\n> a remote=true browser element that you can find in the chatbox binding is\n> socialchat.xml:\n> https://dxr.mozilla.org/mozilla-central/source/browser/base/content/\n> socialchat.xml#30 )\n\nBoth browsers passed to swapDocShells are remote?", "author": "jmathies@mozilla.com", "id": 11198445, "time": "2016-02-26T14:52:06Z"}, {"text": "s/passed/involved in the swapDocShells call", "author": "jmathies@mozilla.com", "id": 11198447, "time": "2016-02-26T14:52:59Z"}, {"text": "(In reply to Jim Mathies [:jimm] from comment #40)\n> Both browsers passed to swapDocShells are remote?\n\nPositive.", "author": "mdeboer@mozilla.com", "id": 11199778, "time": "2016-02-26T20:46:02Z"}, {"text": "Comment on attachment 8718541\nPatch 1: make sure that messageManager message listeners are swapped as well after chat window attach/ detach\n\nApproval Request Comment\n[Feature/regressing bug #]: bug 1154277\n[User impact if declined]: After a detach of a conversation/ chat window into its own dialog window, message listeners would not be attached again thus losing messages. This patch makes sure that this does not happen.\n[Describe test coverage new/current, TreeHerder]: landed on m-c, tests pass, including the here enabled browser_tearoff.js mochitest\n[Risks and why]: minor, fixes broken functionality.\n[String/UUID change made/needed]: n/a.", "author": "mdeboer@mozilla.com", "id": 11210778, "time": "2016-03-02T13:45:54Z"}, {"text": "Comment on attachment 8718541\nPatch 1: make sure that messageManager message listeners are swapped as well after chat window attach/ detach\n\nGood for Hello tab detaching to work as expected with e10s, includes new/fixed tests. Please uplift to aurora.", "author": "lhenry@mozilla.com", "id": 11216564, "time": "2016-03-03T21:24:47Z"}, {"text": "Hi Mike,\nI think I know what the problem is. Here's the swapping code:\nhttps://dxr.mozilla.org/mozilla-central/rev/2b5237c178ea02133a777396c24dd2b713f2b8ee/browser/base/content/socialchat.xml#204\nRight before calling the frameloader's swapDocShells function, it sets the \"remote\" property. There's a setter for that property here:\nhttps://dxr.mozilla.org/mozilla-central/rev/2b5237c178ea02133a777396c24dd2b713f2b8ee/browser/base/content/socialchat.xml#163\nThat setter makes the remote browser element visible. However, layout hasn't had time to happen since the swap happens immediately after.\n\nI would suggest adding a MozAfterPaint handler or something after you change the visibility (although smaug may have a better suggestion when he gets back).\n\nHowever, even with this change, I still get a not implemented error from the swap. But now it fails here:\nhttps://dxr.mozilla.org/mozilla-central/source/dom/base/nsFrameLoader.cpp#934\nI think that should be easy to work around though.\n\nI wasn't able to test this very thoroughly because Hello is totally broken for me with e10s. When I click \"Browse this page with a friend\", I get some weird errors in the console about not being able to leave a room I've already joined. However, if I open a new tab, then the chat window unexpectedly pops up. While the chat window is open, the browser window doesn't respond to mouse clicks. Is that a problem you're aware of?", "author": "bill.mccloskey@gmail.com", "id": 11217116, "time": "2016-03-04T00:11:58Z"}, {"text": "(In reply to Bill McCloskey (:billm) from comment #45)\n> I would suggest adding a MozAfterPaint handler or something after you change\n> the visibility (although smaug may have a better suggestion when he gets\n> back).\n\nThanks _so_ much for looking into this!!! This is a good idea - a `setTimeout` is the best I've come up with so far. :-P\n\n> However, even with this change, I still get a not implemented error from the\n> swap. But now it fails here:\n> https://dxr.mozilla.org/mozilla-central/source/dom/base/nsFrameLoader.cpp#934\n> I think that should be easy to work around though.\n\nFunny enough I made the most recent change on that line specifically for the non-e10s case! What kind of work around were you thinking about?\n\n> I wasn't able to test this very thoroughly because Hello is totally broken\n> for me with e10s. When I click \"Browse this page with a friend\", I get some\n> weird errors in the console about not being able to leave a room I've\n> already joined. However, if I open a new tab, then the chat window\n> unexpectedly pops up. While the chat window is open, the browser window\n> doesn't respond to mouse clicks. Is that a problem you're aware of?\n\nWell, yeah, once you've detached the conversation once, everything goes bonkers at the moment. Part of the problem lies in bug 1250534.", "author": "mdeboer@mozilla.com", "id": 11218055, "time": "2016-03-04T10:07:21Z"}, {"text": "https://hg.mozilla.org/releases/mozilla-aurora/rev/cd7957183311", "author": "standard8@mozilla.com", "id": 11218060, "time": "2016-03-04T10:09:51Z"}, {"text": "I believe when Bill and I were working on getting his setup to the point where he could debug this at all yesterday, things were totally broken before any detachment (I'm pretty sure, though not positive, that we did restart and found it busted from the beginning).  The call to GetUserMedia spewed an error into the browser console, and then the \"can't leave a room you haven't joined spew\", and then finally the chat window would only open (with a \"can't find camera or mic\" view) after a second browser tab had been opened, at which point it became possible to try popping it out and then debug the message manager stuff.  Bill, please correct if I'm misremembering the sequence here...", "author": "dmose@mozilla.org", "id": 11218741, "time": "2016-03-04T15:22:35Z"}, {"text": "Hey Ryan, has softvision done any testing of loop with e10s? If not, can we schedule a round and file bugs on whatever we find?", "author": "jmathies@mozilla.com", "id": 11219157, "time": "2016-03-04T16:01:25Z"}, {"text": "(In reply to Dan Mosedale (:dmose) from comment #48)\n> I believe when Bill and I were working on getting his setup to the point\n> where he could debug this at all yesterday, things were totally broken\n> before any detachment (I'm pretty sure, though not positive, that we did\n> restart and found it busted from the beginning).  The call to GetUserMedia\n> spewed an error into the browser console, and then the \"can't leave a room\n> you haven't joined spew\", and then finally the chat window would only open\n> (with a \"can't find camera or mic\" view) after a second browser tab had been\n> opened, at which point it became possible to try popping it out and then\n> debug the message manager stuff.  Bill, please correct if I'm misremembering\n> the sequence here...\n\nYes, that's what happened. I was able to reproduce it on Windows and Linux.\n\nMike, what happens if you try using Hello from e10s in a fresh profile (with the remote.autostart pref set)?", "author": "bill.mccloskey@gmail.com", "id": 11219179, "time": "2016-03-04T16:07:50Z"}, {"text": "Well, I see the same thing now. But this has nothing to do with e10s - it used to work just fine. It somehow fails to GetUserMedia and whole boatload of other errors that I don't recognize.", "author": "mdeboer@mozilla.com", "id": 11219566, "time": "2016-03-04T17:59:00Z"}, {"text": "(In reply to Mike de Boer [:mikedeboer] from comment #51)\n> Well, I see the same thing now. But this has nothing to do with e10s\n\nI meant not with this bug, it might perhaps have lots to do with e10s. And perhaps recent Media/ WebRTC landings.", "author": "mdeboer@mozilla.com", "id": 11219571, "time": "2016-03-04T18:00:03Z"}, {"text": "Thanks. I looked for a regression range and found it. Filed bug 1253688 for the regression. I'm still unable to use the camera on a recent nightly even after the regressing patch is backed out, so there might have been multiple regressions.", "author": "bill.mccloskey@gmail.com", "id": 11219782, "time": "2016-03-04T19:03:08Z"}, {"text": "The camera issue is bug 1249365. It might be worth trying some aurora builds as they may be a bit more stable.", "author": "standard8@mozilla.com", "id": 11219979, "time": "2016-03-04T20:14:50Z"}, {"text": "Something I've just noticed is that the about pages we use for loop don't currently specify URI_MUST_LOAD_IN_CHILD. No idea if this would affect things here. Due to bug 1249365 I haven't been able to check for effects yet, but it might not be affecting things here.\n\n\n(In reply to Jim Mathies [:jimm] from comment #49)\n> Hey Ryan, has softvision done any testing of loop with e10s? If not, can we\n> schedule a round and file bugs on whatever we find?\n\nThey won't have as we haven't enabled it yet - we haven't got it stable enough in manual testing to make it worth other people testing. Getting it scheduled in would be a good idea though.", "author": "standard8@mozilla.com", "id": 11220234, "time": "2016-03-04T21:30:41Z"}, {"text": "(In reply to Mark Banner (:standard8) from comment #55)\n> Something I've just noticed is that the about pages we use for loop don't\n> currently specify URI_MUST_LOAD_IN_CHILD. No idea if this would affect\n> things here. Due to bug 1249365 I haven't been able to check for effects\n> yet, but it might not be affecting things here.\n\nIt looks like socialchat.xml handles setting the remote attribute on browser elements itself, so the URI_MUST_LOAD_IN_CHILD attribute has no effect.", "author": "bill.mccloskey@gmail.com", "id": 11220250, "time": "2016-03-04T21:38:51Z"}, {"text": "(In reply to Mark Banner (:standard8) from comment #55)\n> They won't have as we haven't enabled it yet - we haven't got it stable\n> enough in manual testing to make it worth other people testing. Getting it\n> scheduled in would be a good idea though.\n\nI assume you're talking about loop + e10s here vs. just loop? Or maybe you're talking about a specific feature of loop that isn't out on release like tab sharing? I'd like to understand what blocks here.\n\nAlso, do we have tests for loop that might have caught these regressions had they been enabled under e10s?", "author": "jmathies@mozilla.com", "id": 11220304, "time": "2016-03-04T22:04:20Z"}, {"text": "Mark, let me know when Loop + e10s is ready for a round of focused testing and we can work something out.", "author": "ryanvm@gmail.com", "id": 11222739, "time": "2016-03-07T02:51:08Z"}, {"text": "(In reply to Jim Mathies [:jimm] from comment #57)\n> (In reply to Mark Banner (:standard8) from comment #55)\n> > They won't have as we haven't enabled it yet - we haven't got it stable\n> > enough in manual testing to make it worth other people testing. Getting it\n> > scheduled in would be a good idea though.\n> \n> I assume you're talking about loop + e10s here vs. just loop? Or maybe\n> you're talking about a specific feature of loop that isn't out on release\n> like tab sharing? I'd like to understand what blocks here.\n\nI'm talking about e10s + loop. e10s without Loop is being frequently tested by softvision.\n\n> Also, do we have tests for loop that might have caught these regressions had\n> they been enabled under e10s?\n\nI think its obvious there's not full coverage here. I believe the main parts are that we haven't got good coverage of the social API chat window - especially for when it pops-out. Though Mike can probably advise if there's other tests that are missing as well.", "author": "standard8@mozilla.com", "id": 11223335, "time": "2016-03-07T10:03:14Z"}, {"text": "(In reply to Bill McCloskey (:billm) from comment #45)\n> Hi Mike,\n> I think I know what the problem is. Here's the swapping code:\n> https://dxr.mozilla.org/mozilla-central/rev/\n> 2b5237c178ea02133a777396c24dd2b713f2b8ee/browser/base/content/socialchat.\n> xml#204\nThat is indeed broken. That code shouldn't either change remote-ness or should flush layout + swap async after that.\n\n\n> I would suggest adding a MozAfterPaint handler or something after you change\n> the visibility (although smaug may have a better suggestion when he gets\n> back).\nWell, just to flush layout we don't need to wait that long. Just try to get getBoundingClientRect() on an element which is\nsupposed to be visible is enough. And _both_ browser elements must be visible and have same remote-ness state at that point.\n\n\n> However, even with this change, I still get a not implemented error from the\n> swap. But now it fails here:\n> https://dxr.mozilla.org/mozilla-central/source/dom/base/nsFrameLoader.cpp#934\n> I think that should be easy to work around though.\nYes, either both or neither of the windows should have nsIBrowserDOMWindow. Why are we moving the tab to different type of window?\nWhy the new window doesn't have nsIBrowserDOMWindow?\nThough, do we have any tests for the links being opened from the socialchat window? If that all works (in non-e10s), and with the check removed also in e10s, we could probably just remove that check in nsFrameLoader.", "author": "bugs@pettay.fi", "id": 11225146, "time": "2016-03-07T20:22:41Z"}, {"text": "(In reply to Olli Pettay [:smaug] from comment #60)\n> (In reply to Bill McCloskey (:billm) from comment #45)\n> > However, even with this change, I still get a not implemented error from the\n> > swap. But now it fails here:\n> > https://dxr.mozilla.org/mozilla-central/source/dom/base/nsFrameLoader.cpp#934\n> > I think that should be easy to work around though.\n>\n> Yes, either both or neither of the windows should have nsIBrowserDOMWindow.\n> Why are we moving the tab to different type of window?\n\nThe case here is that `otherBrowserDOMWindow` is set and `browserDOMWindow` is not. Why? No clue. This is NOT the case when the browser element is not remote (both NULL) - which is what's running in non-e10s windows.\n\n> Why the new window doesn't have nsIBrowserDOMWindow?\n> Though, do we have any tests for the links being opened from the socialchat\n> window? If that all works (in non-e10s), and with the check removed also in\n> e10s, we could probably just remove that check in nsFrameLoader.\n\nIf I remove the check and let the code pass through like that, it hits multiple assertion and crashes Fx with a segfault.\n\nI get the following crash output when I pass a nullptr to `SetBrowserDOMWindow`: https://pastebin.mozilla.org/8862804", "author": "mdeboer@mozilla.com", "id": 11228446, "time": "2016-03-08T18:06:48Z"}, {"text": "Created attachment 8727967\nDebug code", "author": "mdeboer@mozilla.com", "id": 11228452, "time": "2016-03-08T18:07:27Z"}, {"text": "So if I try that debug patch and comment  out if (!!otherBrowserDOMWindow != !!browserDOMWindow) { part in nsFrameLoader, I can drag the Hello window to a separate top level window.\n(Not sure how to verify it all works as expected. I can see myself there, but should I see also the tab which is being shared?) This is on linux.\n\nhttps://pastebin.mozilla.org/8862804 looks like unrelated issue, OSX only perhaps?", "author": "bugs@pettay.fi", "id": 11236137, "time": "2016-03-10T17:10:48Z"}, {"text": "(I'm not familiar at all with Layer code)", "author": "bugs@pettay.fi", "id": 11236142, "time": "2016-03-10T17:11:39Z"}, {"text": "And using the popout button next the minimize button works too?", "author": "mdeboer@mozilla.com", "id": 11236148, "time": "2016-03-10T17:12:38Z"}, {"text": "https://www.evernote.com/l/APuCxWVnzLZP5o3OoXLjePk0sdgpdQdIIVY", "author": "mdeboer@mozilla.com", "id": 11236154, "time": "2016-03-10T17:14:04Z"}, {"text": "yes.\n\nWhat does not work is then the button to merge window back to tab.\nA \"merged window\" is created, but the Hello window stays open and it shows the video.\nIn the terminal I see\nCONTENT:: <xul:browser xmlns:xul=\"http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul\" anonid=\"remote-content\" class=\"chat-frame\" flex=\"1\" context=\"contentAreaContextMenu\" disableglobalhistory=\"true\" frameType=\"social\" message=\"true\" messagemanagergroup=\"social\" tooltip=\"aHTMLTooltip\" remote=\"true\" xbl:inherits=\"src,origin\" xmlns:xbl=\"http://www.mozilla.org/xbl\" type=\"content\" origin=\"https://loop.services.mozilla.com/v0\" clickthrough=\"never\" hidden=\"true\" src=\"about:blank\"/>, undefined, undefined\n5. NOT IMPLEMENTED? true or false", "author": "bugs@pettay.fi", "id": 11236205, "time": "2016-03-10T17:26:06Z"}, {"text": "Comment on attachment 8727967\nDebug code\n\nReminder to myself, \n\n>   if (!!otherBrowserDOMWindow != !!browserDOMWindow) {\n>+    printf(\"7. NOT IMPLEMENTED? %s, %s\\n\", !!otherBrowserDOMWindow ?\n>+      \"otherBrowserDOMWindow\" : \"NO otherBrowserDOMWindow\", !!browserDOMWindow ?\n>+      \"browserDOMWindow\" : \"NO browserDOMWindow\");\n>     return NS_ERROR_NOT_IMPLEMENTED;\n>   }\nIn order to test this patch, one needs to comment this 'if' out and set loop.remote.autostart to true", "author": "bugs@pettay.fi", "id": 11236443, "time": "2016-03-10T18:24:20Z"}, {"text": "nical, could you look at the stack in comment 61. (I don't see a crash on linux).\n\nAnd to test this stuff, see comment 68.", "author": "bugs@pettay.fi", "id": 11236491, "time": "2016-03-10T18:33:53Z"}, {"text": "Created attachment 8730654\nPatch 3: flush layout before swapping docShells\n\nThis patch will need to be uplifted for Loop e10s support.", "author": "mdeboer@mozilla.com", "id": 11247199, "time": "2016-03-15T11:08:51Z"}, {"text": "Sorry for the late answer. I haven't answered the needinfo yet because I am still looking into it (I don't have a mac to test on handy so it's taking longer than I expected). I have a few ideas that I need to validate before I come back with more info.", "author": "nical.bugzilla@gmail.com", "id": 11247407, "time": "2016-03-15T13:02:04Z"}, {"text": "Comment on attachment 8730654\nPatch 3: flush layout before swapping docShells\n\nReview of attachment 8730654:\n-----------------------------------------------------------------\n\nI just tried this on my Mac with a --disable-debug build. When I pop-out the window, I get the old conversation window as transparent, and the new window as grey. This appears on the browser console:\n\nNS_ERROR_NOT_IMPLEMENTED: browser.xml:1235", "author": "standard8@mozilla.com", "id": 11252919, "time": "2016-03-16T19:15:01Z"}, {"text": "Created attachment 8731673\nBulletproof changing a TextureHost's compositor\n\nI am not 100% sure what's going on but it is definitely related to a TextureHost moving from a compositor to another. An assertion that the texture's gl context is current blows up so I added gl->MakeCurrent checks in a few key places in case the TextureHost is still bound to another widget's compositor and calls into the wrong compositor. I also made sure SetCompositor is called before PrepareTextureSource in ImageHost to avoid issuing gl calls before being set the compositor. The rest of the patch is a pile of extra checks when setting the compositor. In particular, I am a bit worried that in some rare case we might have a texture go from a compositor backend to another and we currently have some unsafe casts that expect this not to happen.\nDavid, this is somewhat related to the work you are doing around handling stale compositors (in that TextureHost needs handle temporary invalid states) so it's good that you have a look at this.\nI haven't had a chance to reproduce the issue (and verify the patch) but I would be extremely surprised that it still happens with these checks in place. If one of the assertions that I added blows up we'll know more about the problem.", "author": "nical.bugzilla@gmail.com", "id": 11255089, "time": "2016-03-17T12:40:44Z"}, {"text": "Created attachment 8731695\nBulletproof changing a TextureHost's compositor v2\n\nBuild fixes on windows and mac.", "author": "nical.bugzilla@gmail.com", "id": 11255414, "time": "2016-03-17T14:38:21Z"}, {"text": "*** Bug 1257536 has been marked as a duplicate of this bug. ***", "author": "standard8@mozilla.com", "id": 11255475, "time": "2016-03-17T14:59:03Z"}, {"text": "Created attachment 8731716\nPatch 3.1: flush layout before swapping docShells", "author": "mdeboer@mozilla.com", "id": 11255527, "time": "2016-03-17T15:10:19Z"}, {"text": "Nicolas, I'm getting this error when building on my MBP:\n\n 0:40.03 ld: warning: could not create compact unwind for _ffi_call_unix64: does not use RBP or RSP based frame\n 0:40.03 Undefined symbols for architecture x86_64:\n 0:40.03   \"mozilla::layers::MacIOSurfaceTextureHostOGL::gl() const\", referenced from:\n 0:40.03       mozilla::layers::MacIOSurfaceTextureHostOGL::Lock() in MacIOSurfaceTextureHostOGL.o\n 0:40.03 ld: symbol(s) not found for architecture x86_64\n 0:40.03 clang: error: linker command failed with exit code 1 (use -v to see invocation)\n 0:40.03 make[5]: *** [XUL] Error 1\n 0:40.03 make[4]: *** [toolkit/library/target] Error 2\n 0:40.03 make[3]: *** [compile] Error 2\n 0:40.03 make[2]: *** [default] Error 2\n 0:40.03 make[1]: *** [realbuild] Error 2", "author": "mdeboer@mozilla.com", "id": 11255549, "time": "2016-03-17T15:17:21Z"}, {"text": "Created attachment 8731732\nBulletproof changing a TextureHost's compositor v3\n\nHopefully it'll build this time around.", "author": "nical.bugzilla@gmail.com", "id": 11255657, "time": "2016-03-17T15:53:25Z"}, {"text": "Builds fine! Now I get a crash when I attempt to detach a window:\n\n[Child 8368] ###!!! ABORT: Aborting on channel error.: file /Users/mikedeboer/Projects/fx-team/ipc/glue/MessageChannel.cpp, line 2020\nAssertion failure: mDestroyed, at /Users/mikedeboer/Projects/fx-team/gfx/layers/IPDLActor.h:43\n./run: line 2:  8366 Segmentation fault: 11  ./obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/firefox-bin -p dev -jsconsole\n#01: mozilla::ipc::ProcessLink::OnChannelError()[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0x5461f7]\n#01: mozilla::layers::CompositableClient::DestroyIPDLActor(mozilla::layers::PCompositableChild*)[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0xede05f]\n#02: IPC::Channel::ChannelImpl::OnFileCanReadWithoutBlocking(int)[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0x51a9c9]\n#02: mozilla::layers::PImageBridgeChild::DeallocSubtree()[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0x63af2c]\n#03: event_base_loop[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0x5241a9]\n#03: mozilla::layers::PImageBridgeChild::OnChannelError()[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0x63b30b]\n#04: base::MessagePumpLibevent::Run(base::MessagePump::Delegate*)[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0x509b65]\n#04: mozilla::ipc::MessageChannel::NotifyMaybeChannelError()[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0x543c64]\nmikedeboer:~/Projects/fx-team$ #05: MessageLoop::Run()[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0x507a7c]\n#05: MessageLoop::DeferOrRunPendingTask(MessageLoop::PendingTask const&)[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0x5082ac]\n#06: base::Thread::ThreadMain()[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0x51221d]\n#06: MessageLoop::DoWork()[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0x5085eb]\n#07: ThreadFunc(void*)[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0x51232a]\n#07: base::MessagePumpDefault::Run(base::MessagePump::Delegate*)[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0x5092d5]\n#08: _pthread_body[/usr/lib/system/libsystem_pthread.dylib +0x405a]\n#08: MessageLoop::Run()[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0x507a7c]\n#09: _pthread_body[/usr/lib/system/libsystem_pthread.dylib +0x3fd7]\n[Child 8368] ###!!! ABORT: Aborting on channel error.: file /Users/mikedeboer/Projects/fx-team/ipc/glue/MessageChannel.cpp, line 2020#09: base::Thread::ThreadMain()[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0x51221d]\n\nHit MOZ_CRASH() at /Users/mikedeboer/Projects/fx-team/memory/mozalloc/mozalloc_abort.cpp:33", "author": "mdeboer@mozilla.com", "id": 11255725, "time": "2016-03-17T16:09:49Z"}, {"text": "(In reply to Mike de Boer [:mikedeboer] from comment #79)\n> Builds fine! Now I get a crash when I attempt to detach a window:\n\nOn the parent process, something appears to be crashing, and the content process crashes as well while running the code invoked by OnChannelError. The assertion that is hit on the content side is because an actor appears to be deleted without calling Destroy() beforehand, which should be simple to figure out but isn't the actual problem (what caused the parent process to crash).\n\nCan you reproduce this crash in a debugger and paste here some more details about the crashing stack on the parent process (I assume the debugger will break on the parent process's crash by default if it behaves like gdb)?\nIt would be interesting to see if it is one of the assertions I added.", "author": "nical.bugzilla@gmail.com", "id": 11256075, "time": "2016-03-17T17:38:51Z"}, {"text": "(In reply to Nicolas Silva [:nical] from comment #80)\n> Can you reproduce this crash in a debugger and paste here some more details\n> about the crashing stack on the parent process (I assume the debugger will\n> break on the parent process's crash by default if it behaves like gdb)?\n> It would be interesting to see if it is one of the assertions I added.\n\nI'm blushing whilst I say this, but I've never had to use a debugger for Fx before, so not right away... It should be _very_ easy to reproduce with https://bugzilla.mozilla.org/attachment.cgi?id=8727967 applied and 'loop.remote.autostart' set to `true`. Or isn't it?", "author": "mdeboer@mozilla.com", "id": 11256119, "time": "2016-03-17T17:49:39Z"}, {"text": "Comment on attachment 8731732\nBulletproof changing a TextureHost's compositor v3\n\nReview of attachment 8731732:\n-----------------------------------------------------------------\n\nJust to make sure: We won't have to check Compositor::IsValid in these AssertCompositor checks since we'll be blocking compositable ops from old layers, as well as composites on old compositors. But maybe it's a good idea anyway?\n\nAlso, while looking at bug 1256517 I wondered whether dragging a tab in a D3D11 window to a software window would ever work... with this patch we'll probably be less likely to outright crash. Is there anything to make sure we'd regenerate textures?", "author": "dvander@alliedmods.net", "id": 11257842, "time": "2016-03-18T07:54:37Z"}, {"text": "(In reply to David Anderson [:dvander] from comment #82)\n> Comment on attachment 8731732\n> Bulletproof changing a TextureHost's compositor v3\n> \n> Review of attachment 8731732:\n> -----------------------------------------------------------------\n> \n> Just to make sure: We won't have to check Compositor::IsValid in these\n> AssertCompositor checks since we'll be blocking compositable ops from old\n> layers, as well as composites on old compositors. But maybe it's a good idea\n> anyway?\n\nMy preference would be to take the paranoid stance and re-check everything whenever it is not too expensive,\nin case things change slightly for whatever reason in the future and the more complex assumptions don't hold anymore. Or assert. Either way if we don't expect something it's good to make noise whenever it happens.\n\n> Also, while looking at bug 1256517 I wondered whether dragging a tab in a\n> D3D11 window to a software window would ever work...\n\nI have been wondering this too and the idea terrifies me. Part of this patch aims at helping us notice this without blindly casting the compositor which is a start but I'd like to better understand what the situation is.\n\n> Is there anything to make sure we'd regenerate textures?\n\nI don't think there is anything for video streams. For regular layers, the layer manager is recreated and the content redrawn when attaching to a new widget.", "author": "nical.bugzilla@gmail.com", "id": 11258214, "time": "2016-03-18T12:19:42Z"}, {"text": "(In reply to Mike de Boer [:mikedeboer] from comment #81)\n> It should be _very_ easy to reproduce with\n> https://bugzilla.mozilla.org/attachment.cgi?id=8727967 applied and\n> 'loop.remote.autostart' set to `true`. Or isn't it?\n\nOn linux, going through this steps I don't get a crash, but something else fails and the window stops redrawing with  \"[Parent 22798] WARNING: ConnectReferentLayer failed - Incorrect LayerManager: file gfx/layers/Layers.h, line 2530\" all over the logs.", "author": "nical.bugzilla@gmail.com", "id": 11258306, "time": "2016-03-18T13:06:50Z"}, {"text": "(In reply to Nicolas Silva [:nical] from comment #84)\n> On linux, going through this steps I don't get a crash, but something else\n> fails and the window stops redrawing with  \"[Parent 22798] WARNING:\n> ConnectReferentLayer failed - Incorrect LayerManager: file\n> gfx/layers/Layers.h, line 2530\" all over the logs.\n\nWhat happens when you comment out the `if` block at https://dxr.mozilla.org/mozilla-central/source/dom/base/nsFrameLoader.cpp#933 and retry?", "author": "mdeboer@mozilla.com", "id": 11258479, "time": "2016-03-18T13:50:10Z"}, {"text": "With me applying comment 85, it seems like we're almost there! So it pops out, docShell gets swapped, but after a short while (like 2 seconds) there's a crash with the following stack:\n\n[Parent 53136] WARNING: ConnectReferentLayer failed - Incorrect LayerManager: file /Users/mikedeboer/Projects/fx-team/gfx/layers/Layers.h, line 2530\n[Parent 53136] WARNING: ConnectReferentLayer failed - Incorrect LayerManager: file /Users/mikedeboer/Projects/fx-team/gfx/layers/Layers.h, line 2530\n[Parent 53136] WARNING: ConnectReferentLayer failed - Incorrect LayerManager: file /Users/mikedeboer/Projects/fx-team/gfx/layers/Layers.h, line 2530\n[Parent 53136] WARNING: Trying to query the format of an empty TextureSource.: file /Users/mikedeboer/Projects/fx-team/gfx/layers/opengl/TextureHostOGL.cpp, line 274\n[Parent 53136] WARNING: Trying to query the size of an empty TextureSource.: file /Users/mikedeboer/Projects/fx-team/gfx/layers/opengl/TextureHostOGL.cpp, line 264\n[Parent 53136] WARNING: ConnectReferentLayer failed - Incorrect LayerManager: file /Users/mikedeboer/Projects/fx-team/gfx/layers/Layers.h, line 2530\n[Parent 53136] WARNING: ConnectReferentLayer failed - Incorrect LayerManager: file /Users/mikedeboer/Projects/fx-team/gfx/layers/Layers.h, line 2530\n[Parent 53136] WARNING: ConnectReferentLayer failed - Incorrect LayerManager: file /Users/mikedeboer/Projects/fx-team/gfx/layers/Layers.h, line 2530\n[Parent 53136] WARNING: ConnectReferentLayer failed - Incorrect LayerManager: file /Users/mikedeboer/Projects/fx-team/gfx/layers/Layers.h, line 2530\n[Parent 53136] WARNING: ConnectReferentLayer failed - Incorrect LayerManager: file /Users/mikedeboer/Projects/fx-team/gfx/layers/Layers.h, line 2530\nAssertion failure: IsCurrent(), at /Users/mikedeboer/Projects/fx-team/gfx/gl/GLContext.h:724\n#01: mozilla::layers::ImageHost::Composite(mozilla::layers::LayerComposite*, mozilla::layers::EffectChain&, float, mozilla::gfx::Matrix4x4Typed<mozilla::gfx::UnknownUnits, mozilla::gfx::UnknownUnits> const&, mozilla::gfx::Filter const&, mozilla::gfx::RectTyped[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0xf08b21]\n#02: mozilla::layers::ImageLayerComposite::RenderLayer(mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&)[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0xf0a785]\n#03: void mozilla::layers::RenderLayers<mozilla::layers::ContainerLayerComposite>(mozilla::layers::ContainerLayerComposite*, mozilla::layers::LayerManagerComposite*, mozilla::gfx::IntRectTyped<mozilla::RenderTargetPixel> const&)[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0xf209a9]\n#04: void mozilla::layers::ContainerRender<mozilla::layers::ContainerLayerComposite>(mozilla::layers::ContainerLayerComposite*, mozilla::layers::LayerManagerComposite*, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&)[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0xf133f0]\n[Parent 53136] WARNING: Releasing screensaver: file /Users/mikedeboer/Projects/fx-team/widget/cocoa/nsAppShell.mm, line 83\n[Parent 53136] WARNING: Releasing screensaver: file /Users/mikedeboer/Projects/fx-team/widget/cocoa/nsAppShell.mm, line 83\n[Parent 53136] WARNING: failed to release screensaver: file /Users/mikedeboer/Projects/fx-team/widget/cocoa/nsAppShell.mm, line 87\n#05: void mozilla::layers::RenderLayers<mozilla::layers::ContainerLayerComposite>(mozilla::layers::ContainerLayerComposite*, mozilla::layers::LayerManagerComposite*, mozilla::gfx::IntRectTyped<mozilla::RenderTargetPixel> const&)[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0xf209a9]\n#06: void mozilla::layers::ContainerRender<mozilla::layers::ContainerLayerComposite>(mozilla::layers::ContainerLayerComposite*, mozilla::layers::LayerManagerComposite*, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&)[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0xf133f0]\n#07: void mozilla::layers::RenderLayers<mozilla::layers::RefLayerComposite>(mozilla::layers::RefLayerComposite*, mozilla::layers::LayerManagerComposite*, mozilla::gfx::IntRectTyped<mozilla::RenderTargetPixel> const&)[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0xf24989]\n#08: void mozilla::layers::ContainerRender<mozilla::layers::RefLayerComposite>(mozilla::layers::RefLayerComposite*, mozilla::layers::LayerManagerComposite*, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&)[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0xf141c0]\n#09: void mozilla::layers::RenderLayers<mozilla::layers::ContainerLayerComposite>(mozilla::layers::ContainerLayerComposite*, mozilla::layers::LayerManagerComposite*, mozilla::gfx::IntRectTyped<mozilla::RenderTargetPixel> const&)[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0xf209a9]\n#10: void mozilla::layers::ContainerRender<mozilla::layers::ContainerLayerComposite>(mozilla::layers::ContainerLayerComposite*, mozilla::layers::LayerManagerComposite*, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&)[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0xf133f0]\n#11: mozilla::layers::LayerManagerComposite::Render(mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&)[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0xf0e5bc]\n#12: mozilla::layers::LayerManagerComposite::UpdateAndRender()[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0xf0d83a]\n#13: mozilla::layers::LayerManagerComposite::EndTransaction(mozilla::TimeStamp const&, mozilla::layers::LayerManager::EndTransactionFlags)[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0xf0d3a3]\n#14: mozilla::layers::CompositorParent::CompositeToTarget(mozilla::gfx::DrawTarget*, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const*)[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0xf3597e]\n#15: mozilla::layers::CompositorVsyncScheduler::Composite(mozilla::TimeStamp)[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0xf34aed]\n#16: MessageLoop::DeferOrRunPendingTask(MessageLoop::PendingTask const&)[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0x50829c]\n#17: MessageLoop::DoWork()[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0x5085db]\n#18: base::MessagePumpDefault::Run(base::MessagePump::Delegate*)[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0x5092c5]\n#19: MessageLoop::Run()[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0x507a6c]\n#20: base::Thread::ThreadMain()[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0x51220d]\n#21: ThreadFunc(void*)[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0x51231a]\n#22: _pthread_body[/usr/lib/system/libsystem_pthread.dylib +0x405a]\n#23: _pthread_body[/usr/lib/system/libsystem_pthread.dylib +0x3fd7]\n[Child 53138] WARNING: short timeout didn't get an id (ipc/rcv) timed out 10004003\n: file /Users/mikedeboer/Projects/fx-team/ipc/glue/SharedMemoryBasic_mach.mm, line 622\nAssertion failure: false (Receiver message short time out), at /Users/mikedeboer/Projects/fx-team/ipc/glue/SharedMemoryBasic_mach.mm:623\n#01: mozilla::ipc::Shmem::ShareTo(mozilla::ipc::Shmem::IHadBetterBeIPDLCodeCallingThis_OtherwiseIAmADoodyhead, int, int)[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0x5496f8]\n#02: mozilla::layers::PImageBridgeChild::CreateSharedMemory(unsigned long, mozilla::ipc::SharedMemory::SharedMemoryType, bool, int*)[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0x638d84]\n#03: mozilla::layers::PImageBridgeChild::AllocUnsafeShmem(unsigned long, mozilla::ipc::SharedMemory::SharedMemoryType, mozilla::ipc::Shmem*)[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0x63b3ae]\n#04: mozilla::layers::ImageBridgeChild::AllocUnsafeShmem(unsigned long, mozilla::ipc::SharedMemory::SharedMemoryType, mozilla::ipc::Shmem*)[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0xf4170a]\n#05: mozilla::layers::ShmemTextureData::Create(mozilla::gfx::IntSizeTyped<mozilla::gfx::UnknownUnits>, mozilla::gfx::SurfaceFormat, mozilla::gfx::BackendType, mozilla::layers::TextureFlags, mozilla::layers::TextureAllocationFlags, mozilla::layers::ISurfaceAllo[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0xe7285a]\n#06: mozilla::layers::BufferTextureData::Create(mozilla::gfx::IntSizeTyped<mozilla::gfx::UnknownUnits>, mozilla::gfx::SurfaceFormat, mozilla::gfx::BackendType, mozilla::layers::TextureFlags, mozilla::layers::TextureAllocationFlags, mozilla::layers::ISurfaceAll[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0xe7227d]\n#07: mozilla::layers::TextureClient::CreateForRawBufferAccess(mozilla::layers::ISurfaceAllocator*, mozilla::gfx::SurfaceFormat, mozilla::gfx::IntSizeTyped<mozilla::gfx::UnknownUnits>, mozilla::gfx::BackendType, mozilla::layers::TextureFlags, mozilla::layers::T[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0xeed5a9]\n#08: mozilla::layers::TextureClient::CreateForDrawing(mozilla::layers::CompositableForwarder*, mozilla::gfx::SurfaceFormat, mozilla::gfx::IntSizeTyped<mozilla::gfx::UnknownUnits>, mozilla::layers::BackendSelector, mozilla::layers::TextureFlags, mozilla::layers[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0xeed439]\n#09: mozilla::layers::CompositableClient::CreateTextureClientForDrawing(mozilla::gfx::SurfaceFormat, mozilla::gfx::IntSizeTyped<mozilla::gfx::UnknownUnits>, mozilla::layers::BackendSelector, mozilla::layers::TextureFlags, mozilla::layers::TextureAllocationFlag[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0xede482]\n#10: mozilla::layers::SourceSurfaceImage::GetTextureClient(mozilla::layers::CompositableClient*)[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0xe55970]\n#11: mozilla::layers::ImageClientSingle::UpdateImage(mozilla::layers::ImageContainer*, unsigned int)[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0xee138f]\n#12: mozilla::layers::UpdateImageClientNow(mozilla::layers::ImageClient*, RefPtr<mozilla::layers::ImageContainer>&&)[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0xf3ef7d]\n#13: MessageLoop::DeferOrRunPendingTask(MessageLoop::PendingTask const&)[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0x50829c]\n#14: MessageLoop::DoWork()[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0x5085db]\n#15: base::MessagePumpDefault::Run(base::MessagePump::Delegate*)[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0x5092c5]\n#16: MessageLoop::Run()[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0x507a6c]\n#17: base::Thread::ThreadMain()[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0x51220d]\n#18: ThreadFunc(void*)[/Users/mikedeboer/Projects/fx-team/obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/XUL +0x51231a]\n#19: _pthread_body[/usr/lib/system/libsystem_pthread.dylib +0x405a]\n#20: _pthread_body[/usr/lib/system/libsystem_pthread.dylib +0x3fd7]\n./run: line 2: 53136 Segmentation fault: 11  ./obj-x86_64-apple-darwin14.5.0/dist/NightlyDebug.app/Contents/MacOS/firefox-bin -p dev -jsconsole", "author": "mdeboer@mozilla.com", "id": 11258497, "time": "2016-03-18T13:55:57Z"}, {"text": "(In reply to Mike de Boer [:mikedeboer] from comment #85)\n> (In reply to Nicolas Silva [:nical] from comment #84)\n> What happens when you comment out the `if` block at\n> https://dxr.mozilla.org/mozilla-central/source/dom/base/nsFrameLoader.\n> cpp#933 and retry?\n\nAh, right. With this it work for me, I don't get the crash.", "author": "nical.bugzilla@gmail.com", "id": 11258627, "time": "2016-03-18T14:19:44Z"}, {"text": "Nicolas, what can you make of the crash signature in comment 86?", "author": "mdeboer@mozilla.com", "id": 11263048, "time": "2016-03-21T11:02:09Z"}, {"text": "(In reply to Mike de Boer [:mikedeboer] from comment #88)\n> Nicolas, what can you make of the crash signature in comment 86?\n\nThe assertion we hit is that a texture (most likely a video frame in this case) is using an opengl context that is not the currently active context. This either means that somewhere we should have called MakeCurrent on the context, or that we did call it but it failed and we didn't react to that. From the stack it is not 100% sure which context call is blowing up, so the patch I uploaded tries to strengthen all of the code paths I could think of that could lead to this situation, so I am surprised that you are still seeing the same stack after applying the patch.", "author": "nical.bugzilla@gmail.com", "id": 11263270, "time": "2016-03-21T13:04:34Z"}, {"text": "So what's the most obvious follow-up action here? Will you land your patch? And after that, what can we do to fix this crash?", "author": "mdeboer@mozilla.com", "id": 11267048, "time": "2016-03-22T12:02:52Z"}, {"text": "https://hg.mozilla.org/integration/mozilla-inbound/rev/38aa13f30b92", "author": "pulsebot@bots.tld", "id": 11267359, "time": "2016-03-22T14:29:44Z"}, {"text": "backed out for bc7 crashes like https://treeherder.mozilla.org/logviewer.html#?job_id=24338216&repo=mozilla-inbound", "author": "cbook@mozilla.com", "id": 11267703, "time": "2016-03-22T16:12:37Z"}, {"text": "Backout:\nhttps://hg.mozilla.org/integration/mozilla-inbound/rev/29bf03ba2b47", "author": "pulsebot@bots.tld", "id": 11267729, "time": "2016-03-22T16:22:29Z"}, {"text": "(In reply to Carsten Book [:Tomcat] from comment #92)\n> backed out for bc7 crashes like\n> https://treeherder.mozilla.org/logviewer.html#?job_id=24338216&repo=mozilla-\n> inbound\n\nExciting (read: super scary). This means we are currently doing very unsafe things on Mac. The failing assertion is checking something so fundamental we didn't even think about verifying it before.", "author": "nical.bugzilla@gmail.com", "id": 11267901, "time": "2016-03-22T17:18:35Z"}, {"text": "(In reply to Nicolas Silva [:nical] from comment #94)\n> Exciting (read: super scary). This means we are currently doing very unsafe\n> things on Mac. The failing assertion is checking something so fundamental we\n> didn't even think about verifying it before.\n\nI think this now has moved beyond the scope of this bug. Can you file a new one where the cause of the assertions hit will be resolved, blocking this one? I'm asking you, because I have no real clue what the summary of that issue should be and whom to CC, etc. It will, however, block the release of e10s.", "author": "mdeboer@mozilla.com", "id": 11268866, "time": "2016-03-22T21:16:34Z"}, {"text": "> I think this now has moved beyond the scope of this bug. Can you file a new\n> one where the cause of the assertions hit will be resolved, blocking this\n> one?\n\nAlready did, it's bug 1258768. But I may have gotten carried away too quickly and the thing I was worried about may not be happening anyway, I'll continue that part of the investigation there.", "author": "nical.bugzilla@gmail.com", "id": 11270416, "time": "2016-03-23T10:30:58Z"}, {"text": "https://hg.mozilla.org/integration/mozilla-inbound/rev/2e636d5fcda8", "author": "pulsebot@bots.tld", "id": 11270526, "time": "2016-03-23T11:31:28Z"}, {"text": "https://hg.mozilla.org/integration/mozilla-inbound/rev/8535142add0f", "author": "pulsebot@bots.tld", "id": 11270549, "time": "2016-03-23T11:49:29Z"}, {"text": "https://hg.mozilla.org/integration/mozilla-inbound/rev/bef0b9911c0b", "author": "pulsebot@bots.tld", "id": 11270871, "time": "2016-03-23T14:32:41Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/2e636d5fcda8\nhttps://hg.mozilla.org/mozilla-central/rev/8535142add0f\nhttps://hg.mozilla.org/mozilla-central/rev/bef0b9911c0b", "author": "cbook@mozilla.com", "id": 11274893, "time": "2016-03-24T15:18:26Z"}, {"text": "I think the work here is done and we've been able to iron out a few edge cases for remote browsers. Thanks all!", "author": "mdeboer@mozilla.com", "id": 11644410, "time": "2016-08-22T15:03:38Z"}], "cf_last_resolved": "2016-08-22T15:03:38Z", "priority": "P1", "mentors_detail": [], "cf_crash_signature": "", "version": "Trunk", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox59": "---", "last_change_time": "2016-08-22T15:03:38Z", "cf_platform_rel": "---", "product": "Firefox", "cf_status_firefox_esr52": "---", "blocks": [1154273, 1250847, 1256357], "qa_contact": "", "see_also": [], "cf_fx_iteration": "---", "component": "General", "votes": 0, "groups": [], "cf_status_firefox60": "---", "target_milestone": "---", "is_cc_accessible": true, "cf_status_firefox46": "fixed", "url": "", "creator_detail": {"email": "mdeboer@mozilla.com", "id": 463945, "name": "mdeboer@mozilla.com", "real_name": "Mike de Boer [:mikedeboer] (Away from March 5 - 21st)"}, "whiteboard": "[e10s]", "mentors": [], "cc_detail": [{"email": "bill.mccloskey@gmail.com", "id": 389993, "name": "bill.mccloskey@gmail.com", "real_name": "Bill McCloskey [inactive unless it's an emergency] (:billm)"}, {"email": "bugs@pettay.fi", "id": 39966, "name": "bugs@pettay.fi", "real_name": "Olli Pettay [:smaug]"}, {"email": "cbook@mozilla.com", "id": 277293, "name": "cbook@mozilla.com", "real_name": "Carsten Book [:Tomcat]"}, {"email": "dmose@mozilla.org", "id": 1537, "name": "dmose@mozilla.org", "real_name": "Dan Mosedale (:dmose)"}, {"email": "dvander@alliedmods.net", "id": 309316, "name": "dvander@alliedmods.net", "real_name": "David Anderson [:dvander] - inactive, e-mail if emergency"}, {"email": "edilee@mozilla.com", "id": 125983, "name": "edilee@mozilla.com", "real_name": "Ed Lee :Mardak (PTO-Mar18)"}, {"email": "felipc@gmail.com", "id": 208747, "name": "felipc@gmail.com", "real_name": ":Felipe Gomes (needinfo me!)"}, {"email": "freesamael@gmail.com", "id": 531029, "name": "freesamael@gmail.com", "real_name": "Samael Wang [:freesamael] (away for now)"}, {"email": "ianb@mozilla.com", "id": 49196, "name": "ianb@mozilla.com", "real_name": "Ian Bicking (:ianbicking)"}, {"email": "jgriffiths@mozilla.com", "id": 421111, "name": "jgriffiths@mozilla.com", "real_name": "Jeff Griffiths (:canuckistani) (:\u26a1\ufe0e)"}, {"email": "jmathies@mozilla.com", "id": 279663, "name": "jmathies@mozilla.com", "real_name": "Jim Mathies [:jimm]"}, {"email": "mconley@mozilla.com", "id": 403756, "name": "mconley@mozilla.com", "real_name": "Mike Conley (:mconley) (:\u2699\ufe0f) (Totally backlogged on reviews and needinfos)"}, {"email": "mdeboer@mozilla.com", "id": 463945, "name": "mdeboer@mozilla.com", "real_name": "Mike de Boer [:mikedeboer] (Away from March 5 - 21st)"}, {"email": "mixedpuppy@gmail.com", "id": 372685, "name": "mixedpuppy@gmail.com", "real_name": "Shane Caraveo (:mixedpuppy)"}, {"email": "nical.bugzilla@gmail.com", "id": 438998, "name": "nical.bugzilla@gmail.com", "real_name": "Nicolas Silva [:nical]"}, {"email": "ovidiu.boca@softvision.ro", "id": 551038, "name": "ovidiu.boca@softvision.ro", "real_name": "ovidiu boca[:Ovidiu]"}, {"email": "ryanvm@gmail.com", "id": 75935, "name": "ryanvm@gmail.com", "real_name": "Ryan VanderMeulen [:RyanVM]"}, {"email": "standard8@mozilla.com", "id": 112088, "name": "standard8@mozilla.com", "real_name": "Mark Banner (:standard8)"}], "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [{"status": "+", "name": "firefox-backlog", "modification_date": "2016-02-04T12:48:26Z", "type_id": 846, "creation_date": "2016-02-04T12:48:26Z", "id": 1336522, "setter": "mdeboer@mozilla.com"}, {"status": "+", "name": "qe-verify", "modification_date": "2016-02-04T12:48:26Z", "type_id": 864, "creation_date": "2016-02-04T12:48:26Z", "id": 1336523, "setter": "mdeboer@mozilla.com"}], "cf_tracking_firefox58": "---", "cf_rank": null, "is_open": false, "resolution": "FIXED", "op_sys": "Unspecified", "cf_fx_points": "---", "history": [{"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "firefox-backlog+, qe-verify+"}], "who": "mdeboer@mozilla.com", "when": "2016-02-04T12:48:26Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(bugs@pettay.fi)"}], "who": "mdeboer@mozilla.com", "when": "2016-02-10T13:33:10Z"}, {"changes": [{"removed": "needinfo?(bugs@pettay.fi)", "field_name": "flagtypes.name", "added": ""}], "who": "bugs@pettay.fi", "when": "2016-02-10T15:19:34Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(bugs@pettay.fi)"}], "who": "mdeboer@mozilla.com", "when": "2016-02-10T16:00:22Z"}, {"changes": [{"removed": "needinfo?(bugs@pettay.fi)", "field_name": "flagtypes.name", "added": ""}], "who": "bugs@pettay.fi", "when": "2016-02-10T17:49:52Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(bugs@pettay.fi)"}], "who": "mdeboer@mozilla.com", "when": "2016-02-11T10:44:26Z"}, {"changes": [{"removed": "needinfo?(bugs@pettay.fi)", "field_name": "flagtypes.name", "added": ""}], "who": "bugs@pettay.fi", "when": "2016-02-11T17:10:48Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "ASSIGNED"}, {"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "mdeboer@mozilla.com"}], "who": "mdeboer@mozilla.com", "when": "2016-02-11T20:54:23Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8718518, "added": "review?(standard8@mozilla.com)"}], "who": "mdeboer@mozilla.com", "when": "2016-02-11T21:12:12Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8718511, "added": "review?(standard8@mozilla.com)"}], "who": "mdeboer@mozilla.com", "when": "2016-02-11T21:12:35Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8718518, "added": "review?(mixedpuppy@gmail.com)"}], "who": "mdeboer@mozilla.com", "when": "2016-02-11T21:13:21Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(standard8@mozilla.com), review?(mixedpuppy@gmail.com)", "attachment_id": 8718518, "added": ""}], "who": "mdeboer@mozilla.com", "when": "2016-02-11T21:16:09Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8718518, "added": "1"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8718541, "added": "review?(mixedpuppy@gmail.com)"}], "who": "mdeboer@mozilla.com", "when": "2016-02-11T22:11:35Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8718542, "added": "review?(bugs@pettay.fi)"}], "who": "mdeboer@mozilla.com", "when": "2016-02-11T22:12:25Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(bugs@pettay.fi)", "attachment_id": 8718542, "added": "review+"}], "who": "bugs@pettay.fi", "when": "2016-02-11T22:16:08Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(mixedpuppy@gmail.com)", "attachment_id": 8718541, "added": "review+"}], "who": "mixedpuppy@gmail.com", "when": "2016-02-11T23:46:43Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "leave-open"}], "who": "mdeboer@mozilla.com", "when": "2016-02-12T12:25:36Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(standard8@mozilla.com)", "attachment_id": 8718511, "added": "review+"}], "who": "standard8@mozilla.com", "when": "2016-02-12T13:30:44Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1248377"}], "who": "mdeboer@mozilla.com", "when": "2016-02-15T14:35:15Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "ianb@mozilla.com"}, {"removed": "---", "field_name": "cf_tracking_e10s", "added": "?"}], "who": "standard8@mozilla.com", "when": "2016-02-24T11:05:14Z"}, {"changes": [{"removed": "", "field_name": "blocks", "added": "1154273"}], "who": "standard8@mozilla.com", "when": "2016-02-24T11:07:45Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(standard8@mozilla.com)"}], "who": "jmathies@mozilla.com", "when": "2016-02-25T17:37:48Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "mdeboer@mozilla.com"}, {"removed": "needinfo?(standard8@mozilla.com)", "field_name": "flagtypes.name", "added": "needinfo?(mdeboer@mozilla.com)"}], "who": "standard8@mozilla.com", "when": "2016-02-25T19:06:30Z"}, {"changes": [{"removed": "needinfo?(mdeboer@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "mdeboer@mozilla.com", "when": "2016-02-25T21:33:33Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(jmathies@mozilla.com)"}], "who": "mdeboer@mozilla.com", "when": "2016-02-25T21:34:00Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(bugs@pettay.fi)"}], "who": "mixedpuppy@gmail.com", "when": "2016-02-25T22:39:20Z"}, {"changes": [{"removed": "needinfo?(bugs@pettay.fi)", "field_name": "flagtypes.name", "added": ""}], "who": "bugs@pettay.fi", "when": "2016-02-26T13:30:28Z"}, {"changes": [{"removed": "needinfo?(jmathies@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "jmathies@mozilla.com", "when": "2016-02-26T14:52:59Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "wmccloskey@mozilla.com"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(wmccloskey@mozilla.com)"}], "who": "bill.mccloskey@gmail.com", "when": "2016-03-01T21:15:39Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8718541, "added": "approval-mozilla-aurora?"}], "who": "mdeboer@mozilla.com", "when": "2016-03-02T13:45:54Z"}, {"changes": [{"removed": "", "field_name": "blocks", "added": "1250847"}], "who": "standard8@mozilla.com", "when": "2016-03-02T14:03:20Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "approval-mozilla-aurora?", "attachment_id": 8718541, "added": "approval-mozilla-aurora+"}], "who": "lhenry@mozilla.com", "when": "2016-03-03T21:24:47Z"}, {"changes": [{"removed": "needinfo?(wmccloskey@mozilla.com)", "field_name": "flagtypes.name", "added": "needinfo?(mdeboer@mozilla.com)"}], "who": "bill.mccloskey@gmail.com", "when": "2016-03-04T00:11:58Z"}, {"changes": [{"removed": "needinfo?(mdeboer@mozilla.com)", "field_name": "flagtypes.name", "added": "needinfo?(wmccloskey@mozilla.com)"}], "who": "mdeboer@mozilla.com", "when": "2016-03-04T10:07:21Z"}, {"changes": [{"removed": "---", "field_name": "cf_status_firefox46", "added": "fixed"}], "who": "standard8@mozilla.com", "when": "2016-03-04T10:09:51Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "dmose@mozilla.org"}], "who": "dmose@mozilla.org", "when": "2016-03-04T15:22:35Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "ryanvm@gmail.com"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(ryanvm@gmail.com)"}], "who": "jmathies@mozilla.com", "when": "2016-03-04T16:01:25Z"}, {"changes": [{"removed": "needinfo?(wmccloskey@mozilla.com)", "field_name": "flagtypes.name", "added": "needinfo?(mdeboer@mozilla.com)"}], "who": "bill.mccloskey@gmail.com", "when": "2016-03-04T16:07:50Z"}, {"changes": [{"removed": "needinfo?(mdeboer@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "mdeboer@mozilla.com", "when": "2016-03-04T17:59:00Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(standard8@mozilla.com)"}], "who": "jmathies@mozilla.com", "when": "2016-03-04T22:04:20Z"}, {"changes": [{"removed": "needinfo?(ryanvm@gmail.com)", "field_name": "flagtypes.name", "added": ""}], "who": "ryanvm@gmail.com", "when": "2016-03-07T02:51:08Z"}, {"changes": [{"removed": "needinfo?(standard8@mozilla.com)", "field_name": "flagtypes.name", "added": "needinfo?(mdeboer@mozilla.com)"}], "who": "standard8@mozilla.com", "when": "2016-03-07T10:03:14Z"}, {"changes": [{"removed": "needinfo?(mdeboer@mozilla.com)", "field_name": "flagtypes.name", "added": "needinfo?(wmccloskey@mozilla.com), needinfo?(bugs@pettay.fi)"}], "who": "mdeboer@mozilla.com", "when": "2016-03-08T18:06:48Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8715831, "added": "1"}], "who": "mdeboer@mozilla.com", "when": "2016-03-08T18:07:27Z"}, {"changes": [{"removed": "needinfo?(bugs@pettay.fi)", "field_name": "flagtypes.name", "added": ""}], "who": "bugs@pettay.fi", "when": "2016-03-10T17:10:48Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "nical.bugzilla@gmail.com"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(nical.bugzilla@gmail.com)"}], "who": "bugs@pettay.fi", "when": "2016-03-10T18:33:53Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "jgriffiths@mozilla.com"}], "who": "jgriffiths@mozilla.com", "when": "2016-03-10T23:01:10Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1255491"}], "who": "standard8@mozilla.com", "when": "2016-03-11T14:31:52Z"}, {"changes": [{"removed": "", "field_name": "blocks", "added": "1256357"}], "who": "mdeboer@mozilla.com", "when": "2016-03-14T17:03:13Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8730654, "added": "review?(standard8@mozilla.com)"}], "who": "mdeboer@mozilla.com", "when": "2016-03-15T11:08:51Z"}, {"changes": [{"removed": "Swapping messageManagers doesn't work for regular browser elements", "field_name": "summary", "added": "Swapping docShells doesn't work for regular browser elements"}], "who": "mdeboer@mozilla.com", "when": "2016-03-15T16:29:52Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(standard8@mozilla.com)", "attachment_id": 8730654, "added": "review-"}], "who": "standard8@mozilla.com", "when": "2016-03-16T19:15:01Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "dvander@alliedmods.net"}, {"removed": "needinfo?(nical.bugzilla@gmail.com)", "field_name": "flagtypes.name", "added": ""}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8731673, "added": "review?(dvander@alliedmods.net)"}], "who": "nical.bugzilla@gmail.com", "when": "2016-03-17T12:40:44Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8731673, "added": "1"}, {"field_name": "flagtypes.name", "removed": "review?(dvander@alliedmods.net)", "attachment_id": 8731673, "added": ""}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8731695, "added": "review?(dvander@alliedmods.net)"}], "who": "nical.bugzilla@gmail.com", "when": "2016-03-17T14:38:21Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "ovidiu.boca@softvision.ro"}], "who": "standard8@mozilla.com", "when": "2016-03-17T14:59:03Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8730654, "added": "1"}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8731716, "added": "review?(standard8@mozilla.com)"}], "who": "mdeboer@mozilla.com", "when": "2016-03-17T15:10:19Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(nical.bugzilla@gmail.com)"}], "who": "mdeboer@mozilla.com", "when": "2016-03-17T15:17:21Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8731695, "added": "1"}, {"field_name": "flagtypes.name", "removed": "review?(dvander@alliedmods.net)", "attachment_id": 8731695, "added": ""}, {"removed": "needinfo?(nical.bugzilla@gmail.com)", "field_name": "flagtypes.name", "added": ""}, {"field_name": "flagtypes.name", "removed": "", "attachment_id": 8731732, "added": "review?(dvander@alliedmods.net)"}], "who": "nical.bugzilla@gmail.com", "when": "2016-03-17T15:53:25Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(dvander@alliedmods.net)", "attachment_id": 8731732, "added": "review+"}], "who": "dvander@alliedmods.net", "when": "2016-03-18T07:54:37Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(nical.bugzilla@gmail.com)"}], "who": "mdeboer@mozilla.com", "when": "2016-03-18T13:50:10Z"}, {"changes": [{"removed": "needinfo?(nical.bugzilla@gmail.com)", "field_name": "flagtypes.name", "added": ""}], "who": "nical.bugzilla@gmail.com", "when": "2016-03-18T14:19:44Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(nical.bugzilla@gmail.com)"}], "who": "mdeboer@mozilla.com", "when": "2016-03-21T11:02:09Z"}, {"changes": [{"removed": "needinfo?(nical.bugzilla@gmail.com)", "field_name": "flagtypes.name", "added": ""}], "who": "nical.bugzilla@gmail.com", "when": "2016-03-21T13:04:34Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(nical.bugzilla@gmail.com)"}], "who": "mdeboer@mozilla.com", "when": "2016-03-22T12:02:52Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(standard8@mozilla.com)", "attachment_id": 8731716, "added": "review+"}], "who": "standard8@mozilla.com", "when": "2016-03-22T16:10:55Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "cbook@mozilla.com"}], "who": "cbook@mozilla.com", "when": "2016-03-22T16:12:37Z"}, {"changes": [{"removed": "needinfo?(nical.bugzilla@gmail.com)", "field_name": "flagtypes.name", "added": ""}], "who": "nical.bugzilla@gmail.com", "when": "2016-03-22T17:18:35Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(nical.bugzilla@gmail.com)"}], "who": "mdeboer@mozilla.com", "when": "2016-03-22T21:16:47Z"}, {"changes": [{"removed": "needinfo?(nical.bugzilla@gmail.com)", "field_name": "flagtypes.name", "added": ""}], "who": "nical.bugzilla@gmail.com", "when": "2016-03-23T10:30:58Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1258768"}], "who": "mdeboer@mozilla.com", "when": "2016-03-23T12:23:54Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1266421"}], "who": "lhenry@mozilla.com", "when": "2016-04-21T14:41:11Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "sawang@mozilla.com"}], "who": "freesamael@gmail.com", "when": "2016-04-22T07:43:35Z"}, {"changes": [{"removed": "?", "field_name": "cf_tracking_e10s", "added": "+"}], "who": "jmathies@mozilla.com", "when": "2016-04-27T15:43:34Z"}, {"changes": [{"removed": "needinfo?(wmccloskey@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "bill.mccloskey@gmail.com", "when": "2016-06-07T23:28:40Z"}, {"changes": [{"removed": "leave-open", "field_name": "keywords", "added": ""}, {"removed": "ASSIGNED", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2016-08-22 15:03:38"}], "who": "mdeboer@mozilla.com", "when": "2016-08-22T15:03:38Z"}]}