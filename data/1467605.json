{"cf_tracking_thunderbird_esr52": "---", "status": "RESOLVED", "cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "classification": "Components", "creator": "mfroman@nostrum.com", "cc": ["bpostelnicu@mozilla.com", "dustin@mozilla.com", "gps@mozilla.com", "mcastelluccio@mozilla.com", "mh+mozilla@glandium.org"], "depends_on": [], "creation_time": "2018-06-07T22:05:10Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "keywords": ["regression"], "summary": "Bug 1460777 seems to break ./mach bootstrap on linux", "cf_last_resolved": "2018-06-08T10:00:49Z", "attachments": [{"creator": "phab-bot@bmo.tld", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-06-07T23:04:24Z", "type_id": 4, "creation_date": "2018-06-07T23:04:24Z", "id": 1767373, "setter": "mh+mozilla@glandium.org"}], "content_type": "text/x-phabricator-request", "id": 8984310}], "assigned_to_detail": {"email": "gps@mozilla.com", "id": 420446, "name": "gps@mozilla.com", "real_name": "Gregory Szorc [:gps]"}, "severity": "normal", "is_confirmed": true, "is_creator_accessible": true, "comments": [{"text": "I'm running an Ubuntu 18.04 VM.  Also verified on 16.04 baremetal.\nIf I update to 306ce4906024 (the commit prior to 1460777 landing) ./mach bootstrap completes successfully.  If I update to 90dca0906337, ./mach bootstrap fails with the following output:\n\nError running mach:\n\n    ['artifact', 'toolchain', '--from-build', 'linux64-clang']\n\nThe error occurred in code that was called by the mach command. This is either\na bug in the called code itself or in the way that mach is calling it.\n\nYou should consider filing a bug for this issue.\n\nIf filing a bug, please include the full output of mach, including this error\nmessage.\n\nThe details of the failure are as follows:\n\nException: Missing fetch job for toolchain-linux64-mingw32-gcc: binutils-2.27\n\n  File \"/home/mfroman/mozilla/moz-central/python/mozbuild/mozbuild/mach_commands.py\", line 1389, in artifact_toolchain\n    toolchains = tasks('toolchain')\n  File \"/home/mfroman/mozilla/moz-central/python/mozbuild/mozbuild/mach_commands.py\", line 1383, in tasks\n    tasks = Kind.load(root_path, graph_config, kind_name).load_tasks(params, {})\n  File \"/home/mfroman/mozilla/moz-central/taskcluster/taskgraph/generator.py\", line 73, in load_tasks\n    for task_dict in transforms(trans_config, inputs)]\n  File \"/home/mfroman/mozilla/moz-central/taskcluster/taskgraph/transforms/task.py\", line 1710, in check_run_task_caches\n    for task in tasks:\n  File \"/home/mfroman/mozilla/moz-central/taskcluster/taskgraph/transforms/task.py\", line 1656, in check_task_dependencies\n    for task in tasks:\n  File \"/home/mfroman/mozilla/moz-central/taskcluster/taskgraph/transforms/task.py\", line 1644, in check_task_identifiers\n    for task in tasks:\n  File \"/home/mfroman/mozilla/moz-central/taskcluster/taskgraph/transforms/task.py\", line 1627, in chain_of_trust\n    for task in tasks:\n  File \"/home/mfroman/mozilla/moz-central/taskcluster/taskgraph/transforms/task.py\", line 1474, in build_task\n    for task in tasks:\n  File \"/home/mfroman/mozilla/moz-central/taskcluster/taskgraph/transforms/task.py\", line 1444, in add_index_routes\n    for task in tasks:\n  File \"/home/mfroman/mozilla/moz-central/taskcluster/taskgraph/transforms/task.py\", line 1266, in validate\n    for task in tasks:\n  File \"/home/mfroman/mozilla/moz-central/taskcluster/taskgraph/transforms/task.py\", line 1243, in task_name_from_label\n    for task in tasks:\n  File \"/home/mfroman/mozilla/moz-central/taskcluster/taskgraph/transforms/task.py\", line 1204, in set_defaults\n    for task in tasks:\n  File \"/home/mfroman/mozilla/moz-central/taskcluster/taskgraph/transforms/job/__init__.py\", line 136, in make_task_description\n    for job in jobs:\n  File \"/home/mfroman/mozilla/moz-central/taskcluster/taskgraph/transforms/job/__init__.py\", line 113, in rewrite_when_to_optimization\n    for job in jobs:\n  File \"/home/mfroman/mozilla/moz-central/taskcluster/taskgraph/transforms/job/__init__.py\", line 105, in validate\n    for job in jobs:\n  File \"/home/mfroman/mozilla/moz-central/taskcluster/taskgraph/transforms/use_toolchains.py\", line 32, in use_toolchains\n    jobs = list(jobs)\n  File \"/home/mfroman/mozilla/moz-central/taskcluster/taskgraph/transforms/use_fetches.py\", line 40, in use_fetches\n    config.kind, job['name'], fetch))\nError running mach:\n\n    ['bootstrap']\n\nThe error occurred in code that was called by the mach command. This is either\na bug in the called code itself or in the way that mach is calling it.\n\nYou should consider filing a bug for this issue.\n\nIf filing a bug, please include the full output of mach, including this error\nmessage.\n\nThe details of the failure are as follows:\n\nCalledProcessError: Command '['/usr/bin/python2.7', u'/home/mfroman/mozilla/moz-central/mach', u'artifact', u'toolchain', u'--from-build', u'linux64-clang']' returned non-zero exit status 1\n\n  File \"/home/mfroman/mozilla/moz-central/python/mozboot/mozboot/mach_commands.py\", line 32, in bootstrap\n    bootstrapper.bootstrap()\n  File \"/home/mfroman/mozilla/moz-central/python/mozboot/mozboot/bootstrap.py\", line 360, in bootstrap\n    self.instance.ensure_stylo_packages(state_dir, checkout_root)\n  File \"/home/mfroman/mozilla/moz-central/python/mozboot/mozboot/linux_common.py\", line 18, in ensure_stylo_packages\n    self.install_toolchain_artifact(state_dir, checkout_root, stylo.LINUX)\n  File \"/home/mfroman/mozilla/moz-central/python/mozboot/mozboot/base.py\", line 277, in install_toolchain_artifact\n    subprocess.check_call(cmd, cwd=state_dir)\n  File \"/usr/lib/python2.7/subprocess.py\", line 190, in check_call\n    raise CalledProcessError(retcode, cmd)", "author": "mfroman@nostrum.com", "id": 13395060, "time": "2018-06-07T22:05:10Z"}, {"text": "I seem to recall someone saying that it was dangerous for `mach artifact` to be making calls into low-level taskgraph code. This bug is a case in point.\n\nThis is definitely a regression from the changesets tracked by bug 1460777. I'll have a look.", "author": "gps@mozilla.com", "id": 13395082, "time": "2018-06-07T22:19:22Z"}, {"text": "the taskcluster code in the tree is in desperate need for a *fast* api that can pull out task information for a single kind.", "author": "mh+mozilla@glandium.org", "id": 13395089, "time": "2018-06-07T22:21:26Z"}, {"text": "Created attachment 8984310\nBug 1467605 - Disable processing of fetch dependencies; r?glandium\n\n90dca0906337 accidentally broke `mach artifact toolchain --from-build`\nbecause that code is attempting to load toolchain tasks in isolation.\nThe new \"use_fetches\" transform added to toolchain tasks requires\nthat \"fetch\" tasks are already processed and their references are\navailable to toolchain tasks.\n\nThis commit adds a mechanism to effectively disable the \"use_fetches\"\ntransform when called by `mach artifact toolchain`. It is a hack. I\nsuspect future planned work around artifacts/fetches will necessitate\nadditional changes to the `mach artifact toolchain` code. But this\ncan be deferred to a later day: this commit unbusts `mach artifact\ntoolchain` and isn't super hacky, so it seems more reasonable than\nbacking out fetch tasks completely.", "author": "phab-bot@bmo.tld", "id": 13395133, "time": "2018-06-07T22:53:49Z"}, {"text": "Comment on attachment 8984310\nBug 1467605 - Disable processing of fetch dependencies; r?glandium\n\nMike Hommey [:glandium] has approved the revision.\n\nhttps://phabricator.services.mozilla.com/D1588", "author": "phab-bot@bmo.tld", "id": 13395151, "time": "2018-06-07T23:04:24Z"}, {"text": "Pushed by gszorc@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/cdaaa5caac74\nDisable processing of fetch dependencies; r=glandium", "author": "pulsebot@bots.tld", "id": 13395154, "time": "2018-06-07T23:06:42Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/cdaaa5caac74", "author": "aiakab@mozilla.com", "id": 13395850, "time": "2018-06-08T10:00:49Z"}, {"text": "*** Bug 1467773 has been marked as a duplicate of this bug. ***", "author": "mh+mozilla@glandium.org", "id": 13396237, "time": "2018-06-08T13:56:09Z"}], "id": 1467605, "priority": "--", "mentors_detail": [], "comment_count": 8, "cf_status_thunderbird_esr52": "---", "cf_qa_whiteboard": "", "version": "Version 3", "cf_tracking_firefox62": "---", "cf_platform_rel": "---", "product": "Firefox Build System", "cf_fx_iteration": "---", "blocks": [1460777], "qa_contact": "", "see_also": [], "cf_status_firefox_esr52": "unaffected", "component": "Bootstrap Configuration", "votes": 0, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "fixed", "cf_status_firefox61": "unaffected", "cf_status_firefox60": "unaffected", "target_milestone": "mozilla62", "is_cc_accessible": true, "cf_tracking_thunderbird_esr60": "---", "groups": [], "cf_tracking_firefox_esr52": "---", "url": "", "cf_status_thunderbird_esr60": "---", "creator_detail": {"email": "mfroman@nostrum.com", "id": 546718, "name": "mfroman@nostrum.com", "real_name": "Michael Froman [:mjf]"}, "whiteboard": "", "mentors": [], "cc_detail": [{"email": "bpostelnicu@mozilla.com", "id": 555858, "name": "bpostelnicu@mozilla.com", "real_name": "Andi-Bogdan Postelnicu [:andi]"}, {"email": "dustin@mozilla.com", "id": 373217, "name": "dustin@mozilla.com", "real_name": "Dustin J. Mitchell [:dustin] pronoun: he"}, {"email": "gps@mozilla.com", "id": 420446, "name": "gps@mozilla.com", "real_name": "Gregory Szorc [:gps]"}, {"email": "mcastelluccio@mozilla.com", "id": 420453, "name": "mcastelluccio@mozilla.com", "real_name": "Marco Castelluccio [:marco]"}, {"email": "mh+mozilla@glandium.org", "id": 47192, "name": "mh+mozilla@glandium.org", "real_name": "Mike Hommey [:glandium]"}], "alias": null, "dupe_of": null, "flags": [], "last_change_time": "2018-06-08T16:41:53Z", "cf_status_firefox_esr60": "unaffected", "assigned_to": "gps@mozilla.com", "is_open": false, "history": [{"changes": [{"removed": "", "field_name": "cc", "added": "gps@mozilla.com"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(gps@mozilla.com)"}], "who": "mfroman@nostrum.com", "when": "2018-06-07T22:05:46Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "ASSIGNED"}, {"removed": "", "field_name": "cc", "added": "dustin@mozilla.com, mh+mozilla@glandium.org"}, {"removed": "", "field_name": "depends_on", "added": "1460777"}, {"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "gps@mozilla.com"}, {"removed": "needinfo?(gps@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "gps@mozilla.com", "when": "2018-06-07T22:19:22Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8984310, "added": "review+"}], "who": "phab-bot@bmo.tld", "when": "2018-06-07T23:04:24Z"}, {"changes": [{"removed": "ASSIGNED", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla62"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2018-06-08 10:00:49"}, {"removed": "---", "field_name": "cf_status_firefox62", "added": "fixed"}], "who": "aiakab@mozilla.com", "when": "2018-06-08T10:00:49Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "regression"}, {"removed": "", "field_name": "cc", "added": "mcastelluccio@mozilla.com"}], "who": "mcastelluccio@mozilla.com", "when": "2018-06-08T12:50:38Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "bpostelnicu@mozilla.com"}], "who": "mh+mozilla@glandium.org", "when": "2018-06-08T13:56:09Z"}, {"changes": [{"removed": "", "field_name": "blocks", "added": "1460777"}, {"removed": "1460777", "field_name": "depends_on", "added": ""}, {"removed": "---", "field_name": "cf_status_firefox_esr52", "added": "unaffected"}, {"removed": "---", "field_name": "cf_status_firefox_esr60", "added": "unaffected"}, {"removed": "---", "field_name": "cf_status_firefox60", "added": "unaffected"}, {"removed": "---", "field_name": "cf_status_firefox61", "added": "unaffected"}], "who": "ryanvm@gmail.com", "when": "2018-06-08T16:41:53Z"}], "resolution": "FIXED", "op_sys": "Unspecified", "cf_fx_points": "---", "cf_blocking_fennec": "---"}