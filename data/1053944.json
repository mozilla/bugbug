{"cf_tracking_thunderbird_esr52": "---", "status": "RESOLVED", "cf_tracking_firefox60": "---", "attachments": [{"creator": "till@tillschneidereit.net", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2014-08-26T18:43:17Z", "type_id": 4, "creation_date": "2014-08-22T11:56:49Z", "id": 958355, "setter": "jwalden+bmo@mit.edu"}, {"status": "+", "name": "approval-mozilla-aurora", "modification_date": "2014-08-28T15:30:56Z", "type_id": 720, "creation_date": "2014-08-28T11:08:34Z", "id": 963454, "setter": "sledru@mozilla.com"}], "content_type": "text/plain", "id": 8477361}], "classification": "Components", "creator": "samth@indiana.edu", "cc": ["ae.anderson0@gmail.com", "arai.unmht@gmail.com", "jwalden+bmo@mit.edu", "sledru@mozilla.com", "till@tillschneidereit.net"], "depends_on": [], "cf_status_firefox33": "fixed", "creation_time": "2014-08-14T18:45:02Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "x86_64", "cf_status_firefox58": "---", "cf_status_firefox59": "---", "keywords": ["dev-doc-complete"], "summary": "RegExp.$N changed behavior since FF 33", "id": 1053944, "assigned_to_detail": {"email": "till@tillschneidereit.net", "id": 292831, "name": "till@tillschneidereit.net", "real_name": "Till Schneidereit [:till]"}, "severity": "normal", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "assigned_to": "till@tillschneidereit.net", "comment_count": 20, "comments": [{"text": "To reproduce:\n\n- Visit http://mirror.racket-lang.org/releases/6.1/doc/ \n- Typed \"f\" in the search box and hit enter\n- In FF 33 (and Chrome), you'll go to http://mirror.racket-lang.org/releases/6.1/doc/search/index.html?q=f but in FF 34 you'll go to http://mirror.racket-lang.org/releases/6.1/doc/search/index.html?q=fundefined\n- Note message in console about \"RegExp.$2 is undefined\"\n\nI haven't yet figured out what behavior exactly changed, but I'm working on it.", "author": "samth@indiana.edu", "id": 9185103, "time": "2014-08-14T18:45:02Z"}, {"text": "This was bug 369778.\n\nNot sure whether this is something we should, or shouldn't, fix, honestly.  Having different behavior for the case fixed there, and for $N, seems undesirable to me.", "author": "jwalden+bmo@mit.edu", "id": 9185309, "time": "2014-08-14T19:23:16Z"}, {"text": "First, since this breaks a large number of pages that have worked for years, I really hope that this gets fixed.\n\nSecond, Chrome appears to behave the same as old FF:\n\n> re = /(?:(ABC)|(123)){2}/;\n/(?:(ABC)|(123)){2}/\n> var t = re.exec(\"ABC123\");\n> var u = re.exec(\"123ABC\");\n> t\n[\"ABC123\", undefined, \"123\"]\n> u\n[\"123ABC\", \"ABC\", undefined]", "author": "samth@indiana.edu", "id": 9185359, "time": "2014-08-14T19:33:31Z"}, {"text": "So we have this:\n\n  var page_query_string =\n    (location.href.search(/\\?([^#]+)(?:#|$)/) >= 0) && RegExp.$1;\n\nIt's not clear to me why this is using location.href this way, versus the far simpler\n\n  var page_query_string = location.search.substring(1);", "author": "jwalden+bmo@mit.edu", "id": 9185393, "time": "2014-08-14T19:39:44Z"}, {"text": "(In reply to Sam Tobin-Hochstadt [:samth] from comment #2)\n> Second, Chrome appears to behave the same as old FF:\n> \n> > re = /(?:(ABC)|(123)){2}/;\n> /(?:(ABC)|(123)){2}/\n> > var t = re.exec(\"ABC123\");\n> > var u = re.exec(\"123ABC\");\n> > t\n> [\"ABC123\", undefined, \"123\"]\n> > u\n> [\"123ABC\", \"ABC\", undefined]\n\nNo, that's the new way.  I believe it's what every JS engine except SpiderMonkey has done basically forever.  And that's the way that's standard, that ECMAScript has specified since time immemorial.\n\nThe only difference appears to be in the behavior of the non-standard $N properties of RegExp.", "author": "jwalden+bmo@mit.edu", "id": 9185401, "time": "2014-08-14T19:41:38Z"}, {"text": "Ah, ok, I misunderstood the first comment in bug 369778.\n\nI'm happy to believe that this is old and bad code, and I'm planning to rewrite it at some point (I didn't write it in the first place). \n\nHowever, there's a bunch of archived content (old documentation) which uses this code and I'll probably have to tell people to use Chrome for it. Which is annoying, of course, but not the end of the world.", "author": "samth@indiana.edu", "id": 9185443, "time": "2014-08-14T19:53:29Z"}, {"text": "It's possible we'd change RegExp.$N back to the old behavior, to be sure.  But I'd like more evidence than a single site of this being a pervasive problem.  And I suspect this line is probably the same in all the archived versions, such that a modification to it would be easy to make if necessary.", "author": "jwalden+bmo@mit.edu", "id": 9185479, "time": "2014-08-14T20:01:05Z"}, {"text": "Here's the change to the code I ended up with: https://github.com/plt/racket/commit/51254f06267f\n\nNot too bad, but not trivial.", "author": "samth@indiana.edu", "id": 9196323, "time": "2014-08-18T17:57:30Z"}, {"text": "And here's a github search for RegExp.$2 : https://www.google.com/webhp?#q=site%3Agithub.com+%22RegExp.%242%22&safe=off", "author": "samth@indiana.edu", "id": 9197619, "time": "2014-08-18T21:23:38Z"}, {"text": "Whether RegExp.$\\d is problematic entirely depends on whether \\d refers to a potentially-unmatchable component of the most recently used regular expression.  Without citing any evidence, I suspect it's not the common case for capturing groups in a regular expression to be potentially zero-quantified, or nested within another group that is potentially zero-quantified.  So a mere search for RegExp.$\\d unfortunately doesn't say much one way or another.", "author": "jwalden+bmo@mit.edu", "id": 9201717, "time": "2014-08-19T17:02:17Z"}, {"text": "As a (perhaps final) hope for this to change, I'll mention that in addition to a bunch of extant pages, this code is also present in shipping software and documentation pages that are on users local computers, which we can't change to avoid this incompatibility. So for all of those pages, using another browser is likely to be the only solution.", "author": "samth@indiana.edu", "id": 9203189, "time": "2014-08-19T21:02:06Z"}, {"text": "I'm pretty sure we'll have to change this: trying to book an Air France flight, I found that their form validation code breaks because of this change. As an example of what they're doing, check lines 101 to 106 of http://www.airfrance.com/DE/common/js/pceAfValidation.js.\n\nI cannot really imagine that this isn't pretty common, and making people unable to book flights is a bit awkward.", "author": "till@tillschneidereit.net", "id": 9206021, "time": "2014-08-20T12:44:21Z"}, {"text": "Created attachment 8477361\nChange RegExp. getters to return '' instead of undefined for non-matched groups\n\nGiven that we've encountered quite a bit of breakage, some in high-profile websites, I think we should change this back. The downside is a loss in conceptual purity, but then it's for a feature that is far away from bein conceptually pure in its entirety.\n\nThe attached patch changes just the static getters, nothing else. Passes tests (with the single test requiring changes changed). Try-servering here:\nhttps://treeherder.mozilla.org/ui/#/jobs?repo=try&revision=97875b185e4e", "author": "till@tillschneidereit.net", "id": 9217481, "time": "2014-08-22T11:56:49Z"}, {"text": "Comment on attachment 8477361\nChange RegExp. getters to return '' instead of undefined for non-matched groups\n\nReview of attachment 8477361:\n-----------------------------------------------------------------\n\nSigh.  I hate the web, I hate our non-standard extensions, I hate life.  :-(", "author": "jwalden+bmo@mit.edu", "id": 9231789, "time": "2014-08-26T18:43:17Z"}, {"text": "*Sigh*, I know.\n\nremote:   https://hg.mozilla.org/integration/mozilla-inbound/rev/df3b50b23153", "author": "till@tillschneidereit.net", "id": 9236018, "time": "2014-08-27T13:20:48Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/df3b50b23153", "author": "kwierso@gmail.com", "id": 9239254, "time": "2014-08-27T23:39:29Z"}, {"text": "Comment on attachment 8477361\nChange RegExp. getters to return '' instead of undefined for non-matched groups\n\nApproval Request Comment\n[Feature/regressing bug #]: bug 369778\n[User impact if declined]: various site breakage. E.g., booking flights on airfrance.com is impossible.\n[Describe test coverage new/current, TBPL]: tested by jstests\n[Risks and why]: very low, reverts to previous behavior\n[String/UUID change made/needed]: none", "author": "till@tillschneidereit.net", "id": 9241257, "time": "2014-08-28T11:08:34Z"}, {"text": "https://hg.mozilla.org/releases/mozilla-aurora/rev/c760537e6dd8", "author": "ryanvm@gmail.com", "id": 9244391, "time": "2014-08-28T20:56:53Z"}, {"text": "Updated following page:\n  https://developer.mozilla.org/en-US/Firefox/Releases/34", "author": "arai.unmht@gmail.com", "id": 9746052, "time": "2015-01-02T06:11:51Z"}, {"text": "Also https://developer.mozilla.org/en-US/Firefox/Releases/34/Site_Compatibility#JavaScript and https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp#Gecko_specific_notes", "author": "fscholz@mozilla.com", "id": 9751500, "time": "2015-01-05T11:30:18Z"}], "cf_last_resolved": "2014-08-27T23:39:29Z", "priority": "--", "mentors_detail": [], "cf_crash_signature": "", "version": "34 Branch", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "see_also": [], "cf_tracking_firefox59": "---", "last_change_time": "2015-01-05T11:30:18Z", "cf_platform_rel": "---", "product": "Core", "cf_status_firefox_esr52": "---", "blocks": [], "qa_contact": "", "cf_status_firefox34": "fixed", "cf_fx_iteration": "---", "component": "JavaScript: Standard Library", "votes": 0, "groups": [], "cf_status_firefox60": "---", "target_milestone": "mozilla34", "is_cc_accessible": true, "cf_status_thunderbird_esr52": "---", "url": "http://mirror.racket-lang.org/releases/6.1/doc/", "creator_detail": {"email": "samth@indiana.edu", "id": 265320, "name": "samth@indiana.edu", "real_name": "Sam Tobin-Hochstadt [:samth]"}, "whiteboard": "[DocArea=JS]", "mentors": [], "cc_detail": [{"email": "ae.anderson0@gmail.com", "id": 509961, "name": "ae.anderson0@gmail.com", "real_name": "Andy Anderson"}, {"email": "arai.unmht@gmail.com", "id": 310076, "name": "arai.unmht@gmail.com", "real_name": "Tooru Fujisawa [:arai]"}, {"email": "jwalden+bmo@mit.edu", "id": 83595, "name": "jwalden+bmo@mit.edu", "real_name": "Jeff Walden [:Waldo]"}, {"email": "sledru@mozilla.com", "id": 495955, "name": "sledru@mozilla.com", "real_name": "Sylvestre Ledru [:sylvestre]"}, {"email": "till@tillschneidereit.net", "id": 292831, "name": "till@tillschneidereit.net", "real_name": "Till Schneidereit [:till]"}], "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [{"status": "+", "name": "in-testsuite", "modification_date": "2014-08-28T15:31:07Z", "type_id": 37, "creation_date": "2014-08-28T15:31:07Z", "id": 963645, "setter": "sledru@mozilla.com"}], "cf_tracking_firefox58": "---", "cf_rank": null, "is_open": false, "history": [{"changes": [{"removed": "", "field_name": "cc", "added": "ae.anderson0@gmail.com, jwalden+bmo@mit.edu"}], "who": "jwalden+bmo@mit.edu", "when": "2014-08-14T19:23:16Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "till@tillschneidereit.net"}], "who": "till@tillschneidereit.net", "when": "2014-08-20T12:44:21Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8477361, "added": "review?(jwalden+bmo@mit.edu)"}], "who": "till@tillschneidereit.net", "when": "2014-08-22T11:56:49Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "ASSIGNED"}, {"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "till@tillschneidereit.net"}], "who": "till@tillschneidereit.net", "when": "2014-08-22T11:56:56Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(jwalden+bmo@mit.edu)", "attachment_id": 8477361, "added": "review+"}], "who": "jwalden+bmo@mit.edu", "when": "2014-08-26T18:43:17Z"}, {"changes": [{"removed": "ASSIGNED", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla34"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2014-08-27 16:39:29"}], "who": "kwierso@gmail.com", "when": "2014-08-27T23:39:29Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "dev-doc-needed"}, {"removed": "", "field_name": "whiteboard", "added": "[DocArea=JS]"}], "who": "fscholz@mozilla.com", "when": "2014-08-28T11:00:09Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8477361, "added": "approval-mozilla-aurora?"}], "who": "till@tillschneidereit.net", "when": "2014-08-28T11:08:34Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "sledru@mozilla.com"}, {"removed": "---", "field_name": "cf_status_firefox33", "added": "affected"}, {"removed": "---", "field_name": "cf_status_firefox34", "added": "fixed"}], "who": "sledru@mozilla.com", "when": "2014-08-28T15:30:34Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "approval-mozilla-aurora?", "attachment_id": 8477361, "added": "approval-mozilla-aurora+"}], "who": "sledru@mozilla.com", "when": "2014-08-28T15:30:56Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "in-testsuite+"}], "who": "sledru@mozilla.com", "when": "2014-08-28T15:31:07Z"}, {"changes": [{"removed": "affected", "field_name": "cf_status_firefox33", "added": "fixed"}], "who": "ryanvm@gmail.com", "when": "2014-08-28T20:56:53Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "arai_a@mac.com"}], "who": "arai.unmht@gmail.com", "when": "2015-01-02T06:11:51Z"}, {"changes": [{"removed": "dev-doc-needed", "field_name": "keywords", "added": "dev-doc-complete"}], "who": "fscholz@mozilla.com", "when": "2015-01-05T11:30:18Z"}], "resolution": "FIXED", "op_sys": "Linux", "cf_fx_points": "---", "cf_blocking_fennec": "---"}