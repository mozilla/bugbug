{"status": "RESOLVED", "cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "classification": "Client Software", "creator": "gbrown@mozilla.com", "cc": ["cmanchester@mozilla.com", "jh+bugzilla@buttercookie.de", "mcastelluccio@mozilla.com", "snorp@snorp.net"], "depends_on": [], "creation_time": "2018-06-05T21:44:32Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "All", "keywords": ["regression"], "summary": "Android 'mach mochitest'/'mach robocop' fails: \"IOError: Add-on path does not exist: <objdir>/_tests/testing/mochitest/mochijar\"", "cf_last_resolved": "2018-06-08T10:00:42Z", "attachments": [{"creator": "snorp@snorp.net", "is_obsolete": 0, "is_patch": 0, "flags": [], "content_type": "text/x-review-board-request", "id": 8983579}, {"creator": "cmanchester@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2018-06-07T20:07:33Z", "type_id": 4, "creation_date": "2018-06-07T20:00:29Z", "id": 1767303, "setter": "gbrown@mozilla.com"}], "content_type": "text/x-review-board-request", "id": 8983981}], "assigned_to_detail": {"email": "cmanchester@mozilla.com", "id": 432261, "name": "cmanchester@mozilla.com", "real_name": "Chris Manchester (:chmanchester)"}, "severity": "normal", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 14, "comments": [{"text": "./mach mochitest testing/mochitest/tests/Harness_sanity\n\n 0:22.06 SUITE_START: mochitest-plain - running 25 tests\n 0:22.06 TEST_START: testing/mochitest/tests/Harness_sanity/test_TestsRunningAfterSimpleTestFinish.html\n 0:22.06 TEST_END: SKIP\n 0:22.06 TEST_START: testing/mochitest/tests/Harness_sanity/test_sanityEventUtils.html\n 0:22.06 TEST_END: SKIP\n 0:22.06 TEST_START: testing/mochitest/tests/Harness_sanity/test_sanity_manifest.html\n 0:22.06 TEST_END: SKIP\n 0:22.06 TEST_START: testing/mochitest/tests/Harness_sanity/test_sanity_manifest_pf.html\n 0:22.06 TEST_END: SKIP\n 0:22.06 INFO Running manifest: testing/mochitest/tests/Harness_sanity/mochitest.ini\n 0:22.33 ERROR Automation Error: Exception caught while running tests\nTraceback (most recent call last):\n  File \"/home/gbrown/objdirs/x86/_tests/testing/mochitest/runtestsremote.py\", line 350, in run_test_harness\n    retVal = mochitest.runTests(options)\n  File \"/home/gbrown/objdirs/x86/_tests/testing/mochitest/runtests.py\", line 2608, in runTests\n    res = self.runMochitests(options, tests_in_manifest)\n  File \"/home/gbrown/objdirs/x86/_tests/testing/mochitest/runtests.py\", line 2403, in runMochitests\n    result = self.doTests(options, testsToRun)\n  File \"/home/gbrown/objdirs/x86/_tests/testing/mochitest/runtests.py\", line 2698, in doTests\n    self.manifest = self.buildProfile(options)\n  File \"/home/gbrown/objdirs/x86/_tests/testing/mochitest/runtestsremote.py\", line 228, in buildProfile\n    manifest = MochitestDesktop.buildProfile(self, options)\n  File \"/home/gbrown/objdirs/x86/_tests/testing/mochitest/runtests.py\", line 1877, in buildProfile\n    whitelistpaths=sandbox_whitelist_paths,\n  File \"/home/gbrown/src/testing/mozbase/mozprofile/mozprofile/profile.py\", line 198, in __init__\n    self._reset()\n  File \"/home/gbrown/src/testing/mozbase/mozprofile/mozprofile/profile.py\", line 246, in _reset\n    self.addons.install(self._addons)\n  File \"/home/gbrown/src/testing/mozbase/mozprofile/mozprofile/addons.py\", line 201, in install\n    self._install_addon(addon, **kwargs)\n  File \"/home/gbrown/src/testing/mozbase/mozprofile/mozprofile/addons.py\", line 128, in _install_addon\n    self.addon_details(path)\n  File \"/home/gbrown/src/testing/mozbase/mozprofile/mozprofile/addons.py\", line 251, in addon_details\n    raise IOError('Add-on path does not exist: %s' % addon_path)\nIOError: Add-on path does not exist: /home/gbrown/objdirs/x86/_tests/testing/mochitest/mochijar\n 0:22.66 INFO Buffered messages finished\n 0:22.66 SUITE_END\n\n\nSeems likely this is a regression from changes in bug 1462489.", "author": "gbrown@mozilla.com", "id": 13389358, "time": "2018-06-05T21:44:32Z"}, {"text": "Chris, can you have a look?", "author": "gbrown@mozilla.com", "id": 13389367, "time": "2018-06-05T21:46:12Z"}, {"text": "Created attachment 8983579\nBug 1466958 - hack to make things work\n\nReview commit: https://reviewboard.mozilla.org/r/249440/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/249440/", "author": "snorp@snorp.net", "id": 13389508, "time": "2018-06-05T22:12:46Z"}, {"text": "The patch from comment 2 makes sense, although looking at it I'd expect that to fail in automation, which it doesn't. I'll upload a version that retains the default for when we're building in automation, but I might need some help verifying the fix.", "author": "cmanchester@mozilla.com", "id": 13392454, "time": "2018-06-06T23:41:52Z"}, {"text": "Created attachment 8983981\nBug 1466958 - Fix mochitests when run locally against an android build.\n\nReview commit: https://reviewboard.mozilla.org/r/249842/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/249842/", "author": "cmanchester@mozilla.com", "id": 13392469, "time": "2018-06-06T23:58:39Z"}, {"text": ":gbrown, does comment 4 work for you? This seems to keep things consistent for local and automation builds.", "author": "cmanchester@mozilla.com", "id": 13392470, "time": "2018-06-07T00:00:06Z"}, {"text": "(In reply to Chris Manchester (:chmanchester) from comment #3)\n> The patch from comment 2 makes sense, although looking at it I'd expect that\n> to fail in automation, which it doesn't. I'll upload a version that retains\n> the default for when we're building in automation, but I might need some\n> help verifying the fix.\n\nAh I think it does fail in automation, actually. I've been wondering why my Try jobs are hosed :)", "author": "snorp@snorp.net", "id": 13393604, "time": "2018-06-07T13:46:18Z"}, {"text": "https://treeherder.mozilla.org/#/jobs?repo=try&revision=c49cea0fc19dfbc5d87bb8a5c293c72f4b43f0d7&selectedJob=182160413", "author": "snorp@snorp.net", "id": 13393606, "time": "2018-06-07T13:46:29Z"}, {"text": "When I run 'mach mochitest testing/mochitest/tests/Harness_sanity' locally, with comment 4 applied, the IOError is avoided, but mochitests do not run: Fennec is launched and loads the mochitest main page, but no tests run.", "author": "gbrown@mozilla.com", "id": 13393812, "time": "2018-06-07T14:51:54Z"}, {"text": "Local runs are okay if I add specialpowers:\n\ndiff --git a/testing/mochitest/mochitest_options.py b/testing/mochitest/mochitest_options.py\n--- a/testing/mochitest/mochitest_options.py\n+++ b/testing/mochitest/mochitest_options.py\n@@ -911,16 +911,23 @@ class AndroidArguments(ArgumentContainer\n     }\n \n     def validate(self, parser, options, context):\n         \"\"\"Validate android options.\"\"\"\n \n         if build_obj:\n             options.log_mach = '-'\n \n+            objdir_xpi_stage = os.path.join(build_obj.distdir, 'xpi-stage')\n+            if os.path.isdir(objdir_xpi_stage):\n+                options.extensionsToInstall = [\n+                    os.path.join(objdir_xpi_stage, 'specialpowers'),\n+                    os.path.join(objdir_xpi_stage, 'mochijar'),\n+                ]\n+\n         if options.remoteWebServer is None:\n             if os.name != \"nt\":\n                 options.remoteWebServer = moznetwork.get_ip()\n             else:\n                 parser.error(\n                     \"you must specify a --remote-webserver=<ip address>\")", "author": "gbrown@mozilla.com", "id": 13393835, "time": "2018-06-07T14:57:57Z"}, {"text": "Comment on attachment 8983981\nBug 1466958 - Fix mochitests when run locally against an android build.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/249842/diff/1-2/", "author": "cmanchester@mozilla.com", "id": 13394672, "time": "2018-06-07T20:00:29Z"}, {"text": "Comment on attachment 8983981\nBug 1466958 - Fix mochitests when run locally against an android build.\n\nhttps://reviewboard.mozilla.org/r/249842/#review256360\n\nThat should do it. Thanks!", "author": "gbrown@mozilla.com", "id": 13394698, "time": "2018-06-07T20:07:33Z"}, {"text": "Pushed by cmanchester@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/9a68a0a2eff4\nFix mochitests when run locally against an android build. r=gbrown", "author": "pulsebot@bots.tld", "id": 13394838, "time": "2018-06-07T20:51:14Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/9a68a0a2eff4", "author": "aiakab@mozilla.com", "id": 13395847, "time": "2018-06-08T10:00:42Z"}], "id": 1466958, "priority": "--", "mentors_detail": [], "cf_crash_signature": "", "version": "Trunk", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox62": "---", "cf_platform_rel": "---", "product": "Firefox for Android", "cf_status_firefox_esr52": "---", "blocks": [1462489], "qa_contact": "", "see_also": [], "cf_fx_iteration": "---", "component": "Testing", "votes": 0, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "fixed", "cf_status_firefox61": "unaffected", "cf_status_firefox60": "unaffected", "target_milestone": "Firefox 62", "is_cc_accessible": true, "cf_rank": null, "groups": [], "url": "", "creator_detail": {"email": "gbrown@mozilla.com", "id": 411471, "name": "gbrown@mozilla.com", "real_name": "Geoff Brown [:gbrown]"}, "whiteboard": "", "mentors": [], "cc_detail": [{"email": "cmanchester@mozilla.com", "id": 432261, "name": "cmanchester@mozilla.com", "real_name": "Chris Manchester (:chmanchester)"}, {"email": "jh+bugzilla@buttercookie.de", "id": 470713, "name": "jh+bugzilla@buttercookie.de", "real_name": "Jan Henning (on vacation in June) [:JanH]"}, {"email": "mcastelluccio@mozilla.com", "id": 420453, "name": "mcastelluccio@mozilla.com", "real_name": "Marco Castelluccio [:marco]"}, {"email": "snorp@snorp.net", "id": 227322, "name": "snorp@snorp.net", "real_name": "James Willcox (:snorp) (jwillcox@mozilla.com)"}], "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "last_change_time": "2018-06-08T16:44:37Z", "cf_status_firefox_esr60": "---", "assigned_to": "cmanchester@mozilla.com", "is_open": false, "history": [{"changes": [{"removed": "", "field_name": "cc", "added": "snorp@snorp.net"}], "who": "gbrown@mozilla.com", "when": "2018-06-05T21:44:46Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "cmanchester@mozilla.com"}, {"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(cmanchester@mozilla.com)"}], "who": "gbrown@mozilla.com", "when": "2018-06-05T21:46:12Z"}, {"changes": [{"removed": "needinfo?(cmanchester@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "cmanchester@mozilla.com", "when": "2018-06-06T23:41:52Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(gbrown@mozilla.com)"}], "who": "cmanchester@mozilla.com", "when": "2018-06-07T00:00:06Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "regression"}, {"removed": "", "field_name": "cc", "added": "mcastelluccio@mozilla.com"}], "who": "mcastelluccio@mozilla.com", "when": "2018-06-07T13:25:20Z"}, {"changes": [{"removed": "needinfo?(gbrown@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "gbrown@mozilla.com", "when": "2018-06-07T14:51:54Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "jh+bugzilla@buttercookie.de"}, {"removed": "Unspecified", "field_name": "platform", "added": "All"}, {"removed": "Android 'mach mochitest' fails: \"IOError: Add-on path does not exist: <objdir>/_tests/testing/mochitest/mochijar\"", "field_name": "summary", "added": "Android 'mach mochitest'/'mach robocop' fails: \"IOError: Add-on path does not exist: <objdir>/_tests/testing/mochitest/mochijar\""}, {"removed": "Unspecified", "field_name": "op_sys", "added": "Android"}], "who": "jh+bugzilla@buttercookie.de", "when": "2018-06-07T18:15:43Z"}, {"changes": [{"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "cmanchester@mozilla.com"}], "who": "cmanchester@mozilla.com", "when": "2018-06-07T19:57:51Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8983981, "added": "review?(gbrown@mozilla.com)"}], "who": "cmanchester@mozilla.com", "when": "2018-06-07T20:00:29Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(gbrown@mozilla.com)", "attachment_id": 8983981, "added": "review+"}], "who": "gbrown@mozilla.com", "when": "2018-06-07T20:07:33Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "Firefox 62"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2018-06-08 10:00:42"}, {"removed": "affected", "field_name": "cf_status_firefox62", "added": "fixed"}], "who": "aiakab@mozilla.com", "when": "2018-06-08T10:00:42Z"}, {"changes": [{"removed": "---", "field_name": "cf_status_firefox60", "added": "unaffected"}, {"removed": "---", "field_name": "cf_status_firefox61", "added": "unaffected"}], "who": "ryanvm@gmail.com", "when": "2018-06-08T16:44:37Z"}], "resolution": "FIXED", "op_sys": "Android", "cf_fx_points": "---", "cf_blocking_fennec": "---"}