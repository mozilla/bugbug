{"cf_tracking_thunderbird_esr52": "---", "status": "NEW", "cf_tracking_firefox60": "---", "cf_tracking_firefox61": "---", "cf_tracking_firefox62": "---", "creator": "n.nethercote@gmail.com", "mentors_detail": [], "depends_on": [1449883, 1451169, 1449395, 1449827], "cf_status_firefox_esr60": "---", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "keywords": [], "cc_detail": [{"email": "mcastelluccio@mozilla.com", "id": 420453, "name": "mcastelluccio@mozilla.com", "real_name": "Marco Castelluccio [:marco]"}, {"email": "Ms2ger@gmail.com", "id": 302720, "name": "Ms2ger@gmail.com", "real_name": ":Ms2ger (\u231a UTC+1/+2)"}], "cf_last_resolved": null, "attachments": [], "votes": 0, "classification": "Components", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "comment_count": 3, "comments": [{"text": "Once bug 1449395 is done, we'll be very close to the minimal static atom setup. The only thing left will be that the individual static atom pointers (nsGkAtoms::foo, etc.) still take up space. It's possible to make them `constexpr` and thus take up no space, except that MSVC has a bug that prevents this from happening:\n\nhttps://developercommunity.visualstudio.com/content/problem/223146/constexpr-code-gneration-bug.html\n\nOnce that MSVC bug is fixed, this bug can be implemented.", "author": "n.nethercote@gmail.com", "id": 13165361, "time": "2018-03-29T00:15:06Z"}, {"text": "Note: we have a ton of static data structures that have references to static atoms like this:\n\n> &nsGkAtoms::foo\n\nWhy is the '&' there? Because static atoms used to not be statically allocated, and so couldn't be pointed to directly by other static data structures. Instead the static data structures would point to a pointer to the atom, which is static. (This means all uses required an additional dereference.)\n\nBut bug 1411469 made atoms statically allocated, and bug 1445113 will disallow duplicate static atoms, whereupon it will be be both possible and valid for static data structures to refer directly to the static atoms. Indeed, in order to complete *this* bug, all these pointers-to-pointers must be changed to direct pointers, because all the nsGkAtoms::foo pointers will become constexpr, which means they are rvalues rather than lvalues, and so doing &nsGkAtoms::foo will be impossible.\n\nSo this bug will have a bunch of blockers doing those nsStaticAtom** to nsStaticAtom* conversions.", "author": "n.nethercote@gmail.com", "id": 13165435, "time": "2018-03-29T01:01:27Z"}, {"text": "Here's a frustrating thing: bug 1449883 and bug 1451169 are precursors to this bug. They cause the number of static constructors to go up, by about 17 or so. (Bug 1451169's patches were backed out for this reason.) This bug will then reverse the static constructor increase.\n\nTherefore, I can't land this bug's precursors gradually. They'll have to land all at once, when this bug also lands. And that's blocked by the MSVC bug described in comment 0. Sigh.", "author": "n.nethercote@gmail.com", "id": 13234303, "time": "2018-04-26T03:33:41Z"}], "id": 1449787, "priority": "--", "cc": ["mcastelluccio@mozilla.com", "Ms2ger@gmail.com"], "cf_crash_signature": "", "version": "Trunk", "is_cc_accessible": true, "cf_tracking_firefox_esr52": "---", "see_also": [], "cf_tracking_thunderbird_esr60": "---", "cf_platform_rel": "---", "product": "Core", "cf_fx_iteration": "---", "blocks": [1257126], "qa_contact": "", "creation_time": "2018-03-29T00:15:06Z", "cf_status_firefox_esr52": "---", "component": "XPCOM", "assigned_to_detail": {"email": "nobody@mozilla.org", "id": 1, "name": "nobody@mozilla.org", "real_name": "Nobody; OK to take it and work on it"}, "cf_tracking_firefox_esr60": "---", "cf_status_firefox62": "---", "cf_status_firefox61": "affected", "cf_status_firefox60": "---", "target_milestone": "---", "cf_rank": null, "cf_qa_whiteboard": "", "severity": "normal", "groups": [], "cf_status_thunderbird_esr52": "---", "url": "", "cf_status_thunderbird_esr60": "---", "creator_detail": {"email": "n.nethercote@gmail.com", "id": 334849, "name": "n.nethercote@gmail.com", "real_name": "Nicholas Nethercote [:njn]"}, "whiteboard": "", "mentors": [], "summary": "Make static atom pointers `constexpr`", "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "last_change_time": "2018-04-26T03:33:41Z", "assigned_to": "nobody@mozilla.org", "is_open": true, "history": [{"changes": [{"removed": "1449395", "field_name": "blocks", "added": ""}, {"removed": "", "field_name": "depends_on", "added": "1449395"}], "who": "n.nethercote@gmail.com", "when": "2018-03-29T03:49:19Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1449827"}], "who": "n.nethercote@gmail.com", "when": "2018-03-29T03:50:22Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1449883"}], "who": "n.nethercote@gmail.com", "when": "2018-03-29T09:37:41Z"}, {"changes": [{"removed": "", "field_name": "blocks", "added": "1257126"}], "who": "n.nethercote@gmail.com", "when": "2018-03-29T11:32:54Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "mcastelluccio@mozilla.com"}], "who": "mcastelluccio@mozilla.com", "when": "2018-03-29T11:49:39Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "Ms2ger@gmail.com"}], "who": "Ms2ger@gmail.com", "when": "2018-03-29T12:18:19Z"}, {"changes": [{"removed": "", "field_name": "depends_on", "added": "1451169"}], "who": "n.nethercote@gmail.com", "when": "2018-04-03T23:41:17Z"}], "resolution": "", "op_sys": "Unspecified", "cf_fx_points": "---", "cf_blocking_fennec": "---"}