{"cf_tracking_thunderbird_esr52": "---", "status": "RESOLVED", "cf_tracking_firefox60": "---", "attachments": [{"creator": "ehsan@mozilla.com", "is_obsolete": 1, "is_patch": 1, "flags": [], "content_type": "text/plain", "id": 8690932}, {"creator": "ehsan@mozilla.com", "is_obsolete": 0, "is_patch": 1, "flags": [{"status": "+", "name": "review", "modification_date": "2015-11-26T15:28:37Z", "type_id": 4, "creation_date": "2015-11-25T23:12:21Z", "id": 1299707, "setter": "josh@joshmatthews.net"}], "content_type": "text/plain", "id": 8692213}], "classification": "Components", "creator": "bkelly@mozilla.com", "cc": ["angelesoteo@gmail.com", "ehsan@mozilla.com", "josh@joshmatthews.net", "noemi.freiredecarlos@telefonica.com", "nsm.nikhil@gmail.com"], "depends_on": [], "creation_time": "2015-09-02T16:27:55Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "cf_status_firefox58": "---", "cf_status_firefox59": "---", "keywords": [], "summary": "Various APIs should return same ServiceWorkerRegistration object with js equality", "id": 1201127, "assigned_to_detail": {"email": "ehsan@mozilla.com", "id": 251051, "name": "ehsan@mozilla.com", "real_name": ":Ehsan Akhgari"}, "severity": "normal", "is_confirmed": true, "is_creator_accessible": true, "cf_status_firefox45": "fixed", "cf_has_regression_range": "---", "assigned_to": "ehsan@mozilla.com", "comment_count": 13, "comments": [{"text": "Currently we mint a new ServiceWorkerRegistration object every time we return one from the various SW APIs.  The recent spec agreement is that these objects should actually be === comparable in js since it helps developers and avoids state synchronization issues.\n\nSee:\n\n  https://github.com/slightlyoff/ServiceWorker/issues/416\n  bug 1181039 comment 10", "author": "bkelly@mozilla.com", "id": 10687649, "time": "2015-09-02T16:27:55Z"}, {"text": "web platform tests in testing/web-platform/mozilla/tests/service-workers/service-worker and possibly mochitests in dom/workers/test/serviceworkers will need modification. It is easy to find them by grepping for 'equal.*\\.scope' or 'registration\\.scope' or similar.", "author": "nsm.nikhil@gmail.com", "id": 10689447, "time": "2015-09-02T22:07:42Z"}, {"text": "multiple-register.https.html is one.", "author": "nsm.nikhil@gmail.com", "id": 10692886, "time": "2015-09-03T17:14:53Z"}, {"text": "unregister-then-register.https.html needs to be reverted.", "author": "nsm.nikhil@gmail.com", "id": 10708019, "time": "2015-09-08T23:44:31Z"}, {"text": "getregistrations.https.html after Bug 1189671 lands.", "author": "nsm.nikhil@gmail.com", "id": 10728914, "time": "2015-09-14T18:36:54Z"}, {"text": "Ehsan, you were asking about possible bugs to work.  How about this one?  Its a compat thing we need to fix.", "author": "bkelly@mozilla.com", "id": 10952417, "time": "2015-11-20T20:27:33Z"}, {"text": "ServiceWorkerGlobalScope.registration was marked as [SameObject] in bug 1218141, and nothing needs to be done for ServiceWorkerRegistrationWorkerThread because ServiceWorkerContainer is not yet exposed to Workers.\n\nThe only change required here is to add a hashtable for ServiceWorkerRegistrationMainThread objects to Window to avoid creating a new object if we have previously created one.", "author": "ehsan@mozilla.com", "id": 10956773, "time": "2015-11-23T16:39:02Z"}, {"text": "Created attachment 8690932\nReturn the same ServiceWorkerRegistration object from service worker APIs dealing with the same underlying registration object", "author": "ehsan@mozilla.com", "id": 10957243, "time": "2015-11-23T18:38:23Z"}, {"text": "Comment on attachment 8690932\nReturn the same ServiceWorkerRegistration object from service worker APIs dealing with the same underlying registration object\n\nReview of attachment 8690932:\n-----------------------------------------------------------------\n\n::: dom/base/nsPIDOMWindow.h\n@@ +863,5 @@\n>  \n> +  typedef nsRefPtrHashtable<nsStringHashKey,\n> +                            mozilla::dom::ServiceWorkerRegistrationMainThread>\n> +          ServiceWorkerRegistrationTable;\n> +  ServiceWorkerRegistrationTable mServiceWorkerRegistrationTable;\n\nShould we be updating the cycle-collection macros for this?\n\n::: dom/workers/ServiceWorkerRegistration.cpp\n@@ +872,5 @@\n>  \n>    void\n> +  RegistrationRemoved() override\n> +  {\n> +    AssertIsOnMainThread();\n\nI don't get why this is empty.", "author": "josh@joshmatthews.net", "id": 10957928, "time": "2015-11-23T21:22:25Z"}, {"text": "(In reply to Josh Matthews [:jdm] from comment #8)\n> Comment on attachment 8690932\n> Return the same ServiceWorkerRegistration object from service worker APIs\n> dealing with the same underlying registration object\n> \n> Review of attachment 8690932:\n> -----------------------------------------------------------------\n> \n> ::: dom/base/nsPIDOMWindow.h\n> @@ +863,5 @@\n> >  \n> > +  typedef nsRefPtrHashtable<nsStringHashKey,\n> > +                            mozilla::dom::ServiceWorkerRegistrationMainThread>\n> > +          ServiceWorkerRegistrationTable;\n> > +  ServiceWorkerRegistrationTable mServiceWorkerRegistrationTable;\n> \n> Should we be updating the cycle-collection macros for this?\n\nAh, yes!\n\n> ::: dom/workers/ServiceWorkerRegistration.cpp\n> @@ +872,5 @@\n> >  \n> >    void\n> > +  RegistrationRemoved() override\n> > +  {\n> > +    AssertIsOnMainThread();\n> \n> I don't get why this is empty.\n\nIt will be filled in bug 1228149.", "author": "ehsan@mozilla.com", "id": 10965970, "time": "2015-11-25T23:11:37Z"}, {"text": "Created attachment 8692213\nReturn the same ServiceWorkerRegistration object from service worker APIs dealing with the same underlying registration object", "author": "ehsan@mozilla.com", "id": 10965975, "time": "2015-11-25T23:12:21Z"}, {"text": "https://hg.mozilla.org/integration/mozilla-inbound/rev/98fb5254f788", "author": "pulsebot@bots.tld", "id": 10968508, "time": "2015-11-26T20:16:24Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/98fb5254f788", "author": "cbook@mozilla.com", "id": 10970044, "time": "2015-11-27T15:26:57Z"}], "cf_last_resolved": "2015-11-27T15:26:57Z", "priority": "--", "mentors_detail": [], "cf_crash_signature": "", "version": "unspecified", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox59": "---", "last_change_time": "2016-02-29T20:12:01Z", "cf_platform_rel": "---", "product": "Core", "cf_status_firefox_esr52": "---", "blocks": [1226983, 1173500], "qa_contact": "", "see_also": ["https://bugzilla.mozilla.org/show_bug.cgi?id=1252055"], "cf_fx_iteration": "---", "component": "DOM: Service Workers", "votes": 0, "groups": [], "cf_status_firefox60": "---", "target_milestone": "mozilla45", "is_cc_accessible": true, "cf_status_thunderbird_esr52": "---", "url": "", "creator_detail": {"email": "bkelly@mozilla.com", "id": 465500, "name": "bkelly@mozilla.com", "real_name": "Ben Kelly [PTO, back late March][:bkelly]"}, "whiteboard": "", "mentors": [], "cc_detail": [{"email": "angelesoteo@gmail.com", "id": 434278, "name": "angelesoteo@gmail.com", "real_name": "Maria Angeles Oteo (:oteo)"}, {"email": "ehsan@mozilla.com", "id": 251051, "name": "ehsan@mozilla.com", "real_name": ":Ehsan Akhgari"}, {"email": "josh@joshmatthews.net", "id": 241497, "name": "josh@joshmatthews.net", "real_name": "Josh Matthews [:jdm]"}, {"email": "noemi.freiredecarlos@telefonica.com", "id": 469924, "name": "noemi.freiredecarlos@telefonica.com", "real_name": "Noem\u00ed Freire (:noemi)"}, {"email": "nsm.nikhil@gmail.com", "id": 415061, "name": "nsm.nikhil@gmail.com", "real_name": "Nikhil Marathe [:nsm] (No longer reading bugmail, please needinfo?)"}], "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "cf_tracking_firefox58": "---", "cf_rank": null, "is_open": false, "history": [{"changes": [{"removed": "", "field_name": "cc", "added": "noemi.freiredecarlos@telefonica.com"}], "who": "noemi.freiredecarlos@telefonica.com", "when": "2015-09-02T16:35:38Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "ehsan@mozilla.com"}], "who": "ehsan@mozilla.com", "when": "2015-09-02T17:19:51Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "nsm.nikhil@gmail.com"}], "who": "nsm.nikhil@gmail.com", "when": "2015-09-02T22:07:42Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "oteo@tid.es"}], "who": "angelesoteo@gmail.com", "when": "2015-09-03T08:11:27Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(ehsan@mozilla.com)"}], "who": "bkelly@mozilla.com", "when": "2015-11-20T20:27:33Z"}, {"changes": [{"removed": "", "field_name": "blocks", "added": "1226983"}], "who": "bkelly@mozilla.com", "when": "2015-11-22T20:17:42Z"}, {"changes": [{"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "ehsan@mozilla.com"}, {"removed": "needinfo?(ehsan@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "ehsan@mozilla.com", "when": "2015-11-23T15:00:08Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8690932, "added": "review?(josh@joshmatthews.net)"}, {"removed": "", "field_name": "cc", "added": "josh@joshmatthews.net"}], "who": "ehsan@mozilla.com", "when": "2015-11-23T18:38:23Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(josh@joshmatthews.net)", "attachment_id": 8690932, "added": ""}], "who": "josh@joshmatthews.net", "when": "2015-11-23T21:22:25Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8692213, "added": "review?(josh@joshmatthews.net)"}], "who": "ehsan@mozilla.com", "when": "2015-11-25T23:12:21Z"}, {"changes": [{"field_name": "attachments.isobsolete", "removed": "0", "attachment_id": 8690932, "added": "1"}], "who": "ehsan@mozilla.com", "when": "2015-11-25T23:12:22Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(josh@joshmatthews.net)", "attachment_id": 8692213, "added": "review+"}], "who": "josh@joshmatthews.net", "when": "2015-11-26T15:28:37Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "mozilla45"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2015-11-27 07:26:57"}, {"removed": "---", "field_name": "cf_status_firefox45", "added": "fixed"}], "who": "cbook@mozilla.com", "when": "2015-11-27T15:26:57Z"}, {"changes": [{"removed": "", "field_name": "see_also", "added": "https://bugzilla.mozilla.org/show_bug.cgi?id=1252055"}], "who": "bkelly@mozilla.com", "when": "2016-02-29T20:12:01Z"}], "resolution": "FIXED", "op_sys": "Unspecified", "cf_fx_points": "---", "cf_blocking_fennec": "---"}