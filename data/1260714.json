{"status": "RESOLVED", "cf_tracking_firefox60": "---", "attachments": [{"creator": "nchevobbe@mozilla.com", "is_obsolete": 0, "is_patch": 0, "flags": [{"status": "+", "name": "review", "modification_date": "2016-04-01T23:17:56Z", "type_id": 748, "creation_date": "2016-04-01T23:01:07Z", "id": 1370324, "setter": "jdescottes@mozilla.com"}], "content_type": "text/x-review-board-request", "id": 8737404}], "classification": "Client Software", "creator": "cbook@mozilla.com", "cc": ["jdescottes@mozilla.com", "nchevobbe@mozilla.com", "pbrosset@mozilla.com"], "depends_on": [], "creation_time": "2016-03-30T13:10:02Z", "cf_user_story": "", "cf_tracking_firefox_relnote": "---", "platform": "Unspecified", "cf_status_firefox58": "---", "cf_status_firefox59": "---", "keywords": ["intermittent-failure"], "summary": "Intermittent browser_computed_search-filter_clear.js | This test exceeded the timeout threshold. It should be rewritten or split up. If that's not possible, use requestLongerTimeout(N), but only as a last resort. -", "cf_last_resolved": "2016-04-04T01:44:09Z", "assigned_to_detail": {"email": "nchevobbe@mozilla.com", "id": 557153, "name": "nchevobbe@mozilla.com", "real_name": "Nicolas Chevobbe [:nchevobbe]"}, "severity": "normal", "is_confirmed": true, "is_creator_accessible": true, "cf_has_regression_range": "---", "assigned_to": "nchevobbe@mozilla.com", "comment_count": 23, "comments": [{"text": "https://treeherder.mozilla.org/logviewer.html#?job_id=8306037&repo=fx-team\n\n 17:19:27 INFO - 131 INFO TEST-UNEXPECTED-FAIL | devtools/client/inspector/computed/test/browser_computed_search-filter_clear.js | This test exceeded the timeout threshold. It should be rewritten or split up. If that's not possible, use requestLongerTimeout(N), but only as a last resort. -", "author": "cbook@mozilla.com", "id": 11287743, "time": "2016-03-30T13:10:02Z"}, {"text": "Triaging (filter on CLIMBING SHOES).", "author": "pbrosset@mozilla.com", "id": 11290558, "time": "2016-03-31T12:35:01Z"}, {"text": "As discussed on IRC, this test is borderline timeout even when successful.\n(the current mochitest timeout is set to 45 seconds) \n=> looks like a valid case for splitting up or requesting longer timeout IMO.\n\nLooking at the bug it doesn't seem to be doing a lot though. And the two tested functions are somehow tied together.\n\nSince we can't rely on the timestamps from the logs, currently we have no idea what actually takes time in this test. Before deciding how to split, it could be interesting to try and log the time at different steps of the test. Maybe we can understand what's taking so long.", "author": "jdescottes@mozilla.com", "id": 11293397, "time": "2016-04-01T09:17:00Z"}, {"text": "Looking a bit more at the tests, there are two hints worth mentioning:\n- the \"include browser styles\" checkbox is ticked\n- we send \"background-color\" key by key\n\nEach key triggers a filtering + repainting of the whole list. On a debug & non optimized build, this could very well take a lot of time.", "author": "jdescottes@mozilla.com", "id": 11293449, "time": "2016-04-01T09:51:19Z"}, {"text": "So, a rough measuring using performance.now in the test gives me this : \n\n- addTab from-start: \"107\", since-last: \"107\"\n- openComputedView from-start: \"1551\", since-last: \"1445\"\n- selectNode from-start: \"1682\", since-last: \"130\"\n- testAddTextInFilter from-start: \"2526\", since-last: \"844\"\n- testClearSearchFilter from-start: \"2859\", since-last: \"333\"\n\nThe main culprit are the opening of the computedView, on which we can't speed things up ( or at least, not quiclky ), and the testAddTextInFilter. \nIn the test, if we don't click the \"includes browser style\", it goes down to ~300ms ( similar to what we have for testClearSearchFilter ). It's great but then the tests fails.\n\nI guess we could restrict the list of properties to check, ignoring the browser styles' one.\nDoes it sounds a good things to do ? I think it's kind of harmless, since we test the filtering with the browser style in a sibling test ( browser_compted_search-filter.js) .", "author": "nchevobbe@mozilla.com", "id": 11293657, "time": "2016-04-01T10:52:46Z"}, {"text": "(In reply to Nicolas Chevobbe from comment #4)\n> So, a rough measuring using performance.now in the test gives me this : \n> \n> - addTab from-start: \"107\", since-last: \"107\"\n> - openComputedView from-start: \"1551\", since-last: \"1445\"\n> - selectNode from-start: \"1682\", since-last: \"130\"\n> - testAddTextInFilter from-start: \"2526\", since-last: \"844\"\n> - testClearSearchFilter from-start: \"2859\", since-last: \"333\"\n> \n\nThanks for measuring! As discussed on IRC please do a try push with these logs to get some more data.\n\n> The main culprit are the opening of the computedView, on which we can't\n> speed things up ( or at least, not quiclky ), and the testAddTextInFilter. \n> In the test, if we don't click the \"includes browser style\", it goes down to\n> ~300ms ( similar to what we have for testClearSearchFilter ). It's great but\n> then the tests fails.\n> \n> I guess we could restrict the list of properties to check, ignoring the\n> browser styles' one.\n> Does it sounds a good things to do ? I think it's kind of harmless, since we\n> test the filtering with the browser style in a sibling test (\n> browser_compted_search-filter.js) .\n\nSounds good to me. \nThe only non \"browser style\" property is \"color\" for now, we will have to add a few others to keep the filtering relevant.", "author": "jdescottes@mozilla.com", "id": 11293795, "time": "2016-04-01T12:34:40Z"}, {"text": "I pushed my patch with my measurement logs : https://treeherder.mozilla.org/logviewer.html#?job_id=18926736&repo=try ( filter on NCHEVOBBE ), and fortunately, the failure shown up.\n\nThe test are indeed much slower on Linux : \n\n* [NCHEVOBBE] start add_task | since start:3ms | since last:3ms\n* [NCHEVOBBE] addTab | since start:919ms | since last:917ms\n* [NCHEVOBBE] openComputedView | since start:9912ms | since last:8992ms\n* [NCHEVOBBE] selectNode | since start:13292ms | since last:3380ms\n* [NCHEVOBBE] testAddTextInFilter | since start:37514ms | since last:24222ms\n* [NCHEVOBBE] testClearSearchFilter | since start:45369ms | since last:7855ms\n\nUndoubtly, testAddTextInFilter really takes too much time compared to testClearSearchFilter. As discussed previously, I'll edit the test to not show the browser styles and will push again.", "author": "nchevobbe@mozilla.com", "id": 11295121, "time": "2016-04-01T19:34:15Z"}, {"text": "I edited the test and pushed again ( https://treeherder.mozilla.org/#/jobs?repo=try&revision=68e2799fe2dd&group_state=expanded&selectedJob=18935618 ), this time, no failures. The measures now are : \n\n* [NCHEVOBBE] start add_task | since start:13ms | since last:13ms\n* [NCHEVOBBE] addTab | since start:903ms | since last:890ms\n* [NCHEVOBBE] openComputedView | since start:11099ms | since last:10197ms\n* [NCHEVOBBE] selectNode | since start:15270ms | since last:4171ms\n* [NCHEVOBBE] testAddTextInFilter | since start:17054ms | since last:1784ms\n* [NCHEVOBBE] testClearSearchFilter | since start:19267ms | since last:2213ms\n\nWhich is definitely better.", "author": "nchevobbe@mozilla.com", "id": 11295669, "time": "2016-04-01T22:30:49Z"}, {"text": "(In reply to Nicolas Chevobbe from comment #7)\n> I edited the test and pushed again (\n> https://treeherder.mozilla.org/#/\n> jobs?repo=try&revision=68e2799fe2dd&group_state=expanded&selectedJob=18935618\n> ), this time, no failures. The measures now are : \n> \n> * [NCHEVOBBE] start add_task | since start:13ms | since last:13ms\n> * [NCHEVOBBE] addTab | since start:903ms | since last:890ms\n> * [NCHEVOBBE] openComputedView | since start:11099ms | since last:10197ms\n> * [NCHEVOBBE] selectNode | since start:15270ms | since last:4171ms\n> * [NCHEVOBBE] testAddTextInFilter | since start:17054ms | since last:1784ms\n> * [NCHEVOBBE] testClearSearchFilter | since start:19267ms | since last:2213ms\n> \n> Which is definitely better.\n\nGreat ! \nFor info you can use propView.hasMatchedSelectors to check if a property is not coming from a browser style. This way the last check can be turned into:\n\n> is(propView.visible, propView.hasMatchedSelectors, \"span \" + name + \" property visibility check\");\n\nand no need for an intermediary object.", "author": "jdescottes@mozilla.com", "id": 11295754, "time": "2016-04-01T22:44:35Z"}, {"text": "> Great ! \n> For info you can use propView.hasMatchedSelectors to check if a property is\n> not coming from a browser style. This way the last check can be turned into:\n> \n> > is(propView.visible, propView.hasMatchedSelectors, \"span \" + name + \" property visibility check\");\n> \n> and no need for an intermediary object.\n\nEven greater ! I was unsure about my code, it definitely look nicer your way.", "author": "nchevobbe@mozilla.com", "id": 11295823, "time": "2016-04-01T22:54:03Z"}, {"text": "Created attachment 8737404\nMozReview Request: Bug 1260714 - Fix intermittent browser_computed_search-filter_clear.js . r=jdescottes\n\nThe test used to time out, mainly because we were checking 'Browser styles' on the\ncomputed properties panel, which is quite slow. As the 'Browser styles' checkbox\nis already tested in its own test, we can remove it from here, and adapt this test\nto take this into account.\n\nReview commit: https://reviewboard.mozilla.org/r/43949/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/43949/", "author": "nchevobbe@mozilla.com", "id": 11295831, "time": "2016-04-01T23:01:07Z"}, {"text": "Comment on attachment 8737404\nMozReview Request: Bug 1260714 - Fix intermittent browser_computed_search-filter_clear.js . r=jdescottes\n\nhttps://reviewboard.mozilla.org/r/43949/#review40549\n\nPerfect, thanks for fixing this Nicolas!\n\nOne last try push for this changeset and we are good to go.", "author": "jdescottes@mozilla.com", "id": 11295856, "time": "2016-04-01T23:17:56Z"}, {"text": "23 automation job failures were associated with this bug yesterday.\n\nRepository breakdown:\n* mozilla-inbound: 11\n* fx-team: 7\n* try: 4\n* mozilla-central: 1\n\nPlatform breakdown:\n* linux32: 14\n* linux64: 9\n\nFor more details, see:\nhttps://brasstacks.mozilla.com/orangefactor/?display=Bug&bugid=1260714&startday=2016-04-01&endday=2016-04-01&tree=all", "author": "orangefactor@bots.tld", "id": 11296019, "time": "2016-04-02T01:00:04Z"}, {"text": "The TRY run is over ( https://treeherder.mozilla.org/#/jobs?repo=try&revision=02f8b7b30936 ) and everything looks good, the failure did not occurred.", "author": "nchevobbe@mozilla.com", "id": 11296261, "time": "2016-04-02T09:08:22Z"}, {"text": "https://hg.mozilla.org/integration/fx-team/rev/bf1bd53f98ad", "author": "pulsebot@bots.tld", "id": 11296448, "time": "2016-04-02T15:53:52Z"}, {"text": "65 automation job failures were associated with this bug in the last 7 days.\n\nRepository breakdown:\n* mozilla-inbound: 22\n* try: 21\n* fx-team: 18\n* mozilla-central: 3\n* ash: 1\n\nPlatform breakdown:\n* linux32: 41\n* linux64: 24\n\nFor more details, see:\nhttps://brasstacks.mozilla.com/orangefactor/?display=Bug&bugid=1260714&startday=2016-03-28&endday=2016-04-03&tree=all", "author": "orangefactor@bots.tld", "id": 11297452, "time": "2016-04-04T01:01:58Z"}, {"text": "https://hg.mozilla.org/mozilla-central/rev/bf1bd53f98ad", "author": "ryanvm@gmail.com", "id": 11297666, "time": "2016-04-04T01:44:09Z"}, {"text": "7 automation job failures were associated with this bug in the last 7 days.\n\nRepository breakdown:\n* mozilla-inbound: 2\n* fx-team: 2\n* autoland: 2\n* mozilla-central: 1\n\nPlatform breakdown:\n* linux64: 4\n* linux32: 3\n\nFor more details, see:\nhttps://brasstacks.mozilla.com/orangefactor/?display=Bug&bugid=1260714&startday=2016-07-25&endday=2016-07-31&tree=all", "author": "orangefactor@bots.tld", "id": 11588199, "time": "2016-08-01T01:08:21Z"}, {"text": "12 automation job failures were associated with this bug in the last 7 days.\n\nRepository breakdown:\n* mozilla-inbound: 9\n* autoland: 3\n\nPlatform breakdown:\n* linux64: 6\n* linux32: 6\n\nFor more details, see:\nhttps://brasstacks.mozilla.com/orangefactor/?display=Bug&bugid=1260714&startday=2016-08-01&endday=2016-08-07&tree=all", "author": "orangefactor@bots.tld", "id": 11605714, "time": "2016-08-08T01:10:41Z"}, {"text": "6 automation job failures were associated with this bug in the last 7 days.\n\nRepository breakdown:\n* mozilla-inbound: 4\n* fx-team: 1\n* autoland: 1\n\nPlatform breakdown:\n* linux32: 5\n* linux64: 1\n\nFor more details, see:\nhttps://brasstacks.mozilla.com/orangefactor/?display=Bug&bugid=1260714&startday=2016-08-15&endday=2016-08-21&tree=all", "author": "orangefactor@bots.tld", "id": 11643015, "time": "2016-08-22T01:10:29Z"}, {"text": "6 automation job failures were associated with this bug in the last 7 days.\n\nRepository breakdown:\n* autoland: 3\n* mozilla-central: 2\n* mozilla-inbound: 1\n\nPlatform breakdown:\n* linux32: 6\n\nFor more details, see:\nhttps://brasstacks.mozilla.com/orangefactor/?display=Bug&bugid=1260714&startday=2016-08-29&endday=2016-09-04&tree=all", "author": "orangefactor@bots.tld", "id": 11685383, "time": "2016-09-05T01:11:31Z"}, {"text": "6 automation job failures were associated with this bug in the last 7 days.\n\nRepository breakdown:\n* autoland: 3\n* mozilla-inbound: 2\n* mozilla-central: 1\n\nPlatform breakdown:\n* linux32: 6\n\nFor more details, see:\nhttps://brasstacks.mozilla.com/orangefactor/?display=Bug&bugid=1260714&startday=2016-09-05&endday=2016-09-11&tree=all", "author": "orangefactor@bots.tld", "id": 11701815, "time": "2016-09-12T01:08:28Z"}, {"text": "10 automation job failures were associated with this bug in the last 7 days.\n\nRepository breakdown:\n* mozilla-inbound: 5\n* autoland: 4\n* mozilla-central: 1\n\nPlatform breakdown:\n* linux32: 10\n\nFor more details, see:\nhttps://brasstacks.mozilla.com/orangefactor/?display=Bug&bugid=1260714&startday=2016-11-07&endday=2016-11-13&tree=all", "author": "orangefactor@bots.tld", "id": 11856254, "time": "2016-11-14T01:02:05Z"}], "id": 1260714, "priority": "P3", "mentors_detail": [{"email": "jdescottes@mozilla.com", "id": 559949, "name": "jdescottes@mozilla.com", "real_name": "Julian Descottes [:jdescottes][:julian]"}], "cf_crash_signature": "", "version": "unspecified", "cf_qa_whiteboard": "", "cf_tracking_firefox_esr52": "---", "cf_tracking_firefox59": "---", "last_change_time": "2016-11-14T01:02:05Z", "cf_platform_rel": "---", "product": "Firefox", "cf_status_firefox_esr52": "---", "blocks": [], "qa_contact": "", "see_also": [], "cf_fx_iteration": "---", "component": "Developer Tools: Inspector", "votes": 0, "cf_status_firefox48": "fixed", "groups": [], "cf_status_firefox60": "---", "target_milestone": "Firefox 48", "is_cc_accessible": true, "url": "https://treeherder.mozilla.org/logviewer.html#?job_id=8306037&repo=fx-team", "creator_detail": {"email": "cbook@mozilla.com", "id": 277293, "name": "cbook@mozilla.com", "real_name": "Carsten Book [:Tomcat]"}, "whiteboard": "", "mentors": ["jdescottes@mozilla.com"], "cc_detail": [{"email": "jdescottes@mozilla.com", "id": 559949, "name": "jdescottes@mozilla.com", "real_name": "Julian Descottes [:jdescottes][:julian]"}, {"email": "nchevobbe@mozilla.com", "id": 557153, "name": "nchevobbe@mozilla.com", "real_name": "Nicolas Chevobbe [:nchevobbe]"}, {"email": "pbrosset@mozilla.com", "id": 478661, "name": "pbrosset@mozilla.com", "real_name": "Patrick Brosset <:pbro>"}], "cf_has_str": "---", "alias": null, "dupe_of": null, "flags": [], "cf_tracking_firefox58": "---", "cf_rank": null, "is_open": false, "resolution": "FIXED", "op_sys": "Unspecified", "cf_fx_points": "---", "history": [{"changes": [{"removed": "--", "field_name": "priority", "added": "P3"}, {"removed": "", "field_name": "cc", "added": "pbrosset@mozilla.com"}], "who": "pbrosset@mozilla.com", "when": "2016-03-31T12:35:01Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "chevobbe.nicolas@gmail.com"}, {"removed": "nobody@mozilla.org", "field_name": "assigned_to", "added": "chevobbe.nicolas@gmail.com"}], "who": "nchevobbe@mozilla.com", "when": "2016-03-31T13:49:13Z"}, {"changes": [{"removed": "NEW", "field_name": "status", "added": "ASSIGNED"}], "who": "nchevobbe@mozilla.com", "when": "2016-03-31T15:21:20Z"}, {"changes": [{"removed": "", "field_name": "cc", "added": "jdescottes@mozilla.com"}, {"removed": "", "field_name": "bug_mentor", "added": "jdescottes@mozilla.com"}], "who": "jdescottes@mozilla.com", "when": "2016-04-01T09:17:00Z"}, {"changes": [{"removed": "", "field_name": "flagtypes.name", "added": "needinfo?(jdescottes@mozilla.com)"}], "who": "nchevobbe@mozilla.com", "when": "2016-04-01T10:52:46Z"}, {"changes": [{"removed": "needinfo?(jdescottes@mozilla.com)", "field_name": "flagtypes.name", "added": ""}], "who": "jdescottes@mozilla.com", "when": "2016-04-01T12:34:40Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "", "attachment_id": 8737404, "added": "review?(jdescottes@mozilla.com)"}], "who": "nchevobbe@mozilla.com", "when": "2016-04-01T23:01:07Z"}, {"changes": [{"field_name": "flagtypes.name", "removed": "review?(jdescottes@mozilla.com)", "attachment_id": 8737404, "added": "review+"}], "who": "jdescottes@mozilla.com", "when": "2016-04-01T23:17:56Z"}, {"changes": [{"removed": "", "field_name": "keywords", "added": "checkin-needed"}], "who": "nchevobbe@mozilla.com", "when": "2016-04-02T09:08:22Z"}, {"changes": [{"removed": "checkin-needed", "field_name": "keywords", "added": ""}], "who": "pulsebot@bots.tld", "when": "2016-04-02T15:53:52Z"}, {"changes": [{"removed": "ASSIGNED", "field_name": "status", "added": "RESOLVED"}, {"removed": "", "field_name": "resolution", "added": "FIXED"}, {"removed": "---", "field_name": "target_milestone", "added": "Firefox 48"}, {"removed": "", "field_name": "cf_last_resolved", "added": "2016-04-03 18:44:09"}, {"removed": "---", "field_name": "cf_status_firefox48", "added": "fixed"}], "who": "ryanvm@gmail.com", "when": "2016-04-04T01:44:09Z"}]}